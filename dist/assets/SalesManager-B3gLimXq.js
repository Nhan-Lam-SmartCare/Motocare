const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-Y4_AZb1T.js","assets/index-BUHS2GnV.css"])))=>i.map(i=>d[i]);
import{c as Ve,r,u as Mt,a as Pt,b as Lt,d as ts,e as ss,s as j,f as Dt,j as e,B as Ke,S as st,g as c,h as rt,R as It,i as lt,k as St,_ as gt,l as zt}from"./index-Y4_AZb1T.js";import{c as as}from"./permissions-C90GyMnD.js";import{P as rs,p as Tt}from"./print-CQTfDhTr.js";import{P as At,X as Bt}from"./Icons-CZ4PC3V7.js";import{u as ls,a as ns}from"./useDebtsRepository-Cema-8BA.js";import{H as ds}from"./history-Y19nDx2o.js";import{B as _t}from"./banknote-BudHhkvm.js";/**
 * @license lucide-react v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const os=Ve("CalendarDays",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M8 18h.01",key:"lrp35t"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M16 18h.01",key:"kzsmim"}]]);/**
 * @license lucide-react v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qt=Ve("CreditCard",[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]]);/**
 * @license lucide-react v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const is=Ve("MapPin",[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]);/**
 * @license lucide-react v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cs=Ve("Receipt",[["path",{d:"M4 2v20l2-1 2 1 2-1 2 1 2-1 2 1 2-1 2 1V2l-2 1-2-1-2 1-2-1-2 1-2-1-2 1Z",key:"q3az6g"}],["path",{d:"M16 8h-6a2 2 0 1 0 0 4h4a2 2 0 1 1 0 4H8",key:"1h4pet"}],["path",{d:"M12 17.5v-11",key:"1jc1ny"}]]);/**
 * @license lucide-react v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xs=Ve("ScanLine",[["path",{d:"M3 7V5a2 2 0 0 1 2-2h2",key:"aa7l1z"}],["path",{d:"M17 3h2a2 2 0 0 1 2 2v2",key:"4qcy5o"}],["path",{d:"M21 17v2a2 2 0 0 1-2 2h-2",key:"6vwrx8"}],["path",{d:"M7 21H5a2 2 0 0 1-2-2v-2",key:"ioqczr"}],["path",{d:"M7 12h10",key:"b7w52i"}]]);function ms(A,_,n=5){return r.useMemo(()=>{const L=Array.isArray(A)?A:[],q=_||"",J=L.filter(G=>{var ae;return(((ae=G.stock)==null?void 0:ae[q])??0)<=0}),x=L.filter(G=>{var S;const ae=((S=G.stock)==null?void 0:S[q])??0;return ae>0&&ae<=n});return{lowStock:x,outOfStock:J,lowStockCount:x.length,outOfStockCount:J.length}},[A,_,n])}const at=5,hs=({isOpen:A,onClose:_,sale:n,onPrint:L})=>{if(!A||!n)return null;const q=n.items.reduce((x,G)=>x+G.quantity*G.sellingPrice,0),J=q-n.total;return e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-[60] p-4",children:e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-lg w-full max-w-2xl max-h-[90vh] overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"flex justify-between items-center p-6 border-b border-slate-200 dark:border-slate-700",children:[e.jsx("h2",{className:"text-xl font-bold text-slate-900 dark:text-slate-100",children:"Chi ti·∫øt ƒë∆°n h√†ng"}),e.jsx("button",{onClick:_,className:"text-slate-500 hover:text-slate-700 dark:hover:text-slate-300 text-2xl",children:"√ó"})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-6 space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-slate-500 dark:text-slate-400",children:"M√£ ƒë∆°n h√†ng"}),e.jsx("div",{className:"text-base font-semibold text-slate-900 dark:text-slate-100",children:n.sale_code||lt(n.id)||n.id})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-slate-500 dark:text-slate-400",children:"Ng√†y t·∫°o"}),e.jsxs("div",{className:"text-base font-semibold text-slate-900 dark:text-slate-100",children:[rt(new Date(n.date),!1)," ",new Date(n.date).toLocaleTimeString("vi-VN",{hour:"2-digit",minute:"2-digit"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-slate-500 dark:text-slate-400",children:"Kh√°ch h√†ng"}),e.jsx("div",{className:"text-base font-semibold text-slate-900 dark:text-slate-100",children:n.customer.name}),n.customer.phone&&e.jsx("div",{className:"text-sm text-slate-500",children:n.customer.phone})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-slate-500 dark:text-slate-400",children:"Nh√¢n vi√™n b√°n h√†ng"}),e.jsx("div",{className:"text-base font-semibold text-slate-900 dark:text-slate-100",children:n.username||n.userName||"N/A"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-slate-500 dark:text-slate-400",children:"Ph∆∞∆°ng th·ª©c thanh to√°n"}),e.jsx("div",{className:"text-base font-semibold text-slate-900 dark:text-slate-100",children:n.paymentMethod==="cash"?"Ti·ªÅn m·∫∑t":"Chuy·ªÉn kho·∫£n"})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-slate-900 dark:text-slate-100 mb-3",children:"S·∫£n ph·∫©m"}),e.jsx("div",{className:"border border-slate-200 dark:border-slate-700 rounded-lg overflow-hidden",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-slate-50 dark:bg-slate-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left px-4 py-3 text-xs font-medium text-slate-500 dark:text-slate-400 uppercase",children:"T√™n s·∫£n ph·∫©m"}),e.jsx("th",{className:"text-right px-4 py-3 text-xs font-medium text-slate-500 dark:text-slate-400 uppercase",children:"SL"}),e.jsx("th",{className:"text-right px-4 py-3 text-xs font-medium text-slate-500 dark:text-slate-400 uppercase",children:"ƒê∆°n gi√°"}),e.jsx("th",{className:"text-right px-4 py-3 text-xs font-medium text-slate-500 dark:text-slate-400 uppercase",children:"Th√†nh ti·ªÅn"})]})}),e.jsx("tbody",{className:"bg-white dark:bg-slate-800 divide-y divide-slate-200 dark:divide-slate-700",children:n.items.map((x,G)=>e.jsxs("tr",{children:[e.jsxs("td",{className:"px-4 py-3 text-sm text-slate-900 dark:text-slate-100",children:[x.partName,x.sku&&e.jsxs("div",{className:"text-xs text-slate-500",children:["SKU: ",x.sku]})]}),e.jsx("td",{className:"px-4 py-3 text-sm text-right text-slate-900 dark:text-slate-100",children:x.quantity}),e.jsx("td",{className:"px-4 py-3 text-sm text-right text-slate-900 dark:text-slate-100",children:c(x.sellingPrice)}),e.jsx("td",{className:"px-4 py-3 text-sm text-right font-semibold text-slate-900 dark:text-slate-100",children:c(x.quantity*x.sellingPrice)})]},G))})]})})]}),e.jsx("div",{className:"border-t border-slate-200 dark:border-slate-700 pt-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-slate-600 dark:text-slate-400",children:"T·∫°m t√≠nh:"}),e.jsx("span",{className:"font-semibold text-slate-900 dark:text-slate-100",children:c(q)})]}),J>0&&e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-slate-600 dark:text-slate-400",children:"Gi·∫£m gi√°:"}),e.jsxs("span",{className:"font-semibold text-red-600 dark:text-red-400",children:["-",c(J)]})]}),e.jsxs("div",{className:"flex justify-between text-lg font-bold border-t border-slate-200 dark:border-slate-700 pt-2",children:[e.jsx("span",{className:"text-slate-900 dark:text-slate-100",children:"T·ªïng c·ªông:"}),e.jsx("span",{className:"text-green-600 dark:text-green-400",children:c(n.total)})]})]})})]}),e.jsxs("div",{className:"flex justify-end gap-3 p-6 border-t border-slate-200 dark:border-slate-700",children:[e.jsx("button",{onClick:_,className:"px-4 py-2 border border-slate-300 dark:border-slate-600 rounded-lg text-slate-700 dark:text-slate-300 hover:bg-slate-50 dark:hover:bg-slate-700 transition-colors",children:"ƒê√≥ng"}),e.jsxs("button",{onClick:()=>{L(n),_()},className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors flex items-center gap-2",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z"})}),"In h√≥a ƒë∆°n"]})]})]})})},us=({isOpen:A,onClose:_,sale:n,onSave:L})=>{const{customers:q,upsertCustomer:J}=Mt(),{data:x=[]}=Lt(),G=Pt(),{profile:ae}=Dt(),[S,Y]=r.useState([]),[ee,ge]=r.useState({id:"",name:"",phone:""}),[be,Ne]=r.useState("cash"),[_e,U]=r.useState(0),[re,qe]=r.useState(""),[le,we]=r.useState(!1),[Oe,Ce]=r.useState(!1),[pe,Se]=r.useState(""),[Te,fe]=r.useState(""),[V,ne]=r.useState(""),[O,ke]=r.useState(!1);if(r.useEffect(()=>{n&&(Y([...n.items]),ge({id:n.customer.id||"",name:n.customer.name,phone:n.customer.phone||""}),ne(n.customer.name),Ne(n.paymentMethod),U(n.discount||0))},[n]),!A||!n)return null;const y=S.reduce((l,f)=>l+f.quantity*f.sellingPrice,0),je=y-_e,W=x.filter(l=>l.name.toLowerCase().includes(re.toLowerCase())||l.sku.toLowerCase().includes(re.toLowerCase())),X=q.filter(l=>l.name.toLowerCase().includes(V.toLowerCase())),Me=l=>{const f=typeof l.stock=="object"?l.stock[n.branchId]||0:l.stock,T=typeof l.retailPrice=="object"?l.retailPrice[n.branchId]||0:l.retailPrice||0,s=S.find(i=>i.partId===l.id);Y(s?S.map(i=>i.partId===l.id?{...i,quantity:i.quantity+1}:i):[...S,{partId:l.id,partName:l.name,sku:l.sku,quantity:1,sellingPrice:T,stockSnapshot:typeof f=="number"?f:0}]),qe(""),we(!1)},u=l=>{ge({id:l.id,name:l.name,phone:l.phone||""}),ne(l.name),ke(!1)},Fe=async()=>{if(!pe.trim()){j.error("Vui l√≤ng nh·∫≠p t√™n kh√°ch h√†ng");return}try{const l={id:crypto.randomUUID(),name:pe,phone:Te||void 0,email:"",created_at:new Date().toISOString()};await J(l),ge({id:l.id,name:l.name,phone:l.phone||""}),ne(l.name),Ce(!1),Se(""),fe(""),j.success("Th√™m kh√°ch h√†ng th√†nh c√¥ng")}catch(l){console.error("Error adding customer:",l),j.error("L·ªói khi th√™m kh√°ch h√†ng")}},Pe=(l,f)=>{f<=0?Y(S.filter(T=>T.partId!==l)):Y(S.map(T=>T.partId===l?{...T,quantity:f}:T))},Le=(l,f)=>{Y(S.map(T=>T.partId===l?{...T,sellingPrice:f}:T))},Q=l=>{Y(S.filter(f=>f.partId!==l))},de=async()=>{if(S.length===0){j.error("Vui l√≤ng c√≥ √≠t nh·∫•t m·ªôt s·∫£n ph·∫©m");return}if(!ee.name){j.error("Vui l√≤ng nh·∫≠p t√™n kh√°ch h√†ng");return}try{await L({id:n.id,items:S,customer:ee,paymentMethod:be,discount:_e}),G.invalidateQueries({queryKey:["salesRepoPaged"]}),_()}catch(l){console.error("Error saving sale:",l)}};return e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-[60] p-4",children:e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-lg w-full max-w-2xl max-h-[95vh] overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"flex justify-between items-center p-4 border-b border-slate-200 dark:border-slate-700",children:[e.jsxs("h2",{className:"text-lg font-bold text-slate-900 dark:text-slate-100",children:["‚úèÔ∏è [Ch·ªânh s·ª≠a] ƒê∆°n Xu·∫•t B√°n ",n.sale_code||lt(n.id)]}),e.jsx("button",{onClick:_,className:"text-slate-500 hover:text-slate-700 dark:hover:text-slate-300 text-2xl leading-none",children:"√ó"})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:"Th·ªùi gian b√°n h√†ng:"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"text",value:rt(new Date(n.date),!1),disabled:!0,className:"flex-1 px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-slate-50 dark:bg-slate-700 text-slate-900 dark:text-slate-100"}),e.jsx("input",{type:"text",value:new Date(n.date).toLocaleTimeString("vi-VN",{hour:"2-digit",minute:"2-digit"}),disabled:!0,className:"w-24 px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-slate-50 dark:bg-slate-700 text-slate-900 dark:text-slate-100 text-center"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:"Kh√°ch h√†ng: ‚ÑπÔ∏è"}),Oe?e.jsxs("div",{className:"border border-slate-300 dark:border-slate-600 rounded-lg p-3 space-y-2",children:[e.jsx("input",{type:"text",value:pe,onChange:l=>Se(l.target.value),placeholder:"T√™n kh√°ch h√†ng",className:"w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100"}),e.jsx("input",{type:"tel",value:Te,onChange:l=>fe(l.target.value),placeholder:"S·ªë ƒëi·ªán tho·∫°i (t√πy ch·ªçn)",className:"w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:Fe,className:"flex-1 px-3 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"L∆∞u"}),e.jsx("button",{onClick:()=>{Ce(!1),Se(""),fe("")},className:"px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg text-slate-700 dark:text-slate-300",children:"H·ªßy"})]})]}):e.jsx(e.Fragment,{children:e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx("input",{type:"text",value:V,onChange:l=>{ne(l.target.value),ke(!0)},onFocus:()=>ke(!0),placeholder:"T√¨m ki·∫øm v√† ch·ªçn m·ªôt kh√°ch h√†ng",className:"w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100"}),O&&X.length>0&&e.jsx("div",{className:"absolute top-full left-0 right-0 mt-1 bg-white dark:bg-slate-700 border border-slate-300 dark:border-slate-600 rounded-lg shadow-lg max-h-48 overflow-y-auto z-10",children:X.slice(0,10).map(l=>e.jsxs("button",{onClick:()=>u(l),className:"w-full px-3 py-2 text-left hover:bg-slate-100 dark:hover:bg-slate-600 text-sm",children:[e.jsx("div",{className:"font-medium text-slate-900 dark:text-slate-100",children:l.name}),l.phone&&e.jsx("div",{className:"text-xs text-slate-500",children:l.phone})]},l.id))})]}),e.jsxs("button",{onClick:()=>Ce(!0),className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors flex items-center gap-2",children:[e.jsx(At,{className:"w-4 h-4"}),"Th√™m m·ªõi"]})]})})]}),e.jsxs("div",{children:[e.jsx("div",{className:"flex items-center justify-between mb-2",children:e.jsx("label",{className:"text-sm font-medium text-slate-700 dark:text-slate-300",children:"Chi ti·∫øt s·∫£n ph·∫©m:"})}),e.jsxs("div",{className:"relative mb-3",children:[e.jsx("input",{type:"text",value:re,onChange:l=>{qe(l.target.value),we(!0)},onFocus:()=>we(!0),placeholder:"T√¨m ki·∫øm v√† th√™m s·∫£n ph·∫©m...",className:"w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100"}),le&&re&&W.length>0&&e.jsx("div",{className:"absolute top-full left-0 right-0 mt-1 bg-white dark:bg-slate-700 border border-slate-300 dark:border-slate-600 rounded-lg shadow-lg max-h-60 overflow-y-auto z-10",children:W.slice(0,10).map(l=>e.jsxs("button",{onClick:()=>Me(l),className:"w-full px-3 py-2 text-left hover:bg-slate-100 dark:hover:bg-slate-600 text-sm",children:[e.jsx("div",{className:"font-medium text-slate-900 dark:text-slate-100",children:l.name}),e.jsxs("div",{className:"text-xs text-slate-500",children:["SKU: ",l.sku]})]},l.id))})]}),e.jsx("div",{className:"border border-slate-200 dark:border-slate-700 rounded-lg overflow-hidden",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-slate-50 dark:bg-slate-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-center px-2 py-2 text-xs font-medium text-slate-500 dark:text-slate-400 w-8",children:"-"}),e.jsx("th",{className:"text-left px-3 py-2 text-xs font-medium text-slate-500 dark:text-slate-400",children:"T√™n"}),e.jsx("th",{className:"text-center px-3 py-2 text-xs font-medium text-slate-500 dark:text-slate-400 w-20",children:"SL"}),e.jsx("th",{className:"text-right px-3 py-2 text-xs font-medium text-slate-500 dark:text-slate-400 w-24",children:"ƒê∆°n gi√°"}),e.jsx("th",{className:"text-right px-3 py-2 text-xs font-medium text-slate-500 dark:text-slate-400 w-28",children:"Th√†nh ti·ªÅn"}),e.jsx("th",{className:"w-10"})]})}),e.jsx("tbody",{className:"bg-white dark:bg-slate-800 divide-y divide-slate-200 dark:divide-slate-700",children:S.map((l,f)=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-2 py-2 text-center text-sm text-slate-900 dark:text-slate-100",children:f+1}),e.jsxs("td",{className:"px-3 py-2 text-sm",children:[e.jsx("div",{className:"font-medium text-slate-900 dark:text-slate-100",children:l.partName}),e.jsx("div",{className:"text-xs text-slate-500",children:l.sku})]}),e.jsx("td",{className:"px-3 py-2",children:e.jsx("input",{type:"number",value:l.quantity,onChange:T=>Pe(l.partId,parseInt(T.target.value)||0),min:"1",className:"w-full px-2 py-1 border border-slate-300 dark:border-slate-600 rounded text-center text-sm bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100"})}),e.jsx("td",{className:"px-3 py-2",children:e.jsx("input",{type:"number",value:l.sellingPrice,onChange:T=>Le(l.partId,parseFloat(T.target.value)||0),min:"0",step:"1000",className:"w-full px-2 py-1 border border-slate-300 dark:border-slate-600 rounded text-right text-sm bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100"})}),e.jsx("td",{className:"px-3 py-2 text-right text-sm font-semibold text-slate-900 dark:text-slate-100",children:c(l.quantity*l.sellingPrice)}),e.jsx("td",{className:"px-2 py-2 text-center",children:e.jsx("button",{onClick:()=>Q(l.partId),className:"text-slate-400 hover:text-red-600 transition-colors",children:e.jsx(Bt,{className:"w-5 h-5"})})})]},l.partId))})]})}),S.length===0&&e.jsx("div",{className:"text-center py-8 text-slate-400 text-sm",children:"Ch∆∞a c√≥ s·∫£n ph·∫©m n√†o"}),S.length>0&&e.jsxs("div",{className:"mt-2 text-right",children:[e.jsx("div",{className:"text-sm text-slate-600 dark:text-slate-400",children:"T·ªîNG:"}),e.jsx("div",{className:"text-lg font-bold text-slate-900 dark:text-slate-100",children:c(y)})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:"Ch·ªçn nh√¢n vi√™n b√°n h√†ng"}),e.jsx("select",{disabled:!0,className:"w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-slate-50 dark:bg-slate-700 text-slate-900 dark:text-slate-100",children:e.jsx("option",{children:n.username||n.userName})})]}),e.jsxs("div",{className:"border-t border-slate-200 dark:border-slate-700 pt-4",children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:"C√¥ng n·ª£:"}),e.jsx("div",{className:"text-sm text-slate-600 dark:text-slate-400 mb-3",children:"Kh√°ch h√†ng ph·∫£i thanh to√°n"}),e.jsxs("div",{className:"bg-green-50 dark:bg-green-900/20 rounded-lg p-3 mb-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium text-green-700 dark:text-green-400",children:"T·ªîNG PH·∫¢I THU:"}),e.jsx("span",{className:"text-lg font-bold text-green-700 dark:text-green-400",children:c(je)})]}),e.jsxs("div",{className:"mt-2 flex items-center gap-2 text-xs text-green-600 dark:text-green-400",children:[e.jsx("input",{type:"checkbox",checked:!0,readOnly:!0}),e.jsx("span",{children:"ƒê√£ thanh to√°n ƒë·ªß"})]})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"block text-xs text-slate-500 dark:text-slate-400 mb-2",children:"- Th·ªùi gian Ng∆∞·ªùi thu - Ghi ch√∫"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>Ne("cash"),className:`flex-1 py-2 rounded-lg border transition-colors text-sm font-medium ${be==="cash"?"bg-green-600 text-white border-green-600":"border-slate-300 dark:border-slate-600 text-slate-700 dark:text-slate-300 hover:bg-slate-50 dark:hover:bg-slate-700"}`,children:"Ti·ªÅn m·∫∑t"}),e.jsx("button",{onClick:()=>Ne("bank"),className:`flex-1 py-2 rounded-lg border transition-colors text-sm font-medium ${be==="bank"?"bg-blue-600 text-white border-blue-600":"border-slate-300 dark:border-slate-600 text-slate-700 dark:text-slate-300 hover:bg-slate-50 dark:hover:bg-slate-700"}`,children:"Chuy·ªÉn kho·∫£n"})]})]}),e.jsx("div",{className:"border border-slate-200 dark:border-slate-700 rounded-lg overflow-hidden",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-slate-50 dark:bg-slate-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-center px-2 py-2 text-xs font-medium text-slate-500 dark:text-slate-400",children:"-"}),e.jsx("th",{className:"text-left px-3 py-2 text-xs font-medium text-slate-500 dark:text-slate-400",children:"Th·ªùi gian"}),e.jsx("th",{className:"text-left px-3 py-2 text-xs font-medium text-slate-500 dark:text-slate-400",children:"Ng∆∞·ªùi thu - Ghi ch√∫"}),e.jsx("th",{className:"text-right px-3 py-2 text-xs font-medium text-slate-500 dark:text-slate-400",children:"S·ªë ti·ªÅn"}),e.jsx("th",{className:"w-10"})]})}),e.jsx("tbody",{className:"bg-white dark:bg-slate-800",children:e.jsxs("tr",{children:[e.jsx("td",{className:"px-2 py-2 text-center text-slate-900 dark:text-slate-100",children:"1"}),e.jsxs("td",{className:"px-3 py-2",children:[e.jsxs("div",{className:"text-slate-900 dark:text-slate-100",children:[new Date(n.date).toLocaleTimeString("vi-VN",{hour:"2-digit",minute:"2-digit"})," ",rt(new Date(n.date),!1)]}),e.jsx("div",{className:"text-xs text-slate-500",children:"(Ti·ªÅn m·∫∑t)"})]}),e.jsx("td",{className:"px-3 py-2 text-slate-900 dark:text-slate-100",children:n.username||n.userName}),e.jsx("td",{className:"px-3 py-2 text-right text-slate-900 dark:text-slate-100",children:c(je)}),e.jsx("td",{})]})})]})}),e.jsxs("div",{className:"mt-2 text-right",children:[e.jsx("div",{className:"text-sm text-slate-600 dark:text-slate-400",children:"T·ªïng ƒë√£ thu"}),e.jsx("div",{className:"text-xl font-bold text-slate-900 dark:text-slate-100",children:c(je)})]})]})]}),e.jsxs("div",{className:"flex items-center justify-end gap-3 p-4 border-t border-slate-200 dark:border-slate-700 bg-slate-50 dark:bg-slate-700",children:[e.jsx("button",{onClick:_,className:"px-6 py-2 border border-slate-300 dark:border-slate-600 rounded-lg text-slate-700 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-slate-600 transition-colors font-medium",children:"ƒê√ìNG"}),e.jsx("button",{onClick:de,disabled:S.length===0,className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed font-semibold",children:"L∆ØU"})]})]})})},gs=({isOpen:A,onClose:_,sales:n,currentBranchId:L,onPrintReceipt:q,onEditSale:J,onDeleteSale:x,page:G,totalPages:ae,total:S,hasMore:Y,pageSize:ee,onPrevPage:ge,onNextPage:be,onPageSizeChange:Ne,search:_e,onSearchChange:U,fromDate:re,toDate:qe,onDateRangeChange:le,status:we="all",onStatusChange:Oe,paymentMethodFilter:Ce="all",onPaymentMethodFilterChange:pe,keysetMode:Se=!1,onToggleKeyset:Te,customerDebts:fe=[]})=>{const[V,ne]=r.useState("7days"),[O,ke]=r.useState(""),[y,je]=r.useState(""),[W,X]=r.useState(""),[Me,u]=r.useState(null),[Fe,Pe]=r.useState(!1),[Le,Q]=r.useState(!1),[de,l]=r.useState(null);r.useEffect(()=>{const s=new Date,i=new Date(s.getFullYear(),s.getMonth(),s.getDate()),D=new Date(s.getFullYear(),s.getMonth(),s.getDate(),23,59,59,999);let I,z;switch(V){case"today":I=i,z=D;break;case"week":{const g=s.getDay(),K=g===0?-6:1-g,N=new Date(s);N.setDate(s.getDate()+K),I=new Date(N.getFullYear(),N.getMonth(),N.getDate()),z=D;break}case"month":{I=new Date(s.getFullYear(),s.getMonth(),1),z=D;break}case"7days":{const g=new Date(s);g.setDate(g.getDate()-6),I=new Date(g.getFullYear(),g.getMonth(),g.getDate()),z=D;break}case"30days":{const g=new Date(s);g.setDate(g.getDate()-29),I=new Date(g.getFullYear(),g.getMonth(),g.getDate()),z=D;break}case"custom":{y&&W&&(I=new Date(y),z=new Date(W+"T23:59:59"));break}case"all":I=void 0,z=void 0;break}le(I?I.toISOString():void 0,z?z.toISOString():void 0)},[V,y,W,le]);const f=r.useMemo(()=>{let s=n.filter(i=>i.branchId===L||i.branchid===L);return O&&(s=s.filter(i=>i.id.toLowerCase().includes(O.toLowerCase())||(i.sale_code||"").toLowerCase().includes(O.toLowerCase())||i.customer.name.toLowerCase().includes(O.toLowerCase())||(i.username||i.userName||"").toLowerCase().includes(O.toLowerCase()))),s.sort((i,D)=>new Date(D.date).getTime()-new Date(i.date).getTime()),s},[n,L,O]),T=r.useMemo(()=>f.reduce((s,i)=>s+i.total,0),[f]);return r.useEffect(()=>{const s=i=>{i.target.closest(".dropdown-menu-container")||l(null)};if(de)return document.addEventListener("mousedown",s),()=>document.removeEventListener("mousedown",s)},[de]),A?e.jsxs(It.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-black/60 z-50 flex md:items-center md:justify-center items-end justify-center p-0 md:p-4",children:e.jsxs("div",{className:"bg-white dark:bg-slate-800 w-full md:max-w-7xl max-h-[95vh] md:rounded-2xl rounded-t-3xl shadow-2xl overflow-hidden flex flex-col animate-slide-up-bottom",children:[e.jsxs("div",{className:"p-4 border-b border-slate-200 dark:border-slate-700 bg-white/95 dark:bg-slate-900/70 backdrop-blur",children:[e.jsxs("div",{className:"flex items-start justify-between gap-3 mb-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase tracking-wide text-slate-400 dark:text-slate-500",children:"L·ªãch s·ª≠ b√°n h√†ng"}),e.jsx("p",{className:"text-lg font-semibold text-slate-900 dark:text-white",children:"Theo d√µi giao d·ªãch g·∫ßn ƒë√¢y"})]}),e.jsx("button",{onClick:_,className:"text-slate-500 hover:text-slate-900 dark:hover:text-white text-2xl leading-none px-2","aria-label":"ƒê√≥ng l·ªãch s·ª≠ b√°n h√†ng",children:"√ó"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex gap-2 overflow-x-auto pb-1 -mx-4 px-4 md:mx-0 md:px-0 scrollbar-thin",children:[{key:"7days",label:"7 ng√†y qua"},{key:"week",label:"Tu·∫ßn"},{key:"month",label:"Th√°ng"},{key:"30days",label:"30 ng√†y qua"},{key:"custom",label:"T√πy ch·ªçn"},{key:"all",label:"T·∫•t c·∫£"}].map(s=>e.jsx("button",{onClick:()=>ne(s.key),className:`px-4 py-2 rounded-2xl text-sm font-medium whitespace-nowrap border transition-all min-w-[96px] ${V===s.key?"bg-blue-600 text-white border-blue-600 shadow-lg shadow-blue-500/30":"bg-slate-100 dark:bg-slate-800/80 text-slate-700 dark:text-slate-200 border-transparent"}`,children:s.label},s.key))}),e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center gap-3",children:[e.jsxs("div",{className:"w-full md:flex-1 relative",children:[e.jsx("input",{type:"text",value:O,onChange:s=>ke(s.target.value),placeholder:"T√¨m h√≥a ƒë∆°n, kh√°ch h√†ng ho·∫∑c m√£ phi·∫øu",className:"w-full pl-10 pr-4 py-2.5 rounded-xl border border-slate-200 dark:border-slate-600 bg-slate-50 dark:bg-slate-800 text-sm text-slate-900 dark:text-slate-100 focus:ring-2 focus:ring-blue-500"}),e.jsxs("svg",{className:"w-5 h-5 text-slate-400 absolute left-3 top-1/2 -translate-y-1/2",fill:"none",stroke:"currentColor",strokeWidth:"1.5",viewBox:"0 0 24 24",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M11 19a8 8 0 100-16 8 8 0 000 16z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 21l-4.3-4.3"})]})]}),e.jsx("div",{className:"flex items-center justify-between md:justify-end gap-4 w-full md:w-auto",children:e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-xs text-slate-500 dark:text-slate-400",children:"T·ªïng doanh thu"}),e.jsx("div",{className:"text-xl font-bold text-green-600 dark:text-green-400",children:c(T)})]})})]}),V==="custom"&&e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center gap-3",children:[e.jsxs("label",{className:"text-sm text-slate-600 dark:text-slate-400 flex items-center gap-2",children:["T·ª´",e.jsx("input",{type:"date",value:y,onChange:s=>je(s.target.value),className:"px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-800 text-slate-900 dark:text-slate-100 text-sm"})]}),e.jsxs("label",{className:"text-sm text-slate-600 dark:text-slate-400 flex items-center gap-2",children:["ƒê·∫øn",e.jsx("input",{type:"date",value:W,onChange:s=>X(s.target.value),className:"px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-800 text-slate-900 dark:text-slate-100 text-sm"})]})]})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:f.length===0?e.jsx("div",{className:"text-center py-12 text-slate-400",children:"Kh√¥ng c√≥ h√≥a ƒë∆°n n√†o"}):e.jsxs("div",{children:[e.jsxs("div",{className:"hidden md:grid grid-cols-12 gap-4 px-4 py-3 bg-slate-100 dark:bg-slate-700 border-b border-slate-200 dark:border-slate-600 sticky top-0 z-10",children:[e.jsx("div",{className:"col-span-1 text-xs font-semibold text-slate-600 dark:text-slate-300"}),e.jsx("div",{className:"col-span-2 text-xs font-semibold text-slate-600 dark:text-slate-300",children:"M√£ phi·∫øu"}),e.jsx("div",{className:"col-span-2 text-xs font-semibold text-slate-600 dark:text-slate-300",children:"Kh√°ch h√†ng"}),e.jsx("div",{className:"col-span-4 text-xs font-semibold text-slate-600 dark:text-slate-300",children:"Chi ti·∫øt"}),e.jsx("div",{className:"col-span-2 text-xs font-semibold text-slate-600 dark:text-slate-300",children:"Thanh to√°n"}),e.jsx("div",{className:"col-span-1 text-xs font-semibold text-slate-600 dark:text-slate-300",children:"Thao t√°c"})]}),e.jsx("div",{className:"divide-y divide-slate-200 dark:divide-slate-700",children:f.map(s=>{var De,M,ie,Ge,Ie,F;const i=new Date(s.date);s.items.reduce((k,B)=>k+B.quantity*B.sellingPrice,0);const D=(fe||[]).find(k=>{var B;return(B=k.description)==null?void 0:B.includes(s.sale_code||s.id)}),I=D?D.totalAmount-D.remainingAmount:s.total,z=(D==null?void 0:D.remainingAmount)||0,g=z>0,N=s.items.slice(0,3),Re=s.items.length-N.length,He=i.toLocaleDateString("vi-VN",{day:"2-digit",month:"2-digit",year:"numeric"}),ve=i.toLocaleTimeString("vi-VN",{hour:"2-digit",minute:"2-digit"}),oe=(((M=(De=s.customer)==null?void 0:De.name)==null?void 0:M.charAt(0))||"K").toUpperCase(),Z=s.paymentMethod==="cash"?"Ti·ªÅn m·∫∑t":"Chuy·ªÉn kho·∫£n";return e.jsxs("div",{className:"p-4 hover:bg-slate-50 dark:hover:bg-slate-700/50 transition-colors",children:[e.jsxs("div",{className:"md:hidden flex flex-col gap-3 bg-white dark:bg-slate-800/60 rounded-2xl border border-slate-200 dark:border-slate-700 p-4 shadow-sm",children:[e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{children:[s.sale_code&&e.jsxs("div",{className:"flex items-center gap-2 text-sm font-semibold text-blue-600 dark:text-blue-300",children:[e.jsx(cs,{className:"w-4 h-4"}),s.sale_code]}),e.jsxs("div",{className:"text-xs text-slate-500 dark:text-slate-400 flex items-center gap-1 mt-1",children:[e.jsx(os,{className:"w-3.5 h-3.5"}),e.jsxs("span",{children:[He," ¬∑ ",ve]})]}),e.jsxs("div",{className:"text-xs text-slate-500 dark:text-slate-400 flex items-center gap-1 mt-1",children:[e.jsx("span",{className:"font-medium text-slate-600 dark:text-slate-300",children:"NV"}),e.jsx("span",{children:s.userName||s.username||"N/A"})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-xs text-slate-500 dark:text-slate-400",children:"T·ªïng ti·ªÅn"}),e.jsx("div",{className:"text-lg font-bold text-slate-900 dark:text-white",children:c(s.total)}),e.jsxs("div",{className:"text-xs text-slate-500 dark:text-slate-400 flex items-center gap-1 justify-end mt-1",children:[s.paymentMethod==="cash"?e.jsx(_t,{className:"w-4 h-4"}):e.jsx(qt,{className:"w-4 h-4"}),e.jsx("span",{children:Z})]})]})]}),e.jsxs("div",{className:"flex items-center gap-3 bg-slate-50 dark:bg-slate-900/30 rounded-2xl p-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-blue-100 dark:bg-blue-900/30 flex items-center justify-center text-blue-600 dark:text-blue-200 font-semibold",children:oe}),e.jsxs("div",{children:[e.jsx("div",{className:"text-base font-semibold text-slate-900 dark:text-white",children:((ie=s.customer)==null?void 0:ie.name)||"Kh√°ch v√£ng lai"}),((Ge=s.customer)==null?void 0:Ge.phone)&&e.jsxs("div",{className:"text-xs text-slate-500 dark:text-slate-400 flex items-center gap-1",children:[e.jsx("svg",{className:"w-3.5 h-3.5",fill:"none",stroke:"currentColor",strokeWidth:"1.5",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2 5.5C2 4.119 3.12 3 4.5 3h1.76c.636 0 1.197.4 1.39 1.005l.8 2.47a1.5 1.5 0 01-.35 1.46L7.11 8.94a12.044 12.044 0 005.95 5.95l1.006-1.002a1.5 1.5 0 011.46-.349l2.469.8c.606.193 1.005.754 1.005 1.39V19.5c0 1.38-1.119 2.5-2.5 2.5h-.25C8.268 22 2 15.732 2 7.75v-.25z"})}),s.customer.phone]})]})]}),e.jsxs("div",{className:"space-y-2",children:[N.map((k,B)=>e.jsxs("div",{className:"flex items-start justify-between text-sm text-slate-700 dark:text-slate-200",children:[e.jsxs("div",{children:[e.jsxs("span",{className:"font-semibold",children:[k.quantity," x ",k.partName]}),e.jsxs("div",{className:"text-xs text-slate-400",children:[c(k.sellingPrice||0)," ","/ s·∫£n ph·∫©m"]})]}),e.jsx("span",{className:"font-bold text-slate-900 dark:text-white",children:c(k.quantity*(k.sellingPrice||0))})]},B)),Re>0&&e.jsxs("div",{className:"text-xs text-slate-500 dark:text-slate-400",children:["+",Re," s·∫£n ph·∫©m kh√°c"]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[g?e.jsxs("span",{className:"inline-flex items-center gap-1 px-3 py-1 rounded-full text-xs font-semibold bg-orange-100 text-orange-700 dark:bg-orange-900/30 dark:text-orange-200",children:["‚ö†Ô∏è C√≤n n·ª£ ",c(z)]}):e.jsx("span",{className:"inline-flex items-center gap-1 px-3 py-1 rounded-full text-xs font-semibold bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-200",children:"‚úì ƒê√£ thanh to√°n"}),e.jsx("span",{className:"inline-flex items-center gap-1 px-3 py-1 rounded-full text-xs font-medium bg-slate-100 text-slate-700 dark:bg-slate-800 dark:text-slate-200",children:Z})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 pt-3 border-t border-dashed border-slate-200 dark:border-slate-700",children:[e.jsx("button",{onClick:()=>q(s),className:"flex-1 min-w-[120px] px-3 py-2 rounded-xl bg-slate-100 dark:bg-slate-800 text-slate-700 dark:text-slate-200 text-sm font-medium",children:"In ho√° ƒë∆°n"}),e.jsx("button",{onClick:()=>{u(s),Pe(!0)},className:"flex-1 min-w-[120px] px-3 py-2 rounded-xl bg-slate-100 dark:bg-slate-800 text-slate-700 dark:text-slate-200 text-sm font-medium",children:"Xem chi ti·∫øt"}),e.jsx("button",{onClick:()=>{u(s),Q(!0)},className:"flex-1 min-w-[120px] px-3 py-2 rounded-xl bg-slate-100 dark:bg-slate-800 text-slate-700 dark:text-slate-200 text-sm font-medium",children:"Ch·ªânh s·ª≠a"}),e.jsx("button",{onClick:()=>x(s.id),className:"flex-1 min-w-[120px] px-3 py-2 rounded-xl bg-red-50 dark:bg-red-900/20 text-red-600 dark:text-red-300 text-sm font-medium",children:"X√≥a ƒë∆°n"})]})]}),e.jsxs("div",{className:"hidden md:grid grid-cols-12 gap-4 items-start",children:[e.jsx("div",{className:"col-span-1 flex items-start pt-1",children:e.jsx("input",{type:"checkbox",className:"w-4 h-4 rounded border-slate-300"})}),e.jsx("div",{className:"col-span-2",children:e.jsxs("div",{className:"space-y-1",children:[s.sale_code&&e.jsx("div",{className:"text-sm font-bold text-blue-600 dark:text-blue-400",children:s.sale_code}),e.jsxs("div",{className:"text-xs text-slate-500 dark:text-slate-400",children:[i.getDate(),"/",i.getMonth()+1,"/",i.getFullYear()," ",String(i.getHours()).padStart(2,"0"),":",String(i.getMinutes()).padStart(2,"0")]}),e.jsxs("div",{className:"text-xs text-slate-600 dark:text-slate-300",children:[e.jsx("span",{className:"font-medium",children:"NV:"})," ",s.userName||s.username||"N/A"]})]})}),e.jsx("div",{className:"col-span-2",children:e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"text-sm font-semibold text-slate-900 dark:text-slate-100",children:((Ie=s.customer)==null?void 0:Ie.name)||"Kh√°ch v√£ng lai"}),((F=s.customer)==null?void 0:F.phone)&&e.jsxs("div",{className:"text-xs text-slate-500 dark:text-slate-400",children:["üìû ",s.customer.phone]})]})}),e.jsx("div",{className:"col-span-4",children:e.jsx("div",{className:"space-y-1",children:s.items.map((k,B)=>e.jsxs("div",{className:"text-xs text-slate-700 dark:text-slate-300",children:[e.jsxs("span",{className:"font-medium",children:[k.quantity," x"]})," ",k.partName,e.jsxs("span",{className:"text-slate-400 ml-1",children:["(",c(k.sellingPrice||0),")"]})," = ",e.jsx("span",{className:"font-semibold text-slate-900 dark:text-slate-100",children:c(k.quantity*(k.sellingPrice||0))})]},B))})}),e.jsx("div",{className:"col-span-2",children:e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"text-xs text-slate-600 dark:text-slate-400",children:"T·ªïng ti·ªÅn:"}),e.jsx("div",{className:"text-base font-bold text-slate-900 dark:text-slate-100",children:c(s.total)}),g?e.jsxs("div",{className:"mt-2 space-y-1",children:[e.jsxs("div",{className:"text-xs text-green-600 dark:text-green-400",children:["ƒê√£ tr·∫£: ",c(I)]}),e.jsxs("div",{className:"text-xs font-semibold text-red-600 dark:text-red-400",children:["C√≤n n·ª£: ",c(z)]}),e.jsx("div",{className:"inline-flex items-center gap-1 px-2 py-1 rounded text-xs font-medium bg-orange-100 text-orange-700 dark:bg-orange-900/30 dark:text-orange-300",children:"‚ö†Ô∏è C√≤n n·ª£"})]}):e.jsx("div",{className:"mt-2",children:e.jsx("div",{className:"inline-flex items-center gap-1 px-2 py-1 rounded text-xs font-medium bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-300",children:"‚úì ƒê√£ thanh to√°n"})}),e.jsx("div",{className:"text-xs text-slate-500 mt-1",children:s.paymentMethod==="cash"?"üíµ Ti·ªÅn m·∫∑t":"üè¶ Chuy·ªÉn kho·∫£n"})]})}),e.jsxs("div",{className:"col-span-1 flex items-start justify-end gap-2 pt-1",children:[e.jsx("button",{onClick:()=>{u(s),Q(!0)},className:"p-1.5 text-slate-400 hover:text-amber-600 dark:hover:text-amber-400 transition-colors",title:"Ch·ªânh s·ª≠a",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})})}),e.jsxs("div",{className:"relative dropdown-menu-container",children:[e.jsx("button",{onClick:()=>l(de===s.id?null:s.id),className:"p-1.5 text-slate-400 hover:text-slate-600 dark:hover:text-slate-300 transition-colors",title:"T√πy ch·ªçn",children:e.jsxs("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 24 24",children:[e.jsx("circle",{cx:"12",cy:"5",r:"2"}),e.jsx("circle",{cx:"12",cy:"12",r:"2"}),e.jsx("circle",{cx:"12",cy:"19",r:"2"})]})}),de===s.id&&e.jsxs("div",{className:"absolute right-0 mt-1 w-48 bg-white dark:bg-slate-800 rounded-lg shadow-lg border border-slate-200 dark:border-slate-700 z-50",children:[e.jsxs("button",{onClick:()=>{q(s),l(null)},className:"w-full text-left px-4 py-2 text-sm text-slate-700 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-slate-700 flex items-center gap-2 rounded-t-lg",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z"})}),"In l·∫°i h√≥a ƒë∆°n"]}),e.jsxs("button",{onClick:()=>{u(s),Pe(!0),l(null)},className:"w-full text-left px-4 py-2 text-sm text-slate-700 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-slate-700 flex items-center gap-2",children:[e.jsxs("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]}),"Xem chi ti·∫øt"]}),e.jsxs("button",{onClick:()=>{x&&x(s.id),l(null)},className:"w-full text-left px-4 py-2 text-sm text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/20 flex items-center gap-2 rounded-b-lg",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})}),"X√≥a h√≥a ƒë∆°n"]})]})]})]})]})]},s.id)})})]})}),e.jsx("div",{className:"p-4 border-t border-slate-200 dark:border-slate-700 flex items-center justify-between",children:e.jsxs("div",{className:"text-sm text-slate-600 dark:text-slate-400",children:["Hi·ªÉn th·ªã ",f.length," ƒë∆°n h√†ng"]})})]})}),e.jsx(hs,{isOpen:Fe,onClose:()=>{Pe(!1),u(null)},sale:Me,onPrint:q}),e.jsx(us,{isOpen:Le,onClose:()=>{Q(!1),u(null)},sale:Me,onSave:async s=>{try{const{supabase:i}=await gt(async()=>{const{supabase:K}=await import("./index-Y4_AZb1T.js").then(N=>N.bf);return{supabase:K}},__vite__mapDeps([0,1])),{profile:D}=await gt(async()=>{const{profile:K}=await import("./index-Y4_AZb1T.js").then(N=>N.bg);return{profile:K}},__vite__mapDeps([0,1])).then(K=>({profile:null})),z=s.items.reduce((K,N)=>K+N.quantity*N.sellingPrice,0)-s.discount,{error:g}=await i.from("sales").update({items:s.items,customer:s.customer,paymentmethod:s.paymentMethod,discount:s.discount,total:z}).eq("id",s.id);if(g)throw g;await zt(null,{action:"sale_update",tableName:"sales",recordId:s.id,newData:{items:s.items,customer:s.customer,paymentMethod:s.paymentMethod,discount:s.discount,total:z}}),queryClient.invalidateQueries({queryKey:["salesRepo"]}),queryClient.invalidateQueries({queryKey:["salesRepoPaged"]}),queryClient.invalidateQueries({queryKey:["salesRepoKeyset"]}),j.success("ƒê√£ c·∫≠p nh·∫≠t ƒë∆°n h√†ng th√†nh c√¥ng"),Q(!1),u(null)}catch(i){console.error("Error updating sale:",i),j.error("L·ªói khi c·∫≠p nh·∫≠t ƒë∆°n h√†ng: "+i.message)}}})]}):null},Ns=()=>{const{customers:A,upsertCustomer:_,cartItems:n,setCartItems:L,clearCart:q,deleteSale:J,currentBranchId:x,finalizeSale:G,setCashTransactions:ae,setPaymentSources:S}=Mt(),Y=Pt(),{data:ee=[],isLoading:ge,error:be}=Lt(),{data:Ne=[]}=ls(),[_e,U]=r.useState(1),[re,qe]=r.useState(20),[le,we]=r.useState(""),[Oe,Ce]=r.useState(""),[pe,Se]=r.useState(),[Te,fe]=r.useState(),[V,ne]=r.useState("all"),[O,ke]=r.useState("all"),[y,je]=r.useState(!1),[W,X]=r.useState(null),Me={branchId:x,page:y?void 0:_e,pageSize:re,search:Oe||void 0,fromDate:pe,toDate:Te,mode:y?"keyset":"offset",afterDate:y?W==null?void 0:W.afterDate:void 0,afterId:y?W==null?void 0:W.afterId:void 0,status:V==="all"?void 0:V==="cancelled"?"refunded":V==="completed"?"completed":V,paymentMethod:O==="all"?void 0:O},{data:u,isLoading:Fe,error:Pe}=ts(Me),Le=(u==null?void 0:u.data)||[],Q=(u==null?void 0:u.meta)||{page:1,totalPages:1,total:Le.length,hasMore:!1};r.useEffect(()=>{var t;y&&((t=u==null?void 0:u.meta)==null?void 0:t.mode)==="keyset"&&X({afterDate:u.meta.nextAfterDate,afterId:u.meta.nextAfterId})},[y,u]);const{mutateAsync:de}=ss(),l=ns(),f=r.useCallback(()=>U(t=>Math.max(1,t-1)),[]),T=r.useCallback(()=>U(t=>t+1),[]),s=r.useCallback(t=>{qe(t),U(1),y&&X(null)},[]);r.useEffect(()=>{const t=setTimeout(()=>{Ce(le),U(1)},300);return()=>clearTimeout(t)},[le]);const[i,D]=r.useState(""),[I,z]=r.useState("all"),[g,K]=r.useState(""),[N,Re]=r.useState(!1),He=r.useRef(null),[ve,oe]=r.useState(""),[Z,De]=r.useState("products"),[M,ie]=r.useState(null),[Ge,Ie]=r.useState(!1),[F,k]=r.useState(0),[B,bt]=r.useState("amount"),[pt,Ue]=r.useState(0),[Ht,nt]=r.useState(!1),[Et,Xe]=r.useState(!1),[H,ye]=r.useState({name:"",phone:"",vehicleModel:"",licensePlate:""}),[ft,kt]=r.useState(""),[ze,dt]=r.useState(""),[ce,ot]=r.useState(""),[Ee,jt]=r.useState([]),[Qe,vt]=r.useState(0),[te,it]=r.useState(null),[R,Ye]=r.useState(null),[Ae,Ze]=r.useState(0),[yt,$t]=r.useState(!1);r.useEffect(()=>{var t;N&&((t=He.current)==null||t.focus())},[N]);const[Wt,ct]=r.useState(!1),[P,xt]=r.useState(null),[b,Kt]=r.useState(null);r.useEffect(()=>{(async()=>{try{const{data:a,error:d}=await St.from("store_settings").select("store_name, address, phone, email, logo_url, bank_qr_url, bank_name, bank_account_number, bank_account_holder, bank_branch").order("created_at",{ascending:!1}).limit(1).single();if(d){console.error("Error fetching store settings:",d);return}Kt(a)}catch(a){console.error("Failed to fetch store settings:",a)}})()},[]);const mt=r.useCallback(t=>{var m,h;const a=((m=t.retailPrice)==null?void 0:m[x])??0,d=((h=t.stock)==null?void 0:h[x])??0,o=n.find(w=>w.partId===t.id);if(o){const w=o.quantity+1;if(w>d){j.error(`Kh√¥ng ƒë·ªß h√†ng! T·ªìn kho: ${d}`);return}L(E=>E.map(v=>v.partId===t.id?{...v,quantity:w}:v))}else{if(d<1){j.error("S·∫£n ph·∫©m ƒë√£ h·∫øt h√†ng!");return}const w={partId:t.id,partName:t.name,sku:t.sku,quantity:1,sellingPrice:a,stockSnapshot:d,discount:0};L(E=>[...E,w])}},[n,L,x]),Je=r.useCallback(t=>{L(a=>a.filter(d=>d.partId!==t))},[L]),et=r.useCallback((t,a)=>{if(a<=0){Je(t);return}const d=n.find(o=>o.partId===t);if(d&&a>d.stockSnapshot){j.error(`Kh√¥ng ƒë·ªß h√†ng! T·ªìn kho: ${d.stockSnapshot}`);return}L(o=>o.map(m=>m.partId===t?{...m,quantity:a}:m))},[n,L,Je]),xe=r.useMemo(()=>n.reduce((t,a)=>t+a.sellingPrice*a.quantity,0),[n]),Nt=r.useMemo(()=>Math.max(0,xe-F),[xe,F]),Vt=r.useMemo(()=>{const t=new Map;return n.forEach(a=>t.set(a.partId,a)),t},[n]),ht=r.useMemo(()=>Ee.reduce((t,a)=>t+a.sellingPrice*a.quantity,0),[Ee]),Ot=r.useMemo(()=>Math.max(0,ht-Qe),[ht,Qe]),Ft=r.useMemo(()=>Ee.reduce((t,a)=>t+a.quantity,0),[Ee]),me=r.useMemo(()=>{if(ge||be)return[];let t=ee;return i&&(t=t.filter(a=>a.name.toLowerCase().includes(i.toLowerCase())||a.sku.toLowerCase().includes(i.toLowerCase()))),t},[ee,i,ge,be]),ut=r.useMemo(()=>{if(!me.length)return[];const t=me.filter(d=>{var m;const o=Number(((m=d.stock)==null?void 0:m[x])??0);return I==="low"?o>0&&o<=at:I==="out"?o<=0:!0}),a=d=>d<=0?2:d<=at?1:0;return t.slice().sort((d,o)=>{var E,v;const m=Number(((E=d.stock)==null?void 0:E[x])??0),h=Number(((v=o.stock)==null?void 0:v[x])??0),w=a(m)-a(h);return w!==0?w:d.name.localeCompare(o.name)}).slice(0,36)},[me,I,x]),Rt=t=>{if(t.preventDefault(),!g.trim())return;const a=g.trim(),d=me.find(o=>{var m,h;return((m=o.sku)==null?void 0:m.toLowerCase())===a.toLowerCase()||((h=o.name)==null?void 0:h.toLowerCase().includes(a.toLowerCase()))});d?(mt(d),j.success(`ƒê√£ th√™m ${d.name} v√†o gi·ªè h√†ng`),K(""),setTimeout(()=>{var o;return(o=He.current)==null?void 0:o.focus()},100)):(j.error(`Kh√¥ng t√¨m th·∫•y s·∫£n ph·∫©m c√≥ m√£: ${a}`),K(""))},{lowStockCount:$e,outOfStockCount:We}=ms(ee,x,at),Gt=[{key:"all",label:"T·∫•t c·∫£",count:me.length,activeClass:"bg-gradient-to-r from-blue-600 to-indigo-600 text-white border-transparent shadow-blue-500/30",inactiveClass:"bg-white/80 dark:bg-slate-900/50 text-slate-700 dark:text-slate-200 border border-slate-200 dark:border-slate-700"},{key:"low",label:"T·ªìn th·∫•p",count:$e,activeClass:"bg-gradient-to-r from-amber-500 to-orange-500 text-white border-transparent shadow-amber-500/30",inactiveClass:"bg-white/80 dark:bg-slate-900/50 text-amber-700 dark:text-amber-200 border border-amber-200/70 dark:border-amber-800/60"},{key:"out",label:"H·∫øt h√†ng",count:We,activeClass:"bg-gradient-to-r from-rose-500 to-red-500 text-white border-transparent shadow-rose-500/30",inactiveClass:"bg-white/80 dark:bg-slate-900/50 text-rose-700 dark:text-rose-200 border border-rose-200/70 dark:border-rose-800/60"}],wt=r.useRef(!1);r.useEffect(()=>{if(!wt.current&&($e>0||We>0)){const t=[];We>0&&t.push(`H·∫øt h√†ng: ${We}`),$e>0&&t.push(`T·ªìn th·∫•p: ${$e}`),j.info(t.join(" ¬∑ ")),wt.current=!0}},[$e,We]);const Ct=r.useMemo(()=>ve?A.filter(t=>{var a;return t.name.toLowerCase().includes(ve.toLowerCase())||((a=t.phone)==null?void 0:a.includes(ve))||!1}).slice(0,10):A.slice(0,10),[A,ve]),Ut=()=>{if(!H.name||!H.phone){alert("Vui l√≤ng nh·∫≠p t√™n v√† s·ªë ƒëi·ªán tho·∫°i");return}if(A.find(d=>d.phone===H.phone)){alert("S·ªë ƒëi·ªán tho·∫°i n√†y ƒë√£ t·ªìn t·∫°i!");return}const a={id:`CUST-${Date.now()}`,name:H.name,phone:H.phone,vehicleModel:H.vehicleModel,licensePlate:H.licensePlate,status:"active",segment:"New",loyaltyPoints:0,totalSpent:0,visitCount:1,lastVisit:new Date().toISOString(),created_at:new Date().toISOString()};_(a),ie(a),oe(a.name),ye({name:"",phone:"",vehicleModel:"",licensePlate:""}),Xe(!1)},Xt=t=>{xt(t),ct(!0)},Qt=()=>{if(!P)return;kt(P.sale_code||lt(P.id)||P.id),dt(P.customer.name),ot(P.customer.phone||"");const t=P.items.map(a=>({partId:a.partId||a.partid||"",partName:a.partName||a.partname||"",sku:a.sku||"",quantity:a.quantity||0,sellingPrice:a.sellingPrice||a.sellingprice||a.price||0,stockSnapshot:a.stockSnapshot||0,discount:a.discount||0}));jt(t),vt(P.discount||0),setTimeout(()=>{Tt("last-receipt"),ct(!1),xt(null)},100)},{profile:p}=Dt(),Yt=async t=>{var a;if(!as(p==null?void 0:p.role,"sale.delete")){j.error("B·∫°n kh√¥ng c√≥ quy·ªÅn x√≥a h√≥a ƒë∆°n");return}if(confirm("X√°c nh·∫≠n x√≥a h√≥a ƒë∆°n n√†y? H√†nh ƒë·ªông n√†y kh√¥ng th·ªÉ ho√†n t√°c."))try{const{deleteSaleById:d}=await gt(async()=>{const{deleteSaleById:m}=await import("./index-Y4_AZb1T.js").then(h=>h.bh);return{deleteSaleById:m}},__vite__mapDeps([0,1])),o=await d(t);if(!o.ok){j.error(((a=o.error)==null?void 0:a.message)||"X√≥a h√≥a ƒë∆°n th·∫•t b·∫°i!");return}Y.invalidateQueries({queryKey:["sales"]}),j.success("ƒê√£ x√≥a h√≥a ƒë∆°n th√†nh c√¥ng!"),zt((p==null?void 0:p.id)||null,{action:"sale.delete",tableName:"sales",recordId:t,oldData:null,newData:null})}catch(d){j.error("X√≥a h√≥a ƒë∆°n th·∫•t b·∫°i!"),console.error("Delete sale error:",d)}},Zt=t=>{if(confirm("M·ªü l·∫°i h√≥a ƒë∆°n n√†y ƒë·ªÉ ch·ªânh s·ª≠a? Gi·ªè h√†ng hi·ªán t·∫°i s·∫Ω b·ªã x√≥a.")){if(q(),t.items.forEach(a=>{const d=ee.find(o=>o.id===a.partId);if(d)for(let o=0;o<a.quantity;o++)mt(d)}),t.customer.id){const a=A.find(d=>d.id===t.customer.id);a&&(ie(a),oe(a.name))}else dt(t.customer.name),ot(t.customer.phone||"");k(t.discount||0),nt(!1),alert("H√≥a ƒë∆°n ƒë√£ ƒë∆∞·ª£c t·∫£i v√†o gi·ªè h√†ng ƒë·ªÉ ch·ªânh s·ª≠a")}},Jt=async(t,a,d,o)=>{var m;if(!(a<=0)){console.log("[createCustomerDebtIfNeeded] CALLED with:",{saleId:t.id,totalAmount:d,paidAmount:o,remainingAmount:a,customerName:t.customer.name,timestamp:new Date().toISOString()});try{const h=t.customer.id||t.customer.phone||`CUST-ANON-${Date.now()}`,w=((m=t.customer.name)==null?void 0:m.trim())||t.customer.phone||"Kh√°ch l·∫ª";let v=`B√°n h√†ng - H√≥a ƒë∆°n ${t.sale_code||t.id}`;t.items&&t.items.length>0&&(v+=`

S·∫£n ph·∫©m ƒë√£ mua:`,t.items.forEach(C=>{const $=C.quantity*C.sellingPrice,Be=C.discount||0;v+=`
  ‚Ä¢ ${C.quantity} x ${C.partName} - ${c($)}`,Be>0&&(v+=` (Gi·∫£m: ${c(Be)})`)})),t.discount&&t.discount>0&&(v+=`

Gi·∫£m gi√° ƒë∆°n h√†ng: -${c(t.discount)}`);const he=t.paymentMethod==="cash"?"Ti·ªÅn m·∫∑t":"Chuy·ªÉn kho·∫£n";v+=`

Ph∆∞∆°ng th·ª©c: ${he}`,v+=`

NV: ${t.userName||"N/A"}`;const se={customerId:h,customerName:w,phone:t.customer.phone||null,licensePlate:null,description:v,totalAmount:d,paidAmount:o,remainingAmount:a,createdDate:new Date().toISOString().split("T")[0],branchId:x,saleId:t.id};console.log("[SalesManager] createCustomerDebt payload:",se);const ue=await l.mutateAsync(se);console.log("[SalesManager] createCustomerDebt result:",ue),j.success(`ƒê√£ t·∫°o c√¥ng n·ª£ ${c(a)} cho ${w}`)}catch(h){console.error("Error creating customer debt:",h),console.error("Error details:",{message:h==null?void 0:h.message,cause:h==null?void 0:h.cause,stack:h==null?void 0:h.stack}),j.error(`Kh√¥ng th·ªÉ t·∫°o c√¥ng n·ª£ t·ª± ƒë·ªông: ${(h==null?void 0:h.message)||"L·ªói kh√¥ng x√°c ƒë·ªãnh"}`)}}},es=async()=>{var t,a,d,o;if(n.length===0){alert("Vui l√≤ng th√™m s·∫£n ph·∫©m v√†o gi·ªè h√†ng");return}if(!M&&!ze&&!ce){alert("Vui l√≤ng nh·∫≠p th√¥ng tin kh√°ch h√†ng tr∆∞·ªõc khi b√°n h√†ng");return}if(!te){alert("Vui l√≤ng ch·ªçn ph∆∞∆°ng th·ª©c thanh to√°n");return}if(!R){alert("Vui l√≤ng ch·ªçn h√¨nh th·ª©c thanh to√°n");return}if(R==="partial"&&Ae<=0){alert("Vui l√≤ng nh·∫≠p s·ªë ti·ªÅn kh√°ch tr·∫£");return}try{for(const C of n){const $=ee.find(tt=>tt.id===C.partId);if(!$){j.error(`Kh√¥ng t√¨m th·∫•y s·∫£n ph·∫©m: ${C.partName}`);return}const Be=((t=$.stock)==null?void 0:t[x])??0;if(C.quantity>Be){j.error(`Kh√¥ng ƒë·ªß h√†ng cho ${$.name}. T·ªìn kho: ${Be}`);return}}const m=`SALE-${Date.now()}`,h=n.reduce((C,$)=>C+$.sellingPrice*$.quantity,0),w=n.reduce((C,$)=>C+($.discount||0),0),E=Math.max(0,h-w-F),v={id:M==null?void 0:M.id,name:(M==null?void 0:M.name)||ze||"Kh√°ch l·∫ª",phone:(M==null?void 0:M.phone)||ce};kt(m),dt(v.name),ot(v.phone||""),jt([...n]),vt(F+w),!M&&ce&&ze&&(A.find($=>$.phone===ce)||_({id:`CUST-${Date.now()}`,name:ze,phone:ce,status:"active",segment:"New",loyaltyPoints:0,totalSpent:0,visitCount:1,lastVisit:new Date().toISOString(),created_at:new Date().toISOString()}));const he=await de({id:m,items:n,discount:F+w,customer:v,paymentMethod:te,userId:(p==null?void 0:p.id)||"local-user",userName:(p==null?void 0:p.email)||(p==null?void 0:p.full_name)||"Local User",branchId:x});if(he!=null&&he.error)throw he.error;const se=R==="full"?E:R==="partial"?Ae:0,ue=E-se;if(console.log("[SalesManager] Payment details:",{paymentType:R,total:E,paidAmount:se,partialAmount:Ae,remainingAmount:ue,hasCustomer:!!(M||ze||ce)}),ue>0){console.log("[SalesManager] Creating debt because remaining > 0");const{data:C,error:$}=await St.from("sales").select(`
            *,
            user:userid(
              full_name,
              display_name,
              email
            )
          `).eq("id",m).single();$&&console.error("[SalesManager] Error fetching sale:",$);const tt=(C?{...C,userName:((a=C.user)==null?void 0:a.full_name)||((d=C.user)==null?void 0:d.display_name)||((o=C.user)==null?void 0:o.email)||"N/A"}:null)||{id:m,sale_code:void 0,date:new Date().toISOString(),items:n,subtotal:xe,discount:F+w,total:E,customer:v,paymentMethod:te,userName:(p==null?void 0:p.email)||(p==null?void 0:p.full_name)||"Local User",userId:(p==null?void 0:p.id)||"",branchId:x||""};console.log("[SalesManager] Sale data for debt:",tt),await Jt(tt,ue,E,se)}else console.log("[SalesManager] No debt needed, paid in full");ie(null),oe(""),k(0),Ue(0),bt("amount"),it(null),Ye(null),Ze(0),q(),yt&&setTimeout(()=>{Tt("last-receipt")},100)}catch(m){console.error("Error finalizing sale (atomic):",m),j.error((m==null?void 0:m.message)||"C√≥ l·ªói khi t·∫°o h√≥a ƒë∆°n (atomic)")}};return r.useEffect(()=>{const t=a=>{a.target.closest(".customer-dropdown-container")||Ie(!1)};return document.addEventListener("mousedown",t),()=>document.removeEventListener("mousedown",t)},[]),e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 via-blue-50/20 to-indigo-50/30 dark:from-slate-900 dark:via-slate-900 dark:to-slate-800",children:[e.jsx("div",{className:"md:hidden sticky top-0 z-10 bg-white/95 dark:bg-slate-800/95 backdrop-blur-sm border-b border-slate-200/50 dark:border-slate-700/50 shadow-sm",children:e.jsxs("div",{className:"grid grid-cols-2",children:[e.jsxs("button",{onClick:()=>De("products"),className:`py-3.5 px-4 font-bold transition-all relative ${Z==="products"?"text-blue-600 dark:text-blue-400 bg-blue-50/50 dark:bg-blue-900/20":"text-slate-600 dark:text-slate-400 hover:bg-slate-50 dark:hover:bg-slate-700/50"}`,children:[e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(Ke,{className:"w-5 h-5"}),e.jsx("span",{className:"text-sm",children:"S·∫£n ph·∫©m"})]}),Z==="products"&&e.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-1 bg-gradient-to-r from-blue-500 to-indigo-500 rounded-t-full"})]}),e.jsxs("button",{onClick:()=>De("cart"),className:`py-3.5 px-4 font-bold transition-all relative ${Z==="cart"?"text-blue-600 dark:text-blue-400 bg-blue-50/50 dark:bg-blue-900/20":"text-slate-600 dark:text-slate-400 hover:bg-slate-50 dark:hover:bg-slate-700/50"}`,children:[e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(st,{className:"w-5 h-5"}),e.jsx("span",{className:"text-sm",children:"Gi·ªè h√†ng"}),n.length>0&&e.jsx("span",{className:"ml-1 px-2 py-0.5 text-xs font-bold rounded-full bg-gradient-to-r from-orange-500 to-red-500 text-white shadow-lg",children:n.length})]}),Z==="cart"&&e.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-1 bg-gradient-to-r from-blue-500 to-indigo-500 rounded-t-full"})]})]})}),e.jsxs("div",{className:"flex h-[calc(100vh-57px)] md:h-screen",children:[e.jsxs("div",{className:`flex-1 flex flex-col transition-all duration-300 ${Z==="cart"?"hidden md:flex":"animate-fade-in"}`,children:[e.jsx("div",{className:"bg-white/80 dark:bg-slate-800/80 backdrop-blur-sm border-b border-slate-200/50 dark:border-slate-700/50 p-3 md:p-4 shadow-sm",children:e.jsxs("div",{className:"flex flex-col md:flex-row items-stretch md:items-center gap-3",children:[e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsxs("div",{className:"flex items-stretch gap-2",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx("div",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-slate-400",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})}),e.jsx("input",{type:"text",placeholder:"T√¨m ki·∫øm s·∫£n ph·∫©m...",value:i,onChange:t=>D(t.target.value),className:"w-full pl-10 pr-4 py-2.5 border-2 border-slate-300/50 dark:border-slate-600/50 rounded-xl bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-sm md:text-base transition-all placeholder:text-slate-400"})]}),e.jsxs("button",{type:"button",onClick:()=>Re(t=>!t),className:`px-4 py-2 rounded-xl border-2 font-semibold text-sm flex items-center gap-2 transition-all ${N?"border-blue-500 text-blue-600 bg-blue-50 dark:bg-blue-900/20":"border-slate-200 dark:border-slate-700 text-slate-600 dark:text-slate-200 bg-white dark:bg-slate-800"}`,children:[e.jsx(xs,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden md:inline",children:N?"ƒê√≥ng qu√©t":"Qu√©t m√£"})]})]}),N&&e.jsxs("form",{onSubmit:Rt,className:"relative",children:[e.jsx("div",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-blue-500",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v1m6 11h2m-6 0h-2v4m0-11v3m0 0h.01M12 12h4.01M16 20h4M4 12h4m12 0h.01M5 8h2a1 1 0 001-1V5a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1zm12 0h2a1 1 0 001-1V5a1 1 0 00-1-1h-2a1 1 0 00-1 1v2a1 1 0 001 1zM5 20h2a1 1 0 001-1v-2a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1z"})})}),e.jsx("input",{ref:He,type:"text",placeholder:"Nh·∫≠p ho·∫∑c qu√©t m√£ v·∫°ch...",value:g,onChange:t=>K(t.target.value),className:"w-full pl-10 pr-10 py-2.5 border-2 border-blue-400 dark:border-blue-600 rounded-xl bg-blue-50/50 dark:bg-blue-900/20 text-slate-900 dark:text-slate-100 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-sm md:text-base transition-all placeholder:text-blue-500/70 font-mono"}),g&&e.jsx("button",{type:"button",onClick:()=>K(""),className:"absolute right-3 top-1/2 -translate-y-1/2 text-slate-400 hover:text-slate-600 dark:hover:text-slate-300",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("button",{onClick:()=>nt(!0),className:"px-4 py-2.5 bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-700 hover:to-indigo-700 text-white rounded-xl whitespace-nowrap transition-all inline-flex items-center gap-2 text-sm font-bold shadow-lg hover:shadow-xl hover:scale-105 active:scale-95",title:"L·ªãch s·ª≠ b√°n h√†ng",children:[e.jsx(ds,{className:"w-5 h-5"}),e.jsx("span",{children:"L·ªãch s·ª≠"})]})})]})}),e.jsxs("div",{className:"bg-white/80 dark:bg-slate-800/80 border-b border-slate-200/60 dark:border-slate-700/60 px-3 md:px-6 py-3 flex flex-col md:flex-row md:items-center md:justify-between gap-2",children:[e.jsxs("div",{className:"text-xs md:text-sm text-slate-600 dark:text-slate-400 font-medium",children:["Hi·ªÉn th·ªã ",ut.length," / ",me.length||0," s·∫£n ph·∫©m",i&&" theo t·ª´ kh√≥a"]}),e.jsx("div",{className:"flex items-center gap-2 overflow-x-auto pb-1",children:Gt.map(t=>{const a=I===t.key;return e.jsxs("button",{type:"button","aria-pressed":a,onClick:()=>z(t.key),className:`flex items-center gap-1.5 px-3 py-1.5 rounded-full text-xs font-semibold transition-all whitespace-nowrap ${a?t.activeClass:t.inactiveClass}`,children:[e.jsx("span",{children:t.label}),e.jsx("span",{className:`px-1.5 py-0.5 rounded-full text-[10px] font-black ${a?"bg-white/30":"bg-slate-100 dark:bg-slate-800"}`,children:t.count})]},t.key)})})]}),e.jsx("div",{className:"flex-1 p-0 md:p-6 overflow-y-auto bg-slate-50 dark:bg-slate-900 pb-24 md:pb-6",children:ut.length===0?e.jsxs("div",{className:"text-center text-slate-400 mt-20",children:[e.jsx("div",{className:"mb-4 flex items-center justify-center",children:e.jsx(Ke,{className:"w-16 h-16 text-slate-300"})}),e.jsx("div",{className:"text-xl font-medium mb-2",children:me.length===0?i?"Kh√¥ng t√¨m th·∫•y s·∫£n ph·∫©m n√†o":"Ch∆∞a c√≥ s·∫£n ph·∫©m":I==="low"?"Kh√¥ng c√≥ s·∫£n ph·∫©m t·ªìn th·∫•p":"Kh√¥ng c√≥ s·∫£n ph·∫©m h·∫øt h√†ng"}),e.jsx("div",{className:"text-sm",children:me.length===0?i?"H√£y th·ª≠ m·ªôt t·ª´ kh√≥a t√¨m ki·∫øm kh√°c":"Vui l√≤ng th√™m s·∫£n ph·∫©m v√†o h·ªá th·ªëng":"H√£y ch·ªçn b·ªô l·ªçc kh√°c ƒë·ªÉ xem th√™m s·∫£n ph·∫©m"})]}):e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-2.5 md:gap-3",children:ut.map(t=>{var se,ue;const a=Number(((se=t.retailPrice)==null?void 0:se[x])??0),d=Number(((ue=t.stock)==null?void 0:ue[x])??0),o=d<=0,m=d>0&&d<=at,h=Vt.get(t.id),w=!!h,E=o?"H·∫øt h√†ng":m?"T·ªìn th·∫•p":"S·∫µn h√†ng",v=o?"bg-rose-50 text-rose-600 dark:bg-rose-900/20 dark:text-rose-200":m?"bg-amber-50 text-amber-600 dark:bg-amber-900/20 dark:text-amber-200":"bg-emerald-50 text-emerald-600 dark:bg-emerald-900/20 dark:text-emerald-200",he=o?"bg-gradient-to-r from-rose-500 to-red-500 text-white":m?"bg-gradient-to-r from-amber-500 to-orange-500 text-white":"bg-gradient-to-r from-emerald-500 to-green-500 text-white";return e.jsx("button",{type:"button",onClick:()=>!o&&mt(t),disabled:o,className:`group relative text-left p-3 md:p-4 rounded-2xl border transition-all duration-200 h-full ${o?"bg-slate-50/70 dark:bg-slate-900/30 border-slate-200 dark:border-slate-800 cursor-not-allowed":"bg-white dark:bg-slate-800/70 border-slate-200/70 dark:border-slate-700 hover:border-blue-400 dark:hover:border-blue-500 hover:shadow-xl"} ${w?"ring-2 ring-blue-200 dark:ring-blue-500/40":""}`,children:e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-12 h-12 rounded-xl flex items-center justify-center ${o?"bg-slate-100 dark:bg-slate-700":"bg-slate-100 text-orange-500 dark:bg-slate-700/70"}`,children:e.jsx(Ke,{className:`w-6 h-6 ${o?"text-slate-400":"text-orange-500 dark:text-orange-300"}`})}),e.jsx("span",{className:`px-2 py-0.5 rounded-full text-[11px] font-semibold ${v}`,children:E})]}),w&&e.jsxs("span",{className:"text-[10px] font-semibold px-2 py-0.5 rounded-full bg-blue-50 text-blue-700 dark:bg-blue-900/30 dark:text-blue-200",children:["ƒê√£ ch·ªçn √ó",h==null?void 0:h.quantity]})]}),e.jsxs("div",{className:"space-y-1 mb-4",children:[e.jsx("h3",{className:"font-semibold text-xs md:text-sm text-slate-900 dark:text-slate-100 line-clamp-2",title:t.name,children:t.name}),e.jsx("div",{className:"text-[11px] text-slate-500 dark:text-slate-400 font-mono truncate",children:t.sku})]}),e.jsxs("div",{className:"flex items-center justify-between mt-auto pt-3 border-t border-slate-100 dark:border-slate-700",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-[11px] uppercase tracking-wide text-slate-400 dark:text-slate-500 font-semibold",children:"Gi√° b√°n"}),e.jsx("p",{className:`text-sm md:text-base font-bold ${o?"text-slate-400 dark:text-slate-500":"text-blue-600 dark:text-blue-300"}`,children:c(a)})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-[11px] uppercase tracking-wide text-slate-400 dark:text-slate-500 font-semibold",children:"T·ªìn kho"}),e.jsx("span",{className:`inline-flex items-center justify-center min-w-[2.75rem] px-2.5 py-1 text-[11px] font-black rounded-lg ${he}`,children:Math.max(0,Math.floor(d))})]})]})]})},t.id)})})})]}),e.jsxs("div",{className:`w-full md:w-[40%] bg-white dark:bg-slate-800 md:border-l border-slate-200 dark:border-slate-700 flex flex-col transition-all duration-300 overflow-y-auto ${Z==="products"?"hidden md:flex":"animate-fade-in"}`,children:[e.jsx("div",{className:"p-3 md:p-4 border-b border-slate-200 md:border-slate-200/50 dark:border-slate-700/50 bg-white dark:bg-slate-800 md:bg-gradient-to-r md:from-emerald-50/30 md:via-teal-50/20 md:to-cyan-50/30 dark:md:from-slate-800/50 dark:md:via-slate-800/30 dark:md:to-slate-800/50",children:e.jsxs("div",{className:"customer-dropdown-container",children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm font-semibold md:font-bold text-slate-900 dark:text-slate-100 mb-2 md:mb-3",children:[e.jsx("div",{className:"w-7 h-7 md:w-8 md:h-8 bg-emerald-500 md:bg-gradient-to-br md:from-emerald-500 md:to-teal-500 rounded-lg flex items-center justify-center md:shadow-lg",children:e.jsx("svg",{className:"w-4 h-4 md:w-5 md:h-5 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})})}),e.jsx("span",{children:"Kh√°ch h√†ng"})]}),e.jsxs("div",{className:"relative flex flex-col md:flex-row gap-2",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx("div",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-slate-400",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})}),e.jsx("input",{type:"text",placeholder:"T√¨m t√™n, s·ªë ƒëi·ªán tho·∫°i...",value:ve,onChange:t=>oe(t.target.value),onFocus:()=>Ie(!0),className:"w-full pl-10 pr-4 py-2 md:py-2.5 border md:border-2 border-slate-300 md:border-slate-300/50 dark:border-slate-600/50 rounded-lg md:rounded-xl bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100 text-sm focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 transition-all placeholder:text-slate-400"})]}),e.jsxs("button",{onClick:()=>Xe(!0),className:"px-3 py-2 md:px-4 md:py-2.5 bg-emerald-500 md:bg-gradient-to-r md:from-emerald-500 md:to-teal-500 hover:bg-emerald-600 md:hover:from-emerald-600 md:hover:to-teal-600 text-white rounded-lg md:rounded-xl flex items-center justify-center gap-2 transition-all md:shadow-lg md:hover:shadow-xl md:hover:scale-105 md:active:scale-95 font-semibold md:font-bold",title:"Th√™m kh√°ch h√†ng m·ªõi",children:[e.jsx(At,{className:"w-4 h-4 md:w-5 md:h-5"}),e.jsx("span",{className:"hidden sm:inline text-sm",children:"Th√™m"})]}),Ge&&Ct.length>0&&e.jsx("div",{className:"absolute top-full left-0 right-0 z-10 mt-1 max-h-40 overflow-y-auto bg-white dark:bg-slate-700 border border-slate-200 dark:border-slate-600 rounded-lg shadow-lg",children:Ct.map(t=>e.jsxs("button",{onClick:()=>{ie(t),oe(t.name),Ie(!1)},className:"w-full text-left px-3 py-2 hover:bg-slate-50 dark:hover:bg-slate-600 border-b border-slate-100 dark:border-slate-600 last:border-b-0",children:[e.jsx("div",{className:"font-medium text-slate-900 dark:text-slate-100",children:t.name}),t.phone&&e.jsx("div",{className:"text-sm text-slate-500",children:t.phone})]},t.id))})]}),M&&e.jsx("div",{className:"mt-2 md:mt-3 p-2 md:p-3.5 bg-emerald-50 dark:bg-emerald-900/20 md:bg-gradient-to-r md:from-emerald-50 md:to-teal-50 dark:md:from-emerald-900/20 dark:md:to-teal-900/20 rounded-lg md:rounded-xl border md:border-2 border-emerald-200 dark:border-emerald-800 md:shadow-sm",children:e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2 md:gap-2.5 flex-1 min-w-0",children:[e.jsx("div",{className:"hidden md:flex w-10 h-10 bg-gradient-to-br from-emerald-500 to-teal-500 rounded-lg items-center justify-center shadow-lg flex-shrink-0",children:e.jsx("svg",{className:"w-5 h-5 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-medium md:font-bold text-emerald-900 dark:text-emerald-100 truncate text-sm md:text-base",children:M.name}),M.phone&&e.jsxs("div",{className:"text-xs text-emerald-700 dark:text-emerald-300 flex items-center gap-1 mt-0.5",children:[e.jsx("svg",{className:"w-3 h-3 flex-shrink-0 hidden md:inline",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"})}),e.jsx("span",{className:"truncate",children:M.phone})]})]})]}),e.jsx("button",{onClick:()=>{ie(null),oe("")},className:"w-7 h-7 md:w-8 md:h-8 bg-red-100 dark:bg-red-900/30 hover:bg-red-200 dark:hover:bg-red-900/50 text-red-600 dark:text-red-400 rounded-md md:rounded-lg flex items-center justify-center transition-all flex-shrink-0 md:shadow-sm md:hover:shadow-md text-lg",title:"X√≥a",children:"√ó"})]})})]})}),e.jsxs("div",{className:"p-3 md:p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3 md:mb-4 pb-2 md:pb-3 border-b md:border-b-2 border-slate-200 md:border-slate-200/50 dark:border-slate-700/50",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"hidden md:flex w-8 h-8 bg-gradient-to-br from-blue-500 to-indigo-500 rounded-lg items-center justify-center shadow-lg",children:e.jsx(st,{className:"w-4 h-4 text-white"})}),e.jsx("h3",{className:"text-base md:text-lg font-semibold md:font-black text-slate-900 dark:text-slate-100",children:"Gi·ªè h√†ng"})]}),e.jsx("span",{className:"px-2 py-0.5 md:px-3 md:py-1 bg-blue-100 md:bg-gradient-to-r md:from-blue-100 md:to-indigo-100 dark:from-blue-900/30 dark:to-indigo-900/30 text-blue-700 dark:text-blue-300 rounded-full text-xs font-semibold md:font-bold md:shadow-sm",children:n.length})]}),n.length===0?e.jsxs("div",{className:"text-center py-12 md:py-16 mb-3",children:[e.jsx("div",{className:"mb-3 md:mb-4 flex items-center justify-center",children:e.jsx("div",{className:"w-16 h-16 md:w-20 md:h-20 bg-slate-100 md:bg-gradient-to-br md:from-slate-100 md:to-slate-200 dark:from-slate-800 dark:to-slate-700 rounded-2xl md:rounded-3xl flex items-center justify-center md:shadow-lg",children:e.jsx(st,{className:"w-8 h-8 md:w-10 md:h-10 text-slate-400 dark:text-slate-500"})})}),e.jsx("div",{className:"text-sm md:text-base font-semibold md:font-bold text-slate-600 dark:text-slate-400 mb-1",children:"Gi·ªè h√†ng tr·ªëng"}),e.jsx("div",{className:"text-xs text-slate-500 dark:text-slate-500",children:"Ch·ªçn s·∫£n ph·∫©m ƒë·ªÉ th√™m v√†o gi·ªè"})]}):e.jsx("div",{className:"space-y-2 md:space-y-2.5",children:n.map(t=>e.jsxs("div",{className:"group p-2.5 md:p-3 border md:border-2 border-slate-200 md:border-slate-200/50 dark:border-slate-700/50 rounded-xl md:rounded-xl bg-white dark:bg-slate-800 md:hover:border-blue-400 dark:hover:border-blue-600 transition-all duration-200 md:hover:shadow-lg md:hover:shadow-blue-500/10",children:[e.jsxs("div",{className:"md:hidden",children:[e.jsxs("div",{className:"flex items-start gap-2.5 mb-2",children:[e.jsx("div",{className:"w-10 h-10 bg-orange-50 dark:bg-orange-900/30 rounded-lg flex items-center justify-center flex-shrink-0",children:e.jsx(Ke,{className:"w-5 h-5 text-orange-500 dark:text-orange-400"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-semibold text-sm text-slate-900 dark:text-slate-100 leading-tight mb-1",title:t.partName,children:t.partName}),e.jsx("div",{className:"inline-flex items-center gap-1 px-1.5 py-0.5 bg-slate-100 dark:bg-slate-700 rounded-md",children:e.jsx("span",{className:"text-[10px] text-slate-500 dark:text-slate-400 font-medium",children:t.sku})})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"text-sm font-bold text-blue-600 dark:text-blue-400",children:c(t.sellingPrice)}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("button",{onClick:()=>et(t.partId,Math.max(1,t.quantity-1)),className:"w-8 h-8 flex items-center justify-center bg-slate-100 dark:bg-slate-700 rounded-lg text-slate-700 dark:text-slate-300 hover:bg-slate-200 dark:hover:bg-slate-600 transition-all font-bold text-lg",children:"-"}),e.jsx("span",{className:"w-8 text-center font-bold text-sm text-slate-900 dark:text-slate-100 px-1 py-1 bg-slate-50 dark:bg-slate-700 rounded-lg",children:t.quantity}),e.jsx("button",{onClick:()=>et(t.partId,t.quantity+1),className:"w-8 h-8 flex items-center justify-center bg-blue-500 dark:bg-blue-600 rounded-lg text-white hover:bg-blue-600 dark:hover:bg-blue-700 transition-all font-bold text-lg",children:"+"}),e.jsx("button",{onClick:()=>Je(t.partId),className:"w-8 h-8 flex items-center justify-center bg-red-500 hover:bg-red-600 rounded-lg text-white transition-all ml-1 font-bold text-lg",children:"√ó"})]})]})]}),e.jsxs("div",{className:"hidden md:flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-orange-100 to-amber-100 dark:from-orange-900/30 dark:to-amber-900/30 rounded-xl flex items-center justify-center flex-shrink-0 shadow-sm group-hover:scale-110 transition-transform",children:e.jsx(Ke,{className:"w-6 h-6 text-orange-500 dark:text-orange-400"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-bold text-sm text-slate-900 dark:text-slate-100 line-clamp-1 mb-1",title:t.partName,children:t.partName}),e.jsx("div",{className:"inline-flex items-center gap-1 px-2 py-0.5 bg-slate-100 dark:bg-slate-700 rounded-md mb-1",children:e.jsx("span",{className:"text-[10px] text-slate-500 dark:text-slate-400 font-semibold",children:t.sku})}),e.jsx("div",{className:"text-sm font-black bg-gradient-to-r from-blue-600 to-indigo-600 dark:from-blue-400 dark:to-indigo-400 bg-clip-text text-transparent",children:c(t.sellingPrice)})]}),e.jsxs("div",{className:"flex items-center gap-1.5 flex-shrink-0",children:[e.jsx("button",{onClick:()=>et(t.partId,Math.max(1,t.quantity-1)),className:"w-8 h-8 flex items-center justify-center bg-gradient-to-r from-slate-100 to-slate-200 dark:from-slate-700 dark:to-slate-600 rounded-lg text-slate-700 dark:text-slate-300 hover:from-slate-200 hover:to-slate-300 dark:hover:from-slate-600 dark:hover:to-slate-500 transition-all shadow-sm hover:shadow-md font-bold",children:"-"}),e.jsx("span",{className:"w-10 text-center font-black text-sm text-slate-900 dark:text-slate-100 px-2 py-1 bg-slate-50 dark:bg-slate-700 rounded-lg",children:t.quantity}),e.jsx("button",{onClick:()=>et(t.partId,t.quantity+1),className:"w-8 h-8 flex items-center justify-center bg-gradient-to-r from-blue-500 to-indigo-500 dark:from-blue-600 dark:to-indigo-600 rounded-lg text-white hover:from-blue-600 hover:to-indigo-600 dark:hover:from-blue-700 dark:hover:to-indigo-700 transition-all shadow-md hover:shadow-lg font-bold",children:"+"}),e.jsx("button",{onClick:()=>Je(t.partId),className:"w-8 h-8 flex items-center justify-center bg-gradient-to-r from-red-500 to-pink-500 hover:from-red-600 hover:to-pink-600 rounded-lg text-white transition-all ml-1 shadow-md hover:shadow-lg font-bold text-lg",children:"√ó"})]})]})]},t.partId))})]}),n.length>0&&e.jsxs("div",{className:"border-t md:border-t-2 border-slate-200 md:border-slate-200/50 dark:border-slate-700/50 bg-slate-50 dark:bg-slate-800 md:bg-gradient-to-br md:from-slate-50 md:to-blue-50/30 dark:md:from-slate-800 dark:md:to-slate-800/50",children:[e.jsxs("div",{className:"p-3 md:p-4 space-y-2 md:space-y-3 pb-20 md:pb-3",children:[e.jsxs("div",{className:"flex justify-between text-xs md:text-sm",children:[e.jsx("span",{className:"text-slate-600 dark:text-slate-400 font-medium",children:"T·ªïng ti·ªÅn h√†ng"}),e.jsx("span",{className:"font-semibold md:font-bold text-slate-900 dark:text-slate-100",children:c(xe)})]}),e.jsxs("div",{className:"space-y-2 md:space-y-2.5",children:[e.jsxs("div",{className:"flex flex-col md:flex-row items-start md:items-center justify-between text-xs md:text-sm gap-1.5 md:gap-2",children:[e.jsx("span",{className:"text-slate-600 dark:text-slate-400 font-medium",children:"Gi·∫£m gi√°:"}),e.jsxs("div",{className:"flex items-center gap-1.5 md:gap-2 w-full md:w-auto",children:[e.jsx("input",{type:"number",value:B==="amount"?F:pt,onChange:t=>{const a=Number(t.target.value)||0;if(B==="amount")k(Math.min(a,xe));else{const d=Math.min(a,100);Ue(d),k(Math.round(xe*d/100))}},className:"flex-1 md:w-24 px-2 md:px-3 py-1.5 md:py-2 text-right text-xs md:text-sm border md:border-2 border-slate-300 md:border-slate-300 dark:border-slate-600 rounded-lg md:rounded-xl bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100 focus:ring-2 focus:ring-purple-500 focus:border-purple-500 transition-all font-medium md:font-semibold",placeholder:"0",min:"0",max:B==="amount"?xe:100}),e.jsxs("select",{value:B,onChange:t=>{const a=t.target.value;bt(a),k(0),Ue(0)},className:"px-2 md:px-3 py-1.5 md:py-2 border md:border-2 border-slate-300 md:border-slate-300 dark:border-slate-600 rounded-lg md:rounded-xl bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100 text-xs md:text-sm font-semibold md:font-bold focus:ring-2 focus:ring-purple-500 transition-all",children:[e.jsx("option",{value:"amount",children:"‚Ç´"}),e.jsx("option",{value:"percent",children:"%"})]})]})]}),B==="percent"&&e.jsx("div",{className:"flex gap-1.5 md:gap-2 justify-end flex-wrap",children:[5,10,15,20].map(t=>e.jsxs("button",{onClick:()=>{Ue(t),k(Math.round(xe*t/100))},className:"px-2 md:px-3 py-1 md:py-1.5 text-[10px] md:text-xs font-semibold md:font-bold bg-purple-100 md:bg-gradient-to-r md:from-purple-100 md:to-pink-100 dark:from-purple-900/30 dark:to-pink-900/30 hover:bg-purple-200 md:hover:from-purple-200 md:hover:to-pink-200 dark:hover:from-purple-900/50 dark:hover:to-pink-900/50 text-purple-700 dark:text-purple-300 rounded-md md:rounded-lg transition-all md:shadow-sm md:hover:shadow-md",children:[t,"%"]},t))}),B==="percent"&&pt>0&&e.jsxs("div",{className:"text-[10px] md:text-xs text-slate-500 dark:text-slate-400 text-right",children:["= ",c(F)]})]}),e.jsxs("div",{className:"flex justify-between items-center pt-2 md:pt-3 mt-2 md:mt-3 border-t md:border-t-2 border-slate-200 dark:border-slate-700 p-2 md:p-3 -mx-3 md:-mx-4 bg-blue-600 md:bg-gradient-to-r md:from-blue-600 md:to-indigo-600 dark:from-blue-700 dark:to-indigo-700 rounded-b-lg md:rounded-b-xl md:shadow-lg",children:[e.jsx("span",{className:"font-semibold md:font-bold text-white text-xs md:text-sm",children:"Kh√°ch ph·∫£i tr·∫£"}),e.jsx("span",{className:"font-black text-lg md:text-2xl text-white",children:c(Math.max(0,Nt-F))})]})]}),e.jsxs("div",{className:"px-3 md:px-4 pb-3 md:pb-4",children:[e.jsxs("label",{className:"flex items-center gap-2 text-xs md:text-sm font-semibold md:font-bold text-slate-900 dark:text-slate-100 mb-2 md:mb-3",children:[e.jsx("span",{children:"Ph∆∞∆°ng th·ª©c thanh to√°n"}),e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 md:gap-3",children:[e.jsxs("button",{onClick:()=>it("cash"),className:`flex items-center justify-center gap-1.5 md:gap-2 px-3 md:px-4 py-2 md:py-3 rounded-lg md:rounded-xl border md:border-2 transition-all font-semibold md:font-bold md:shadow-sm md:hover:shadow-md ${te==="cash"?"border-emerald-500 bg-emerald-50 md:bg-gradient-to-r md:from-emerald-50 md:to-green-50 dark:from-emerald-900/30 dark:to-green-900/30 text-emerald-700 dark:text-emerald-400 md:shadow-lg":"border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700 text-slate-700 dark:text-slate-300 hover:border-emerald-400"}`,children:[e.jsx(_t,{className:"w-4 h-4 md:w-5 md:h-5"}),e.jsx("span",{className:"text-xs md:text-sm",children:"Ti·ªÅn m·∫∑t"})]}),e.jsxs("button",{onClick:()=>it("bank"),className:`flex items-center justify-center gap-1.5 md:gap-2 px-3 md:px-4 py-2 md:py-3 rounded-lg md:rounded-xl border md:border-2 transition-all font-semibold md:font-bold md:shadow-sm md:hover:shadow-md ${te==="bank"?"border-blue-500 bg-blue-50 md:bg-gradient-to-r md:from-blue-50 md:to-cyan-50 dark:from-blue-900/30 dark:to-cyan-900/30 text-blue-700 dark:text-blue-400 md:shadow-lg":"border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700 text-slate-700 dark:text-slate-300 hover:border-blue-400"}`,children:[e.jsx(qt,{className:"w-4 h-4 md:w-5 md:h-5"}),e.jsx("span",{className:"text-xs md:text-sm",children:"Chuy·ªÉn kho·∫£n"})]})]})]}),te&&e.jsxs("div",{className:"px-3 md:px-4 pb-3 md:pb-4",children:[e.jsx("label",{className:"block text-xs md:text-sm font-semibold md:font-bold text-slate-900 dark:text-slate-100 mb-2 md:mb-3",children:"H√¨nh th·ª©c"}),e.jsxs("div",{className:"grid grid-cols-3 gap-1.5 md:gap-2",children:[e.jsx("button",{onClick:()=>{Ye("full"),Ze(0)},className:`px-2 md:px-3 py-2 md:py-2.5 text-xs md:text-sm rounded-lg md:rounded-xl border md:border-2 transition-all font-bold md:shadow-sm ${R==="full"?"border-orange-500 bg-orange-50 md:bg-gradient-to-r md:from-orange-50 md:to-amber-50 dark:from-orange-900/30 dark:to-amber-900/30 text-orange-700 dark:text-orange-400 md:shadow-lg":"border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700 text-slate-600 dark:text-slate-400 hover:border-orange-400"}`,children:"ƒê·ªß"}),e.jsx("button",{onClick:()=>Ye("partial"),className:`px-2 md:px-3 py-2 md:py-2.5 text-xs md:text-sm rounded-lg md:rounded-xl border md:border-2 transition-all font-bold md:shadow-sm ${R==="partial"?"border-orange-500 bg-orange-50 md:bg-gradient-to-r md:from-orange-50 md:to-amber-50 dark:from-orange-900/30 dark:to-amber-900/30 text-orange-700 dark:text-orange-400 md:shadow-lg":"border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700 text-slate-600 dark:text-slate-400 hover:border-orange-400"}`,children:"1 ph·∫ßn"}),e.jsx("button",{onClick:()=>{Ye("note"),Ze(0)},className:`px-2 md:px-3 py-2 md:py-2.5 text-xs md:text-sm rounded-lg md:rounded-xl border md:border-2 transition-all font-bold md:shadow-sm ${R==="note"?"border-orange-500 bg-orange-50 md:bg-gradient-to-r md:from-orange-50 md:to-amber-50 dark:from-orange-900/30 dark:to-amber-900/30 text-orange-700 dark:text-orange-400 md:shadow-lg":"border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700 text-slate-600 dark:text-slate-400 hover:border-orange-400"}`,children:"Ghi n·ª£"})]})]}),R==="partial"&&e.jsxs("div",{className:"px-4 pb-3",children:[e.jsx("label",{className:"block text-sm font-medium text-slate-900 dark:text-slate-100 mb-2",children:"S·ªë ti·ªÅn kh√°ch tr·∫£"}),e.jsx("input",{type:"number",value:Ae,onChange:t=>Ze(Number(t.target.value)||0),className:"w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100",placeholder:"0"}),e.jsxs("div",{className:"text-xs text-slate-500 dark:text-slate-400 mt-1",children:["C√≤n l·∫°i:"," ",c(Math.max(0,Nt-F-Ae))," ","ƒë"]})]}),e.jsxs("div",{className:"px-3 md:px-4 pb-2 md:pb-3 space-y-1.5 md:space-y-2",children:[e.jsx("div",{className:"text-xs md:text-sm font-semibold md:font-medium text-slate-900 dark:text-slate-100 mb-1.5 md:mb-2",children:"Th·ªùi gian b√°n h√†ng"}),e.jsxs("label",{className:"flex items-center gap-1.5 md:gap-2 cursor-pointer",children:[e.jsx("input",{type:"radio",name:"salesTime",defaultChecked:!0,className:"w-1.5 h-1.5 md:w-3.5 md:h-3.5 text-pink-600 focus:ring-pink-500"}),e.jsx("span",{className:"text-xs md:text-sm text-slate-700 dark:text-slate-300",children:"Th·ªùi gian hi·ªán t·∫°i"})]}),e.jsxs("label",{className:"flex items-center gap-1.5 md:gap-2 cursor-pointer",children:[e.jsx("input",{type:"radio",name:"salesTime",className:"w-1.5 h-1.5 md:w-3.5 md:h-3.5 text-blue-600 focus:ring-blue-500"}),e.jsx("span",{className:"text-xs md:text-sm text-slate-700 dark:text-slate-300",children:"T√πy ch·ªânh"})]}),e.jsxs("label",{className:"flex items-center gap-1.5 cursor-pointer",children:[e.jsx("input",{type:"checkbox",className:"w-1.5 h-1.5 md:w-3.5 md:h-3.5 rounded border-slate-300 text-blue-600 focus:ring-blue-500"}),e.jsx("span",{className:"text-sm md:text-sm text-slate-700 dark:text-slate-300",children:"Ghi ch√∫ ri√™ng cho ƒë∆°n h√†ng"})]}),e.jsxs("label",{className:"flex items-center gap-1.5 md:gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:yt,onChange:t=>$t(t.target.checked),className:"w-1.5 h-1.5 md:w-3.5 md:h-3.5 rounded border-slate-300 text-blue-600 focus:ring-blue-500"}),e.jsx("span",{className:"text-xs md:text-sm text-slate-700 dark:text-slate-300",children:"ƒê√≥ng th·ªùi in ho√° ƒë∆°n"})]})]}),e.jsxs("div",{className:"p-3 md:p-4 pt-0 flex flex-col md:flex-row gap-2 md:gap-3",children:[e.jsx("button",{onClick:q,className:"flex-1 px-3 md:px-4 py-2 md:py-3 bg-white dark:bg-slate-700 border md:border-2 border-slate-300 dark:border-slate-600 hover:border-slate-400 dark:hover:border-slate-500 hover:bg-slate-50 dark:hover:bg-slate-600 text-slate-700 dark:text-slate-300 font-semibold md:font-bold rounded-lg md:rounded-xl transition-all md:shadow-sm md:hover:shadow-md text-sm md:text-base",children:"L∆ØU NH√ÅP"}),e.jsx("button",{onClick:es,disabled:!te||!R,className:`flex-1 px-3 md:px-4 py-2 md:py-3 font-bold md:font-black rounded-lg md:rounded-xl transition-all md:shadow-lg text-sm md:text-base ${te&&R?"bg-orange-500 md:bg-gradient-to-r md:from-orange-500 md:to-red-500 hover:bg-orange-600 md:hover:from-orange-600 md:hover:to-red-600 text-white md:shadow-orange-500/30 md:hover:shadow-xl md:hover:shadow-orange-500/40 md:hover:scale-105 md:active:scale-95":"bg-slate-300 dark:bg-slate-700 text-slate-500 dark:text-slate-500 cursor-not-allowed opacity-60"}`,children:"XU·∫§T B√ÅN"})]})]})]})]}),e.jsx(gs,{isOpen:Ht,onClose:()=>nt(!1),sales:Le,currentBranchId:x,onPrintReceipt:Xt,onEditSale:Zt,onDeleteSale:Yt,page:Q.page,totalPages:Q.totalPages,total:Q.total,hasMore:Q.hasMore,pageSize:re,onPrevPage:f,onNextPage:()=>{var t,a;if(y){const d=(t=u==null?void 0:u.meta)==null?void 0:t.nextAfterDate,o=(a=u==null?void 0:u.meta)==null?void 0:a.nextAfterId;(d||o)&&X({afterDate:d,afterId:o})}else T()},onPageSizeChange:s,search:le,onSearchChange:t=>{we(t),t||U(1)},fromDate:pe,toDate:Te,onDateRangeChange:(t,a)=>{Se(t),fe(a),U(1),y&&X(null)},status:V,onStatusChange:t=>{ne(t),U(1),y&&X(null)},paymentMethodFilter:O,onPaymentMethodFilterChange:t=>{ke(t),U(1),y&&X(null)},keysetMode:y,onToggleKeyset:t=>{je(t),U(1),X(null)},customerDebts:Ne}),ft&&e.jsx("div",{id:"last-receipt",className:"hidden print:block",children:e.jsxs("div",{style:{width:"148mm",minHeight:"210mm",margin:"0 auto",padding:"15mm",fontFamily:"Arial, sans-serif",fontSize:"12px",backgroundColor:"white",color:"#000",boxSizing:"border-box"},children:[e.jsxs("div",{style:{textAlign:"center",marginBottom:"20px",borderBottom:"2px solid #333",paddingBottom:"15px"},children:[e.jsx("img",{src:"https://raw.githubusercontent.com/Nhan-Lam-SmartCare/Motocare/main/public/logo.png",alt:"Nh·∫≠n-L√¢m SmartCare",style:{width:"120px",height:"120px",margin:"0 auto 10px",display:"block"},onError:t=>{t.currentTarget.style.display="none"}}),e.jsx("h1",{style:{fontSize:"24px",fontWeight:"bold",margin:"0 0 8px 0",color:"#c92a2a"},children:"Nh·∫≠n-L√¢m SmartCare"}),e.jsxs("div",{style:{fontSize:"11px",lineHeight:"1.6"},children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(is,{className:"w-4 h-4","aria-hidden":"true"}),e.jsx("span",{children:"ƒê·ªãa ch·ªâ: 4p Ph√∫ L·ª£i B, Ph√∫ Thu·∫≠n B, H·ªìng Ng·ª±, ƒê·ªìng Th√°p"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",className:"w-4 h-4",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.25 6.75c0 8.284 6.716 15 15 15 .828 0 1.5-.672 1.5-1.5v-2.25a1.5 1.5 0 00-1.5-1.5h-1.158a1.5 1.5 0 00-1.092.468l-.936.996a1.5 1.5 0 01-1.392.444 12.035 12.035 0 01-7.29-7.29 1.5 1.5 0 01.444-1.392l.996-.936a1.5 1.5 0 00.468-1.092V6.75A1.5 1.5 0 006.75 5.25H4.5c-.828 0-1.5.672-1.5 1.5z"})}),e.jsx("span",{children:"ƒêi·ªán tho·∫°i: 0947747907"})]})]})]}),e.jsxs("div",{style:{backgroundColor:"#f8f9fa",border:"1px solid #dee2e6",borderRadius:"6px",padding:"10px 12px",marginBottom:"20px",fontSize:"11px"},children:[e.jsx("div",{style:{fontWeight:"bold",marginBottom:"6px"},children:"üí≥ Th√¥ng tin chuy·ªÉn kho·∫£n:"}),e.jsxs("div",{style:{lineHeight:"1.6"},children:[e.jsxs("div",{children:["‚Ä¢ Ng√¢n h√†ng: ",e.jsx("strong",{children:"NH Li√™n Vi·ªát (LPBank)"})]}),e.jsxs("div",{children:["‚Ä¢ S·ªë t√†i kho·∫£n: ",e.jsx("strong",{children:"LAMVOT"})]}),e.jsxs("div",{children:["‚Ä¢ Ch·ªß t√†i kho·∫£n: ",e.jsx("strong",{children:"VO THANH LAM"})]})]})]}),e.jsxs("div",{style:{textAlign:"center",marginBottom:"15px"},children:[e.jsx("h2",{style:{fontSize:"18px",fontWeight:"bold",margin:"0 0 8px 0",textTransform:"uppercase",letterSpacing:"1px"},children:"H√ìA ƒê∆†N B√ÅN H√ÄNG"}),e.jsxs("div",{style:{fontSize:"11px",color:"#666"},children:["S·ªë: ",e.jsx("strong",{style:{color:"#000"},children:ft})," - Ng√†y:"," ",e.jsx("strong",{style:{color:"#000"},children:rt(new Date,!0)})]})]}),e.jsx("div",{style:{marginBottom:"15px",padding:"10px",backgroundColor:"#f8f9fa",borderRadius:"4px"},children:e.jsxs("div",{style:{fontSize:"12px",lineHeight:"1.8"},children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Kh√°ch h√†ng:"})," ",ze||"Kh√°ch l·∫ª"]}),ce&&e.jsxs("div",{children:[e.jsx("strong",{children:"ƒêi·ªán tho·∫°i:"})," ",ce]})]})}),e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",marginBottom:"15px",fontSize:"11px"},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{backgroundColor:"#f1f3f5",borderTop:"2px solid #333",borderBottom:"2px solid #333"},children:[e.jsx("th",{style:{textAlign:"center",padding:"8px 4px",width:"8%",fontWeight:"bold"},children:"STT"}),e.jsx("th",{style:{textAlign:"left",padding:"8px 6px",width:"37%",fontWeight:"bold"},children:"T√™n s·∫£n ph·∫©m"}),e.jsx("th",{style:{textAlign:"center",padding:"8px 4px",width:"10%",fontWeight:"bold"},children:"SL"}),e.jsx("th",{style:{textAlign:"right",padding:"8px 6px",width:"20%",fontWeight:"bold"},children:"ƒê∆°n gi√°"}),e.jsx("th",{style:{textAlign:"right",padding:"8px 6px",width:"25%",fontWeight:"bold"},children:"Th√†nh ti·ªÅn"})]})}),e.jsx("tbody",{children:Ee.map((t,a)=>e.jsx(It.Fragment,{children:e.jsxs("tr",{style:{borderBottom:"1px solid #e9ecef"},children:[e.jsx("td",{style:{textAlign:"center",padding:"10px 4px",verticalAlign:"top"},children:a+1}),e.jsxs("td",{style:{padding:"10px 6px",verticalAlign:"top"},children:[e.jsx("div",{style:{fontWeight:"600",marginBottom:"3px"},children:t.partName}),t.sku&&e.jsxs("div",{style:{fontSize:"9px",color:"#868e96"},children:["SKU: ",t.sku]})]}),e.jsx("td",{style:{textAlign:"center",padding:"10px 4px",verticalAlign:"top",fontWeight:"600"},children:t.quantity}),e.jsx("td",{style:{textAlign:"right",padding:"10px 6px",verticalAlign:"top"},children:c(t.sellingPrice)}),e.jsx("td",{style:{textAlign:"right",padding:"10px 6px",verticalAlign:"top",fontWeight:"600"},children:c(t.sellingPrice*t.quantity)})]})},t.partId))})]}),e.jsx("div",{style:{borderTop:"2px solid #333",paddingTop:"12px",marginBottom:"15px"},children:e.jsx("table",{style:{width:"100%",fontSize:"12px"},children:e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsxs("td",{style:{padding:"6px 0",textAlign:"right"},children:["T·ªïng c·ªông (",Ft," s·∫£n ph·∫©m):"]}),e.jsx("td",{style:{padding:"6px 0 6px 20px",textAlign:"right",width:"30%",fontWeight:"600"},children:c(ht)})]}),Qe>0&&e.jsxs("tr",{children:[e.jsx("td",{style:{padding:"6px 0",textAlign:"right",color:"#c92a2a"},children:"Gi·∫£m gi√°:"}),e.jsxs("td",{style:{padding:"6px 0 6px 20px",textAlign:"right",fontWeight:"600",color:"#c92a2a"},children:["-",c(Qe)]})]}),e.jsxs("tr",{style:{borderTop:"1px solid #dee2e6",fontSize:"14px"},children:[e.jsx("td",{style:{padding:"10px 0",textAlign:"right",fontWeight:"bold"},children:"T·ªîNG THANH TO√ÅN:"}),e.jsx("td",{style:{padding:"10px 0 10px 20px",textAlign:"right",fontWeight:"bold",fontSize:"16px",color:"#2f9e44"},children:c(Ot)})]})]})})}),e.jsxs("div",{style:{marginBottom:"20px",padding:"10px 12px",backgroundColor:"#f8f9fa",borderRadius:"4px",fontSize:"11px"},children:[e.jsxs("div",{style:{marginBottom:"4px"},children:[e.jsx("strong",{children:"H√¨nh th·ª©c thanh to√°n:"})," ",te==="cash"?"Ti·ªÅn m·∫∑t":"Chuy·ªÉn kho·∫£n"]}),e.jsx("div",{style:{fontStyle:"italic",color:"#495057"},children:R==="full"?"‚úì ƒê√£ thanh to√°n ƒë·ªß":R==="partial"?`Thanh to√°n m·ªôt ph·∫ßn: ${c(Ae)}`:"Ghi n·ª£"})]}),e.jsx("div",{style:{marginTop:"30px",borderTop:"1px solid #dee2e6",paddingTop:"20px"},children:e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",fontSize:"11px"},children:[e.jsxs("div",{style:{textAlign:"center",width:"40%"},children:[e.jsx("div",{style:{fontWeight:"bold",marginBottom:"50px",fontSize:"12px"},children:"Kh√°ch h√†ng"}),e.jsx("div",{style:{fontStyle:"italic",color:"#868e96"},children:"(K√Ω v√† ghi r√µ h·ªç t√™n)"})]}),e.jsxs("div",{style:{textAlign:"center",width:"40%"},children:[e.jsx("div",{style:{fontWeight:"bold",marginBottom:"50px",fontSize:"12px"},children:"Ng∆∞·ªùi b√°n h√†ng"}),e.jsx("div",{style:{fontStyle:"italic",color:"#868e96"},children:"(K√Ω v√† ghi r√µ h·ªç t√™n)"})]})]})}),e.jsxs("div",{style:{textAlign:"center",marginTop:"25px",paddingTop:"15px",borderTop:"1px dashed #adb5bd",fontSize:"11px",fontStyle:"italic",color:"#495057"},children:[e.jsxs("div",{style:{marginBottom:"5px",display:"flex",alignItems:"center",justifyContent:"center",gap:"6px"},children:[e.jsx("span",{style:{display:"inline-flex"},children:"*"}),"C·∫£m ∆°n qu√Ω kh√°ch ƒë√£ s·ª≠ d·ª•ng d·ªãch v·ª•",e.jsx("span",{style:{display:"inline-flex"},children:"*"})]}),e.jsx("div",{children:"H·∫πn g·∫∑p l·∫°i qu√Ω kh√°ch!"})]})]})}),Et&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50",children:e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-lg shadow-xl w-full max-w-md mx-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-slate-200 dark:border-slate-700",children:[e.jsx("h3",{className:"text-lg font-semibold text-slate-900 dark:text-slate-100",children:"Th√™m kh√°ch h√†ng m·ªõi"}),e.jsx("button",{onClick:()=>{Xe(!1),ye({name:"",phone:"",vehicleModel:"",licensePlate:""})},className:"text-slate-400 hover:text-slate-600 dark:hover:text-slate-200",children:e.jsx(Bt,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:["T√™n kh√°ch h√†ng ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",value:H.name,onChange:t=>ye({...H,name:t.target.value}),className:"w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100 focus:ring-2 focus:ring-blue-500",placeholder:"Nh·∫≠p t√™n kh√°ch h√†ng"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:["S·ªë ƒëi·ªán tho·∫°i ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"tel",value:H.phone,onChange:t=>ye({...H,phone:t.target.value}),className:"w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100 focus:ring-2 focus:ring-blue-500",placeholder:"Nh·∫≠p s·ªë ƒëi·ªán tho·∫°i"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"D√≤ng xe"}),e.jsx("input",{type:"text",value:H.vehicleModel,onChange:t=>ye({...H,vehicleModel:t.target.value}),className:"w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100 focus:ring-2 focus:ring-blue-500",placeholder:"VD: Honda SH 2023"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"Bi·ªÉn s·ªë xe"}),e.jsx("input",{type:"text",value:H.licensePlate,onChange:t=>ye({...H,licensePlate:t.target.value}),className:"w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100 focus:ring-2 focus:ring-blue-500",placeholder:"VD: 30A-12345"})]})]}),e.jsxs("div",{className:"flex gap-2 p-4 border-t border-slate-200 dark:border-slate-700",children:[e.jsx("button",{onClick:()=>{Xe(!1),ye({name:"",phone:"",vehicleModel:"",licensePlate:""})},className:"flex-1 px-4 py-2 bg-slate-100 dark:bg-slate-700 text-slate-700 dark:text-slate-300 rounded-lg hover:bg-slate-200 dark:hover:bg-slate-600",children:"H·ªßy"}),e.jsx("button",{onClick:Ut,className:"flex-1 px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600",children:"L∆∞u"})]})]})}),Wt&&P&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl w-full max-w-4xl max-h-[90vh] flex flex-col",children:[e.jsxs("div",{className:"bg-white dark:bg-slate-800 border-b border-slate-200 dark:border-slate-700 px-6 py-4 flex items-center justify-between rounded-t-xl flex-shrink-0",children:[e.jsx("h2",{className:"text-xl font-bold text-slate-900 dark:text-slate-100",children:"Xem tr∆∞·ªõc h√≥a ƒë∆°n"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("button",{onClick:Qt,className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg flex items-center gap-2 transition",children:[e.jsx(rs,{className:"w-4 h-4"}),"In h√≥a ƒë∆°n"]}),e.jsx("button",{onClick:()=>{ct(!1),xt(null)},className:"text-slate-400 hover:text-slate-600 dark:hover:text-slate-300","aria-label":"ƒê√≥ng",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",className:"w-5 h-5",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-6 bg-slate-100 dark:bg-slate-900",children:e.jsx("div",{className:"bg-white shadow-lg mx-auto",style:{width:"80mm",minHeight:"100mm",color:"#000"},children:e.jsxs("div",{style:{padding:"5mm"},children:[e.jsx("div",{style:{borderBottom:"2px solid #3b82f6",paddingBottom:"2mm",marginBottom:"3mm"},children:e.jsxs("div",{style:{textAlign:"center"},children:[(b==null?void 0:b.logo_url)&&e.jsx("img",{src:b.logo_url,alt:"Logo",style:{height:"12mm",width:"auto",objectFit:"contain",margin:"0 auto 2mm"}}),e.jsx("div",{style:{fontWeight:"bold",fontSize:"11pt",color:"#1e40af"},children:(b==null?void 0:b.store_name)||"Nh·∫°n L√¢m SmartCare"}),e.jsx("div",{style:{fontSize:"8pt",color:"#000",marginTop:"1mm"},children:(b==null?void 0:b.address)&&`üìç ${b.address}`}),e.jsx("div",{style:{fontSize:"8pt",color:"#000"},children:(b==null?void 0:b.phone)&&`üìû ${b.phone}`})]})}),e.jsxs("div",{style:{textAlign:"center",marginBottom:"3mm"},children:[e.jsx("h1",{style:{fontSize:"14pt",fontWeight:"bold",margin:"0",color:"#1e40af"},children:"H√ìA ƒê∆†N B√ÅN H√ÄNG"}),e.jsx("div",{style:{fontSize:"8pt",color:"#666",marginTop:"1mm"},children:new Date(P.date).toLocaleString("vi-VN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})}),e.jsxs("div",{style:{fontSize:"8pt",fontWeight:"bold",marginTop:"0.5mm"},children:["M√£: ",lt(P.id)||P.id]})]}),e.jsxs("div",{style:{border:"1px solid #ddd",padding:"2mm",marginBottom:"3mm",borderRadius:"2mm",backgroundColor:"#f8fafc",fontSize:"8.5pt"},children:[e.jsxs("div",{style:{marginBottom:"1mm"},children:[e.jsx("span",{style:{fontWeight:"bold"},children:"KH:"})," ",P.customer.name]}),P.customer.phone&&e.jsxs("div",{children:[e.jsx("span",{style:{fontWeight:"bold"},children:"SƒêT:"})," ",P.customer.phone]})]}),e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",marginBottom:"3mm",fontSize:"8.5pt"},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{borderBottom:"1px solid #ddd"},children:[e.jsx("th",{style:{textAlign:"left",padding:"1mm",fontSize:"8pt"},children:"S·∫£n ph·∫©m"}),e.jsx("th",{style:{textAlign:"center",padding:"1mm",width:"15%",fontSize:"8pt"},children:"SL"}),e.jsx("th",{style:{textAlign:"right",padding:"1mm",width:"28%",fontSize:"8pt"},children:"Th√†nh ti·ªÅn"})]})}),e.jsx("tbody",{children:P.items.map((t,a)=>{const d=t.sellingPrice||t.sellingprice||t.price||0,o=t.quantity||0;return e.jsxs("tr",{style:{borderBottom:"1px dashed #ddd"},children:[e.jsx("td",{style:{padding:"1.5mm 1mm",fontSize:"8.5pt"},children:t.partName||t.partname}),e.jsx("td",{style:{textAlign:"center",padding:"1.5mm 1mm",fontSize:"8.5pt"},children:o}),e.jsx("td",{style:{textAlign:"right",padding:"1.5mm 1mm",fontSize:"8.5pt",fontWeight:"bold"},children:c(d*o)})]},a)})})]}),e.jsxs("div",{style:{borderTop:"2px solid #333",paddingTop:"2mm",marginBottom:"3mm",fontSize:"9pt"},children:[P.discount>0&&e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"1mm",color:"#e74c3c"},children:[e.jsx("span",{children:"Gi·∫£m gi√°:"}),e.jsxs("span",{children:["-",c(P.discount)]})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",fontWeight:"bold",fontSize:"11pt"},children:[e.jsx("span",{children:"T·ªîNG C·ªòNG:"}),e.jsxs("span",{style:{color:"#2563eb"},children:[c(P.total)," ‚Ç´"]})]})]}),(b==null?void 0:b.bank_name)&&e.jsxs("div",{style:{borderTop:"1px dashed #999",paddingTop:"2mm",marginBottom:"3mm",fontSize:"7.5pt",textAlign:"center"},children:[e.jsxs("div",{style:{fontWeight:"bold",marginBottom:"1mm"},children:["Chuy·ªÉn kho·∫£n: ",b.bank_name]}),b.bank_account_number&&e.jsxs("div",{children:["STK: ",b.bank_account_number]}),b.bank_account_holder&&e.jsx("div",{style:{fontSize:"7pt"},children:b.bank_account_holder}),b.bank_qr_url&&e.jsx("div",{style:{marginTop:"2mm"},children:e.jsx("img",{src:b.bank_qr_url,alt:"QR Banking",style:{height:"20mm",width:"20mm",objectFit:"contain",margin:"0 auto"}})})]}),e.jsxs("div",{style:{textAlign:"center",fontSize:"7.5pt",color:"#666",borderTop:"1px dashed #999",paddingTop:"2mm"},children:[e.jsx("div",{children:"C·∫£m ∆°n qu√Ω kh√°ch!"}),e.jsx("div",{children:"H·∫πn g·∫∑p l·∫°i"})]})]})})})]})}),Z==="products"&&n.length>0&&e.jsxs("button",{onClick:()=>De("cart"),className:"md:hidden fixed bottom-24 right-4 z-50 bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-700 hover:to-indigo-700 text-white rounded-full shadow-2xl p-3 transition-all duration-200 hover:scale-105 active:scale-95","aria-label":"M·ªü gi·ªè h√†ng",children:[e.jsxs("div",{className:"relative",children:[e.jsx(st,{className:"w-5 h-5"}),n.length>0&&e.jsx("span",{className:"absolute -top-2 -right-2 bg-red-500 text-white text-[11px] font-bold rounded-full w-5 h-5 flex items-center justify-center animate-pulse",children:n.length})]}),e.jsx("div",{className:"absolute -top-1 -right-1 w-2.5 h-2.5 bg-red-500 rounded-full animate-ping"})]})]})};export{Ns as default};
