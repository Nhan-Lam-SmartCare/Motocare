import{c as wr,m as ei,n as ti,u as os,o as fn,r as V,j as a,g as Se,h as Or,p as Gr,k as dt,l as Ss,q as gn,t as Xr,a as Os,v as ri,s as be,R as Wr,w as ts,x as si,X as ni,y as ii,z as Ms,A as ai,f as mn,B as Es,P as rs,C as ss,F as ks,T as Qs}from"./index-Y4_AZb1T.js";import{c as oi}from"./permissions-C90GyMnD.js";import{r as li,u as pr,w as bn}from"./xlsx-BBWTpfDg.js";import{u as ci,a as js,C as di,b as hi,c as pn}from"./CategoriesManager-CZhy0prf.js";import ui from"./LookupManager-CAouKQT0.js";import{u as xi,a as fi,b as gi}from"./useInventoryTransactionsRepository-m7d5e4hL.js";import{b as wn}from"./useDebtsRepository-Cema-8BA.js";import{v as Ts}from"./validation-CmPBxZwi.js";import{P as vs}from"./plus-D8vROI23.js";import"./Icons-CZ4PC3V7.js";import"./palette-Bkdd6i3U.js";import"./bike-B3wGI0QP.js";function mi(x,g){for(var h=0;h<g.length;h++){const p=g[h];if(typeof p!="string"&&!Array.isArray(p)){for(const w in p)if(w!=="default"&&!(w in x)){const m=Object.getOwnPropertyDescriptor(p,w);m&&Object.defineProperty(x,w,m.get?m:{enumerable:!0,get:()=>p[w]})}}}return Object.freeze(Object.defineProperty(x,Symbol.toStringTag,{value:"Module"}))}/**
 * @license lucide-react v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bi=wr("Camera",[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]]);/**
 * @license lucide-react v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pi=wr("CloudDownload",[["path",{d:"M12 13v8l-4-4",key:"1f5nwf"}],["path",{d:"m12 21 4-4",key:"1lfcce"}],["path",{d:"M4.393 15.269A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 2.436 8.284",key:"ui1hmy"}]]);/**
 * @license lucide-react v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wi=wr("CloudUpload",[["path",{d:"M12 13v8",key:"1l5pq0"}],["path",{d:"M4 14.899A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 2.5 8.242",key:"1pljnt"}],["path",{d:"m8 17 4-4 4 4",key:"1quai1"}]]);/**
 * @license lucide-react v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Js=wr("Ellipsis",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"19",cy:"12",r:"1",key:"1wjl8i"}],["circle",{cx:"5",cy:"12",r:"1",key:"1pcz8c"}]]);/**
 * @license lucide-react v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ci=wr("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]);/**
 * @license lucide-react v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $s=wr("Repeat",[["path",{d:"m17 2 4 4-4 4",key:"nntrym"}],["path",{d:"M3 11v-1a4 4 0 0 1 4-4h14",key:"84bu3i"}],["path",{d:"m7 22-4-4 4-4",key:"1wqhfi"}],["path",{d:"M21 13v1a4 4 0 0 1-4 4H3",key:"1rx37r"}]]);/**
 * @license lucide-react v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const en=wr("SquarePen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]]),Ni=(x,g,h="inventory-export.xlsx")=>{const p=x.map((k,P)=>{var B;return{STT:P+1,"T√™n s·∫£n ph·∫©m":k.name,SKU:k.sku,"Danh m·ª•c":k.category||"","T·ªìn kho":k.stock[g]||0,"Gi√° b√°n l·∫ª":k.retailPrice[g]||0,"Gi√° b√°n s·ªâ":((B=k.wholesalePrice)==null?void 0:B[g])||0,"Gi√° tr·ªã t·ªìn":(k.stock[g]||0)*(k.retailPrice[g]||0),"M√¥ t·∫£":k.description||""}}),w=pr.json_to_sheet(p);w["!cols"]=[{wch:5},{wch:30},{wch:15},{wch:20},{wch:10},{wch:15},{wch:15},{wch:15},{wch:40}];const m=pr.book_new();pr.book_append_sheet(m,w,"T·ªìn kho"),bn(m,h)},yi=(x="inventory-template.xlsx")=>{const g=[{"T√™n s·∫£n ph·∫©m":"VD: Nh·ªõt Motul 7100 10W40",SKU:"A3B7K9M2 (ho·∫∑c ƒë·ªÉ tr·ªëng - h·ªá th·ªëng t·ª± t·∫°o)","Danh m·ª•c":"Nh·ªõt ƒë·ªông c∆°","S·ªë l∆∞·ª£ng nh·∫≠p":50,"Gi√° b√°n l·∫ª":18e4,"Gi√° b√°n s·ªâ":15e4,"M√¥ t·∫£":"Nh·ªõt cao c·∫•p cho xe c√¥n tay"}],h=pr.json_to_sheet(g);h["!cols"]=[{wch:30},{wch:15},{wch:20},{wch:15},{wch:15},{wch:15},{wch:40}];const p=pr.book_new();pr.book_append_sheet(p,h,"Template"),bn(p,x)},Ai=(x,g)=>new Promise((h,p)=>{const w=new FileReader;w.onload=m=>{var k;try{const P=(k=m.target)==null?void 0:k.result,B=/\.csv$/i.test(x.name),C=li(P,{type:B?"string":"binary"}),R=C.SheetNames[0],_=C.Sheets[R],ne=pr.sheet_to_json(_,{defval:"",blankrows:!1}),$=I=>I.normalize("NFD").replace(new RegExp("\\p{Diacritic}","gu"),"").replace(/ƒë/gi,W=>W==="ƒë"?"d":"D"),q=I=>$(String(I).toLowerCase().trim()).replace(/[^a-z0-9]+/g,""),K=I=>{if(I==null||I==="")return 0;if(typeof I=="number")return I;let W=String(I).trim();W=W.replace(/\s+/g,""),W.includes(".")&&W.includes(",")?W=W.replace(/\./g,"").replace(/,/g,"."):W.includes(",")&&!W.includes(".")?W=W.replace(/,/g,"."):W=W.replace(/,/g,"");const oe=parseFloat(W);return isNaN(oe)?0:oe},ce={name:["tensanpham","ten","productname","name","tenhang","tenmh"],sku:["sku","mahang","mah","code","ma","masp","mavt"],category:["danhmuc","nhom","loai","category"],quantity:["soluongnhap","soluong","ton","tonkho","sl","qty"],costPrice:["dongianhap","gianhap","costprice","giavon"],retailPrice:["giabanle","giale","giaban","gia","retailprice","giabanra","dongiabanle"],wholesalePrice:["giabansi","giasi","wholesaleprice","giabuon","dongiabansi"],description:["mota","ghichu","note","description"]},he=[],X=ne.map((I,W)=>{const oe=I||{},re={};Object.keys(oe).forEach(Ce=>{re[q(Ce)]=oe[Ce]});const S=(Ce,J)=>{for(const Ne of ce[Ce]){const Oe=re[Ne];if(Oe!=null&&Oe!=="")return Oe}return J},U=String(S("name","")).trim();let M=String(S("sku","")).trim().toUpperCase();(!M||!ei(M))&&(M=ti(),console.log(`üîÑ Generated SKU for "${U}": ${M}`));const xe=S("category"),pe=K(S("quantity",0)),G=K(S("costPrice",0)),ie=K(S("retailPrice",0)),ge=K(S("wholesalePrice",0)),j=S("description");if(!U&&Object.values(oe).some(Ce=>Ce!=="")){const Ce=Object.values(oe).map(J=>String(J).trim()).filter(J=>J!=="");if(Ce.length>0&&Ce[0].length>0)return he.push(`H√†ng ${W+2}: Thi·∫øu t√™n s·∫£n ph·∫©m, t·∫°o SKU: ${M}`),null}return U?{name:U,sku:M,category:xe,quantity:pe,costPrice:G,retailPrice:ie,wholesalePrice:ge,description:j}:null}).filter(Boolean);h({items:X,errors:he})}catch(P){const B=P instanceof Error?P.message:"Kh√¥ng ƒë·ªçc ƒë∆∞·ª£c d·ªØ li·ªáu";p(new Error(B))}},w.onerror=()=>{p(new Error("L·ªói ƒë·ªçc file"))},/\.csv$/i.test(x.name)?w.readAsText(x,"utf-8"):w.readAsBinaryString(x)}),Ei=()=>{const{sales:x,workOrders:g,currentBranchId:h}=os(),{data:p,isLoading:w}=fn({page:1,pageSize:20}),m=(p==null?void 0:p.data)||[],[k,P]=V.useState(""),[B,C]=V.useState("all"),[R,_]=V.useState(null),[ne,$]=V.useState("all"),[q,K]=V.useState(null),[ce,he]=V.useState(!1),[X,I]=V.useState(!1),W=V.useMemo(()=>{const U=new Set;return m.forEach(M=>{M.category&&U.add(M.category)}),Array.from(U).sort()},[m]),oe=V.useMemo(()=>m.filter(U=>{var xe,pe;if(k){const G=k.toLowerCase(),ie=U.name.toLowerCase().includes(G),ge=(xe=U.sku)==null?void 0:xe.toLowerCase().includes(G),j=(pe=U.description)==null?void 0:pe.toLowerCase().includes(G);if(!ie&&!ge&&!j)return!1}if(B!=="all"&&U.category!==B)return!1;if(R){const G=U.retailPrice[h]||0;if(G<R.min||G>R.max)return!1}const M=U.stock[h]||0;return!(ne==="in-stock"&&M<=0||ne==="low-stock"&&M>10||ne==="out-of-stock"&&M>0)}),[m,k,B,R,ne,h]),S=q?(U=>{const M=m.find(ge=>ge.id===U);if(!M)return null;const xe=x.filter(ge=>ge.items.some(j=>j.partId===U)),pe=g.filter(ge=>{var j;return(j=ge.partsUsed)==null?void 0:j.some(Ce=>Ce.partId===U)}),G=xe.reduce((ge,j)=>{const Ce=j.items.find(J=>J.partId===U);return ge+((Ce==null?void 0:Ce.quantity)||0)},0),ie=xe.reduce((ge,j)=>{const Ce=j.items.find(J=>J.partId===U);return ge+((Ce==null?void 0:Ce.sellingPrice)||0)*((Ce==null?void 0:Ce.quantity)||0)},0);return{part:M,salesCount:xe.length,totalSold:G,revenue:ie,lastSold:xe.length>0?xe.sort((ge,j)=>new Date(j.date).getTime()-new Date(ge.date).getTime())[0].date:null,workOrdersCount:pe.length}})(q):null;return a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"flex flex-col h-full bg-slate-50 dark:bg-[#0f172a]",children:[a.jsxs("div",{className:"sticky top-0 z-10 bg-white dark:bg-[#1e293b] border-b border-slate-200 dark:border-slate-700 p-3 space-y-2",children:[a.jsx("input",{type:"text",value:k,onChange:U=>P(U.target.value),placeholder:"T√¨m s·∫£n ph·∫©m...",className:"w-full px-4 py-2.5 border border-slate-300 dark:border-slate-600 rounded-lg dark:bg-slate-700 dark:text-slate-100 placeholder-slate-400 text-sm"}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsxs("button",{onClick:()=>he(!0),className:"flex-1 flex items-center justify-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg text-sm font-medium",children:[a.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z"})}),"B·ªô l·ªçc"]}),a.jsxs("div",{className:"px-4 py-2 bg-slate-100 dark:bg-slate-700 rounded-lg text-sm font-medium text-slate-700 dark:text-slate-300",children:[oe.length," sp"]})]})]}),a.jsx("div",{className:"flex-1 overflow-auto",children:oe.length===0?a.jsxs("div",{className:"flex flex-col items-center justify-center h-full p-8 text-center",children:[a.jsxs("svg",{className:"w-16 h-16 text-slate-300 dark:text-slate-600 mb-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[a.jsx("circle",{cx:"11",cy:"11",r:"7"}),a.jsx("path",{d:"m21 21-4.35-4.35"})]}),a.jsx("h3",{className:"text-lg font-semibold text-slate-900 dark:text-slate-100 mb-2",children:"Kh√¥ng t√¨m th·∫•y s·∫£n ph·∫©m"}),a.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400",children:"Th·ª≠ thay ƒë·ªïi b·ªô l·ªçc ho·∫∑c t·ª´ kh√≥a t√¨m ki·∫øm"})]}):a.jsx("div",{className:"divide-y divide-slate-200 dark:divide-slate-700",children:oe.map(U=>{const M=U.stock[h]||0,xe=U.retailPrice[h]||0;return a.jsxs("button",{onClick:()=>{K(U.id),I(!0)},className:"w-full p-4 flex items-center gap-3 bg-white dark:bg-[#1e293b] hover:bg-slate-50 dark:hover:bg-slate-700/50 transition-colors text-left",children:[a.jsx("div",{className:"w-12 h-12 rounded-lg bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center flex-shrink-0",children:a.jsx("svg",{className:"w-6 h-6 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"})})}),a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsx("h3",{className:"font-semibold text-slate-900 dark:text-slate-100 truncate",children:U.name}),a.jsxs("p",{className:"text-xs text-slate-500 dark:text-slate-400",children:["SKU: ",U.sku]}),U.category&&a.jsx("p",{className:"text-xs text-slate-400 dark:text-slate-500 mt-0.5",children:U.category})]}),a.jsxs("div",{className:"text-right flex-shrink-0",children:[a.jsx("div",{className:"text-base font-bold text-blue-600 dark:text-blue-400",children:Se(xe)}),a.jsx("div",{className:"flex items-center gap-1 justify-end mt-1",children:M<=0?a.jsx("span",{className:"px-2 py-0.5 bg-red-100 dark:bg-red-900/30 text-red-700 dark:text-red-400 text-xs rounded",children:"H·∫øt"}):M<=10?a.jsx("span",{className:"px-2 py-0.5 bg-amber-100 dark:bg-amber-900/30 text-amber-700 dark:text-amber-400 text-xs rounded",children:M}):a.jsx("span",{className:"px-2 py-0.5 bg-emerald-100 dark:bg-emerald-900/30 text-emerald-700 dark:text-emerald-400 text-xs rounded",children:M})})]})]},U.id)})})})]}),ce&&a.jsxs("div",{className:"fixed inset-0 z-50 flex items-end",children:[a.jsx("div",{className:"absolute inset-0 bg-black/50",onClick:()=>he(!1)}),a.jsxs("div",{className:"relative bg-white dark:bg-[#1e293b] rounded-t-2xl w-full max-h-[80vh] overflow-hidden flex flex-col",children:[a.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-slate-200 dark:border-slate-700",children:[a.jsx("h3",{className:"text-lg font-semibold text-slate-900 dark:text-slate-100",children:"B·ªô l·ªçc t√¨m ki·∫øm"}),a.jsx("button",{onClick:()=>he(!1),className:"p-2 hover:bg-slate-100 dark:hover:bg-slate-700 rounded-lg",children:a.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),a.jsxs("div",{className:"flex-1 overflow-auto p-4 space-y-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:"Danh m·ª•c"}),a.jsxs("select",{value:B,onChange:U=>C(U.target.value),className:"w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg dark:bg-slate-700 dark:text-slate-100",children:[a.jsx("option",{value:"all",children:"T·∫•t c·∫£ danh m·ª•c"}),W.map(U=>a.jsx("option",{value:U,children:U},U))]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:"T·ªìn kho"}),a.jsx("div",{className:"space-y-2",children:[{value:"all",label:"T·∫•t c·∫£"},{value:"in-stock",label:"C√≤n h√†ng"},{value:"low-stock",label:"S·∫Øp h·∫øt (‚â§10)"},{value:"out-of-stock",label:"H·∫øt h√†ng"}].map(U=>a.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[a.jsx("input",{type:"radio",name:"stock",value:U.value,checked:ne===U.value,onChange:M=>$(M.target.value),className:"w-4 h-4 text-blue-600"}),a.jsx("span",{className:"text-sm text-slate-700 dark:text-slate-300",children:U.label})]},U.value))})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:"Kho·∫£ng gi√°"}),a.jsxs("div",{className:"space-y-2",children:[a.jsxs("div",{className:"flex gap-2",children:[a.jsx("input",{type:"number",placeholder:"T·ª´",onChange:U=>_(M=>({min:Number(U.target.value)||0,max:(M==null?void 0:M.max)||999999999})),className:"flex-1 px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg dark:bg-slate-700 dark:text-slate-100 text-sm"}),a.jsx("input",{type:"number",placeholder:"ƒê·∫øn",onChange:U=>_(M=>({min:(M==null?void 0:M.min)||0,max:Number(U.target.value)||999999999})),className:"flex-1 px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg dark:bg-slate-700 dark:text-slate-100 text-sm"})]}),R&&a.jsx("button",{onClick:()=>_(null),className:"text-xs text-blue-600 dark:text-blue-400 hover:underline",children:"X√≥a b·ªô l·ªçc gi√°"})]})]})]}),a.jsxs("div",{className:"p-4 border-t border-slate-200 dark:border-slate-700 flex gap-2",children:[a.jsx("button",{onClick:()=>{C("all"),$("all"),_(null)},className:"flex-1 px-4 py-2.5 border border-slate-300 dark:border-slate-600 rounded-lg text-sm font-medium text-slate-700 dark:text-slate-300",children:"ƒê·∫∑t l·∫°i"}),a.jsx("button",{onClick:()=>he(!1),className:"flex-1 px-4 py-2.5 bg-blue-600 text-white rounded-lg text-sm font-medium",children:"√Åp d·ª•ng"})]})]})]}),X&&S&&a.jsxs("div",{className:"fixed inset-0 z-50 flex items-end",children:[a.jsx("div",{className:"absolute inset-0 bg-black/50",onClick:()=>I(!1)}),a.jsxs("div",{className:"relative bg-white dark:bg-[#1e293b] rounded-t-2xl w-full max-h-[85vh] overflow-hidden flex flex-col",children:[a.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-slate-200 dark:border-slate-700",children:[a.jsx("h3",{className:"text-lg font-semibold text-slate-900 dark:text-slate-100",children:"Chi ti·∫øt s·∫£n ph·∫©m"}),a.jsx("button",{onClick:()=>I(!1),className:"p-2 hover:bg-slate-100 dark:hover:bg-slate-700 rounded-lg",children:a.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),a.jsxs("div",{className:"flex-1 overflow-auto p-4 space-y-4",children:[a.jsxs("div",{children:[a.jsx("h2",{className:"text-xl font-bold text-slate-900 dark:text-slate-100 mb-1",children:S.part.name}),a.jsxs("p",{className:"text-sm text-slate-600 dark:text-slate-400",children:["SKU: ",S.part.sku]}),S.part.category&&a.jsxs("p",{className:"text-sm text-slate-500 dark:text-slate-400 mt-1",children:["Danh m·ª•c: ",S.part.category]})]}),S.part.description&&a.jsxs("div",{children:[a.jsx("div",{className:"text-xs font-medium text-slate-500 dark:text-slate-400 mb-1",children:"M√¥ t·∫£"}),a.jsx("p",{className:"text-sm text-slate-700 dark:text-slate-300",children:S.part.description})]}),a.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[a.jsxs("div",{className:"p-3 bg-slate-50 dark:bg-slate-800 rounded-lg",children:[a.jsx("div",{className:"text-xs text-slate-500 dark:text-slate-400 mb-1",children:"T·ªìn kho"}),a.jsx("div",{className:"text-2xl font-bold text-slate-900 dark:text-slate-100",children:S.part.stock[h]||0})]}),a.jsxs("div",{className:"p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg",children:[a.jsx("div",{className:"text-xs text-blue-600 dark:text-blue-400 mb-1",children:"Gi√° b√°n l·∫ª"}),a.jsx("div",{className:"text-xl font-bold text-blue-600 dark:text-blue-400",children:Se(S.part.retailPrice[h]||0)})]})]}),a.jsxs("div",{children:[a.jsx("h4",{className:"font-semibold text-slate-900 dark:text-slate-100 mb-3",children:"Th·ªëng k√™ b√°n h√†ng"}),a.jsxs("div",{className:"space-y-3",children:[a.jsxs("div",{className:"bg-gradient-to-br from-blue-50 to-blue-100 dark:from-blue-900/20 dark:to-blue-800/20 p-3 rounded-lg",children:[a.jsx("div",{className:"text-sm text-blue-600 dark:text-blue-400 mb-1",children:"T·ªïng ƒë√£ b√°n"}),a.jsx("div",{className:"text-2xl font-bold text-blue-900 dark:text-blue-100",children:S.totalSold})]}),a.jsxs("div",{className:"bg-gradient-to-br from-emerald-50 to-emerald-100 dark:from-emerald-900/20 dark:to-emerald-800/20 p-3 rounded-lg",children:[a.jsx("div",{className:"text-sm text-emerald-600 dark:text-emerald-400 mb-1",children:"Doanh thu"}),a.jsx("div",{className:"text-xl font-bold text-emerald-900 dark:text-emerald-100",children:Se(S.revenue)})]}),a.jsxs("div",{className:"bg-gradient-to-br from-amber-50 to-amber-100 dark:from-amber-900/20 dark:to-amber-800/20 p-3 rounded-lg",children:[a.jsx("div",{className:"text-sm text-amber-600 dark:text-amber-400 mb-1",children:"S·ªë ƒë∆°n h√†ng"}),a.jsx("div",{className:"text-2xl font-bold text-amber-900 dark:text-amber-100",children:S.salesCount})]}),S.lastSold&&a.jsxs("div",{className:"p-3 bg-slate-50 dark:bg-slate-800 rounded-lg",children:[a.jsx("div",{className:"text-xs text-slate-500 dark:text-slate-400 mb-1",children:"B√°n g·∫ßn nh·∫•t"}),a.jsx("div",{className:"text-sm font-medium text-slate-700 dark:text-slate-300",children:Or(S.lastSold)})]})]})]})]})]})]})]})},_s="suppliers";async function ki(){try{const{data:x,error:g}=await dt.from(_s).select("*").order("name");return g?Gr({code:"supabase",message:"Kh√¥ng th·ªÉ t·∫£i nh√† cung c·∫•p",cause:g}):gn(x||[])}catch(x){return Gr({code:"network",message:"L·ªói k·∫øt n·ªëi",cause:x})}}async function vi(x){var g;try{if(!x.name)return Gr({code:"validation",message:"Thi·∫øu t√™n nh√† cung c·∫•p"});const h={id:typeof crypto<"u"&&crypto.randomUUID?crypto.randomUUID():`${Math.random().toString(36).slice(2)}-${Date.now()}`,name:x.name,phone:x.phone,address:x.address,created_at:new Date().toISOString()},{data:p,error:w}=await dt.from(_s).insert([h]).select().single();if(w||!p){const k=(w==null?void 0:w.message)||(w==null?void 0:w.details)||"T·∫°o nh√† cung c·∫•p th·∫•t b·∫°i";return Gr({code:"supabase",message:k,cause:w})}let m=null;try{const{data:k}=await dt.auth.getUser();m=((g=k==null?void 0:k.user)==null?void 0:g.id)||null}catch{}return await Ss(m,{action:"supplier.create",tableName:_s,recordId:p.id,oldData:null,newData:p}),gn(p)}catch(h){return Gr({code:"network",message:"L·ªói k·∫øt n·ªëi khi t·∫°o nh√† cung c·∫•p",cause:h})}}const Ds=()=>Xr({queryKey:["suppliers"],queryFn:async()=>{const x=await ki();if(!x.ok)throw x.error;return x.data}}),Cn=()=>{const x=Os();return ri({mutationFn:async g=>{const h=await vi(g);if(!h.ok)throw h.error;return h.data},onSuccess:()=>{x.invalidateQueries({queryKey:["suppliers"]}),be.success("ƒê√£ th√™m nh√† cung c·∫•p")},onError:g=>be.error((g==null?void 0:g.message)||"L·ªói th√™m nh√† cung c·∫•p")})},Is=new Intl.NumberFormat("vi-VN",{minimumFractionDigits:0,maximumFractionDigits:2});function Ii(x){let g=x.replace(/[^0-9.,-]/g,"");const h=g.includes("."),p=g.includes(",");h&&p?g=g.replace(/\./g,"").replace(",","."):p&&!h&&(g=g.replace(",","."));const w=Number(g);return Number.isFinite(w)?w:0}const ir=({value:x,onValue:g,placeholder:h,className:p,min:w,max:m,disabled:k,ariaLabel:P})=>{const[B,C]=Wr.useState(x?Is.format(x):""),[R,_]=Wr.useState(!1);Wr.useEffect(()=>{R||C(x?Is.format(x):"")},[x,R]);const ne=q=>{const K=q.target.value;C(K);const ce=Ii(K);if(w!==void 0&&ce<w){g(w);return}if(m!==void 0&&ce>m){g(m);return}g(ce)},$=()=>{_(!1),C(x?Is.format(x):"")};return a.jsx("input",{type:"text",inputMode:"decimal",value:B,onChange:ne,onFocus:()=>_(!0),onBlur:$,placeholder:h,className:p,disabled:k,"aria-label":P})},Si=({isOpen:x,onClose:g,selectedSupplierId:h,onSelectSupplier:p})=>{const[w,m]=V.useState(""),[k,P]=V.useState(!1),{data:B=[]}=Ds(),C=Cn(),[R,_]=V.useState({name:"",phone:"",address:"",note:""}),ne=B.filter(q=>{var ce,he;const K=w.toLowerCase();return((ce=q.name)==null?void 0:ce.toLowerCase().includes(K))||((he=q.phone)==null?void 0:he.toLowerCase().includes(K))}),$=async()=>{if(!R.name.trim()){be.error("Vui l√≤ng nh·∫≠p t√™n nh√† cung c·∫•p");return}try{const q=await C.mutateAsync(R);be.success("ƒê√£ th√™m nh√† cung c·∫•p"),p(q.id),_({name:"",phone:"",address:"",note:""}),P(!1),g()}catch(q){be.error((q==null?void 0:q.message)||"L·ªói th√™m nh√† cung c·∫•p")}};return x?a.jsx("div",{className:"fixed inset-0 bg-black/50 z-[110] flex items-end sm:items-center justify-center",onClick:g,children:a.jsxs("div",{onClick:q=>q.stopPropagation(),className:"bg-white dark:bg-slate-800 w-full sm:max-w-md h-[85vh] sm:h-auto sm:max-h-[80vh] rounded-t-3xl sm:rounded-xl overflow-hidden flex flex-col",children:[a.jsxs("div",{className:"bg-gradient-to-r from-blue-600 to-blue-700 p-4 flex items-center justify-between flex-shrink-0",children:[a.jsx("h3",{className:"text-lg font-bold text-white",children:k?"Th√™m NCC m·ªõi":"Ch·ªçn nh√† cung c·∫•p"}),a.jsx("button",{onClick:g,className:"text-white text-2xl leading-none",children:"√ó"})]}),k?a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:[a.jsxs("div",{children:[a.jsxs("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:["T√™n nh√† cung c·∫•p ",a.jsx("span",{className:"text-red-500",children:"*"})]}),a.jsx("input",{type:"text",value:R.name,onChange:q=>_({...R,name:q.target.value}),placeholder:"Nh·∫≠p t√™n NCC",className:"w-full px-4 py-3 border border-slate-300 dark:border-slate-600 rounded-xl bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:"S·ªë ƒëi·ªán tho·∫°i"}),a.jsx("input",{type:"tel",inputMode:"numeric",value:R.phone,onChange:q=>_({...R,phone:q.target.value}),placeholder:"Nh·∫≠p SƒêT",className:"w-full px-4 py-3 border border-slate-300 dark:border-slate-600 rounded-xl bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:"ƒê·ªãa ch·ªâ"}),a.jsx("textarea",{value:R.address,onChange:q=>_({...R,address:q.target.value}),placeholder:"Nh·∫≠p ƒë·ªãa ch·ªâ",rows:3,className:"w-full px-4 py-3 border border-slate-300 dark:border-slate-600 rounded-xl bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100 resize-none"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:"Ghi ch√∫"}),a.jsx("textarea",{value:R.note,onChange:q=>_({...R,note:q.target.value}),placeholder:"Ghi ch√∫ th√™m",rows:2,className:"w-full px-4 py-3 border border-slate-300 dark:border-slate-600 rounded-xl bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100 resize-none"})]})]}),a.jsxs("div",{className:"p-3 border-t border-slate-200 dark:border-slate-700 flex gap-2 flex-shrink-0",children:[a.jsx("button",{onClick:()=>{P(!1),_({name:"",phone:"",address:"",note:""})},className:"flex-1 py-3 border-2 border-slate-300 dark:border-slate-600 text-slate-700 dark:text-slate-300 rounded-xl font-medium active:scale-98 transition-transform",children:"H·ªßy"}),a.jsx("button",{onClick:$,disabled:!R.name.trim()||C.isPending,className:"flex-1 py-3 bg-blue-600 hover:bg-blue-700 disabled:bg-slate-300 dark:disabled:bg-slate-600 text-white rounded-xl font-bold active:scale-98 transition-transform disabled:cursor-not-allowed",children:C.isPending?"ƒêang th√™m...":"Th√™m NCC"})]})]}):a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"p-3 border-b border-slate-200 dark:border-slate-700 flex-shrink-0",children:a.jsxs("div",{className:"relative",children:[a.jsx("input",{type:"text",placeholder:"T√¨m theo t√™n, SƒêT...",value:w,onChange:q=>m(q.target.value),className:"w-full px-4 py-3 pl-10 border border-slate-300 dark:border-slate-600 rounded-xl bg-slate-50 dark:bg-slate-900 text-slate-900 dark:text-slate-100"}),a.jsx("svg",{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-slate-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})]})}),a.jsx("div",{className:"flex-1 overflow-y-auto p-3 space-y-2",children:ne.length===0?a.jsxs("div",{className:"text-center text-slate-500 py-12",children:[a.jsx("div",{className:"text-5xl mb-3",children:"üë§"}),a.jsx("div",{children:"Kh√¥ng t√¨m th·∫•y nh√† cung c·∫•p"})]}):ne.map(q=>a.jsxs("div",{onClick:()=>{p(q.id),g()},className:`p-4 rounded-xl border-2 cursor-pointer transition-all ${h===q.id?"border-blue-500 bg-blue-50 dark:bg-blue-900/20":"border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800 active:scale-98"}`,children:[a.jsx("div",{className:"font-bold text-slate-900 dark:text-slate-100",children:q.name}),q.phone&&a.jsxs("div",{className:"text-sm text-slate-600 dark:text-slate-400 mt-1",children:["üìû ",q.phone]}),q.address&&a.jsxs("div",{className:"text-sm text-slate-500 dark:text-slate-400 mt-1",children:["üìç ",q.address]})]},q.id))}),a.jsx("div",{className:"p-3 border-t border-slate-200 dark:border-slate-700 flex-shrink-0",children:a.jsxs("button",{onClick:()=>P(!0),className:"w-full py-4 bg-green-600 hover:bg-green-700 active:scale-98 text-white rounded-xl font-bold flex items-center justify-center gap-2 transition-transform",children:[a.jsx("span",{className:"text-xl",children:"+"}),a.jsx("span",{children:"Th√™m nh√† cung c·∫•p m·ªõi"})]})})]})]})}):null};var fe;(function(x){x[x.QR_CODE=0]="QR_CODE",x[x.AZTEC=1]="AZTEC",x[x.CODABAR=2]="CODABAR",x[x.CODE_39=3]="CODE_39",x[x.CODE_93=4]="CODE_93",x[x.CODE_128=5]="CODE_128",x[x.DATA_MATRIX=6]="DATA_MATRIX",x[x.MAXICODE=7]="MAXICODE",x[x.ITF=8]="ITF",x[x.EAN_13=9]="EAN_13",x[x.EAN_8=10]="EAN_8",x[x.PDF_417=11]="PDF_417",x[x.RSS_14=12]="RSS_14",x[x.RSS_EXPANDED=13]="RSS_EXPANDED",x[x.UPC_A=14]="UPC_A",x[x.UPC_E=15]="UPC_E",x[x.UPC_EAN_EXTENSION=16]="UPC_EAN_EXTENSION"})(fe||(fe={}));var tn=new Map([[fe.QR_CODE,"QR_CODE"],[fe.AZTEC,"AZTEC"],[fe.CODABAR,"CODABAR"],[fe.CODE_39,"CODE_39"],[fe.CODE_93,"CODE_93"],[fe.CODE_128,"CODE_128"],[fe.DATA_MATRIX,"DATA_MATRIX"],[fe.MAXICODE,"MAXICODE"],[fe.ITF,"ITF"],[fe.EAN_13,"EAN_13"],[fe.EAN_8,"EAN_8"],[fe.PDF_417,"PDF_417"],[fe.RSS_14,"RSS_14"],[fe.RSS_EXPANDED,"RSS_EXPANDED"],[fe.UPC_A,"UPC_A"],[fe.UPC_E,"UPC_E"],[fe.UPC_EAN_EXTENSION,"UPC_EAN_EXTENSION"]]),rn;(function(x){x[x.UNKNOWN=0]="UNKNOWN",x[x.URL=1]="URL"})(rn||(rn={}));function Ti(x){return Object.values(fe).includes(x)}var ns;(function(x){x[x.SCAN_TYPE_CAMERA=0]="SCAN_TYPE_CAMERA",x[x.SCAN_TYPE_FILE=1]="SCAN_TYPE_FILE"})(ns||(ns={}));var _i=(function(){function x(){}return x.GITHUB_PROJECT_URL="https://github.com/mebjas/html5-qrcode",x.SCAN_DEFAULT_FPS=2,x.DEFAULT_DISABLE_FLIP=!1,x.DEFAULT_REMEMBER_LAST_CAMERA_USED=!0,x.DEFAULT_SUPPORTED_SCAN_TYPE=[ns.SCAN_TYPE_CAMERA,ns.SCAN_TYPE_FILE],x})(),Nn=(function(){function x(g,h){this.format=g,this.formatName=h}return x.prototype.toString=function(){return this.formatName},x.create=function(g){if(!tn.has(g))throw"".concat(g," not in html5QrcodeSupportedFormatsTextMap");return new x(g,tn.get(g))},x})(),sn=(function(){function x(){}return x.createFromText=function(g){var h={text:g};return{decodedText:g,result:h}},x.createFromQrcodeResult=function(g){return{decodedText:g.text,result:g}},x})(),Rs;(function(x){x[x.UNKWOWN_ERROR=0]="UNKWOWN_ERROR",x[x.IMPLEMENTATION_ERROR=1]="IMPLEMENTATION_ERROR",x[x.NO_CODE_FOUND_ERROR=2]="NO_CODE_FOUND_ERROR"})(Rs||(Rs={}));var Ri=(function(){function x(){}return x.createFrom=function(g){return{errorMessage:g,type:Rs.UNKWOWN_ERROR}},x})(),Oi=(function(){function x(g){this.verbose=g}return x.prototype.log=function(g){this.verbose&&console.log(g)},x.prototype.warn=function(g){this.verbose&&console.warn(g)},x.prototype.logError=function(g,h){(this.verbose||h===!0)&&console.error(g)},x.prototype.logErrors=function(g){if(g.length===0)throw"Logger#logError called without arguments";this.verbose&&console.error(g)},x})();function nr(x){return typeof x>"u"||x===null}var Rr=(function(){function x(){}return x.codeParseError=function(g){return"QR code parse error, error = ".concat(g)},x.errorGettingUserMedia=function(g){return"Error getting userMedia, error = ".concat(g)},x.onlyDeviceSupportedError=function(){return"The device doesn't support navigator.mediaDevices , only supported cameraIdOrConfig in this case is deviceId parameter (string)."},x.cameraStreamingNotSupported=function(){return"Camera streaming not supported by the browser."},x.unableToQuerySupportedDevices=function(){return"Unable to query supported devices, unknown error."},x.insecureContextCameraQueryError=function(){return"Camera access is only supported in secure context like https or localhost."},x.scannerPaused=function(){return"Scanner paused"},x})(),yn=(function(){function x(){}return x.isMediaStreamConstraintsValid=function(g,h){if(typeof g!="object"){var p=typeof g;return h.logError("videoConstraints should be of type object, the "+"object passed is of type ".concat(p,"."),!0),!1}for(var w=["autoGainControl","channelCount","echoCancellation","latency","noiseSuppression","sampleRate","sampleSize","volume"],m=new Set(w),k=Object.keys(g),P=0,B=k;P<B.length;P++){var C=B[P];if(m.has(C))return h.logError("".concat(C," is not supported videoConstaints."),!0),!1}return!0},x})(),Hr={exports:{}},Mi=Hr.exports,nn;function ji(){return nn||(nn=1,(function(x,g){(function(h,p){p(g)})(Mi,(function(h){function p(u){return u==null}var w=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(u,e){u.__proto__=e}||function(u,e){for(var t in e)e.hasOwnProperty(t)&&(u[t]=e[t])};function m(u,e){w(u,e);function t(){this.constructor=u}u.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}function k(u,e){var t=Object.setPrototypeOf;t?t(u,e):u.__proto__=e}function P(u,e){e===void 0&&(e=u.constructor);var t=Error.captureStackTrace;t&&t(u,e)}var B=(function(u){m(e,u);function e(t){var r=this.constructor,s=u.call(this,t)||this;return Object.defineProperty(s,"name",{value:r.name,enumerable:!1}),k(s,r.prototype),P(s),s}return e})(Error);class C extends B{constructor(e=void 0){super(e),this.message=e}getKind(){return this.constructor.kind}}C.kind="Exception";class R extends C{}R.kind="ArgumentException";class _ extends C{}_.kind="IllegalArgumentException";class ne{constructor(e){if(this.binarizer=e,e===null)throw new _("Binarizer must be non-null.")}getWidth(){return this.binarizer.getWidth()}getHeight(){return this.binarizer.getHeight()}getBlackRow(e,t){return this.binarizer.getBlackRow(e,t)}getBlackMatrix(){return(this.matrix===null||this.matrix===void 0)&&(this.matrix=this.binarizer.getBlackMatrix()),this.matrix}isCropSupported(){return this.binarizer.getLuminanceSource().isCropSupported()}crop(e,t,r,s){const n=this.binarizer.getLuminanceSource().crop(e,t,r,s);return new ne(this.binarizer.createBinarizer(n))}isRotateSupported(){return this.binarizer.getLuminanceSource().isRotateSupported()}rotateCounterClockwise(){const e=this.binarizer.getLuminanceSource().rotateCounterClockwise();return new ne(this.binarizer.createBinarizer(e))}rotateCounterClockwise45(){const e=this.binarizer.getLuminanceSource().rotateCounterClockwise45();return new ne(this.binarizer.createBinarizer(e))}toString(){try{return this.getBlackMatrix().toString()}catch{return""}}}class $ extends C{static getChecksumInstance(){return new $}}$.kind="ChecksumException";class q{constructor(e){this.source=e}getLuminanceSource(){return this.source}getWidth(){return this.source.getWidth()}getHeight(){return this.source.getHeight()}}class K{static arraycopy(e,t,r,s,n){for(;n--;)r[s++]=e[t++]}static currentTimeMillis(){return Date.now()}}class ce extends C{}ce.kind="IndexOutOfBoundsException";class he extends ce{constructor(e=void 0,t=void 0){super(t),this.index=e,this.message=t}}he.kind="ArrayIndexOutOfBoundsException";class X{static fill(e,t){for(let r=0,s=e.length;r<s;r++)e[r]=t}static fillWithin(e,t,r,s){X.rangeCheck(e.length,t,r);for(let n=t;n<r;n++)e[n]=s}static rangeCheck(e,t,r){if(t>r)throw new _("fromIndex("+t+") > toIndex("+r+")");if(t<0)throw new he(t);if(r>e)throw new he(r)}static asList(...e){return e}static create(e,t,r){return Array.from({length:e}).map(n=>Array.from({length:t}).fill(r))}static createInt32Array(e,t,r){return Array.from({length:e}).map(n=>Int32Array.from({length:t}).fill(r))}static equals(e,t){if(!e||!t||!e.length||!t.length||e.length!==t.length)return!1;for(let r=0,s=e.length;r<s;r++)if(e[r]!==t[r])return!1;return!0}static hashCode(e){if(e===null)return 0;let t=1;for(const r of e)t=31*t+r;return t}static fillUint8Array(e,t){for(let r=0;r!==e.length;r++)e[r]=t}static copyOf(e,t){return e.slice(0,t)}static copyOfUint8Array(e,t){if(e.length<=t){const r=new Uint8Array(t);return r.set(e),r}return e.slice(0,t)}static copyOfRange(e,t,r){const s=r-t,n=new Int32Array(s);return K.arraycopy(e,t,n,0,s),n}static binarySearch(e,t,r){r===void 0&&(r=X.numberComparator);let s=0,n=e.length-1;for(;s<=n;){const i=n+s>>1,o=r(t,e[i]);if(o>0)s=i+1;else if(o<0)n=i-1;else return i}return-s-1}static numberComparator(e,t){return e-t}}class I{static numberOfTrailingZeros(e){let t;if(e===0)return 32;let r=31;return t=e<<16,t!==0&&(r-=16,e=t),t=e<<8,t!==0&&(r-=8,e=t),t=e<<4,t!==0&&(r-=4,e=t),t=e<<2,t!==0&&(r-=2,e=t),r-(e<<1>>>31)}static numberOfLeadingZeros(e){if(e===0)return 32;let t=1;return e>>>16||(t+=16,e<<=16),e>>>24||(t+=8,e<<=8),e>>>28||(t+=4,e<<=4),e>>>30||(t+=2,e<<=2),t-=e>>>31,t}static toHexString(e){return e.toString(16)}static toBinaryString(e){return String(parseInt(String(e),2))}static bitCount(e){return e=e-(e>>>1&1431655765),e=(e&858993459)+(e>>>2&858993459),e=e+(e>>>4)&252645135,e=e+(e>>>8),e=e+(e>>>16),e&63}static truncDivision(e,t){return Math.trunc(e/t)}static parseInt(e,t=void 0){return parseInt(e,t)}}I.MIN_VALUE_32_BITS=-2147483648,I.MAX_VALUE=Number.MAX_SAFE_INTEGER;class W{constructor(e,t){e===void 0?(this.size=0,this.bits=new Int32Array(1)):(this.size=e,t==null?this.bits=W.makeArray(e):this.bits=t)}getSize(){return this.size}getSizeInBytes(){return Math.floor((this.size+7)/8)}ensureCapacity(e){if(e>this.bits.length*32){const t=W.makeArray(e);K.arraycopy(this.bits,0,t,0,this.bits.length),this.bits=t}}get(e){return(this.bits[Math.floor(e/32)]&1<<(e&31))!==0}set(e){this.bits[Math.floor(e/32)]|=1<<(e&31)}flip(e){this.bits[Math.floor(e/32)]^=1<<(e&31)}getNextSet(e){const t=this.size;if(e>=t)return t;const r=this.bits;let s=Math.floor(e/32),n=r[s];n&=~((1<<(e&31))-1);const i=r.length;for(;n===0;){if(++s===i)return t;n=r[s]}const o=s*32+I.numberOfTrailingZeros(n);return o>t?t:o}getNextUnset(e){const t=this.size;if(e>=t)return t;const r=this.bits;let s=Math.floor(e/32),n=~r[s];n&=~((1<<(e&31))-1);const i=r.length;for(;n===0;){if(++s===i)return t;n=~r[s]}const o=s*32+I.numberOfTrailingZeros(n);return o>t?t:o}setBulk(e,t){this.bits[Math.floor(e/32)]=t}setRange(e,t){if(t<e||e<0||t>this.size)throw new _;if(t===e)return;t--;const r=Math.floor(e/32),s=Math.floor(t/32),n=this.bits;for(let i=r;i<=s;i++){const o=i>r?0:e&31,c=(2<<(i<s?31:t&31))-(1<<o);n[i]|=c}}clear(){const e=this.bits.length,t=this.bits;for(let r=0;r<e;r++)t[r]=0}isRange(e,t,r){if(t<e||e<0||t>this.size)throw new _;if(t===e)return!0;t--;const s=Math.floor(e/32),n=Math.floor(t/32),i=this.bits;for(let o=s;o<=n;o++){const l=o>s?0:e&31,d=(2<<(o<n?31:t&31))-(1<<l)&4294967295;if((i[o]&d)!==(r?d:0))return!1}return!0}appendBit(e){this.ensureCapacity(this.size+1),e&&(this.bits[Math.floor(this.size/32)]|=1<<(this.size&31)),this.size++}appendBits(e,t){if(t<0||t>32)throw new _("Num bits must be between 0 and 32");this.ensureCapacity(this.size+t);for(let r=t;r>0;r--)this.appendBit((e>>r-1&1)===1)}appendBitArray(e){const t=e.size;this.ensureCapacity(this.size+t);for(let r=0;r<t;r++)this.appendBit(e.get(r))}xor(e){if(this.size!==e.size)throw new _("Sizes don't match");const t=this.bits;for(let r=0,s=t.length;r<s;r++)t[r]^=e.bits[r]}toBytes(e,t,r,s){for(let n=0;n<s;n++){let i=0;for(let o=0;o<8;o++)this.get(e)&&(i|=1<<7-o),e++;t[r+n]=i}}getBitArray(){return this.bits}reverse(){const e=new Int32Array(this.bits.length),t=Math.floor((this.size-1)/32),r=t+1,s=this.bits;for(let n=0;n<r;n++){let i=s[n];i=i>>1&1431655765|(i&1431655765)<<1,i=i>>2&858993459|(i&858993459)<<2,i=i>>4&252645135|(i&252645135)<<4,i=i>>8&16711935|(i&16711935)<<8,i=i>>16&65535|(i&65535)<<16,e[t-n]=i}if(this.size!==r*32){const n=r*32-this.size;let i=e[0]>>>n;for(let o=1;o<r;o++){const l=e[o];i|=l<<32-n,e[o-1]=i,i=l>>>n}e[r-1]=i}this.bits=e}static makeArray(e){return new Int32Array(Math.floor((e+31)/32))}equals(e){if(!(e instanceof W))return!1;const t=e;return this.size===t.size&&X.equals(this.bits,t.bits)}hashCode(){return 31*this.size+X.hashCode(this.bits)}toString(){let e="";for(let t=0,r=this.size;t<r;t++)(t&7)===0&&(e+=" "),e+=this.get(t)?"X":".";return e}clone(){return new W(this.size,this.bits.slice())}}var oe;(function(u){u[u.OTHER=0]="OTHER",u[u.PURE_BARCODE=1]="PURE_BARCODE",u[u.POSSIBLE_FORMATS=2]="POSSIBLE_FORMATS",u[u.TRY_HARDER=3]="TRY_HARDER",u[u.CHARACTER_SET=4]="CHARACTER_SET",u[u.ALLOWED_LENGTHS=5]="ALLOWED_LENGTHS",u[u.ASSUME_CODE_39_CHECK_DIGIT=6]="ASSUME_CODE_39_CHECK_DIGIT",u[u.ASSUME_GS1=7]="ASSUME_GS1",u[u.RETURN_CODABAR_START_END=8]="RETURN_CODABAR_START_END",u[u.NEED_RESULT_POINT_CALLBACK=9]="NEED_RESULT_POINT_CALLBACK",u[u.ALLOWED_EAN_EXTENSIONS=10]="ALLOWED_EAN_EXTENSIONS"})(oe||(oe={}));var re=oe;class S extends C{static getFormatInstance(){return new S}}S.kind="FormatException";var U;(function(u){u[u.Cp437=0]="Cp437",u[u.ISO8859_1=1]="ISO8859_1",u[u.ISO8859_2=2]="ISO8859_2",u[u.ISO8859_3=3]="ISO8859_3",u[u.ISO8859_4=4]="ISO8859_4",u[u.ISO8859_5=5]="ISO8859_5",u[u.ISO8859_6=6]="ISO8859_6",u[u.ISO8859_7=7]="ISO8859_7",u[u.ISO8859_8=8]="ISO8859_8",u[u.ISO8859_9=9]="ISO8859_9",u[u.ISO8859_10=10]="ISO8859_10",u[u.ISO8859_11=11]="ISO8859_11",u[u.ISO8859_13=12]="ISO8859_13",u[u.ISO8859_14=13]="ISO8859_14",u[u.ISO8859_15=14]="ISO8859_15",u[u.ISO8859_16=15]="ISO8859_16",u[u.SJIS=16]="SJIS",u[u.Cp1250=17]="Cp1250",u[u.Cp1251=18]="Cp1251",u[u.Cp1252=19]="Cp1252",u[u.Cp1256=20]="Cp1256",u[u.UnicodeBigUnmarked=21]="UnicodeBigUnmarked",u[u.UTF8=22]="UTF8",u[u.ASCII=23]="ASCII",u[u.Big5=24]="Big5",u[u.GB18030=25]="GB18030",u[u.EUC_KR=26]="EUC_KR"})(U||(U={}));class M{constructor(e,t,r,...s){this.valueIdentifier=e,this.name=r,typeof t=="number"?this.values=Int32Array.from([t]):this.values=t,this.otherEncodingNames=s,M.VALUE_IDENTIFIER_TO_ECI.set(e,this),M.NAME_TO_ECI.set(r,this);const n=this.values;for(let i=0,o=n.length;i!==o;i++){const l=n[i];M.VALUES_TO_ECI.set(l,this)}for(const i of s)M.NAME_TO_ECI.set(i,this)}getValueIdentifier(){return this.valueIdentifier}getName(){return this.name}getValue(){return this.values[0]}static getCharacterSetECIByValue(e){if(e<0||e>=900)throw new S("incorect value");const t=M.VALUES_TO_ECI.get(e);if(t===void 0)throw new S("incorect value");return t}static getCharacterSetECIByName(e){const t=M.NAME_TO_ECI.get(e);if(t===void 0)throw new S("incorect value");return t}equals(e){if(!(e instanceof M))return!1;const t=e;return this.getName()===t.getName()}}M.VALUE_IDENTIFIER_TO_ECI=new Map,M.VALUES_TO_ECI=new Map,M.NAME_TO_ECI=new Map,M.Cp437=new M(U.Cp437,Int32Array.from([0,2]),"Cp437"),M.ISO8859_1=new M(U.ISO8859_1,Int32Array.from([1,3]),"ISO-8859-1","ISO88591","ISO8859_1"),M.ISO8859_2=new M(U.ISO8859_2,4,"ISO-8859-2","ISO88592","ISO8859_2"),M.ISO8859_3=new M(U.ISO8859_3,5,"ISO-8859-3","ISO88593","ISO8859_3"),M.ISO8859_4=new M(U.ISO8859_4,6,"ISO-8859-4","ISO88594","ISO8859_4"),M.ISO8859_5=new M(U.ISO8859_5,7,"ISO-8859-5","ISO88595","ISO8859_5"),M.ISO8859_6=new M(U.ISO8859_6,8,"ISO-8859-6","ISO88596","ISO8859_6"),M.ISO8859_7=new M(U.ISO8859_7,9,"ISO-8859-7","ISO88597","ISO8859_7"),M.ISO8859_8=new M(U.ISO8859_8,10,"ISO-8859-8","ISO88598","ISO8859_8"),M.ISO8859_9=new M(U.ISO8859_9,11,"ISO-8859-9","ISO88599","ISO8859_9"),M.ISO8859_10=new M(U.ISO8859_10,12,"ISO-8859-10","ISO885910","ISO8859_10"),M.ISO8859_11=new M(U.ISO8859_11,13,"ISO-8859-11","ISO885911","ISO8859_11"),M.ISO8859_13=new M(U.ISO8859_13,15,"ISO-8859-13","ISO885913","ISO8859_13"),M.ISO8859_14=new M(U.ISO8859_14,16,"ISO-8859-14","ISO885914","ISO8859_14"),M.ISO8859_15=new M(U.ISO8859_15,17,"ISO-8859-15","ISO885915","ISO8859_15"),M.ISO8859_16=new M(U.ISO8859_16,18,"ISO-8859-16","ISO885916","ISO8859_16"),M.SJIS=new M(U.SJIS,20,"SJIS","Shift_JIS"),M.Cp1250=new M(U.Cp1250,21,"Cp1250","windows-1250"),M.Cp1251=new M(U.Cp1251,22,"Cp1251","windows-1251"),M.Cp1252=new M(U.Cp1252,23,"Cp1252","windows-1252"),M.Cp1256=new M(U.Cp1256,24,"Cp1256","windows-1256"),M.UnicodeBigUnmarked=new M(U.UnicodeBigUnmarked,25,"UnicodeBigUnmarked","UTF-16BE","UnicodeBig"),M.UTF8=new M(U.UTF8,26,"UTF8","UTF-8"),M.ASCII=new M(U.ASCII,Int32Array.from([27,170]),"ASCII","US-ASCII"),M.Big5=new M(U.Big5,28,"Big5"),M.GB18030=new M(U.GB18030,29,"GB18030","GB2312","EUC_CN","GBK"),M.EUC_KR=new M(U.EUC_KR,30,"EUC_KR","EUC-KR");class xe extends C{}xe.kind="UnsupportedOperationException";class pe{static decode(e,t){const r=this.encodingName(t);return this.customDecoder?this.customDecoder(e,r):typeof TextDecoder>"u"||this.shouldDecodeOnFallback(r)?this.decodeFallback(e,r):new TextDecoder(r).decode(e)}static shouldDecodeOnFallback(e){return!pe.isBrowser()&&e==="ISO-8859-1"}static encode(e,t){const r=this.encodingName(t);return this.customEncoder?this.customEncoder(e,r):typeof TextEncoder>"u"?this.encodeFallback(e):new TextEncoder().encode(e)}static isBrowser(){return typeof window<"u"&&{}.toString.call(window)==="[object Window]"}static encodingName(e){return typeof e=="string"?e:e.getName()}static encodingCharacterSet(e){return e instanceof M?e:M.getCharacterSetECIByName(e)}static decodeFallback(e,t){const r=this.encodingCharacterSet(t);if(pe.isDecodeFallbackSupported(r)){let s="";for(let n=0,i=e.length;n<i;n++){let o=e[n].toString(16);o.length<2&&(o="0"+o),s+="%"+o}return decodeURIComponent(s)}if(r.equals(M.UnicodeBigUnmarked))return String.fromCharCode.apply(null,new Uint16Array(e.buffer));throw new xe(`Encoding ${this.encodingName(t)} not supported by fallback.`)}static isDecodeFallbackSupported(e){return e.equals(M.UTF8)||e.equals(M.ISO8859_1)||e.equals(M.ASCII)}static encodeFallback(e){const r=btoa(unescape(encodeURIComponent(e))).split(""),s=[];for(let n=0;n<r.length;n++)s.push(r[n].charCodeAt(0));return new Uint8Array(s)}}class G{static castAsNonUtf8Char(e,t=null){const r=t?t.getName():this.ISO88591;return pe.decode(new Uint8Array([e]),r)}static guessEncoding(e,t){if(t!=null&&t.get(re.CHARACTER_SET)!==void 0)return t.get(re.CHARACTER_SET).toString();const r=e.length;let s=!0,n=!0,i=!0,o=0,l=0,c=0,d=0,f=0,b=0,y=0,A=0,E=0,O=0,F=0;const ee=e.length>3&&e[0]===239&&e[1]===187&&e[2]===191;for(let te=0;te<r&&(s||n||i);te++){const Z=e[te]&255;i&&(o>0?(Z&128)===0?i=!1:o--:(Z&128)!==0&&((Z&64)===0?i=!1:(o++,(Z&32)===0?l++:(o++,(Z&16)===0?c++:(o++,(Z&8)===0?d++:i=!1))))),s&&(Z>127&&Z<160?s=!1:Z>159&&(Z<192||Z===215||Z===247)&&F++),n&&(f>0?Z<64||Z===127||Z>252?n=!1:f--:Z===128||Z===160||Z>239?n=!1:Z>160&&Z<224?(b++,A=0,y++,y>E&&(E=y)):Z>127?(f++,y=0,A++,A>O&&(O=A)):(y=0,A=0))}return i&&o>0&&(i=!1),n&&f>0&&(n=!1),i&&(ee||l+c+d>0)?G.UTF8:n&&(G.ASSUME_SHIFT_JIS||E>=3||O>=3)?G.SHIFT_JIS:s&&n?E===2&&b===2||F*10>=r?G.SHIFT_JIS:G.ISO88591:s?G.ISO88591:n?G.SHIFT_JIS:i?G.UTF8:G.PLATFORM_DEFAULT_ENCODING}static format(e,...t){let r=-1;function s(i,o,l,c,d,f){if(i==="%%")return"%";if(t[++r]===void 0)return;i=c?parseInt(c.substr(1)):void 0;let b=d?parseInt(d.substr(1)):void 0,y;switch(f){case"s":y=t[r];break;case"c":y=t[r][0];break;case"f":y=parseFloat(t[r]).toFixed(i);break;case"p":y=parseFloat(t[r]).toPrecision(i);break;case"e":y=parseFloat(t[r]).toExponential(i);break;case"x":y=parseInt(t[r]).toString(b||16);break;case"d":y=parseFloat(parseInt(t[r],b||10).toPrecision(i)).toFixed(0);break}y=typeof y=="object"?JSON.stringify(y):(+y).toString(b);let A=parseInt(l),E=l&&l[0]+""=="0"?"0":" ";for(;y.length<A;)y=o!==void 0?y+E:E+y;return y}let n=/%(-)?(0?[0-9]+)?([.][0-9]+)?([#][0-9]+)?([scfpexd%])/g;return e.replace(n,s)}static getBytes(e,t){return pe.encode(e,t)}static getCharCode(e,t=0){return e.charCodeAt(t)}static getCharAt(e){return String.fromCharCode(e)}}G.SHIFT_JIS=M.SJIS.getName(),G.GB2312="GB2312",G.ISO88591=M.ISO8859_1.getName(),G.EUC_JP="EUC_JP",G.UTF8=M.UTF8.getName(),G.PLATFORM_DEFAULT_ENCODING=G.UTF8,G.ASSUME_SHIFT_JIS=!1;class ie{constructor(e=""){this.value=e}enableDecoding(e){return this.encoding=e,this}append(e){return typeof e=="string"?this.value+=e.toString():this.encoding?this.value+=G.castAsNonUtf8Char(e,this.encoding):this.value+=String.fromCharCode(e),this}appendChars(e,t,r){for(let s=t;t<t+r;s++)this.append(e[s]);return this}length(){return this.value.length}charAt(e){return this.value.charAt(e)}deleteCharAt(e){this.value=this.value.substr(0,e)+this.value.substring(e+1)}setCharAt(e,t){this.value=this.value.substr(0,e)+t+this.value.substr(e+1)}substring(e,t){return this.value.substring(e,t)}setLengthToZero(){this.value=""}toString(){return this.value}insert(e,t){this.value=this.value.substr(0,e)+t+this.value.substr(e+t.length)}}class ge{constructor(e,t,r,s){if(this.width=e,this.height=t,this.rowSize=r,this.bits=s,t==null&&(t=e),this.height=t,e<1||t<1)throw new _("Both dimensions must be greater than 0");r==null&&(r=Math.floor((e+31)/32)),this.rowSize=r,s==null&&(this.bits=new Int32Array(this.rowSize*this.height))}static parseFromBooleanArray(e){const t=e.length,r=e[0].length,s=new ge(r,t);for(let n=0;n<t;n++){const i=e[n];for(let o=0;o<r;o++)i[o]&&s.set(o,n)}return s}static parseFromString(e,t,r){if(e===null)throw new _("stringRepresentation cannot be null");const s=new Array(e.length);let n=0,i=0,o=-1,l=0,c=0;for(;c<e.length;)if(e.charAt(c)===`
`||e.charAt(c)==="\r"){if(n>i){if(o===-1)o=n-i;else if(n-i!==o)throw new _("row lengths do not match");i=n,l++}c++}else if(e.substring(c,c+t.length)===t)c+=t.length,s[n]=!0,n++;else if(e.substring(c,c+r.length)===r)c+=r.length,s[n]=!1,n++;else throw new _("illegal character encountered: "+e.substring(c));if(n>i){if(o===-1)o=n-i;else if(n-i!==o)throw new _("row lengths do not match");l++}const d=new ge(o,l);for(let f=0;f<n;f++)s[f]&&d.set(Math.floor(f%o),Math.floor(f/o));return d}get(e,t){const r=t*this.rowSize+Math.floor(e/32);return(this.bits[r]>>>(e&31)&1)!==0}set(e,t){const r=t*this.rowSize+Math.floor(e/32);this.bits[r]|=1<<(e&31)&4294967295}unset(e,t){const r=t*this.rowSize+Math.floor(e/32);this.bits[r]&=~(1<<(e&31)&4294967295)}flip(e,t){const r=t*this.rowSize+Math.floor(e/32);this.bits[r]^=1<<(e&31)&4294967295}xor(e){if(this.width!==e.getWidth()||this.height!==e.getHeight()||this.rowSize!==e.getRowSize())throw new _("input matrix dimensions do not match");const t=new W(Math.floor(this.width/32)+1),r=this.rowSize,s=this.bits;for(let n=0,i=this.height;n<i;n++){const o=n*r,l=e.getRow(n,t).getBitArray();for(let c=0;c<r;c++)s[o+c]^=l[c]}}clear(){const e=this.bits,t=e.length;for(let r=0;r<t;r++)e[r]=0}setRegion(e,t,r,s){if(t<0||e<0)throw new _("Left and top must be nonnegative");if(s<1||r<1)throw new _("Height and width must be at least 1");const n=e+r,i=t+s;if(i>this.height||n>this.width)throw new _("The region must fit inside the matrix");const o=this.rowSize,l=this.bits;for(let c=t;c<i;c++){const d=c*o;for(let f=e;f<n;f++)l[d+Math.floor(f/32)]|=1<<(f&31)&4294967295}}getRow(e,t){t==null||t.getSize()<this.width?t=new W(this.width):t.clear();const r=this.rowSize,s=this.bits,n=e*r;for(let i=0;i<r;i++)t.setBulk(i*32,s[n+i]);return t}setRow(e,t){K.arraycopy(t.getBitArray(),0,this.bits,e*this.rowSize,this.rowSize)}rotate180(){const e=this.getWidth(),t=this.getHeight();let r=new W(e),s=new W(e);for(let n=0,i=Math.floor((t+1)/2);n<i;n++)r=this.getRow(n,r),s=this.getRow(t-1-n,s),r.reverse(),s.reverse(),this.setRow(n,s),this.setRow(t-1-n,r)}getEnclosingRectangle(){const e=this.width,t=this.height,r=this.rowSize,s=this.bits;let n=e,i=t,o=-1,l=-1;for(let c=0;c<t;c++)for(let d=0;d<r;d++){const f=s[c*r+d];if(f!==0){if(c<i&&(i=c),c>l&&(l=c),d*32<n){let b=0;for(;(f<<31-b&4294967295)===0;)b++;d*32+b<n&&(n=d*32+b)}if(d*32+31>o){let b=31;for(;!(f>>>b);)b--;d*32+b>o&&(o=d*32+b)}}}return o<n||l<i?null:Int32Array.from([n,i,o-n+1,l-i+1])}getTopLeftOnBit(){const e=this.rowSize,t=this.bits;let r=0;for(;r<t.length&&t[r]===0;)r++;if(r===t.length)return null;const s=r/e;let n=r%e*32;const i=t[r];let o=0;for(;(i<<31-o&4294967295)===0;)o++;return n+=o,Int32Array.from([n,s])}getBottomRightOnBit(){const e=this.rowSize,t=this.bits;let r=t.length-1;for(;r>=0&&t[r]===0;)r--;if(r<0)return null;const s=Math.floor(r/e);let n=Math.floor(r%e)*32;const i=t[r];let o=31;for(;!(i>>>o);)o--;return n+=o,Int32Array.from([n,s])}getWidth(){return this.width}getHeight(){return this.height}getRowSize(){return this.rowSize}equals(e){if(!(e instanceof ge))return!1;const t=e;return this.width===t.width&&this.height===t.height&&this.rowSize===t.rowSize&&X.equals(this.bits,t.bits)}hashCode(){let e=this.width;return e=31*e+this.width,e=31*e+this.height,e=31*e+this.rowSize,e=31*e+X.hashCode(this.bits),e}toString(e="X ",t="  ",r=`
`){return this.buildToString(e,t,r)}buildToString(e,t,r){let s=new ie;for(let n=0,i=this.height;n<i;n++){for(let o=0,l=this.width;o<l;o++)s.append(this.get(o,n)?e:t);s.append(r)}return s.toString()}clone(){return new ge(this.width,this.height,this.rowSize,this.bits.slice())}}class j extends C{static getNotFoundInstance(){return new j}}j.kind="NotFoundException";class Ce extends q{constructor(e){super(e),this.luminances=Ce.EMPTY,this.buckets=new Int32Array(Ce.LUMINANCE_BUCKETS)}getBlackRow(e,t){const r=this.getLuminanceSource(),s=r.getWidth();t==null||t.getSize()<s?t=new W(s):t.clear(),this.initArrays(s);const n=r.getRow(e,this.luminances),i=this.buckets;for(let l=0;l<s;l++)i[(n[l]&255)>>Ce.LUMINANCE_SHIFT]++;const o=Ce.estimateBlackPoint(i);if(s<3)for(let l=0;l<s;l++)(n[l]&255)<o&&t.set(l);else{let l=n[0]&255,c=n[1]&255;for(let d=1;d<s-1;d++){const f=n[d+1]&255;(c*4-l-f)/2<o&&t.set(d),l=c,c=f}}return t}getBlackMatrix(){const e=this.getLuminanceSource(),t=e.getWidth(),r=e.getHeight(),s=new ge(t,r);this.initArrays(t);const n=this.buckets;for(let l=1;l<5;l++){const c=Math.floor(r*l/5),d=e.getRow(c,this.luminances),f=Math.floor(t*4/5);for(let b=Math.floor(t/5);b<f;b++){const y=d[b]&255;n[y>>Ce.LUMINANCE_SHIFT]++}}const i=Ce.estimateBlackPoint(n),o=e.getMatrix();for(let l=0;l<r;l++){const c=l*t;for(let d=0;d<t;d++)(o[c+d]&255)<i&&s.set(d,l)}return s}createBinarizer(e){return new Ce(e)}initArrays(e){this.luminances.length<e&&(this.luminances=new Uint8ClampedArray(e));const t=this.buckets;for(let r=0;r<Ce.LUMINANCE_BUCKETS;r++)t[r]=0}static estimateBlackPoint(e){const t=e.length;let r=0,s=0,n=0;for(let d=0;d<t;d++)e[d]>n&&(s=d,n=e[d]),e[d]>r&&(r=e[d]);let i=0,o=0;for(let d=0;d<t;d++){const f=d-s,b=e[d]*f*f;b>o&&(i=d,o=b)}if(s>i){const d=s;s=i,i=d}if(i-s<=t/16)throw new j;let l=i-1,c=-1;for(let d=i-1;d>s;d--){const f=d-s,b=f*f*(i-d)*(r-e[d]);b>c&&(l=d,c=b)}return l<<Ce.LUMINANCE_SHIFT}}Ce.LUMINANCE_BITS=5,Ce.LUMINANCE_SHIFT=8-Ce.LUMINANCE_BITS,Ce.LUMINANCE_BUCKETS=1<<Ce.LUMINANCE_BITS,Ce.EMPTY=Uint8ClampedArray.from([0]);class J extends Ce{constructor(e){super(e),this.matrix=null}getBlackMatrix(){if(this.matrix!==null)return this.matrix;const e=this.getLuminanceSource(),t=e.getWidth(),r=e.getHeight();if(t>=J.MINIMUM_DIMENSION&&r>=J.MINIMUM_DIMENSION){const s=e.getMatrix();let n=t>>J.BLOCK_SIZE_POWER;(t&J.BLOCK_SIZE_MASK)!==0&&n++;let i=r>>J.BLOCK_SIZE_POWER;(r&J.BLOCK_SIZE_MASK)!==0&&i++;const o=J.calculateBlackPoints(s,n,i,t,r),l=new ge(t,r);J.calculateThresholdForBlock(s,n,i,t,r,o,l),this.matrix=l}else this.matrix=super.getBlackMatrix();return this.matrix}createBinarizer(e){return new J(e)}static calculateThresholdForBlock(e,t,r,s,n,i,o){const l=n-J.BLOCK_SIZE,c=s-J.BLOCK_SIZE;for(let d=0;d<r;d++){let f=d<<J.BLOCK_SIZE_POWER;f>l&&(f=l);const b=J.cap(d,2,r-3);for(let y=0;y<t;y++){let A=y<<J.BLOCK_SIZE_POWER;A>c&&(A=c);const E=J.cap(y,2,t-3);let O=0;for(let ee=-2;ee<=2;ee++){const te=i[b+ee];O+=te[E-2]+te[E-1]+te[E]+te[E+1]+te[E+2]}const F=O/25;J.thresholdBlock(e,A,f,F,s,o)}}}static cap(e,t,r){return e<t?t:e>r?r:e}static thresholdBlock(e,t,r,s,n,i){for(let o=0,l=r*n+t;o<J.BLOCK_SIZE;o++,l+=n)for(let c=0;c<J.BLOCK_SIZE;c++)(e[l+c]&255)<=s&&i.set(t+c,r+o)}static calculateBlackPoints(e,t,r,s,n){const i=n-J.BLOCK_SIZE,o=s-J.BLOCK_SIZE,l=new Array(r);for(let c=0;c<r;c++){l[c]=new Int32Array(t);let d=c<<J.BLOCK_SIZE_POWER;d>i&&(d=i);for(let f=0;f<t;f++){let b=f<<J.BLOCK_SIZE_POWER;b>o&&(b=o);let y=0,A=255,E=0;for(let F=0,ee=d*s+b;F<J.BLOCK_SIZE;F++,ee+=s){for(let te=0;te<J.BLOCK_SIZE;te++){const Z=e[ee+te]&255;y+=Z,Z<A&&(A=Z),Z>E&&(E=Z)}if(E-A>J.MIN_DYNAMIC_RANGE)for(F++,ee+=s;F<J.BLOCK_SIZE;F++,ee+=s)for(let te=0;te<J.BLOCK_SIZE;te++)y+=e[ee+te]&255}let O=y>>J.BLOCK_SIZE_POWER*2;if(E-A<=J.MIN_DYNAMIC_RANGE&&(O=A/2,c>0&&f>0)){const F=(l[c-1][f]+2*l[c][f-1]+l[c-1][f-1])/4;A<F&&(O=F)}l[c][f]=O}}return l}}J.BLOCK_SIZE_POWER=3,J.BLOCK_SIZE=1<<J.BLOCK_SIZE_POWER,J.BLOCK_SIZE_MASK=J.BLOCK_SIZE-1,J.MINIMUM_DIMENSION=J.BLOCK_SIZE*5,J.MIN_DYNAMIC_RANGE=24;class Ne{constructor(e,t){this.width=e,this.height=t}getWidth(){return this.width}getHeight(){return this.height}isCropSupported(){return!1}crop(e,t,r,s){throw new xe("This luminance source does not support cropping.")}isRotateSupported(){return!1}rotateCounterClockwise(){throw new xe("This luminance source does not support rotation by 90 degrees.")}rotateCounterClockwise45(){throw new xe("This luminance source does not support rotation by 45 degrees.")}toString(){const e=new Uint8ClampedArray(this.width);let t=new ie;for(let r=0;r<this.height;r++){const s=this.getRow(r,e);for(let n=0;n<this.width;n++){const i=s[n]&255;let o;i<64?o="#":i<128?o="+":i<192?o=".":o=" ",t.append(o)}t.append(`
`)}return t.toString()}}class Oe extends Ne{constructor(e){super(e.getWidth(),e.getHeight()),this.delegate=e}getRow(e,t){const r=this.delegate.getRow(e,t),s=this.getWidth();for(let n=0;n<s;n++)r[n]=255-(r[n]&255);return r}getMatrix(){const e=this.delegate.getMatrix(),t=this.getWidth()*this.getHeight(),r=new Uint8ClampedArray(t);for(let s=0;s<t;s++)r[s]=255-(e[s]&255);return r}isCropSupported(){return this.delegate.isCropSupported()}crop(e,t,r,s){return new Oe(this.delegate.crop(e,t,r,s))}isRotateSupported(){return this.delegate.isRotateSupported()}invert(){return this.delegate}rotateCounterClockwise(){return new Oe(this.delegate.rotateCounterClockwise())}rotateCounterClockwise45(){return new Oe(this.delegate.rotateCounterClockwise45())}}class Qe extends Ne{constructor(e){super(e.width,e.height),this.canvas=e,this.tempCanvasElement=null,this.buffer=Qe.makeBufferFromCanvasImageData(e)}static makeBufferFromCanvasImageData(e){const t=e.getContext("2d").getImageData(0,0,e.width,e.height);return Qe.toGrayscaleBuffer(t.data,e.width,e.height)}static toGrayscaleBuffer(e,t,r){const s=new Uint8ClampedArray(t*r);for(let n=0,i=0,o=e.length;n<o;n+=4,i++){let l;if(e[n+3]===0)l=255;else{const d=e[n],f=e[n+1],b=e[n+2];l=306*d+601*f+117*b+512>>10}s[i]=l}return s}getRow(e,t){if(e<0||e>=this.getHeight())throw new _("Requested row is outside the image: "+e);const r=this.getWidth(),s=e*r;return t===null?t=this.buffer.slice(s,s+r):(t.length<r&&(t=new Uint8ClampedArray(r)),t.set(this.buffer.slice(s,s+r))),t}getMatrix(){return this.buffer}isCropSupported(){return!0}crop(e,t,r,s){return super.crop(e,t,r,s),this}isRotateSupported(){return!0}rotateCounterClockwise(){return this.rotate(-90),this}rotateCounterClockwise45(){return this.rotate(-45),this}getTempCanvasElement(){if(this.tempCanvasElement===null){const e=this.canvas.ownerDocument.createElement("canvas");e.width=this.canvas.width,e.height=this.canvas.height,this.tempCanvasElement=e}return this.tempCanvasElement}rotate(e){const t=this.getTempCanvasElement(),r=t.getContext("2d"),s=e*Qe.DEGREE_TO_RADIANS,n=this.canvas.width,i=this.canvas.height,o=Math.ceil(Math.abs(Math.cos(s))*n+Math.abs(Math.sin(s))*i),l=Math.ceil(Math.abs(Math.sin(s))*n+Math.abs(Math.cos(s))*i);return t.width=o,t.height=l,r.translate(o/2,l/2),r.rotate(s),r.drawImage(this.canvas,n/-2,i/-2),this.buffer=Qe.makeBufferFromCanvasImageData(t),this}invert(){return new Oe(this)}}Qe.DEGREE_TO_RADIANS=Math.PI/180;class rt{constructor(e,t,r){this.deviceId=e,this.label=t,this.kind="videoinput",this.groupId=r||void 0}toJSON(){return{kind:this.kind,groupId:this.groupId,deviceId:this.deviceId,label:this.label}}}var Ue=(globalThis||ts||self||window||void 0)&&(globalThis||ts||self||window||void 0).__awaiter||function(u,e,t,r){function s(n){return n instanceof t?n:new t(function(i){i(n)})}return new(t||(t=Promise))(function(n,i){function o(d){try{c(r.next(d))}catch(f){i(f)}}function l(d){try{c(r.throw(d))}catch(f){i(f)}}function c(d){d.done?n(d.value):s(d.value).then(o,l)}c((r=r.apply(u,e||[])).next())})};class Je{constructor(e,t=500,r){this.reader=e,this.timeBetweenScansMillis=t,this._hints=r,this._stopContinuousDecode=!1,this._stopAsyncDecode=!1,this._timeBetweenDecodingAttempts=0}get hasNavigator(){return typeof navigator<"u"}get isMediaDevicesSuported(){return this.hasNavigator&&!!navigator.mediaDevices}get canEnumerateDevices(){return!!(this.isMediaDevicesSuported&&navigator.mediaDevices.enumerateDevices)}get timeBetweenDecodingAttempts(){return this._timeBetweenDecodingAttempts}set timeBetweenDecodingAttempts(e){this._timeBetweenDecodingAttempts=e<0?0:e}set hints(e){this._hints=e||null}get hints(){return this._hints}listVideoInputDevices(){return Ue(this,void 0,void 0,function*(){if(!this.hasNavigator)throw new Error("Can't enumerate devices, navigator is not present.");if(!this.canEnumerateDevices)throw new Error("Can't enumerate devices, method not supported.");const e=yield navigator.mediaDevices.enumerateDevices(),t=[];for(const r of e){const s=r.kind==="video"?"videoinput":r.kind;if(s!=="videoinput")continue;const n=r.deviceId||r.id,i=r.label||`Video device ${t.length+1}`,o=r.groupId,l={deviceId:n,label:i,kind:s,groupId:o};t.push(l)}return t})}getVideoInputDevices(){return Ue(this,void 0,void 0,function*(){return(yield this.listVideoInputDevices()).map(t=>new rt(t.deviceId,t.label))})}findDeviceById(e){return Ue(this,void 0,void 0,function*(){const t=yield this.listVideoInputDevices();return t?t.find(r=>r.deviceId===e):null})}decodeFromInputVideoDevice(e,t){return Ue(this,void 0,void 0,function*(){return yield this.decodeOnceFromVideoDevice(e,t)})}decodeOnceFromVideoDevice(e,t){return Ue(this,void 0,void 0,function*(){this.reset();let r;e?r={deviceId:{exact:e}}:r={facingMode:"environment"};const s={video:r};return yield this.decodeOnceFromConstraints(s,t)})}decodeOnceFromConstraints(e,t){return Ue(this,void 0,void 0,function*(){const r=yield navigator.mediaDevices.getUserMedia(e);return yield this.decodeOnceFromStream(r,t)})}decodeOnceFromStream(e,t){return Ue(this,void 0,void 0,function*(){this.reset();const r=yield this.attachStreamToVideo(e,t);return yield this.decodeOnce(r)})}decodeFromInputVideoDeviceContinuously(e,t,r){return Ue(this,void 0,void 0,function*(){return yield this.decodeFromVideoDevice(e,t,r)})}decodeFromVideoDevice(e,t,r){return Ue(this,void 0,void 0,function*(){let s;e?s={deviceId:{exact:e}}:s={facingMode:"environment"};const n={video:s};return yield this.decodeFromConstraints(n,t,r)})}decodeFromConstraints(e,t,r){return Ue(this,void 0,void 0,function*(){const s=yield navigator.mediaDevices.getUserMedia(e);return yield this.decodeFromStream(s,t,r)})}decodeFromStream(e,t,r){return Ue(this,void 0,void 0,function*(){this.reset();const s=yield this.attachStreamToVideo(e,t);return yield this.decodeContinuously(s,r)})}stopAsyncDecode(){this._stopAsyncDecode=!0}stopContinuousDecode(){this._stopContinuousDecode=!0}attachStreamToVideo(e,t){return Ue(this,void 0,void 0,function*(){const r=this.prepareVideoElement(t);return this.addVideoSource(r,e),this.videoElement=r,this.stream=e,yield this.playVideoOnLoadAsync(r),r})}playVideoOnLoadAsync(e){return new Promise((t,r)=>this.playVideoOnLoad(e,()=>t()))}playVideoOnLoad(e,t){this.videoEndedListener=()=>this.stopStreams(),this.videoCanPlayListener=()=>this.tryPlayVideo(e),e.addEventListener("ended",this.videoEndedListener),e.addEventListener("canplay",this.videoCanPlayListener),e.addEventListener("playing",t),this.tryPlayVideo(e)}isVideoPlaying(e){return e.currentTime>0&&!e.paused&&!e.ended&&e.readyState>2}tryPlayVideo(e){return Ue(this,void 0,void 0,function*(){if(this.isVideoPlaying(e)){console.warn("Trying to play video that is already playing.");return}try{yield e.play()}catch{console.warn("It was not possible to play the video.")}})}getMediaElement(e,t){const r=document.getElementById(e);if(!r)throw new R(`element with id '${e}' not found`);if(r.nodeName.toLowerCase()!==t.toLowerCase())throw new R(`element with id '${e}' must be an ${t} element`);return r}decodeFromImage(e,t){if(!e&&!t)throw new R("either imageElement with a src set or an url must be provided");return t&&!e?this.decodeFromImageUrl(t):this.decodeFromImageElement(e)}decodeFromVideo(e,t){if(!e&&!t)throw new R("Either an element with a src set or an URL must be provided");return t&&!e?this.decodeFromVideoUrl(t):this.decodeFromVideoElement(e)}decodeFromVideoContinuously(e,t,r){if(e===void 0&&t===void 0)throw new R("Either an element with a src set or an URL must be provided");return t&&!e?this.decodeFromVideoUrlContinuously(t,r):this.decodeFromVideoElementContinuously(e,r)}decodeFromImageElement(e){if(!e)throw new R("An image element must be provided.");this.reset();const t=this.prepareImageElement(e);this.imageElement=t;let r;return this.isImageLoaded(t)?r=this.decodeOnce(t,!1,!0):r=this._decodeOnLoadImage(t),r}decodeFromVideoElement(e){const t=this._decodeFromVideoElementSetup(e);return this._decodeOnLoadVideo(t)}decodeFromVideoElementContinuously(e,t){const r=this._decodeFromVideoElementSetup(e);return this._decodeOnLoadVideoContinuously(r,t)}_decodeFromVideoElementSetup(e){if(!e)throw new R("A video element must be provided.");this.reset();const t=this.prepareVideoElement(e);return this.videoElement=t,t}decodeFromImageUrl(e){if(!e)throw new R("An URL must be provided.");this.reset();const t=this.prepareImageElement();this.imageElement=t;const r=this._decodeOnLoadImage(t);return t.src=e,r}decodeFromVideoUrl(e){if(!e)throw new R("An URL must be provided.");this.reset();const t=this.prepareVideoElement(),r=this.decodeFromVideoElement(t);return t.src=e,r}decodeFromVideoUrlContinuously(e,t){if(!e)throw new R("An URL must be provided.");this.reset();const r=this.prepareVideoElement(),s=this.decodeFromVideoElementContinuously(r,t);return r.src=e,s}_decodeOnLoadImage(e){return new Promise((t,r)=>{this.imageLoadedListener=()=>this.decodeOnce(e,!1,!0).then(t,r),e.addEventListener("load",this.imageLoadedListener)})}_decodeOnLoadVideo(e){return Ue(this,void 0,void 0,function*(){return yield this.playVideoOnLoadAsync(e),yield this.decodeOnce(e)})}_decodeOnLoadVideoContinuously(e,t){return Ue(this,void 0,void 0,function*(){yield this.playVideoOnLoadAsync(e),this.decodeContinuously(e,t)})}isImageLoaded(e){return!(!e.complete||e.naturalWidth===0)}prepareImageElement(e){let t;return typeof e>"u"&&(t=document.createElement("img"),t.width=200,t.height=200),typeof e=="string"&&(t=this.getMediaElement(e,"img")),e instanceof HTMLImageElement&&(t=e),t}prepareVideoElement(e){let t;return!e&&typeof document<"u"&&(t=document.createElement("video"),t.width=200,t.height=200),typeof e=="string"&&(t=this.getMediaElement(e,"video")),e instanceof HTMLVideoElement&&(t=e),t.setAttribute("autoplay","true"),t.setAttribute("muted","true"),t.setAttribute("playsinline","true"),t}decodeOnce(e,t=!0,r=!0){this._stopAsyncDecode=!1;const s=(n,i)=>{if(this._stopAsyncDecode){i(new j("Video stream has ended before any code could be detected.")),this._stopAsyncDecode=void 0;return}try{const o=this.decode(e);n(o)}catch(o){const l=t&&o instanceof j,d=(o instanceof $||o instanceof S)&&r;if(l||d)return setTimeout(s,this._timeBetweenDecodingAttempts,n,i);i(o)}};return new Promise((n,i)=>s(n,i))}decodeContinuously(e,t){this._stopContinuousDecode=!1;const r=()=>{if(this._stopContinuousDecode){this._stopContinuousDecode=void 0;return}try{const s=this.decode(e);t(s,null),setTimeout(r,this.timeBetweenScansMillis)}catch(s){t(null,s);const n=s instanceof $||s instanceof S,i=s instanceof j;(n||i)&&setTimeout(r,this._timeBetweenDecodingAttempts)}};r()}decode(e){const t=this.createBinaryBitmap(e);return this.decodeBitmap(t)}_isHTMLVideoElement(e){return e.videoWidth!==0}drawFrameOnCanvas(e,t,r){t||(t={sx:0,sy:0,sWidth:e.videoWidth,sHeight:e.videoHeight,dx:0,dy:0,dWidth:e.videoWidth,dHeight:e.videoHeight}),r||(r=this.captureCanvasContext),r.drawImage(e,t.sx,t.sy,t.sWidth,t.sHeight,t.dx,t.dy,t.dWidth,t.dHeight)}drawImageOnCanvas(e,t,r=this.captureCanvasContext){t||(t={sx:0,sy:0,sWidth:e.naturalWidth,sHeight:e.naturalHeight,dx:0,dy:0,dWidth:e.naturalWidth,dHeight:e.naturalHeight}),r||(r=this.captureCanvasContext),r.drawImage(e,t.sx,t.sy,t.sWidth,t.sHeight,t.dx,t.dy,t.dWidth,t.dHeight)}createBinaryBitmap(e){this.getCaptureCanvasContext(e),this._isHTMLVideoElement(e)?this.drawFrameOnCanvas(e):this.drawImageOnCanvas(e);const t=this.getCaptureCanvas(e),r=new Qe(t),s=new J(r);return new ne(s)}getCaptureCanvasContext(e){if(!this.captureCanvasContext){const r=this.getCaptureCanvas(e).getContext("2d");this.captureCanvasContext=r}return this.captureCanvasContext}getCaptureCanvas(e){if(!this.captureCanvas){const t=this.createCaptureCanvas(e);this.captureCanvas=t}return this.captureCanvas}decodeBitmap(e){return this.reader.decode(e,this._hints)}createCaptureCanvas(e){if(typeof document>"u")return this._destroyCaptureCanvas(),null;const t=document.createElement("canvas");let r,s;return typeof e<"u"&&(e instanceof HTMLVideoElement?(r=e.videoWidth,s=e.videoHeight):e instanceof HTMLImageElement&&(r=e.naturalWidth||e.width,s=e.naturalHeight||e.height)),t.style.width=r+"px",t.style.height=s+"px",t.width=r,t.height=s,t}stopStreams(){this.stream&&(this.stream.getVideoTracks().forEach(e=>e.stop()),this.stream=void 0),this._stopAsyncDecode===!1&&this.stopAsyncDecode(),this._stopContinuousDecode===!1&&this.stopContinuousDecode()}reset(){this.stopStreams(),this._destroyVideoElement(),this._destroyImageElement(),this._destroyCaptureCanvas()}_destroyVideoElement(){this.videoElement&&(typeof this.videoEndedListener<"u"&&this.videoElement.removeEventListener("ended",this.videoEndedListener),typeof this.videoPlayingEventListener<"u"&&this.videoElement.removeEventListener("playing",this.videoPlayingEventListener),typeof this.videoCanPlayListener<"u"&&this.videoElement.removeEventListener("loadedmetadata",this.videoCanPlayListener),this.cleanVideoSource(this.videoElement),this.videoElement=void 0)}_destroyImageElement(){this.imageElement&&(this.imageLoadedListener!==void 0&&this.imageElement.removeEventListener("load",this.imageLoadedListener),this.imageElement.src=void 0,this.imageElement.removeAttribute("src"),this.imageElement=void 0)}_destroyCaptureCanvas(){this.captureCanvasContext=void 0,this.captureCanvas=void 0}addVideoSource(e,t){try{e.srcObject=t}catch{e.src=URL.createObjectURL(t)}}cleanVideoSource(e){try{e.srcObject=null}catch{e.src=""}this.videoElement.removeAttribute("src")}}class z{constructor(e,t,r=t==null?0:8*t.length,s,n,i=K.currentTimeMillis()){this.text=e,this.rawBytes=t,this.numBits=r,this.resultPoints=s,this.format=n,this.timestamp=i,this.text=e,this.rawBytes=t,r==null?this.numBits=t==null?0:8*t.length:this.numBits=r,this.resultPoints=s,this.format=n,this.resultMetadata=null,i==null?this.timestamp=K.currentTimeMillis():this.timestamp=i}getText(){return this.text}getRawBytes(){return this.rawBytes}getNumBits(){return this.numBits}getResultPoints(){return this.resultPoints}getBarcodeFormat(){return this.format}getResultMetadata(){return this.resultMetadata}putMetadata(e,t){this.resultMetadata===null&&(this.resultMetadata=new Map),this.resultMetadata.set(e,t)}putAllMetadata(e){e!==null&&(this.resultMetadata===null?this.resultMetadata=e:this.resultMetadata=new Map(e))}addResultPoints(e){const t=this.resultPoints;if(t===null)this.resultPoints=e;else if(e!==null&&e.length>0){const r=new Array(t.length+e.length);K.arraycopy(t,0,r,0,t.length),K.arraycopy(e,0,r,t.length,e.length),this.resultPoints=r}}getTimestamp(){return this.timestamp}toString(){return this.text}}var Ae;(function(u){u[u.AZTEC=0]="AZTEC",u[u.CODABAR=1]="CODABAR",u[u.CODE_39=2]="CODE_39",u[u.CODE_93=3]="CODE_93",u[u.CODE_128=4]="CODE_128",u[u.DATA_MATRIX=5]="DATA_MATRIX",u[u.EAN_8=6]="EAN_8",u[u.EAN_13=7]="EAN_13",u[u.ITF=8]="ITF",u[u.MAXICODE=9]="MAXICODE",u[u.PDF_417=10]="PDF_417",u[u.QR_CODE=11]="QR_CODE",u[u.RSS_14=12]="RSS_14",u[u.RSS_EXPANDED=13]="RSS_EXPANDED",u[u.UPC_A=14]="UPC_A",u[u.UPC_E=15]="UPC_E",u[u.UPC_EAN_EXTENSION=16]="UPC_EAN_EXTENSION"})(Ae||(Ae={}));var le=Ae,Ve;(function(u){u[u.OTHER=0]="OTHER",u[u.ORIENTATION=1]="ORIENTATION",u[u.BYTE_SEGMENTS=2]="BYTE_SEGMENTS",u[u.ERROR_CORRECTION_LEVEL=3]="ERROR_CORRECTION_LEVEL",u[u.ISSUE_NUMBER=4]="ISSUE_NUMBER",u[u.SUGGESTED_PRICE=5]="SUGGESTED_PRICE",u[u.POSSIBLE_COUNTRY=6]="POSSIBLE_COUNTRY",u[u.UPC_EAN_EXTENSION=7]="UPC_EAN_EXTENSION",u[u.PDF417_EXTRA_METADATA=8]="PDF417_EXTRA_METADATA",u[u.STRUCTURED_APPEND_SEQUENCE=9]="STRUCTURED_APPEND_SEQUENCE",u[u.STRUCTURED_APPEND_PARITY=10]="STRUCTURED_APPEND_PARITY"})(Ve||(Ve={}));var Ge=Ve;class ot{constructor(e,t,r,s,n=-1,i=-1){this.rawBytes=e,this.text=t,this.byteSegments=r,this.ecLevel=s,this.structuredAppendSequenceNumber=n,this.structuredAppendParity=i,this.numBits=e==null?0:8*e.length}getRawBytes(){return this.rawBytes}getNumBits(){return this.numBits}setNumBits(e){this.numBits=e}getText(){return this.text}getByteSegments(){return this.byteSegments}getECLevel(){return this.ecLevel}getErrorsCorrected(){return this.errorsCorrected}setErrorsCorrected(e){this.errorsCorrected=e}getErasures(){return this.erasures}setErasures(e){this.erasures=e}getOther(){return this.other}setOther(e){this.other=e}hasStructuredAppend(){return this.structuredAppendParity>=0&&this.structuredAppendSequenceNumber>=0}getStructuredAppendParity(){return this.structuredAppendParity}getStructuredAppendSequenceNumber(){return this.structuredAppendSequenceNumber}}class Wt{exp(e){return this.expTable[e]}log(e){if(e===0)throw new _;return this.logTable[e]}static addOrSubtract(e,t){return e^t}}class T{constructor(e,t){if(t.length===0)throw new _;this.field=e;const r=t.length;if(r>1&&t[0]===0){let s=1;for(;s<r&&t[s]===0;)s++;s===r?this.coefficients=Int32Array.from([0]):(this.coefficients=new Int32Array(r-s),K.arraycopy(t,s,this.coefficients,0,this.coefficients.length))}else this.coefficients=t}getCoefficients(){return this.coefficients}getDegree(){return this.coefficients.length-1}isZero(){return this.coefficients[0]===0}getCoefficient(e){return this.coefficients[this.coefficients.length-1-e]}evaluateAt(e){if(e===0)return this.getCoefficient(0);const t=this.coefficients;let r;if(e===1){r=0;for(let i=0,o=t.length;i!==o;i++){const l=t[i];r=Wt.addOrSubtract(r,l)}return r}r=t[0];const s=t.length,n=this.field;for(let i=1;i<s;i++)r=Wt.addOrSubtract(n.multiply(e,r),t[i]);return r}addOrSubtract(e){if(!this.field.equals(e.field))throw new _("GenericGFPolys do not have same GenericGF field");if(this.isZero())return e;if(e.isZero())return this;let t=this.coefficients,r=e.coefficients;if(t.length>r.length){const i=t;t=r,r=i}let s=new Int32Array(r.length);const n=r.length-t.length;K.arraycopy(r,0,s,0,n);for(let i=n;i<r.length;i++)s[i]=Wt.addOrSubtract(t[i-n],r[i]);return new T(this.field,s)}multiply(e){if(!this.field.equals(e.field))throw new _("GenericGFPolys do not have same GenericGF field");if(this.isZero()||e.isZero())return this.field.getZero();const t=this.coefficients,r=t.length,s=e.coefficients,n=s.length,i=new Int32Array(r+n-1),o=this.field;for(let l=0;l<r;l++){const c=t[l];for(let d=0;d<n;d++)i[l+d]=Wt.addOrSubtract(i[l+d],o.multiply(c,s[d]))}return new T(o,i)}multiplyScalar(e){if(e===0)return this.field.getZero();if(e===1)return this;const t=this.coefficients.length,r=this.field,s=new Int32Array(t),n=this.coefficients;for(let i=0;i<t;i++)s[i]=r.multiply(n[i],e);return new T(r,s)}multiplyByMonomial(e,t){if(e<0)throw new _;if(t===0)return this.field.getZero();const r=this.coefficients,s=r.length,n=new Int32Array(s+e),i=this.field;for(let o=0;o<s;o++)n[o]=i.multiply(r[o],t);return new T(i,n)}divide(e){if(!this.field.equals(e.field))throw new _("GenericGFPolys do not have same GenericGF field");if(e.isZero())throw new _("Divide by 0");const t=this.field;let r=t.getZero(),s=this;const n=e.getCoefficient(e.getDegree()),i=t.inverse(n);for(;s.getDegree()>=e.getDegree()&&!s.isZero();){const o=s.getDegree()-e.getDegree(),l=t.multiply(s.getCoefficient(s.getDegree()),i),c=e.multiplyByMonomial(o,l),d=t.buildMonomial(o,l);r=r.addOrSubtract(d),s=s.addOrSubtract(c)}return[r,s]}toString(){let e="";for(let t=this.getDegree();t>=0;t--){let r=this.getCoefficient(t);if(r!==0){if(r<0?(e+=" - ",r=-r):e.length>0&&(e+=" + "),t===0||r!==1){const s=this.field.log(r);s===0?e+="1":s===1?e+="a":(e+="a^",e+=s)}t!==0&&(t===1?e+="x":(e+="x^",e+=t))}}return e}}class de extends C{}de.kind="ArithmeticException";class se extends Wt{constructor(e,t,r){super(),this.primitive=e,this.size=t,this.generatorBase=r;const s=new Int32Array(t);let n=1;for(let o=0;o<t;o++)s[o]=n,n*=2,n>=t&&(n^=e,n&=t-1);this.expTable=s;const i=new Int32Array(t);for(let o=0;o<t-1;o++)i[s[o]]=o;this.logTable=i,this.zero=new T(this,Int32Array.from([0])),this.one=new T(this,Int32Array.from([1]))}getZero(){return this.zero}getOne(){return this.one}buildMonomial(e,t){if(e<0)throw new _;if(t===0)return this.zero;const r=new Int32Array(e+1);return r[0]=t,new T(this,r)}inverse(e){if(e===0)throw new de;return this.expTable[this.size-this.logTable[e]-1]}multiply(e,t){return e===0||t===0?0:this.expTable[(this.logTable[e]+this.logTable[t])%(this.size-1)]}getSize(){return this.size}getGeneratorBase(){return this.generatorBase}toString(){return"GF(0x"+I.toHexString(this.primitive)+","+this.size+")"}equals(e){return e===this}}se.AZTEC_DATA_12=new se(4201,4096,1),se.AZTEC_DATA_10=new se(1033,1024,1),se.AZTEC_DATA_6=new se(67,64,1),se.AZTEC_PARAM=new se(19,16,1),se.QR_CODE_FIELD_256=new se(285,256,0),se.DATA_MATRIX_FIELD_256=new se(301,256,1),se.AZTEC_DATA_8=se.DATA_MATRIX_FIELD_256,se.MAXICODE_FIELD_64=se.AZTEC_DATA_6;class ke extends C{}ke.kind="ReedSolomonException";class _e extends C{}_e.kind="IllegalStateException";class st{constructor(e){this.field=e}decode(e,t){const r=this.field,s=new T(r,e),n=new Int32Array(t);let i=!0;for(let y=0;y<t;y++){const A=s.evaluateAt(r.exp(y+r.getGeneratorBase()));n[n.length-1-y]=A,A!==0&&(i=!1)}if(i)return;const o=new T(r,n),l=this.runEuclideanAlgorithm(r.buildMonomial(t,1),o,t),c=l[0],d=l[1],f=this.findErrorLocations(c),b=this.findErrorMagnitudes(d,f);for(let y=0;y<f.length;y++){const A=e.length-1-r.log(f[y]);if(A<0)throw new ke("Bad error location");e[A]=se.addOrSubtract(e[A],b[y])}}runEuclideanAlgorithm(e,t,r){if(e.getDegree()<t.getDegree()){const y=e;e=t,t=y}const s=this.field;let n=e,i=t,o=s.getZero(),l=s.getOne();for(;i.getDegree()>=(r/2|0);){let y=n,A=o;if(n=i,o=l,n.isZero())throw new ke("r_{i-1} was zero");i=y;let E=s.getZero();const O=n.getCoefficient(n.getDegree()),F=s.inverse(O);for(;i.getDegree()>=n.getDegree()&&!i.isZero();){const ee=i.getDegree()-n.getDegree(),te=s.multiply(i.getCoefficient(i.getDegree()),F);E=E.addOrSubtract(s.buildMonomial(ee,te)),i=i.addOrSubtract(n.multiplyByMonomial(ee,te))}if(l=E.multiply(o).addOrSubtract(A),i.getDegree()>=n.getDegree())throw new _e("Division algorithm failed to reduce polynomial?")}const c=l.getCoefficient(0);if(c===0)throw new ke("sigmaTilde(0) was zero");const d=s.inverse(c),f=l.multiplyScalar(d),b=i.multiplyScalar(d);return[f,b]}findErrorLocations(e){const t=e.getDegree();if(t===1)return Int32Array.from([e.getCoefficient(1)]);const r=new Int32Array(t);let s=0;const n=this.field;for(let i=1;i<n.getSize()&&s<t;i++)e.evaluateAt(i)===0&&(r[s]=n.inverse(i),s++);if(s!==t)throw new ke("Error locator degree does not match number of roots");return r}findErrorMagnitudes(e,t){const r=t.length,s=new Int32Array(r),n=this.field;for(let i=0;i<r;i++){const o=n.inverse(t[i]);let l=1;for(let c=0;c<r;c++)if(i!==c){const d=n.multiply(t[c],o),f=(d&1)===0?d|1:d&-2;l=n.multiply(l,f)}s[i]=n.multiply(e.evaluateAt(o),n.inverse(l)),n.getGeneratorBase()!==0&&(s[i]=n.multiply(s[i],o))}return s}}var ht;(function(u){u[u.UPPER=0]="UPPER",u[u.LOWER=1]="LOWER",u[u.MIXED=2]="MIXED",u[u.DIGIT=3]="DIGIT",u[u.PUNCT=4]="PUNCT",u[u.BINARY=5]="BINARY"})(ht||(ht={}));class De{decode(e){this.ddata=e;let t=e.getBits(),r=this.extractBits(t),s=this.correctBits(r),n=De.convertBoolArrayToByteArray(s),i=De.getEncodedData(s),o=new ot(n,i,null,null);return o.setNumBits(s.length),o}static highLevelDecode(e){return this.getEncodedData(e)}static getEncodedData(e){let t=e.length,r=ht.UPPER,s=ht.UPPER,n="",i=0;for(;i<t;)if(s===ht.BINARY){if(t-i<5)break;let o=De.readCode(e,i,5);if(i+=5,o===0){if(t-i<11)break;o=De.readCode(e,i,11)+31,i+=11}for(let l=0;l<o;l++){if(t-i<8){i=t;break}const c=De.readCode(e,i,8);n+=G.castAsNonUtf8Char(c),i+=8}s=r}else{let o=s===ht.DIGIT?4:5;if(t-i<o)break;let l=De.readCode(e,i,o);i+=o;let c=De.getCharacter(s,l);c.startsWith("CTRL_")?(r=s,s=De.getTable(c.charAt(5)),c.charAt(6)==="L"&&(r=s)):(n+=c,s=r)}return n}static getTable(e){switch(e){case"L":return ht.LOWER;case"P":return ht.PUNCT;case"M":return ht.MIXED;case"D":return ht.DIGIT;case"B":return ht.BINARY;case"U":default:return ht.UPPER}}static getCharacter(e,t){switch(e){case ht.UPPER:return De.UPPER_TABLE[t];case ht.LOWER:return De.LOWER_TABLE[t];case ht.MIXED:return De.MIXED_TABLE[t];case ht.PUNCT:return De.PUNCT_TABLE[t];case ht.DIGIT:return De.DIGIT_TABLE[t];default:throw new _e("Bad table")}}correctBits(e){let t,r;this.ddata.getNbLayers()<=2?(r=6,t=se.AZTEC_DATA_6):this.ddata.getNbLayers()<=8?(r=8,t=se.AZTEC_DATA_8):this.ddata.getNbLayers()<=22?(r=10,t=se.AZTEC_DATA_10):(r=12,t=se.AZTEC_DATA_12);let s=this.ddata.getNbDatablocks(),n=e.length/r;if(n<s)throw new S;let i=e.length%r,o=new Int32Array(n);for(let b=0;b<n;b++,i+=r)o[b]=De.readCode(e,i,r);try{new st(t).decode(o,n-s)}catch(b){throw new S(b)}let l=(1<<r)-1,c=0;for(let b=0;b<s;b++){let y=o[b];if(y===0||y===l)throw new S;(y===1||y===l-1)&&c++}let d=new Array(s*r-c),f=0;for(let b=0;b<s;b++){let y=o[b];if(y===1||y===l-1)d.fill(y>1,f,f+r-1),f+=r-1;else for(let A=r-1;A>=0;--A)d[f++]=(y&1<<A)!==0}return d}extractBits(e){let t=this.ddata.isCompact(),r=this.ddata.getNbLayers(),s=(t?11:14)+r*4,n=new Int32Array(s),i=new Array(this.totalBitsInLayer(r,t));if(t)for(let o=0;o<n.length;o++)n[o]=o;else{let o=s+1+2*I.truncDivision(I.truncDivision(s,2)-1,15),l=s/2,c=I.truncDivision(o,2);for(let d=0;d<l;d++){let f=d+I.truncDivision(d,15);n[l-d-1]=c-f-1,n[l+d]=c+f+1}}for(let o=0,l=0;o<r;o++){let c=(r-o)*4+(t?9:12),d=o*2,f=s-1-d;for(let b=0;b<c;b++){let y=b*2;for(let A=0;A<2;A++)i[l+y+A]=e.get(n[d+A],n[d+b]),i[l+2*c+y+A]=e.get(n[d+b],n[f-A]),i[l+4*c+y+A]=e.get(n[f-A],n[f-b]),i[l+6*c+y+A]=e.get(n[f-b],n[d+A])}l+=c*8}return i}static readCode(e,t,r){let s=0;for(let n=t;n<t+r;n++)s<<=1,e[n]&&(s|=1);return s}static readByte(e,t){let r=e.length-t;return r>=8?De.readCode(e,t,8):De.readCode(e,t,r)<<8-r}static convertBoolArrayToByteArray(e){let t=new Uint8Array((e.length+7)/8);for(let r=0;r<t.length;r++)t[r]=De.readByte(e,8*r);return t}totalBitsInLayer(e,t){return((t?88:112)+16*e)*e}}De.UPPER_TABLE=["CTRL_PS"," ","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","CTRL_LL","CTRL_ML","CTRL_DL","CTRL_BS"],De.LOWER_TABLE=["CTRL_PS"," ","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","CTRL_US","CTRL_ML","CTRL_DL","CTRL_BS"],De.MIXED_TABLE=["CTRL_PS"," ","\\1","\\2","\\3","\\4","\\5","\\6","\\7","\b","	",`
`,"\\13","\f","\r","\\33","\\34","\\35","\\36","\\37","@","\\","^","_","`","|","~","\\177","CTRL_LL","CTRL_UL","CTRL_PL","CTRL_BS"],De.PUNCT_TABLE=["","\r",`\r
`,". ",", ",": ","!",'"',"#","$","%","&","'","(",")","*","+",",","-",".","/",":",";","<","=",">","?","[","]","{","}","CTRL_UL"],De.DIGIT_TABLE=["CTRL_PS"," ","0","1","2","3","4","5","6","7","8","9",",",".","CTRL_UL","CTRL_US"];class Be{constructor(){}static round(e){return e===NaN?0:e<=Number.MIN_SAFE_INTEGER?Number.MIN_SAFE_INTEGER:e>=Number.MAX_SAFE_INTEGER?Number.MAX_SAFE_INTEGER:e+(e<0?-.5:.5)|0}static distance(e,t,r,s){const n=e-r,i=t-s;return Math.sqrt(n*n+i*i)}static sum(e){let t=0;for(let r=0,s=e.length;r!==s;r++){const n=e[r];t+=n}return t}}class Cr{static floatToIntBits(e){return e}}Cr.MAX_VALUE=Number.MAX_SAFE_INTEGER;class ue{constructor(e,t){this.x=e,this.y=t}getX(){return this.x}getY(){return this.y}equals(e){if(e instanceof ue){const t=e;return this.x===t.x&&this.y===t.y}return!1}hashCode(){return 31*Cr.floatToIntBits(this.x)+Cr.floatToIntBits(this.y)}toString(){return"("+this.x+","+this.y+")"}static orderBestPatterns(e){const t=this.distance(e[0],e[1]),r=this.distance(e[1],e[2]),s=this.distance(e[0],e[2]);let n,i,o;if(r>=t&&r>=s?(i=e[0],n=e[1],o=e[2]):s>=r&&s>=t?(i=e[1],n=e[0],o=e[2]):(i=e[2],n=e[0],o=e[1]),this.crossProductZ(n,i,o)<0){const l=n;n=o,o=l}e[0]=n,e[1]=i,e[2]=o}static distance(e,t){return Be.distance(e.x,e.y,t.x,t.y)}static crossProductZ(e,t,r){const s=t.x,n=t.y;return(r.x-s)*(e.y-n)-(r.y-n)*(e.x-s)}}class xr{constructor(e,t){this.bits=e,this.points=t}getBits(){return this.bits}getPoints(){return this.points}}class zr extends xr{constructor(e,t,r,s,n){super(e,t),this.compact=r,this.nbDatablocks=s,this.nbLayers=n}getNbLayers(){return this.nbLayers}getNbDatablocks(){return this.nbDatablocks}isCompact(){return this.compact}}class Kt{constructor(e,t,r,s){this.image=e,this.height=e.getHeight(),this.width=e.getWidth(),t==null&&(t=Kt.INIT_SIZE),r==null&&(r=e.getWidth()/2|0),s==null&&(s=e.getHeight()/2|0);const n=t/2|0;if(this.leftInit=r-n,this.rightInit=r+n,this.upInit=s-n,this.downInit=s+n,this.upInit<0||this.leftInit<0||this.downInit>=this.height||this.rightInit>=this.width)throw new j}detect(){let e=this.leftInit,t=this.rightInit,r=this.upInit,s=this.downInit,n=!1,i=!0,o=!1,l=!1,c=!1,d=!1,f=!1;const b=this.width,y=this.height;for(;i;){i=!1;let A=!0;for(;(A||!l)&&t<b;)A=this.containsBlackPoint(r,s,t,!1),A?(t++,i=!0,l=!0):l||t++;if(t>=b){n=!0;break}let E=!0;for(;(E||!c)&&s<y;)E=this.containsBlackPoint(e,t,s,!0),E?(s++,i=!0,c=!0):c||s++;if(s>=y){n=!0;break}let O=!0;for(;(O||!d)&&e>=0;)O=this.containsBlackPoint(r,s,e,!1),O?(e--,i=!0,d=!0):d||e--;if(e<0){n=!0;break}let F=!0;for(;(F||!f)&&r>=0;)F=this.containsBlackPoint(e,t,r,!0),F?(r--,i=!0,f=!0):f||r--;if(r<0){n=!0;break}i&&(o=!0)}if(!n&&o){const A=t-e;let E=null;for(let te=1;E===null&&te<A;te++)E=this.getBlackPointOnSegment(e,s-te,e+te,s);if(E==null)throw new j;let O=null;for(let te=1;O===null&&te<A;te++)O=this.getBlackPointOnSegment(e,r+te,e+te,r);if(O==null)throw new j;let F=null;for(let te=1;F===null&&te<A;te++)F=this.getBlackPointOnSegment(t,r+te,t-te,r);if(F==null)throw new j;let ee=null;for(let te=1;ee===null&&te<A;te++)ee=this.getBlackPointOnSegment(t,s-te,t-te,s);if(ee==null)throw new j;return this.centerEdges(ee,E,F,O)}else throw new j}getBlackPointOnSegment(e,t,r,s){const n=Be.round(Be.distance(e,t,r,s)),i=(r-e)/n,o=(s-t)/n,l=this.image;for(let c=0;c<n;c++){const d=Be.round(e+c*i),f=Be.round(t+c*o);if(l.get(d,f))return new ue(d,f)}return null}centerEdges(e,t,r,s){const n=e.getX(),i=e.getY(),o=t.getX(),l=t.getY(),c=r.getX(),d=r.getY(),f=s.getX(),b=s.getY(),y=Kt.CORR;return n<this.width/2?[new ue(f-y,b+y),new ue(o+y,l+y),new ue(c-y,d-y),new ue(n+y,i-y)]:[new ue(f+y,b+y),new ue(o+y,l-y),new ue(c-y,d+y),new ue(n-y,i-y)]}containsBlackPoint(e,t,r,s){const n=this.image;if(s){for(let i=e;i<=t;i++)if(n.get(i,r))return!0}else for(let i=e;i<=t;i++)if(n.get(r,i))return!0;return!1}}Kt.INIT_SIZE=10,Kt.CORR=1;class Nr{static checkAndNudgePoints(e,t){const r=e.getWidth(),s=e.getHeight();let n=!0;for(let i=0;i<t.length&&n;i+=2){const o=Math.floor(t[i]),l=Math.floor(t[i+1]);if(o<-1||o>r||l<-1||l>s)throw new j;n=!1,o===-1?(t[i]=0,n=!0):o===r&&(t[i]=r-1,n=!0),l===-1?(t[i+1]=0,n=!0):l===s&&(t[i+1]=s-1,n=!0)}n=!0;for(let i=t.length-2;i>=0&&n;i-=2){const o=Math.floor(t[i]),l=Math.floor(t[i+1]);if(o<-1||o>r||l<-1||l>s)throw new j;n=!1,o===-1?(t[i]=0,n=!0):o===r&&(t[i]=r-1,n=!0),l===-1?(t[i+1]=0,n=!0):l===s&&(t[i+1]=s-1,n=!0)}}}class Ut{constructor(e,t,r,s,n,i,o,l,c){this.a11=e,this.a21=t,this.a31=r,this.a12=s,this.a22=n,this.a32=i,this.a13=o,this.a23=l,this.a33=c}static quadrilateralToQuadrilateral(e,t,r,s,n,i,o,l,c,d,f,b,y,A,E,O){const F=Ut.quadrilateralToSquare(e,t,r,s,n,i,o,l);return Ut.squareToQuadrilateral(c,d,f,b,y,A,E,O).times(F)}transformPoints(e){const t=e.length,r=this.a11,s=this.a12,n=this.a13,i=this.a21,o=this.a22,l=this.a23,c=this.a31,d=this.a32,f=this.a33;for(let b=0;b<t;b+=2){const y=e[b],A=e[b+1],E=n*y+l*A+f;e[b]=(r*y+i*A+c)/E,e[b+1]=(s*y+o*A+d)/E}}transformPointsWithValues(e,t){const r=this.a11,s=this.a12,n=this.a13,i=this.a21,o=this.a22,l=this.a23,c=this.a31,d=this.a32,f=this.a33,b=e.length;for(let y=0;y<b;y++){const A=e[y],E=t[y],O=n*A+l*E+f;e[y]=(r*A+i*E+c)/O,t[y]=(s*A+o*E+d)/O}}static squareToQuadrilateral(e,t,r,s,n,i,o,l){const c=e-r+n-o,d=t-s+i-l;if(c===0&&d===0)return new Ut(r-e,n-r,e,s-t,i-s,t,0,0,1);{const f=r-n,b=o-n,y=s-i,A=l-i,E=f*A-b*y,O=(c*A-b*d)/E,F=(f*d-c*y)/E;return new Ut(r-e+O*r,o-e+F*o,e,s-t+O*s,l-t+F*l,t,O,F,1)}}static quadrilateralToSquare(e,t,r,s,n,i,o,l){return Ut.squareToQuadrilateral(e,t,r,s,n,i,o,l).buildAdjoint()}buildAdjoint(){return new Ut(this.a22*this.a33-this.a23*this.a32,this.a23*this.a31-this.a21*this.a33,this.a21*this.a32-this.a22*this.a31,this.a13*this.a32-this.a12*this.a33,this.a11*this.a33-this.a13*this.a31,this.a12*this.a31-this.a11*this.a32,this.a12*this.a23-this.a13*this.a22,this.a13*this.a21-this.a11*this.a23,this.a11*this.a22-this.a12*this.a21)}times(e){return new Ut(this.a11*e.a11+this.a21*e.a12+this.a31*e.a13,this.a11*e.a21+this.a21*e.a22+this.a31*e.a23,this.a11*e.a31+this.a21*e.a32+this.a31*e.a33,this.a12*e.a11+this.a22*e.a12+this.a32*e.a13,this.a12*e.a21+this.a22*e.a22+this.a32*e.a23,this.a12*e.a31+this.a22*e.a32+this.a32*e.a33,this.a13*e.a11+this.a23*e.a12+this.a33*e.a13,this.a13*e.a21+this.a23*e.a22+this.a33*e.a23,this.a13*e.a31+this.a23*e.a32+this.a33*e.a33)}}class yr extends Nr{sampleGrid(e,t,r,s,n,i,o,l,c,d,f,b,y,A,E,O,F,ee,te){const Z=Ut.quadrilateralToQuadrilateral(s,n,i,o,l,c,d,f,b,y,A,E,O,F,ee,te);return this.sampleGridWithTransform(e,t,r,Z)}sampleGridWithTransform(e,t,r,s){if(t<=0||r<=0)throw new j;const n=new ge(t,r),i=new Float32Array(2*t);for(let o=0;o<r;o++){const l=i.length,c=o+.5;for(let d=0;d<l;d+=2)i[d]=d/2+.5,i[d+1]=c;s.transformPoints(i),Nr.checkAndNudgePoints(e,i);try{for(let d=0;d<l;d+=2)e.get(Math.floor(i[d]),Math.floor(i[d+1]))&&n.set(d/2,o)}catch{throw new j}}return n}}class Qt{static setGridSampler(e){Qt.gridSampler=e}static getInstance(){return Qt.gridSampler}}Qt.gridSampler=new yr;class vt{constructor(e,t){this.x=e,this.y=t}toResultPoint(){return new ue(this.getX(),this.getY())}getX(){return this.x}getY(){return this.y}}class Mr{constructor(e){this.EXPECTED_CORNER_BITS=new Int32Array([3808,476,2107,1799]),this.image=e}detect(){return this.detectMirror(!1)}detectMirror(e){let t=this.getMatrixCenter(),r=this.getBullsEyeCorners(t);if(e){let i=r[0];r[0]=r[2],r[2]=i}this.extractParameters(r);let s=this.sampleGrid(this.image,r[this.shift%4],r[(this.shift+1)%4],r[(this.shift+2)%4],r[(this.shift+3)%4]),n=this.getMatrixCornerPoints(r);return new zr(s,n,this.compact,this.nbDataBlocks,this.nbLayers)}extractParameters(e){if(!this.isValidPoint(e[0])||!this.isValidPoint(e[1])||!this.isValidPoint(e[2])||!this.isValidPoint(e[3]))throw new j;let t=2*this.nbCenterLayers,r=new Int32Array([this.sampleLine(e[0],e[1],t),this.sampleLine(e[1],e[2],t),this.sampleLine(e[2],e[3],t),this.sampleLine(e[3],e[0],t)]);this.shift=this.getRotation(r,t);let s=0;for(let i=0;i<4;i++){let o=r[(this.shift+i)%4];this.compact?(s<<=7,s+=o>>1&127):(s<<=10,s+=(o>>2&992)+(o>>1&31))}let n=this.getCorrectedParameterData(s,this.compact);this.compact?(this.nbLayers=(n>>6)+1,this.nbDataBlocks=(n&63)+1):(this.nbLayers=(n>>11)+1,this.nbDataBlocks=(n&2047)+1)}getRotation(e,t){let r=0;e.forEach((s,n,i)=>{let o=(s>>t-2<<1)+(s&1);r=(r<<3)+o}),r=((r&1)<<11)+(r>>1);for(let s=0;s<4;s++)if(I.bitCount(r^this.EXPECTED_CORNER_BITS[s])<=2)return s;throw new j}getCorrectedParameterData(e,t){let r,s;t?(r=7,s=2):(r=10,s=4);let n=r-s,i=new Int32Array(r);for(let l=r-1;l>=0;--l)i[l]=e&15,e>>=4;try{new st(se.AZTEC_PARAM).decode(i,n)}catch{throw new j}let o=0;for(let l=0;l<s;l++)o=(o<<4)+i[l];return o}getBullsEyeCorners(e){let t=e,r=e,s=e,n=e,i=!0;for(this.nbCenterLayers=1;this.nbCenterLayers<9;this.nbCenterLayers++){let f=this.getFirstDifferent(t,i,1,-1),b=this.getFirstDifferent(r,i,1,1),y=this.getFirstDifferent(s,i,-1,1),A=this.getFirstDifferent(n,i,-1,-1);if(this.nbCenterLayers>2){let E=this.distancePoint(A,f)*this.nbCenterLayers/(this.distancePoint(n,t)*(this.nbCenterLayers+2));if(E<.75||E>1.25||!this.isWhiteOrBlackRectangle(f,b,y,A))break}t=f,r=b,s=y,n=A,i=!i}if(this.nbCenterLayers!==5&&this.nbCenterLayers!==7)throw new j;this.compact=this.nbCenterLayers===5;let o=new ue(t.getX()+.5,t.getY()-.5),l=new ue(r.getX()+.5,r.getY()+.5),c=new ue(s.getX()-.5,s.getY()+.5),d=new ue(n.getX()-.5,n.getY()-.5);return this.expandSquare([o,l,c,d],2*this.nbCenterLayers-3,2*this.nbCenterLayers)}getMatrixCenter(){let e,t,r,s;try{let o=new Kt(this.image).detect();e=o[0],t=o[1],r=o[2],s=o[3]}catch{let l=this.image.getWidth()/2,c=this.image.getHeight()/2;e=this.getFirstDifferent(new vt(l+7,c-7),!1,1,-1).toResultPoint(),t=this.getFirstDifferent(new vt(l+7,c+7),!1,1,1).toResultPoint(),r=this.getFirstDifferent(new vt(l-7,c+7),!1,-1,1).toResultPoint(),s=this.getFirstDifferent(new vt(l-7,c-7),!1,-1,-1).toResultPoint()}let n=Be.round((e.getX()+s.getX()+t.getX()+r.getX())/4),i=Be.round((e.getY()+s.getY()+t.getY()+r.getY())/4);try{let o=new Kt(this.image,15,n,i).detect();e=o[0],t=o[1],r=o[2],s=o[3]}catch{e=this.getFirstDifferent(new vt(n+7,i-7),!1,1,-1).toResultPoint(),t=this.getFirstDifferent(new vt(n+7,i+7),!1,1,1).toResultPoint(),r=this.getFirstDifferent(new vt(n-7,i+7),!1,-1,1).toResultPoint(),s=this.getFirstDifferent(new vt(n-7,i-7),!1,-1,-1).toResultPoint()}return n=Be.round((e.getX()+s.getX()+t.getX()+r.getX())/4),i=Be.round((e.getY()+s.getY()+t.getY()+r.getY())/4),new vt(n,i)}getMatrixCornerPoints(e){return this.expandSquare(e,2*this.nbCenterLayers,this.getDimension())}sampleGrid(e,t,r,s,n){let i=Qt.getInstance(),o=this.getDimension(),l=o/2-this.nbCenterLayers,c=o/2+this.nbCenterLayers;return i.sampleGrid(e,o,o,l,l,c,l,c,c,l,c,t.getX(),t.getY(),r.getX(),r.getY(),s.getX(),s.getY(),n.getX(),n.getY())}sampleLine(e,t,r){let s=0,n=this.distanceResultPoint(e,t),i=n/r,o=e.getX(),l=e.getY(),c=i*(t.getX()-e.getX())/n,d=i*(t.getY()-e.getY())/n;for(let f=0;f<r;f++)this.image.get(Be.round(o+f*c),Be.round(l+f*d))&&(s|=1<<r-f-1);return s}isWhiteOrBlackRectangle(e,t,r,s){let n=3;e=new vt(e.getX()-n,e.getY()+n),t=new vt(t.getX()-n,t.getY()-n),r=new vt(r.getX()+n,r.getY()-n),s=new vt(s.getX()+n,s.getY()+n);let i=this.getColor(s,e);if(i===0)return!1;let o=this.getColor(e,t);return o!==i||(o=this.getColor(t,r),o!==i)?!1:(o=this.getColor(r,s),o===i)}getColor(e,t){let r=this.distancePoint(e,t),s=(t.getX()-e.getX())/r,n=(t.getY()-e.getY())/r,i=0,o=e.getX(),l=e.getY(),c=this.image.get(e.getX(),e.getY()),d=Math.ceil(r);for(let b=0;b<d;b++)o+=s,l+=n,this.image.get(Be.round(o),Be.round(l))!==c&&i++;let f=i/r;return f>.1&&f<.9?0:f<=.1===c?1:-1}getFirstDifferent(e,t,r,s){let n=e.getX()+r,i=e.getY()+s;for(;this.isValid(n,i)&&this.image.get(n,i)===t;)n+=r,i+=s;for(n-=r,i-=s;this.isValid(n,i)&&this.image.get(n,i)===t;)n+=r;for(n-=r;this.isValid(n,i)&&this.image.get(n,i)===t;)i+=s;return i-=s,new vt(n,i)}expandSquare(e,t,r){let s=r/(2*t),n=e[0].getX()-e[2].getX(),i=e[0].getY()-e[2].getY(),o=(e[0].getX()+e[2].getX())/2,l=(e[0].getY()+e[2].getY())/2,c=new ue(o+s*n,l+s*i),d=new ue(o-s*n,l-s*i);n=e[1].getX()-e[3].getX(),i=e[1].getY()-e[3].getY(),o=(e[1].getX()+e[3].getX())/2,l=(e[1].getY()+e[3].getY())/2;let f=new ue(o+s*n,l+s*i),b=new ue(o-s*n,l-s*i);return[c,f,d,b]}isValid(e,t){return e>=0&&e<this.image.getWidth()&&t>0&&t<this.image.getHeight()}isValidPoint(e){let t=Be.round(e.getX()),r=Be.round(e.getY());return this.isValid(t,r)}distancePoint(e,t){return Be.distance(e.getX(),e.getY(),t.getX(),t.getY())}distanceResultPoint(e,t){return Be.distance(e.getX(),e.getY(),t.getX(),t.getY())}getDimension(){return this.compact?4*this.nbLayers+11:this.nbLayers<=4?4*this.nbLayers+15:4*this.nbLayers+2*(I.truncDivision(this.nbLayers-4,8)+1)+15}}class Ar{decode(e,t=null){let r=null,s=new Mr(e.getBlackMatrix()),n=null,i=null;try{let d=s.detectMirror(!1);n=d.getPoints(),this.reportFoundResultPoints(t,n),i=new De().decode(d)}catch(d){r=d}if(i==null)try{let d=s.detectMirror(!0);n=d.getPoints(),this.reportFoundResultPoints(t,n),i=new De().decode(d)}catch(d){throw r??d}let o=new z(i.getText(),i.getRawBytes(),i.getNumBits(),n,le.AZTEC,K.currentTimeMillis()),l=i.getByteSegments();l!=null&&o.putMetadata(Ge.BYTE_SEGMENTS,l);let c=i.getECLevel();return c!=null&&o.putMetadata(Ge.ERROR_CORRECTION_LEVEL,c),o}reportFoundResultPoints(e,t){if(e!=null){let r=e.get(re.NEED_RESULT_POINT_CALLBACK);r!=null&&t.forEach((s,n,i)=>{r.foundPossibleResultPoint(s)})}}reset(){}}class ls extends Je{constructor(e=500){super(new Ar,e)}}class lt{decode(e,t){try{return this.doDecode(e,t)}catch{if(t&&t.get(re.TRY_HARDER)===!0&&e.isRotateSupported()){const n=e.rotateCounterClockwise(),i=this.doDecode(n,t),o=i.getResultMetadata();let l=270;o!==null&&o.get(Ge.ORIENTATION)===!0&&(l=l+o.get(Ge.ORIENTATION)%360),i.putMetadata(Ge.ORIENTATION,l);const c=i.getResultPoints();if(c!==null){const d=n.getHeight();for(let f=0;f<c.length;f++)c[f]=new ue(d-c[f].getY()-1,c[f].getX())}return i}else throw new j}}reset(){}doDecode(e,t){const r=e.getWidth(),s=e.getHeight();let n=new W(r);const i=t&&t.get(re.TRY_HARDER)===!0,o=Math.max(1,s>>(i?8:5));let l;i?l=s:l=15;const c=Math.trunc(s/2);for(let d=0;d<l;d++){const f=Math.trunc((d+1)/2),b=(d&1)===0,y=c+o*(b?f:-f);if(y<0||y>=s)break;try{n=e.getBlackRow(y,n)}catch{continue}for(let A=0;A<2;A++){if(A===1&&(n.reverse(),t&&t.get(re.NEED_RESULT_POINT_CALLBACK)===!0)){const E=new Map;t.forEach((O,F)=>E.set(F,O)),E.delete(re.NEED_RESULT_POINT_CALLBACK),t=E}try{const E=this.decodeRow(y,n,t);if(A===1){E.putMetadata(Ge.ORIENTATION,180);const O=E.getResultPoints();O!==null&&(O[0]=new ue(r-O[0].getX()-1,O[0].getY()),O[1]=new ue(r-O[1].getX()-1,O[1].getY()))}return E}catch{}}}throw new j}static recordPattern(e,t,r){const s=r.length;for(let c=0;c<s;c++)r[c]=0;const n=e.getSize();if(t>=n)throw new j;let i=!e.get(t),o=0,l=t;for(;l<n;){if(e.get(l)!==i)r[o]++;else{if(++o===s)break;r[o]=1,i=!i}l++}if(!(o===s||o===s-1&&l===n))throw new j}static recordPatternInReverse(e,t,r){let s=r.length,n=e.get(t);for(;t>0&&s>=0;)e.get(--t)!==n&&(s--,n=!n);if(s>=0)throw new j;lt.recordPattern(e,t+1,r)}static patternMatchVariance(e,t,r){const s=e.length;let n=0,i=0;for(let c=0;c<s;c++)n+=e[c],i+=t[c];if(n<i)return Number.POSITIVE_INFINITY;const o=n/i;r*=o;let l=0;for(let c=0;c<s;c++){const d=e[c],f=t[c]*o,b=d>f?d-f:f-d;if(b>r)return Number.POSITIVE_INFINITY;l+=b}return l/n}}class ae extends lt{static findStartPattern(e){const t=e.getSize(),r=e.getNextSet(0);let s=0,n=Int32Array.from([0,0,0,0,0,0]),i=r,o=!1;const l=6;for(let c=r;c<t;c++)if(e.get(c)!==o)n[s]++;else{if(s===l-1){let d=ae.MAX_AVG_VARIANCE,f=-1;for(let b=ae.CODE_START_A;b<=ae.CODE_START_C;b++){const y=lt.patternMatchVariance(n,ae.CODE_PATTERNS[b],ae.MAX_INDIVIDUAL_VARIANCE);y<d&&(d=y,f=b)}if(f>=0&&e.isRange(Math.max(0,i-(c-i)/2),i,!1))return Int32Array.from([i,c,f]);i+=n[0]+n[1],n=n.slice(2,n.length-1),n[s-1]=0,n[s]=0,s--}else s++;n[s]=1,o=!o}throw new j}static decodeCode(e,t,r){lt.recordPattern(e,r,t);let s=ae.MAX_AVG_VARIANCE,n=-1;for(let i=0;i<ae.CODE_PATTERNS.length;i++){const o=ae.CODE_PATTERNS[i],l=this.patternMatchVariance(t,o,ae.MAX_INDIVIDUAL_VARIANCE);l<s&&(s=l,n=i)}if(n>=0)return n;throw new j}decodeRow(e,t,r){const s=r&&r.get(re.ASSUME_GS1)===!0,n=ae.findStartPattern(t),i=n[2];let o=0;const l=new Uint8Array(20);l[o++]=i;let c;switch(i){case ae.CODE_START_A:c=ae.CODE_CODE_A;break;case ae.CODE_START_B:c=ae.CODE_CODE_B;break;case ae.CODE_START_C:c=ae.CODE_CODE_C;break;default:throw new S}let d=!1,f=!1,b="",y=n[0],A=n[1];const E=Int32Array.from([0,0,0,0,0,0]);let O=0,F=0,ee=i,te=0,Z=!0,Le=!1,Re=!1;for(;!d;){const _r=f;switch(f=!1,O=F,F=ae.decodeCode(t,E,A),l[o++]=F,F!==ae.CODE_STOP&&(Z=!0),F!==ae.CODE_STOP&&(te++,ee+=te*F),y=A,A+=E.reduce((Jn,$n)=>Jn+$n,0),F){case ae.CODE_START_A:case ae.CODE_START_B:case ae.CODE_START_C:throw new S}switch(c){case ae.CODE_CODE_A:if(F<64)Re===Le?b+=String.fromCharCode(32+F):b+=String.fromCharCode(32+F+128),Re=!1;else if(F<96)Re===Le?b+=String.fromCharCode(F-64):b+=String.fromCharCode(F+64),Re=!1;else switch(F!==ae.CODE_STOP&&(Z=!1),F){case ae.CODE_FNC_1:s&&(b.length===0?b+="]C1":b+="");break;case ae.CODE_FNC_2:case ae.CODE_FNC_3:break;case ae.CODE_FNC_4_A:!Le&&Re?(Le=!0,Re=!1):Le&&Re?(Le=!1,Re=!1):Re=!0;break;case ae.CODE_SHIFT:f=!0,c=ae.CODE_CODE_B;break;case ae.CODE_CODE_B:c=ae.CODE_CODE_B;break;case ae.CODE_CODE_C:c=ae.CODE_CODE_C;break;case ae.CODE_STOP:d=!0;break}break;case ae.CODE_CODE_B:if(F<96)Re===Le?b+=String.fromCharCode(32+F):b+=String.fromCharCode(32+F+128),Re=!1;else switch(F!==ae.CODE_STOP&&(Z=!1),F){case ae.CODE_FNC_1:s&&(b.length===0?b+="]C1":b+="");break;case ae.CODE_FNC_2:case ae.CODE_FNC_3:break;case ae.CODE_FNC_4_B:!Le&&Re?(Le=!0,Re=!1):Le&&Re?(Le=!1,Re=!1):Re=!0;break;case ae.CODE_SHIFT:f=!0,c=ae.CODE_CODE_A;break;case ae.CODE_CODE_A:c=ae.CODE_CODE_A;break;case ae.CODE_CODE_C:c=ae.CODE_CODE_C;break;case ae.CODE_STOP:d=!0;break}break;case ae.CODE_CODE_C:if(F<100)F<10&&(b+="0"),b+=F;else switch(F!==ae.CODE_STOP&&(Z=!1),F){case ae.CODE_FNC_1:s&&(b.length===0?b+="]C1":b+="");break;case ae.CODE_CODE_A:c=ae.CODE_CODE_A;break;case ae.CODE_CODE_B:c=ae.CODE_CODE_B;break;case ae.CODE_STOP:d=!0;break}break}_r&&(c=c===ae.CODE_CODE_A?ae.CODE_CODE_B:ae.CODE_CODE_A)}const Lt=A-y;if(A=t.getNextUnset(A),!t.isRange(A,Math.min(t.getSize(),A+(A-y)/2),!1))throw new j;if(ee-=te*O,ee%103!==O)throw new $;const Zt=b.length;if(Zt===0)throw new j;Zt>0&&Z&&(c===ae.CODE_CODE_C?b=b.substring(0,Zt-2):b=b.substring(0,Zt-1));const Ft=(n[1]+n[0])/2,Ze=y+Lt/2,Tt=l.length,Ht=new Uint8Array(Tt);for(let _r=0;_r<Tt;_r++)Ht[_r]=l[_r];const Tr=[new ue(Ft,e),new ue(Ze,e)];return new z(b,Ht,0,Tr,le.CODE_128,new Date().getTime())}}ae.CODE_PATTERNS=[Int32Array.from([2,1,2,2,2,2]),Int32Array.from([2,2,2,1,2,2]),Int32Array.from([2,2,2,2,2,1]),Int32Array.from([1,2,1,2,2,3]),Int32Array.from([1,2,1,3,2,2]),Int32Array.from([1,3,1,2,2,2]),Int32Array.from([1,2,2,2,1,3]),Int32Array.from([1,2,2,3,1,2]),Int32Array.from([1,3,2,2,1,2]),Int32Array.from([2,2,1,2,1,3]),Int32Array.from([2,2,1,3,1,2]),Int32Array.from([2,3,1,2,1,2]),Int32Array.from([1,1,2,2,3,2]),Int32Array.from([1,2,2,1,3,2]),Int32Array.from([1,2,2,2,3,1]),Int32Array.from([1,1,3,2,2,2]),Int32Array.from([1,2,3,1,2,2]),Int32Array.from([1,2,3,2,2,1]),Int32Array.from([2,2,3,2,1,1]),Int32Array.from([2,2,1,1,3,2]),Int32Array.from([2,2,1,2,3,1]),Int32Array.from([2,1,3,2,1,2]),Int32Array.from([2,2,3,1,1,2]),Int32Array.from([3,1,2,1,3,1]),Int32Array.from([3,1,1,2,2,2]),Int32Array.from([3,2,1,1,2,2]),Int32Array.from([3,2,1,2,2,1]),Int32Array.from([3,1,2,2,1,2]),Int32Array.from([3,2,2,1,1,2]),Int32Array.from([3,2,2,2,1,1]),Int32Array.from([2,1,2,1,2,3]),Int32Array.from([2,1,2,3,2,1]),Int32Array.from([2,3,2,1,2,1]),Int32Array.from([1,1,1,3,2,3]),Int32Array.from([1,3,1,1,2,3]),Int32Array.from([1,3,1,3,2,1]),Int32Array.from([1,1,2,3,1,3]),Int32Array.from([1,3,2,1,1,3]),Int32Array.from([1,3,2,3,1,1]),Int32Array.from([2,1,1,3,1,3]),Int32Array.from([2,3,1,1,1,3]),Int32Array.from([2,3,1,3,1,1]),Int32Array.from([1,1,2,1,3,3]),Int32Array.from([1,1,2,3,3,1]),Int32Array.from([1,3,2,1,3,1]),Int32Array.from([1,1,3,1,2,3]),Int32Array.from([1,1,3,3,2,1]),Int32Array.from([1,3,3,1,2,1]),Int32Array.from([3,1,3,1,2,1]),Int32Array.from([2,1,1,3,3,1]),Int32Array.from([2,3,1,1,3,1]),Int32Array.from([2,1,3,1,1,3]),Int32Array.from([2,1,3,3,1,1]),Int32Array.from([2,1,3,1,3,1]),Int32Array.from([3,1,1,1,2,3]),Int32Array.from([3,1,1,3,2,1]),Int32Array.from([3,3,1,1,2,1]),Int32Array.from([3,1,2,1,1,3]),Int32Array.from([3,1,2,3,1,1]),Int32Array.from([3,3,2,1,1,1]),Int32Array.from([3,1,4,1,1,1]),Int32Array.from([2,2,1,4,1,1]),Int32Array.from([4,3,1,1,1,1]),Int32Array.from([1,1,1,2,2,4]),Int32Array.from([1,1,1,4,2,2]),Int32Array.from([1,2,1,1,2,4]),Int32Array.from([1,2,1,4,2,1]),Int32Array.from([1,4,1,1,2,2]),Int32Array.from([1,4,1,2,2,1]),Int32Array.from([1,1,2,2,1,4]),Int32Array.from([1,1,2,4,1,2]),Int32Array.from([1,2,2,1,1,4]),Int32Array.from([1,2,2,4,1,1]),Int32Array.from([1,4,2,1,1,2]),Int32Array.from([1,4,2,2,1,1]),Int32Array.from([2,4,1,2,1,1]),Int32Array.from([2,2,1,1,1,4]),Int32Array.from([4,1,3,1,1,1]),Int32Array.from([2,4,1,1,1,2]),Int32Array.from([1,3,4,1,1,1]),Int32Array.from([1,1,1,2,4,2]),Int32Array.from([1,2,1,1,4,2]),Int32Array.from([1,2,1,2,4,1]),Int32Array.from([1,1,4,2,1,2]),Int32Array.from([1,2,4,1,1,2]),Int32Array.from([1,2,4,2,1,1]),Int32Array.from([4,1,1,2,1,2]),Int32Array.from([4,2,1,1,1,2]),Int32Array.from([4,2,1,2,1,1]),Int32Array.from([2,1,2,1,4,1]),Int32Array.from([2,1,4,1,2,1]),Int32Array.from([4,1,2,1,2,1]),Int32Array.from([1,1,1,1,4,3]),Int32Array.from([1,1,1,3,4,1]),Int32Array.from([1,3,1,1,4,1]),Int32Array.from([1,1,4,1,1,3]),Int32Array.from([1,1,4,3,1,1]),Int32Array.from([4,1,1,1,1,3]),Int32Array.from([4,1,1,3,1,1]),Int32Array.from([1,1,3,1,4,1]),Int32Array.from([1,1,4,1,3,1]),Int32Array.from([3,1,1,1,4,1]),Int32Array.from([4,1,1,1,3,1]),Int32Array.from([2,1,1,4,1,2]),Int32Array.from([2,1,1,2,1,4]),Int32Array.from([2,1,1,2,3,2]),Int32Array.from([2,3,3,1,1,1,2])],ae.MAX_AVG_VARIANCE=.25,ae.MAX_INDIVIDUAL_VARIANCE=.7,ae.CODE_SHIFT=98,ae.CODE_CODE_C=99,ae.CODE_CODE_B=100,ae.CODE_CODE_A=101,ae.CODE_FNC_1=102,ae.CODE_FNC_2=97,ae.CODE_FNC_3=96,ae.CODE_FNC_4_A=101,ae.CODE_FNC_4_B=100,ae.CODE_START_A=103,ae.CODE_START_B=104,ae.CODE_START_C=105,ae.CODE_STOP=106;class ut extends lt{constructor(e=!1,t=!1){super(),this.usingCheckDigit=e,this.extendedMode=t,this.decodeRowResult="",this.counters=new Int32Array(9)}decodeRow(e,t,r){let s=this.counters;s.fill(0),this.decodeRowResult="";let n=ut.findAsteriskPattern(t,s),i=t.getNextSet(n[1]),o=t.getSize(),l,c;do{ut.recordPattern(t,i,s);let E=ut.toNarrowWidePattern(s);if(E<0)throw new j;l=ut.patternToChar(E),this.decodeRowResult+=l,c=i;for(let O of s)i+=O;i=t.getNextSet(i)}while(l!=="*");this.decodeRowResult=this.decodeRowResult.substring(0,this.decodeRowResult.length-1);let d=0;for(let E of s)d+=E;let f=i-c-d;if(i!==o&&f*2<d)throw new j;if(this.usingCheckDigit){let E=this.decodeRowResult.length-1,O=0;for(let F=0;F<E;F++)O+=ut.ALPHABET_STRING.indexOf(this.decodeRowResult.charAt(F));if(this.decodeRowResult.charAt(E)!==ut.ALPHABET_STRING.charAt(O%43))throw new $;this.decodeRowResult=this.decodeRowResult.substring(0,E)}if(this.decodeRowResult.length===0)throw new j;let b;this.extendedMode?b=ut.decodeExtended(this.decodeRowResult):b=this.decodeRowResult;let y=(n[1]+n[0])/2,A=c+d/2;return new z(b,null,0,[new ue(y,e),new ue(A,e)],le.CODE_39,new Date().getTime())}static findAsteriskPattern(e,t){let r=e.getSize(),s=e.getNextSet(0),n=0,i=s,o=!1,l=t.length;for(let c=s;c<r;c++)if(e.get(c)!==o)t[n]++;else{if(n===l-1){if(this.toNarrowWidePattern(t)===ut.ASTERISK_ENCODING&&e.isRange(Math.max(0,i-Math.floor((c-i)/2)),i,!1))return[i,c];i+=t[0]+t[1],t.copyWithin(0,2,2+n-1),t[n-1]=0,t[n]=0,n--}else n++;t[n]=1,o=!o}throw new j}static toNarrowWidePattern(e){let t=e.length,r=0,s;do{let n=2147483647;for(let l of e)l<n&&l>r&&(n=l);r=n,s=0;let i=0,o=0;for(let l=0;l<t;l++){let c=e[l];c>r&&(o|=1<<t-1-l,s++,i+=c)}if(s===3){for(let l=0;l<t&&s>0;l++){let c=e[l];if(c>r&&(s--,c*2>=i))return-1}return o}}while(s>3);return-1}static patternToChar(e){for(let t=0;t<ut.CHARACTER_ENCODINGS.length;t++)if(ut.CHARACTER_ENCODINGS[t]===e)return ut.ALPHABET_STRING.charAt(t);if(e===ut.ASTERISK_ENCODING)return"*";throw new j}static decodeExtended(e){let t=e.length,r="";for(let s=0;s<t;s++){let n=e.charAt(s);if(n==="+"||n==="$"||n==="%"||n==="/"){let i=e.charAt(s+1),o="\0";switch(n){case"+":if(i>="A"&&i<="Z")o=String.fromCharCode(i.charCodeAt(0)+32);else throw new S;break;case"$":if(i>="A"&&i<="Z")o=String.fromCharCode(i.charCodeAt(0)-64);else throw new S;break;case"%":if(i>="A"&&i<="E")o=String.fromCharCode(i.charCodeAt(0)-38);else if(i>="F"&&i<="J")o=String.fromCharCode(i.charCodeAt(0)-11);else if(i>="K"&&i<="O")o=String.fromCharCode(i.charCodeAt(0)+16);else if(i>="P"&&i<="T")o=String.fromCharCode(i.charCodeAt(0)+43);else if(i==="U")o="\0";else if(i==="V")o="@";else if(i==="W")o="`";else if(i==="X"||i==="Y"||i==="Z")o="";else throw new S;break;case"/":if(i>="A"&&i<="O")o=String.fromCharCode(i.charCodeAt(0)-32);else if(i==="Z")o=":";else throw new S;break}r+=o,s++}else r+=n}return r}}ut.ALPHABET_STRING="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ-. $/+%",ut.CHARACTER_ENCODINGS=[52,289,97,352,49,304,112,37,292,100,265,73,328,25,280,88,13,268,76,28,259,67,322,19,274,82,7,262,70,22,385,193,448,145,400,208,133,388,196,168,162,138,42],ut.ASTERISK_ENCODING=148;class v extends lt{constructor(){super(...arguments),this.narrowLineWidth=-1}decodeRow(e,t,r){let s=this.decodeStart(t),n=this.decodeEnd(t),i=new ie;v.decodeMiddle(t,s[1],n[0],i);let o=i.toString(),l=null;r!=null&&(l=r.get(re.ALLOWED_LENGTHS)),l==null&&(l=v.DEFAULT_ALLOWED_LENGTHS);let c=o.length,d=!1,f=0;for(let A of l){if(c===A){d=!0;break}A>f&&(f=A)}if(!d&&c>f&&(d=!0),!d)throw new S;const b=[new ue(s[1],e),new ue(n[0],e)];return new z(o,null,0,b,le.ITF,new Date().getTime())}static decodeMiddle(e,t,r,s){let n=new Int32Array(10),i=new Int32Array(5),o=new Int32Array(5);for(n.fill(0),i.fill(0),o.fill(0);t<r;){lt.recordPattern(e,t,n);for(let c=0;c<5;c++){let d=2*c;i[c]=n[d],o[c]=n[d+1]}let l=v.decodeDigit(i);s.append(l.toString()),l=this.decodeDigit(o),s.append(l.toString()),n.forEach(function(c){t+=c})}}decodeStart(e){let t=v.skipWhiteSpace(e),r=v.findGuardPattern(e,t,v.START_PATTERN);return this.narrowLineWidth=(r[1]-r[0])/4,this.validateQuietZone(e,r[0]),r}validateQuietZone(e,t){let r=this.narrowLineWidth*10;r=r<t?r:t;for(let s=t-1;r>0&&s>=0&&!e.get(s);s--)r--;if(r!==0)throw new j}static skipWhiteSpace(e){const t=e.getSize(),r=e.getNextSet(0);if(r===t)throw new j;return r}decodeEnd(e){e.reverse();try{let t=v.skipWhiteSpace(e),r;try{r=v.findGuardPattern(e,t,v.END_PATTERN_REVERSED[0])}catch(n){n instanceof j&&(r=v.findGuardPattern(e,t,v.END_PATTERN_REVERSED[1]))}this.validateQuietZone(e,r[0]);let s=r[0];return r[0]=e.getSize()-r[1],r[1]=e.getSize()-s,r}finally{e.reverse()}}static findGuardPattern(e,t,r){let s=r.length,n=new Int32Array(s),i=e.getSize(),o=!1,l=0,c=t;n.fill(0);for(let d=t;d<i;d++)if(e.get(d)!==o)n[l]++;else{if(l===s-1){if(lt.patternMatchVariance(n,r,v.MAX_INDIVIDUAL_VARIANCE)<v.MAX_AVG_VARIANCE)return[c,d];c+=n[0]+n[1],K.arraycopy(n,2,n,0,l-1),n[l-1]=0,n[l]=0,l--}else l++;n[l]=1,o=!o}throw new j}static decodeDigit(e){let t=v.MAX_AVG_VARIANCE,r=-1,s=v.PATTERNS.length;for(let n=0;n<s;n++){let i=v.PATTERNS[n],o=lt.patternMatchVariance(e,i,v.MAX_INDIVIDUAL_VARIANCE);o<t?(t=o,r=n):o===t&&(r=-1)}if(r>=0)return r%10;throw new j}}v.PATTERNS=[Int32Array.from([1,1,2,2,1]),Int32Array.from([2,1,1,1,2]),Int32Array.from([1,2,1,1,2]),Int32Array.from([2,2,1,1,1]),Int32Array.from([1,1,2,1,2]),Int32Array.from([2,1,2,1,1]),Int32Array.from([1,2,2,1,1]),Int32Array.from([1,1,1,2,2]),Int32Array.from([2,1,1,2,1]),Int32Array.from([1,2,1,2,1]),Int32Array.from([1,1,3,3,1]),Int32Array.from([3,1,1,1,3]),Int32Array.from([1,3,1,1,3]),Int32Array.from([3,3,1,1,1]),Int32Array.from([1,1,3,1,3]),Int32Array.from([3,1,3,1,1]),Int32Array.from([1,3,3,1,1]),Int32Array.from([1,1,1,3,3]),Int32Array.from([3,1,1,3,1]),Int32Array.from([1,3,1,3,1])],v.MAX_AVG_VARIANCE=.38,v.MAX_INDIVIDUAL_VARIANCE=.5,v.DEFAULT_ALLOWED_LENGTHS=[6,8,10,12,14],v.START_PATTERN=Int32Array.from([1,1,1,1]),v.END_PATTERN_REVERSED=[Int32Array.from([1,1,2]),Int32Array.from([1,1,3])];class Q extends lt{constructor(){super(...arguments),this.decodeRowStringBuffer=""}static findStartGuardPattern(e){let t=!1,r,s=0,n=Int32Array.from([0,0,0]);for(;!t;){n=Int32Array.from([0,0,0]),r=Q.findGuardPattern(e,s,!1,this.START_END_PATTERN,n);let i=r[0];s=r[1];let o=i-(s-i);o>=0&&(t=e.isRange(o,i,!1))}return r}static checkChecksum(e){return Q.checkStandardUPCEANChecksum(e)}static checkStandardUPCEANChecksum(e){let t=e.length;if(t===0)return!1;let r=parseInt(e.charAt(t-1),10);return Q.getStandardUPCEANChecksum(e.substring(0,t-1))===r}static getStandardUPCEANChecksum(e){let t=e.length,r=0;for(let s=t-1;s>=0;s-=2){let n=e.charAt(s).charCodeAt(0)-48;if(n<0||n>9)throw new S;r+=n}r*=3;for(let s=t-2;s>=0;s-=2){let n=e.charAt(s).charCodeAt(0)-48;if(n<0||n>9)throw new S;r+=n}return(1e3-r)%10}static decodeEnd(e,t){return Q.findGuardPattern(e,t,!1,Q.START_END_PATTERN,new Int32Array(Q.START_END_PATTERN.length).fill(0))}static findGuardPatternWithoutCounters(e,t,r,s){return this.findGuardPattern(e,t,r,s,new Int32Array(s.length))}static findGuardPattern(e,t,r,s,n){let i=e.getSize();t=r?e.getNextUnset(t):e.getNextSet(t);let o=0,l=t,c=s.length,d=r;for(let f=t;f<i;f++)if(e.get(f)!==d)n[o]++;else{if(o===c-1){if(lt.patternMatchVariance(n,s,Q.MAX_INDIVIDUAL_VARIANCE)<Q.MAX_AVG_VARIANCE)return Int32Array.from([l,f]);l+=n[0]+n[1];let b=n.slice(2,n.length-1);for(let y=0;y<o-1;y++)n[y]=b[y];n[o-1]=0,n[o]=0,o--}else o++;n[o]=1,d=!d}throw new j}static decodeDigit(e,t,r,s){this.recordPattern(e,r,t);let n=this.MAX_AVG_VARIANCE,i=-1,o=s.length;for(let l=0;l<o;l++){let c=s[l],d=lt.patternMatchVariance(t,c,Q.MAX_INDIVIDUAL_VARIANCE);d<n&&(n=d,i=l)}if(i>=0)return i;throw new j}}Q.MAX_AVG_VARIANCE=.48,Q.MAX_INDIVIDUAL_VARIANCE=.7,Q.START_END_PATTERN=Int32Array.from([1,1,1]),Q.MIDDLE_PATTERN=Int32Array.from([1,1,1,1,1]),Q.END_PATTERN=Int32Array.from([1,1,1,1,1,1]),Q.L_PATTERNS=[Int32Array.from([3,2,1,1]),Int32Array.from([2,2,2,1]),Int32Array.from([2,1,2,2]),Int32Array.from([1,4,1,1]),Int32Array.from([1,1,3,2]),Int32Array.from([1,2,3,1]),Int32Array.from([1,1,1,4]),Int32Array.from([1,3,1,2]),Int32Array.from([1,2,1,3]),Int32Array.from([3,1,1,2])];class me{constructor(){this.CHECK_DIGIT_ENCODINGS=[24,20,18,17,12,6,3,10,9,5],this.decodeMiddleCounters=Int32Array.from([0,0,0,0]),this.decodeRowStringBuffer=""}decodeRow(e,t,r){let s=this.decodeRowStringBuffer,n=this.decodeMiddle(t,r,s),i=s.toString(),o=me.parseExtensionString(i),l=[new ue((r[0]+r[1])/2,e),new ue(n,e)],c=new z(i,null,0,l,le.UPC_EAN_EXTENSION,new Date().getTime());return o!=null&&c.putAllMetadata(o),c}decodeMiddle(e,t,r){let s=this.decodeMiddleCounters;s[0]=0,s[1]=0,s[2]=0,s[3]=0;let n=e.getSize(),i=t[1],o=0;for(let c=0;c<5&&i<n;c++){let d=Q.decodeDigit(e,s,i,Q.L_AND_G_PATTERNS);r+=String.fromCharCode(48+d%10);for(let f of s)i+=f;d>=10&&(o|=1<<4-c),c!==4&&(i=e.getNextSet(i),i=e.getNextUnset(i))}if(r.length!==5)throw new j;let l=this.determineCheckDigit(o);if(me.extensionChecksum(r.toString())!==l)throw new j;return i}static extensionChecksum(e){let t=e.length,r=0;for(let s=t-2;s>=0;s-=2)r+=e.charAt(s).charCodeAt(0)-48;r*=3;for(let s=t-1;s>=0;s-=2)r+=e.charAt(s).charCodeAt(0)-48;return r*=3,r%10}determineCheckDigit(e){for(let t=0;t<10;t++)if(e===this.CHECK_DIGIT_ENCODINGS[t])return t;throw new j}static parseExtensionString(e){if(e.length!==5)return null;let t=me.parseExtension5String(e);return t==null?null:new Map([[Ge.SUGGESTED_PRICE,t]])}static parseExtension5String(e){let t;switch(e.charAt(0)){case"0":t="¬£";break;case"5":t="$";break;case"9":switch(e){case"90000":return null;case"99991":return"0.00";case"99990":return"Used"}t="";break;default:t="";break}let r=parseInt(e.substring(1)),s=(r/100).toString(),n=r%100,i=n<10?"0"+n:n.toString();return t+s+"."+i}}class we{constructor(){this.decodeMiddleCounters=Int32Array.from([0,0,0,0]),this.decodeRowStringBuffer=""}decodeRow(e,t,r){let s=this.decodeRowStringBuffer,n=this.decodeMiddle(t,r,s),i=s.toString(),o=we.parseExtensionString(i),l=[new ue((r[0]+r[1])/2,e),new ue(n,e)],c=new z(i,null,0,l,le.UPC_EAN_EXTENSION,new Date().getTime());return o!=null&&c.putAllMetadata(o),c}decodeMiddle(e,t,r){let s=this.decodeMiddleCounters;s[0]=0,s[1]=0,s[2]=0,s[3]=0;let n=e.getSize(),i=t[1],o=0;for(let l=0;l<2&&i<n;l++){let c=Q.decodeDigit(e,s,i,Q.L_AND_G_PATTERNS);r+=String.fromCharCode(48+c%10);for(let d of s)i+=d;c>=10&&(o|=1<<1-l),l!==1&&(i=e.getNextSet(i),i=e.getNextUnset(i))}if(r.length!==2)throw new j;if(parseInt(r.toString())%4!==o)throw new j;return i}static parseExtensionString(e){return e.length!==2?null:new Map([[Ge.ISSUE_NUMBER,parseInt(e)]])}}class Pe{static decodeRow(e,t,r){let s=Q.findGuardPattern(t,r,!1,this.EXTENSION_START_PATTERN,new Int32Array(this.EXTENSION_START_PATTERN.length).fill(0));try{return new me().decodeRow(e,t,s)}catch{return new we().decodeRow(e,t,s)}}}Pe.EXTENSION_START_PATTERN=Int32Array.from([1,1,2]);class Te extends Q{constructor(){super(),this.decodeRowStringBuffer="",Te.L_AND_G_PATTERNS=Te.L_PATTERNS.map(e=>Int32Array.from(e));for(let e=10;e<20;e++){let t=Te.L_PATTERNS[e-10],r=new Int32Array(t.length);for(let s=0;s<t.length;s++)r[s]=t[t.length-s-1];Te.L_AND_G_PATTERNS[e]=r}}decodeRow(e,t,r){let s=Te.findStartGuardPattern(t),n=r==null?null:r.get(re.NEED_RESULT_POINT_CALLBACK);if(n!=null){const Z=new ue((s[0]+s[1])/2,e);n.foundPossibleResultPoint(Z)}let i=this.decodeMiddle(t,s,this.decodeRowStringBuffer),o=i.rowOffset,l=i.resultString;if(n!=null){const Z=new ue(o,e);n.foundPossibleResultPoint(Z)}let c=this.decodeEnd(t,o);if(n!=null){const Z=new ue((c[0]+c[1])/2,e);n.foundPossibleResultPoint(Z)}let d=c[1],f=d+(d-c[0]);if(f>=t.getSize()||!t.isRange(d,f,!1))throw new j;let b=l.toString();if(b.length<8)throw new S;if(!Te.checkChecksum(b))throw new $;let y=(s[1]+s[0])/2,A=(c[1]+c[0])/2,E=this.getBarcodeFormat(),O=[new ue(y,e),new ue(A,e)],F=new z(b,null,0,O,E,new Date().getTime()),ee=0;try{let Z=Pe.decodeRow(e,t,c[1]);F.putMetadata(Ge.UPC_EAN_EXTENSION,Z.getText()),F.putAllMetadata(Z.getResultMetadata()),F.addResultPoints(Z.getResultPoints()),ee=Z.getText().length}catch{}let te=r==null?null:r.get(re.ALLOWED_EAN_EXTENSIONS);if(te!=null){let Z=!1;for(let Le in te)if(ee.toString()===Le){Z=!0;break}if(!Z)throw new j}return F}decodeEnd(e,t){return Te.findGuardPattern(e,t,!1,Te.START_END_PATTERN,new Int32Array(Te.START_END_PATTERN.length).fill(0))}static checkChecksum(e){return Te.checkStandardUPCEANChecksum(e)}static checkStandardUPCEANChecksum(e){let t=e.length;if(t===0)return!1;let r=parseInt(e.charAt(t-1),10);return Te.getStandardUPCEANChecksum(e.substring(0,t-1))===r}static getStandardUPCEANChecksum(e){let t=e.length,r=0;for(let s=t-1;s>=0;s-=2){let n=e.charAt(s).charCodeAt(0)-48;if(n<0||n>9)throw new S;r+=n}r*=3;for(let s=t-2;s>=0;s-=2){let n=e.charAt(s).charCodeAt(0)-48;if(n<0||n>9)throw new S;r+=n}return(1e3-r)%10}}class Ct extends Te{constructor(){super(),this.decodeMiddleCounters=Int32Array.from([0,0,0,0])}decodeMiddle(e,t,r){let s=this.decodeMiddleCounters;s[0]=0,s[1]=0,s[2]=0,s[3]=0;let n=e.getSize(),i=t[1],o=0;for(let c=0;c<6&&i<n;c++){let d=Te.decodeDigit(e,s,i,Te.L_AND_G_PATTERNS);r+=String.fromCharCode(48+d%10);for(let f of s)i+=f;d>=10&&(o|=1<<5-c)}r=Ct.determineFirstDigit(r,o),i=Te.findGuardPattern(e,i,!0,Te.MIDDLE_PATTERN,new Int32Array(Te.MIDDLE_PATTERN.length).fill(0))[1];for(let c=0;c<6&&i<n;c++){let d=Te.decodeDigit(e,s,i,Te.L_PATTERNS);r+=String.fromCharCode(48+d);for(let f of s)i+=f}return{rowOffset:i,resultString:r}}getBarcodeFormat(){return le.EAN_13}static determineFirstDigit(e,t){for(let r=0;r<10;r++)if(t===this.FIRST_DIGIT_ENCODINGS[r])return e=String.fromCharCode(48+r)+e,e;throw new j}}Ct.FIRST_DIGIT_ENCODINGS=[0,11,13,14,19,25,28,21,22,26];class _t extends Te{constructor(){super(),this.decodeMiddleCounters=Int32Array.from([0,0,0,0])}decodeMiddle(e,t,r){const s=this.decodeMiddleCounters;s[0]=0,s[1]=0,s[2]=0,s[3]=0;let n=e.getSize(),i=t[1];for(let l=0;l<4&&i<n;l++){let c=Te.decodeDigit(e,s,i,Te.L_PATTERNS);r+=String.fromCharCode(48+c);for(let d of s)i+=d}i=Te.findGuardPattern(e,i,!0,Te.MIDDLE_PATTERN,new Int32Array(Te.MIDDLE_PATTERN.length).fill(0))[1];for(let l=0;l<4&&i<n;l++){let c=Te.decodeDigit(e,s,i,Te.L_PATTERNS);r+=String.fromCharCode(48+c);for(let d of s)i+=d}return{rowOffset:i,resultString:r}}getBarcodeFormat(){return le.EAN_8}}class Xt extends Te{constructor(){super(...arguments),this.ean13Reader=new Ct}getBarcodeFormat(){return le.UPC_A}decode(e,t){return this.maybeReturnResult(this.ean13Reader.decode(e))}decodeRow(e,t,r){return this.maybeReturnResult(this.ean13Reader.decodeRow(e,t,r))}decodeMiddle(e,t,r){return this.ean13Reader.decodeMiddle(e,t,r)}maybeReturnResult(e){let t=e.getText();if(t.charAt(0)==="0"){let r=new z(t.substring(1),null,null,e.getResultPoints(),le.UPC_A);return e.getResultMetadata()!=null&&r.putAllMetadata(e.getResultMetadata()),r}else throw new j}reset(){this.ean13Reader.reset()}}class mt extends Te{constructor(){super(),this.decodeMiddleCounters=new Int32Array(4)}decodeMiddle(e,t,r){const s=this.decodeMiddleCounters.map(c=>c);s[0]=0,s[1]=0,s[2]=0,s[3]=0;const n=e.getSize();let i=t[1],o=0;for(let c=0;c<6&&i<n;c++){const d=mt.decodeDigit(e,s,i,mt.L_AND_G_PATTERNS);r+=String.fromCharCode(48+d%10);for(let f of s)i+=f;d>=10&&(o|=1<<5-c)}let l=mt.determineNumSysAndCheckDigit(r,o);return{rowOffset:i,resultString:l}}decodeEnd(e,t){return mt.findGuardPatternWithoutCounters(e,t,!0,mt.MIDDLE_END_PATTERN)}checkChecksum(e){return Te.checkChecksum(mt.convertUPCEtoUPCA(e))}static determineNumSysAndCheckDigit(e,t){for(let r=0;r<=1;r++)for(let s=0;s<10;s++)if(t===this.NUMSYS_AND_CHECK_DIGIT_PATTERNS[r][s]){let n=String.fromCharCode(48+r),i=String.fromCharCode(48+s);return n+e+i}throw j.getNotFoundInstance()}getBarcodeFormat(){return le.UPC_E}static convertUPCEtoUPCA(e){const t=e.slice(1,7).split("").map(n=>n.charCodeAt(0)),r=new ie;r.append(e.charAt(0));let s=t[5];switch(s){case 0:case 1:case 2:r.appendChars(t,0,2),r.append(s),r.append("0000"),r.appendChars(t,2,3);break;case 3:r.appendChars(t,0,3),r.append("00000"),r.appendChars(t,3,2);break;case 4:r.appendChars(t,0,4),r.append("00000"),r.append(t[4]);break;default:r.appendChars(t,0,5),r.append("0000"),r.append(s);break}return e.length>=8&&r.append(e.charAt(7)),r.toString()}}mt.MIDDLE_END_PATTERN=Int32Array.from([1,1,1,1,1,1]),mt.NUMSYS_AND_CHECK_DIGIT_PATTERNS=[Int32Array.from([56,52,50,49,44,38,35,42,41,37]),Int32Array.from([7,11,13,14,19,25,28,21,22,26])];class Vt extends lt{constructor(e){super();let t=e==null?null:e.get(re.POSSIBLE_FORMATS),r=[];p(t)?(r.push(new Ct),r.push(new Xt),r.push(new _t),r.push(new mt)):(t.indexOf(le.EAN_13)>-1&&r.push(new Ct),t.indexOf(le.UPC_A)>-1&&r.push(new Xt),t.indexOf(le.EAN_8)>-1&&r.push(new _t),t.indexOf(le.UPC_E)>-1&&r.push(new mt)),this.readers=r}decodeRow(e,t,r){for(let s of this.readers)try{const n=s.decodeRow(e,t,r),i=n.getBarcodeFormat()===le.EAN_13&&n.getText().charAt(0)==="0",o=r==null?null:r.get(re.POSSIBLE_FORMATS),l=o==null||o.includes(le.UPC_A);if(i&&l){const c=n.getRawBytes(),d=new z(n.getText().substring(1),c,c?c.length:null,n.getResultPoints(),le.UPC_A);return d.putAllMetadata(n.getResultMetadata()),d}return n}catch{}throw new j}reset(){for(let e of this.readers)e.reset()}}class $e extends lt{constructor(){super(),this.decodeFinderCounters=new Int32Array(4),this.dataCharacterCounters=new Int32Array(8),this.oddRoundingErrors=new Array(4),this.evenRoundingErrors=new Array(4),this.oddCounts=new Array(this.dataCharacterCounters.length/2),this.evenCounts=new Array(this.dataCharacterCounters.length/2)}getDecodeFinderCounters(){return this.decodeFinderCounters}getDataCharacterCounters(){return this.dataCharacterCounters}getOddRoundingErrors(){return this.oddRoundingErrors}getEvenRoundingErrors(){return this.evenRoundingErrors}getOddCounts(){return this.oddCounts}getEvenCounts(){return this.evenCounts}parseFinderValue(e,t){for(let r=0;r<t.length;r++)if(lt.patternMatchVariance(e,t[r],$e.MAX_INDIVIDUAL_VARIANCE)<$e.MAX_AVG_VARIANCE)return r;throw new j}static count(e){return Be.sum(new Int32Array(e))}static increment(e,t){let r=0,s=t[0];for(let n=1;n<e.length;n++)t[n]>s&&(s=t[n],r=n);e[r]++}static decrement(e,t){let r=0,s=t[0];for(let n=1;n<e.length;n++)t[n]<s&&(s=t[n],r=n);e[r]--}static isFinderPattern(e){let t=e[0]+e[1],r=t+e[2]+e[3],s=t/r;if(s>=$e.MIN_FINDER_PATTERN_RATIO&&s<=$e.MAX_FINDER_PATTERN_RATIO){let n=Number.MAX_SAFE_INTEGER,i=Number.MIN_SAFE_INTEGER;for(let o of e)o>i&&(i=o),o<n&&(n=o);return i<10*n}return!1}}$e.MAX_AVG_VARIANCE=.2,$e.MAX_INDIVIDUAL_VARIANCE=.45,$e.MIN_FINDER_PATTERN_RATIO=9.5/12,$e.MAX_FINDER_PATTERN_RATIO=12.5/14;class ze{constructor(e,t){this.value=e,this.checksumPortion=t}getValue(){return this.value}getChecksumPortion(){return this.checksumPortion}toString(){return this.value+"("+this.checksumPortion+")"}equals(e){if(!(e instanceof ze))return!1;const t=e;return this.value===t.value&&this.checksumPortion===t.checksumPortion}hashCode(){return this.value^this.checksumPortion}}class Mt{constructor(e,t,r,s,n){this.value=e,this.startEnd=t,this.value=e,this.startEnd=t,this.resultPoints=new Array,this.resultPoints.push(new ue(r,n)),this.resultPoints.push(new ue(s,n))}getValue(){return this.value}getStartEnd(){return this.startEnd}getResultPoints(){return this.resultPoints}equals(e){if(!(e instanceof Mt))return!1;const t=e;return this.value===t.value}hashCode(){return this.value}}class At{constructor(){}static getRSSvalue(e,t,r){let s=0;for(let l of e)s+=l;let n=0,i=0,o=e.length;for(let l=0;l<o-1;l++){let c;for(c=1,i|=1<<l;c<e[l];c++,i&=~(1<<l)){let d=At.combins(s-c-1,o-l-2);if(r&&i===0&&s-c-(o-l-1)>=o-l-1&&(d-=At.combins(s-c-(o-l),o-l-2)),o-l-1>1){let f=0;for(let b=s-c-(o-l-2);b>t;b--)f+=At.combins(s-c-b-1,o-l-3);d-=f*(o-1-l)}else s-c>t&&d--;n+=d}s-=c}return n}static combins(e,t){let r,s;e-t>t?(s=t,r=e-t):(s=e-t,r=t);let n=1,i=1;for(let o=e;o>r;o--)n*=o,i<=s&&(n/=i,i++);for(;i<=s;)n/=i,i++;return n}}class fr{static buildBitArray(e){let t=e.length*2-1;e[e.length-1].getRightChar()==null&&(t-=1);let r=12*t,s=new W(r),n=0,o=e[0].getRightChar().getValue();for(let l=11;l>=0;--l)(o&1<<l)!=0&&s.set(n),n++;for(let l=1;l<e.length;++l){let c=e[l],d=c.getLeftChar().getValue();for(let f=11;f>=0;--f)(d&1<<f)!=0&&s.set(n),n++;if(c.getRightChar()!=null){let f=c.getRightChar().getValue();for(let b=11;b>=0;--b)(f&1<<b)!=0&&s.set(n),n++}}return s}}class Dt{constructor(e,t){t?this.decodedInformation=null:(this.finished=e,this.decodedInformation=t)}getDecodedInformation(){return this.decodedInformation}isFinished(){return this.finished}}class Jt{constructor(e){this.newPosition=e}getNewPosition(){return this.newPosition}}class bt extends Jt{constructor(e,t){super(e),this.value=t}getValue(){return this.value}isFNC1(){return this.value===bt.FNC1}}bt.FNC1="$";class Pt extends Jt{constructor(e,t,r){super(e),r?(this.remaining=!0,this.remainingValue=this.remainingValue):(this.remaining=!1,this.remainingValue=0),this.newString=t}getNewString(){return this.newString}isRemaining(){return this.remaining}getRemainingValue(){return this.remainingValue}}class et extends Jt{constructor(e,t,r){if(super(e),t<0||t>10||r<0||r>10)throw new S;this.firstDigit=t,this.secondDigit=r}getFirstDigit(){return this.firstDigit}getSecondDigit(){return this.secondDigit}getValue(){return this.firstDigit*10+this.secondDigit}isFirstDigitFNC1(){return this.firstDigit===et.FNC1}isSecondDigitFNC1(){return this.secondDigit===et.FNC1}isAnyFNC1(){return this.firstDigit===et.FNC1||this.secondDigit===et.FNC1}}et.FNC1=10;class H{constructor(){}static parseFieldsInGeneralPurpose(e){if(!e)return null;if(e.length<2)throw new j;let t=e.substring(0,2);for(let n of H.TWO_DIGIT_DATA_LENGTH)if(n[0]===t)return n[1]===H.VARIABLE_LENGTH?H.processVariableAI(2,n[2],e):H.processFixedAI(2,n[1],e);if(e.length<3)throw new j;let r=e.substring(0,3);for(let n of H.THREE_DIGIT_DATA_LENGTH)if(n[0]===r)return n[1]===H.VARIABLE_LENGTH?H.processVariableAI(3,n[2],e):H.processFixedAI(3,n[1],e);for(let n of H.THREE_DIGIT_PLUS_DIGIT_DATA_LENGTH)if(n[0]===r)return n[1]===H.VARIABLE_LENGTH?H.processVariableAI(4,n[2],e):H.processFixedAI(4,n[1],e);if(e.length<4)throw new j;let s=e.substring(0,4);for(let n of H.FOUR_DIGIT_DATA_LENGTH)if(n[0]===s)return n[1]===H.VARIABLE_LENGTH?H.processVariableAI(4,n[2],e):H.processFixedAI(4,n[1],e);throw new j}static processFixedAI(e,t,r){if(r.length<e)throw new j;let s=r.substring(0,e);if(r.length<e+t)throw new j;let n=r.substring(e,e+t),i=r.substring(e+t),o="("+s+")"+n,l=H.parseFieldsInGeneralPurpose(i);return l==null?o:o+l}static processVariableAI(e,t,r){let s=r.substring(0,e),n;r.length<e+t?n=r.length:n=e+t;let i=r.substring(e,n),o=r.substring(n),l="("+s+")"+i,c=H.parseFieldsInGeneralPurpose(o);return c==null?l:l+c}}H.VARIABLE_LENGTH=[],H.TWO_DIGIT_DATA_LENGTH=[["00",18],["01",14],["02",14],["10",H.VARIABLE_LENGTH,20],["11",6],["12",6],["13",6],["15",6],["17",6],["20",2],["21",H.VARIABLE_LENGTH,20],["22",H.VARIABLE_LENGTH,29],["30",H.VARIABLE_LENGTH,8],["37",H.VARIABLE_LENGTH,8],["90",H.VARIABLE_LENGTH,30],["91",H.VARIABLE_LENGTH,30],["92",H.VARIABLE_LENGTH,30],["93",H.VARIABLE_LENGTH,30],["94",H.VARIABLE_LENGTH,30],["95",H.VARIABLE_LENGTH,30],["96",H.VARIABLE_LENGTH,30],["97",H.VARIABLE_LENGTH,3],["98",H.VARIABLE_LENGTH,30],["99",H.VARIABLE_LENGTH,30]],H.THREE_DIGIT_DATA_LENGTH=[["240",H.VARIABLE_LENGTH,30],["241",H.VARIABLE_LENGTH,30],["242",H.VARIABLE_LENGTH,6],["250",H.VARIABLE_LENGTH,30],["251",H.VARIABLE_LENGTH,30],["253",H.VARIABLE_LENGTH,17],["254",H.VARIABLE_LENGTH,20],["400",H.VARIABLE_LENGTH,30],["401",H.VARIABLE_LENGTH,30],["402",17],["403",H.VARIABLE_LENGTH,30],["410",13],["411",13],["412",13],["413",13],["414",13],["420",H.VARIABLE_LENGTH,20],["421",H.VARIABLE_LENGTH,15],["422",3],["423",H.VARIABLE_LENGTH,15],["424",3],["425",3],["426",3]],H.THREE_DIGIT_PLUS_DIGIT_DATA_LENGTH=[["310",6],["311",6],["312",6],["313",6],["314",6],["315",6],["316",6],["320",6],["321",6],["322",6],["323",6],["324",6],["325",6],["326",6],["327",6],["328",6],["329",6],["330",6],["331",6],["332",6],["333",6],["334",6],["335",6],["336",6],["340",6],["341",6],["342",6],["343",6],["344",6],["345",6],["346",6],["347",6],["348",6],["349",6],["350",6],["351",6],["352",6],["353",6],["354",6],["355",6],["356",6],["357",6],["360",6],["361",6],["362",6],["363",6],["364",6],["365",6],["366",6],["367",6],["368",6],["369",6],["390",H.VARIABLE_LENGTH,15],["391",H.VARIABLE_LENGTH,18],["392",H.VARIABLE_LENGTH,15],["393",H.VARIABLE_LENGTH,18],["703",H.VARIABLE_LENGTH,30]],H.FOUR_DIGIT_DATA_LENGTH=[["7001",13],["7002",H.VARIABLE_LENGTH,30],["7003",10],["8001",14],["8002",H.VARIABLE_LENGTH,20],["8003",H.VARIABLE_LENGTH,30],["8004",H.VARIABLE_LENGTH,30],["8005",6],["8006",18],["8007",H.VARIABLE_LENGTH,30],["8008",H.VARIABLE_LENGTH,12],["8018",18],["8020",H.VARIABLE_LENGTH,25],["8100",6],["8101",10],["8102",2],["8110",H.VARIABLE_LENGTH,70],["8200",H.VARIABLE_LENGTH,70]];class qe{constructor(e){this.buffer=new ie,this.information=e}decodeAllCodes(e,t){let r=t,s=null;do{let n=this.decodeGeneralPurposeField(r,s),i=H.parseFieldsInGeneralPurpose(n.getNewString());if(i!=null&&e.append(i),n.isRemaining()?s=""+n.getRemainingValue():s=null,r===n.getNewPosition())break;r=n.getNewPosition()}while(!0);return e.toString()}isStillNumeric(e){if(e+7>this.information.getSize())return e+4<=this.information.getSize();for(let t=e;t<e+3;++t)if(this.information.get(t))return!0;return this.information.get(e+3)}decodeNumeric(e){if(e+7>this.information.getSize()){let n=this.extractNumericValueFromBitArray(e,4);return n===0?new et(this.information.getSize(),et.FNC1,et.FNC1):new et(this.information.getSize(),n-1,et.FNC1)}let t=this.extractNumericValueFromBitArray(e,7),r=(t-8)/11,s=(t-8)%11;return new et(e+7,r,s)}extractNumericValueFromBitArray(e,t){return qe.extractNumericValueFromBitArray(this.information,e,t)}static extractNumericValueFromBitArray(e,t,r){let s=0;for(let n=0;n<r;++n)e.get(t+n)&&(s|=1<<r-n-1);return s}decodeGeneralPurposeField(e,t){this.buffer.setLengthToZero(),t!=null&&this.buffer.append(t),this.current.setPosition(e);let r=this.parseBlocks();return r!=null&&r.isRemaining()?new Pt(this.current.getPosition(),this.buffer.toString(),r.getRemainingValue()):new Pt(this.current.getPosition(),this.buffer.toString())}parseBlocks(){let e,t;do{let r=this.current.getPosition();if(this.current.isAlpha()?(t=this.parseAlphaBlock(),e=t.isFinished()):this.current.isIsoIec646()?(t=this.parseIsoIec646Block(),e=t.isFinished()):(t=this.parseNumericBlock(),e=t.isFinished()),!(r!==this.current.getPosition())&&!e)break}while(!e);return t.getDecodedInformation()}parseNumericBlock(){for(;this.isStillNumeric(this.current.getPosition());){let e=this.decodeNumeric(this.current.getPosition());if(this.current.setPosition(e.getNewPosition()),e.isFirstDigitFNC1()){let t;return e.isSecondDigitFNC1()?t=new Pt(this.current.getPosition(),this.buffer.toString()):t=new Pt(this.current.getPosition(),this.buffer.toString(),e.getSecondDigit()),new Dt(!0,t)}if(this.buffer.append(e.getFirstDigit()),e.isSecondDigitFNC1()){let t=new Pt(this.current.getPosition(),this.buffer.toString());return new Dt(!0,t)}this.buffer.append(e.getSecondDigit())}return this.isNumericToAlphaNumericLatch(this.current.getPosition())&&(this.current.setAlpha(),this.current.incrementPosition(4)),new Dt(!1)}parseIsoIec646Block(){for(;this.isStillIsoIec646(this.current.getPosition());){let e=this.decodeIsoIec646(this.current.getPosition());if(this.current.setPosition(e.getNewPosition()),e.isFNC1()){let t=new Pt(this.current.getPosition(),this.buffer.toString());return new Dt(!0,t)}this.buffer.append(e.getValue())}return this.isAlphaOr646ToNumericLatch(this.current.getPosition())?(this.current.incrementPosition(3),this.current.setNumeric()):this.isAlphaTo646ToAlphaLatch(this.current.getPosition())&&(this.current.getPosition()+5<this.information.getSize()?this.current.incrementPosition(5):this.current.setPosition(this.information.getSize()),this.current.setAlpha()),new Dt(!1)}parseAlphaBlock(){for(;this.isStillAlpha(this.current.getPosition());){let e=this.decodeAlphanumeric(this.current.getPosition());if(this.current.setPosition(e.getNewPosition()),e.isFNC1()){let t=new Pt(this.current.getPosition(),this.buffer.toString());return new Dt(!0,t)}this.buffer.append(e.getValue())}return this.isAlphaOr646ToNumericLatch(this.current.getPosition())?(this.current.incrementPosition(3),this.current.setNumeric()):this.isAlphaTo646ToAlphaLatch(this.current.getPosition())&&(this.current.getPosition()+5<this.information.getSize()?this.current.incrementPosition(5):this.current.setPosition(this.information.getSize()),this.current.setIsoIec646()),new Dt(!1)}isStillIsoIec646(e){if(e+5>this.information.getSize())return!1;let t=this.extractNumericValueFromBitArray(e,5);if(t>=5&&t<16)return!0;if(e+7>this.information.getSize())return!1;let r=this.extractNumericValueFromBitArray(e,7);if(r>=64&&r<116)return!0;if(e+8>this.information.getSize())return!1;let s=this.extractNumericValueFromBitArray(e,8);return s>=232&&s<253}decodeIsoIec646(e){let t=this.extractNumericValueFromBitArray(e,5);if(t===15)return new bt(e+5,bt.FNC1);if(t>=5&&t<15)return new bt(e+5,"0"+(t-5));let r=this.extractNumericValueFromBitArray(e,7);if(r>=64&&r<90)return new bt(e+7,""+(r+1));if(r>=90&&r<116)return new bt(e+7,""+(r+7));let s=this.extractNumericValueFromBitArray(e,8),n;switch(s){case 232:n="!";break;case 233:n='"';break;case 234:n="%";break;case 235:n="&";break;case 236:n="'";break;case 237:n="(";break;case 238:n=")";break;case 239:n="*";break;case 240:n="+";break;case 241:n=",";break;case 242:n="-";break;case 243:n=".";break;case 244:n="/";break;case 245:n=":";break;case 246:n=";";break;case 247:n="<";break;case 248:n="=";break;case 249:n=">";break;case 250:n="?";break;case 251:n="_";break;case 252:n=" ";break;default:throw new S}return new bt(e+8,n)}isStillAlpha(e){if(e+5>this.information.getSize())return!1;let t=this.extractNumericValueFromBitArray(e,5);if(t>=5&&t<16)return!0;if(e+6>this.information.getSize())return!1;let r=this.extractNumericValueFromBitArray(e,6);return r>=16&&r<63}decodeAlphanumeric(e){let t=this.extractNumericValueFromBitArray(e,5);if(t===15)return new bt(e+5,bt.FNC1);if(t>=5&&t<15)return new bt(e+5,"0"+(t-5));let r=this.extractNumericValueFromBitArray(e,6);if(r>=32&&r<58)return new bt(e+6,""+(r+33));let s;switch(r){case 58:s="*";break;case 59:s=",";break;case 60:s="-";break;case 61:s=".";break;case 62:s="/";break;default:throw new _e("Decoding invalid alphanumeric value: "+r)}return new bt(e+6,s)}isAlphaTo646ToAlphaLatch(e){if(e+1>this.information.getSize())return!1;for(let t=0;t<5&&t+e<this.information.getSize();++t)if(t===2){if(!this.information.get(e+2))return!1}else if(this.information.get(e+t))return!1;return!0}isAlphaOr646ToNumericLatch(e){if(e+3>this.information.getSize())return!1;for(let t=e;t<e+3;++t)if(this.information.get(t))return!1;return!0}isNumericToAlphaNumericLatch(e){if(e+1>this.information.getSize())return!1;for(let t=0;t<4&&t+e<this.information.getSize();++t)if(this.information.get(e+t))return!1;return!0}}class Rt{constructor(e){this.information=e,this.generalDecoder=new qe(e)}getInformation(){return this.information}getGeneralDecoder(){return this.generalDecoder}}class pt extends Rt{constructor(e){super(e)}encodeCompressedGtin(e,t){e.append("(01)");let r=e.length();e.append("9"),this.encodeCompressedGtinWithoutAI(e,t,r)}encodeCompressedGtinWithoutAI(e,t,r){for(let s=0;s<4;++s){let n=this.getGeneralDecoder().extractNumericValueFromBitArray(t+10*s,10);n/100===0&&e.append("0"),n/10===0&&e.append("0"),e.append(n)}pt.appendCheckDigit(e,r)}static appendCheckDigit(e,t){let r=0;for(let s=0;s<13;s++){let n=e.charAt(s+t).charCodeAt(0)-48;r+=(s&1)===0?3*n:n}r=10-r%10,r===10&&(r=0),e.append(r)}}pt.GTIN_SIZE=40;class Er extends pt{constructor(e){super(e)}parseInformation(){let e=new ie;e.append("(01)");let t=e.length(),r=this.getGeneralDecoder().extractNumericValueFromBitArray(Er.HEADER_SIZE,4);return e.append(r),this.encodeCompressedGtinWithoutAI(e,Er.HEADER_SIZE+4,t),this.getGeneralDecoder().decodeAllCodes(e,Er.HEADER_SIZE+44)}}Er.HEADER_SIZE=4;class Yr extends Rt{constructor(e){super(e)}parseInformation(){let e=new ie;return this.getGeneralDecoder().decodeAllCodes(e,Yr.HEADER_SIZE)}}Yr.HEADER_SIZE=5;class qr extends pt{constructor(e){super(e)}encodeCompressedWeight(e,t,r){let s=this.getGeneralDecoder().extractNumericValueFromBitArray(t,r);this.addWeightCode(e,s);let n=this.checkWeight(s),i=1e5;for(let o=0;o<5;++o)n/i===0&&e.append("0"),i/=10;e.append(n)}}class $t extends qr{constructor(e){super(e)}parseInformation(){if(this.getInformation().getSize()!=$t.HEADER_SIZE+qr.GTIN_SIZE+$t.WEIGHT_SIZE)throw new j;let e=new ie;return this.encodeCompressedGtin(e,$t.HEADER_SIZE),this.encodeCompressedWeight(e,$t.HEADER_SIZE+qr.GTIN_SIZE,$t.WEIGHT_SIZE),e.toString()}}$t.HEADER_SIZE=5,$t.WEIGHT_SIZE=15;class kn extends $t{constructor(e){super(e)}addWeightCode(e,t){e.append("(3103)")}checkWeight(e){return e}}class vn extends $t{constructor(e){super(e)}addWeightCode(e,t){t<1e4?e.append("(3202)"):e.append("(3203)")}checkWeight(e){return e<1e4?e:e-1e4}}class er extends pt{constructor(e){super(e)}parseInformation(){if(this.getInformation().getSize()<er.HEADER_SIZE+pt.GTIN_SIZE)throw new j;let e=new ie;this.encodeCompressedGtin(e,er.HEADER_SIZE);let t=this.getGeneralDecoder().extractNumericValueFromBitArray(er.HEADER_SIZE+pt.GTIN_SIZE,er.LAST_DIGIT_SIZE);e.append("(392"),e.append(t),e.append(")");let r=this.getGeneralDecoder().decodeGeneralPurposeField(er.HEADER_SIZE+pt.GTIN_SIZE+er.LAST_DIGIT_SIZE,null);return e.append(r.getNewString()),e.toString()}}er.HEADER_SIZE=8,er.LAST_DIGIT_SIZE=2;class jt extends pt{constructor(e){super(e)}parseInformation(){if(this.getInformation().getSize()<jt.HEADER_SIZE+pt.GTIN_SIZE)throw new j;let e=new ie;this.encodeCompressedGtin(e,jt.HEADER_SIZE);let t=this.getGeneralDecoder().extractNumericValueFromBitArray(jt.HEADER_SIZE+pt.GTIN_SIZE,jt.LAST_DIGIT_SIZE);e.append("(393"),e.append(t),e.append(")");let r=this.getGeneralDecoder().extractNumericValueFromBitArray(jt.HEADER_SIZE+pt.GTIN_SIZE+jt.LAST_DIGIT_SIZE,jt.FIRST_THREE_DIGITS_SIZE);r/100==0&&e.append("0"),r/10==0&&e.append("0"),e.append(r);let s=this.getGeneralDecoder().decodeGeneralPurposeField(jt.HEADER_SIZE+pt.GTIN_SIZE+jt.LAST_DIGIT_SIZE+jt.FIRST_THREE_DIGITS_SIZE,null);return e.append(s.getNewString()),e.toString()}}jt.HEADER_SIZE=8,jt.LAST_DIGIT_SIZE=2,jt.FIRST_THREE_DIGITS_SIZE=10;class at extends qr{constructor(e,t,r){super(e),this.dateCode=r,this.firstAIdigits=t}parseInformation(){if(this.getInformation().getSize()!=at.HEADER_SIZE+at.GTIN_SIZE+at.WEIGHT_SIZE+at.DATE_SIZE)throw new j;let e=new ie;return this.encodeCompressedGtin(e,at.HEADER_SIZE),this.encodeCompressedWeight(e,at.HEADER_SIZE+at.GTIN_SIZE,at.WEIGHT_SIZE),this.encodeCompressedDate(e,at.HEADER_SIZE+at.GTIN_SIZE+at.WEIGHT_SIZE),e.toString()}encodeCompressedDate(e,t){let r=this.getGeneralDecoder().extractNumericValueFromBitArray(t,at.DATE_SIZE);if(r==38400)return;e.append("("),e.append(this.dateCode),e.append(")");let s=r%32;r/=32;let n=r%12+1;r/=12;let i=r;i/10==0&&e.append("0"),e.append(i),n/10==0&&e.append("0"),e.append(n),s/10==0&&e.append("0"),e.append(s)}addWeightCode(e,t){e.append("("),e.append(this.firstAIdigits),e.append(t/1e5),e.append(")")}checkWeight(e){return e%1e5}}at.HEADER_SIZE=8,at.WEIGHT_SIZE=20,at.DATE_SIZE=16;function Bs(u){try{if(u.get(1))return new Er(u);if(!u.get(2))return new Yr(u);switch(qe.extractNumericValueFromBitArray(u,1,4)){case 4:return new kn(u);case 5:return new vn(u)}switch(qe.extractNumericValueFromBitArray(u,1,5)){case 12:return new er(u);case 13:return new jt(u)}switch(qe.extractNumericValueFromBitArray(u,1,7)){case 56:return new at(u,"310","11");case 57:return new at(u,"320","11");case 58:return new at(u,"310","13");case 59:return new at(u,"320","13");case 60:return new at(u,"310","15");case 61:return new at(u,"320","15");case 62:return new at(u,"310","17");case 63:return new at(u,"320","17")}}catch(e){throw console.log(e),new _e("unknown decoder: "+u)}}class ar{constructor(e,t,r,s){this.leftchar=e,this.rightchar=t,this.finderpattern=r,this.maybeLast=s}mayBeLast(){return this.maybeLast}getLeftChar(){return this.leftchar}getRightChar(){return this.rightchar}getFinderPattern(){return this.finderpattern}mustBeLast(){return this.rightchar==null}toString(){return"[ "+this.leftchar+", "+this.rightchar+" : "+(this.finderpattern==null?"null":this.finderpattern.getValue())+" ]"}static equals(e,t){return e instanceof ar?ar.equalsOrNull(e.leftchar,t.leftchar)&&ar.equalsOrNull(e.rightchar,t.rightchar)&&ar.equalsOrNull(e.finderpattern,t.finderpattern):!1}static equalsOrNull(e,t){return e===null?t===null:ar.equals(e,t)}hashCode(){return this.leftchar.getValue()^this.rightchar.getValue()^this.finderpattern.getValue()}}class cs{constructor(e,t,r){this.pairs=e,this.rowNumber=t,this.wasReversed=r}getPairs(){return this.pairs}getRowNumber(){return this.rowNumber}isReversed(){return this.wasReversed}isEquivalent(e){return this.checkEqualitity(this,e)}toString(){return"{ "+this.pairs+" }"}equals(e,t){return e instanceof cs?this.checkEqualitity(e,t)&&e.wasReversed===t.wasReversed:!1}checkEqualitity(e,t){if(!e||!t)return;let r;return e.forEach((s,n)=>{t.forEach(i=>{s.getLeftChar().getValue()===i.getLeftChar().getValue()&&s.getRightChar().getValue()===i.getRightChar().getValue()&&s.getFinderPatter().getValue()===i.getFinderPatter().getValue()&&(r=!0)})}),r}}class Y extends $e{constructor(e){super(...arguments),this.pairs=new Array(Y.MAX_PAIRS),this.rows=new Array,this.startEnd=[2],this.verbose=e===!0}decodeRow(e,t,r){this.pairs.length=0,this.startFromEven=!1;try{return Y.constructResult(this.decodeRow2pairs(e,t))}catch(s){this.verbose&&console.log(s)}return this.pairs.length=0,this.startFromEven=!0,Y.constructResult(this.decodeRow2pairs(e,t))}reset(){this.pairs.length=0,this.rows.length=0}decodeRow2pairs(e,t){let r=!1;for(;!r;)try{this.pairs.push(this.retrieveNextPair(t,this.pairs,e))}catch(n){if(n instanceof j){if(!this.pairs.length)throw new j;r=!0}}if(this.checkChecksum())return this.pairs;let s;if(this.rows.length?s=!0:s=!1,this.storeRow(e,!1),s){let n=this.checkRowsBoolean(!1);if(n!=null||(n=this.checkRowsBoolean(!0),n!=null))return n}throw new j}checkRowsBoolean(e){if(this.rows.length>25)return this.rows.length=0,null;this.pairs.length=0,e&&(this.rows=this.rows.reverse());let t=null;try{t=this.checkRows(new Array,0)}catch(r){this.verbose&&console.log(r)}return e&&(this.rows=this.rows.reverse()),t}checkRows(e,t){for(let r=t;r<this.rows.length;r++){let s=this.rows[r];this.pairs.length=0;for(let i of e)this.pairs.push(i.getPairs());if(this.pairs.push(s.getPairs()),!Y.isValidSequence(this.pairs))continue;if(this.checkChecksum())return this.pairs;let n=new Array(e);n.push(s);try{return this.checkRows(n,r+1)}catch(i){this.verbose&&console.log(i)}}throw new j}static isValidSequence(e){for(let t of Y.FINDER_PATTERN_SEQUENCES){if(e.length>t.length)continue;let r=!0;for(let s=0;s<e.length;s++)if(e[s].getFinderPattern().getValue()!=t[s]){r=!1;break}if(r)return!0}return!1}storeRow(e,t){let r=0,s=!1,n=!1;for(;r<this.rows.length;){let i=this.rows[r];if(i.getRowNumber()>e){n=i.isEquivalent(this.pairs);break}s=i.isEquivalent(this.pairs),r++}n||s||Y.isPartialRow(this.pairs,this.rows)||(this.rows.push(r,new cs(this.pairs,e,t)),this.removePartialRows(this.pairs,this.rows))}removePartialRows(e,t){for(let r of t)if(r.getPairs().length!==e.length){for(let s of r.getPairs())for(let n of e)if(ar.equals(s,n))break}}static isPartialRow(e,t){for(let r of t){let s=!0;for(let n of e){let i=!1;for(let o of r.getPairs())if(n.equals(o)){i=!0;break}if(!i){s=!1;break}}if(s)return!0}return!1}getRows(){return this.rows}static constructResult(e){let t=fr.buildBitArray(e),s=Bs(t).parseInformation(),n=e[0].getFinderPattern().getResultPoints(),i=e[e.length-1].getFinderPattern().getResultPoints(),o=[n[0],n[1],i[0],i[1]];return new z(s,null,null,o,le.RSS_EXPANDED,null)}checkChecksum(){let e=this.pairs.get(0),t=e.getLeftChar(),r=e.getRightChar();if(r==null)return!1;let s=r.getChecksumPortion(),n=2;for(let o=1;o<this.pairs.size();++o){let l=this.pairs.get(o);s+=l.getLeftChar().getChecksumPortion(),n++;let c=l.getRightChar();c!=null&&(s+=c.getChecksumPortion(),n++)}return s%=211,211*(n-4)+s==t.getValue()}static getNextSecondBar(e,t){let r;return e.get(t)?(r=e.getNextUnset(t),r=e.getNextSet(r)):(r=e.getNextSet(t),r=e.getNextUnset(r)),r}retrieveNextPair(e,t,r){let s=t.length%2==0;this.startFromEven&&(s=!s);let n,i=!0,o=-1;do this.findNextPair(e,t,o),n=this.parseFoundFinderPattern(e,r,s),n==null?o=Y.getNextSecondBar(e,this.startEnd[0]):i=!1;while(i);let l=this.decodeDataCharacter(e,n,s,!0);if(!this.isEmptyPair(t)&&t[t.length-1].mustBeLast())throw new j;let c;try{c=this.decodeDataCharacter(e,n,s,!1)}catch(d){c=null,this.verbose&&console.log(d)}return new ar(l,c,n,!0)}isEmptyPair(e){return e.length===0}findNextPair(e,t,r){let s=this.getDecodeFinderCounters();s[0]=0,s[1]=0,s[2]=0,s[3]=0;let n=e.getSize(),i;r>=0?i=r:this.isEmptyPair(t)?i=0:i=t[t.length-1].getFinderPattern().getStartEnd()[1];let o=t.length%2!=0;this.startFromEven&&(o=!o);let l=!1;for(;i<n&&(l=!e.get(i),!!l);)i++;let c=0,d=i;for(let f=i;f<n;f++)if(e.get(f)!=l)s[c]++;else{if(c==3){if(o&&Y.reverseCounters(s),Y.isFinderPattern(s)){this.startEnd[0]=d,this.startEnd[1]=f;return}o&&Y.reverseCounters(s),d+=s[0]+s[1],s[0]=s[2],s[1]=s[3],s[2]=0,s[3]=0,c--}else c++;s[c]=1,l=!l}throw new j}static reverseCounters(e){let t=e.length;for(let r=0;r<t/2;++r){let s=e[r];e[r]=e[t-r-1],e[t-r-1]=s}}parseFoundFinderPattern(e,t,r){let s,n,i;if(r){let c=this.startEnd[0]-1;for(;c>=0&&!e.get(c);)c--;c++,s=this.startEnd[0]-c,n=c,i=this.startEnd[1]}else n=this.startEnd[0],i=e.getNextUnset(this.startEnd[1]+1),s=i-this.startEnd[1];let o=this.getDecodeFinderCounters();K.arraycopy(o,0,o,1,o.length-1),o[0]=s;let l;try{l=this.parseFinderValue(o,Y.FINDER_PATTERNS)}catch{return null}return new Mt(l,[n,i],n,i,t)}decodeDataCharacter(e,t,r,s){let n=this.getDataCharacterCounters();for(let Ze=0;Ze<n.length;Ze++)n[Ze]=0;if(s)Y.recordPatternInReverse(e,t.getStartEnd()[0],n);else{Y.recordPattern(e,t.getStartEnd()[1],n);for(let Ze=0,Tt=n.length-1;Ze<Tt;Ze++,Tt--){let Ht=n[Ze];n[Ze]=n[Tt],n[Tt]=Ht}}let i=17,o=Be.sum(new Int32Array(n))/i,l=(t.getStartEnd()[1]-t.getStartEnd()[0])/15;if(Math.abs(o-l)/l>.3)throw new j;let c=this.getOddCounts(),d=this.getEvenCounts(),f=this.getOddRoundingErrors(),b=this.getEvenRoundingErrors();for(let Ze=0;Ze<n.length;Ze++){let Tt=1*n[Ze]/o,Ht=Tt+.5;if(Ht<1){if(Tt<.3)throw new j;Ht=1}else if(Ht>8){if(Tt>8.7)throw new j;Ht=8}let Tr=Ze/2;(Ze&1)==0?(c[Tr]=Ht,f[Tr]=Tt-Ht):(d[Tr]=Ht,b[Tr]=Tt-Ht)}this.adjustOddEvenCounts(i);let y=4*t.getValue()+(r?0:2)+(s?0:1)-1,A=0,E=0;for(let Ze=c.length-1;Ze>=0;Ze--){if(Y.isNotA1left(t,r,s)){let Tt=Y.WEIGHTS[y][2*Ze];E+=c[Ze]*Tt}A+=c[Ze]}let O=0;for(let Ze=d.length-1;Ze>=0;Ze--)if(Y.isNotA1left(t,r,s)){let Tt=Y.WEIGHTS[y][2*Ze+1];O+=d[Ze]*Tt}let F=E+O;if((A&1)!=0||A>13||A<4)throw new j;let ee=(13-A)/2,te=Y.SYMBOL_WIDEST[ee],Z=9-te,Le=At.getRSSvalue(c,te,!0),Re=At.getRSSvalue(d,Z,!1),Lt=Y.EVEN_TOTAL_SUBSET[ee],Zt=Y.GSUM[ee],Ft=Le*Lt+Re+Zt;return new ze(Ft,F)}static isNotA1left(e,t,r){return!(e.getValue()==0&&t&&r)}adjustOddEvenCounts(e){let t=Be.sum(new Int32Array(this.getOddCounts())),r=Be.sum(new Int32Array(this.getEvenCounts())),s=!1,n=!1;t>13?n=!0:t<4&&(s=!0);let i=!1,o=!1;r>13?o=!0:r<4&&(i=!0);let l=t+r-e,c=(t&1)==1,d=(r&1)==0;if(l==1)if(c){if(d)throw new j;n=!0}else{if(!d)throw new j;o=!0}else if(l==-1)if(c){if(d)throw new j;s=!0}else{if(!d)throw new j;i=!0}else if(l==0){if(c){if(!d)throw new j;t<r?(s=!0,o=!0):(n=!0,i=!0)}else if(d)throw new j}else throw new j;if(s){if(n)throw new j;Y.increment(this.getOddCounts(),this.getOddRoundingErrors())}if(n&&Y.decrement(this.getOddCounts(),this.getOddRoundingErrors()),i){if(o)throw new j;Y.increment(this.getEvenCounts(),this.getOddRoundingErrors())}o&&Y.decrement(this.getEvenCounts(),this.getEvenRoundingErrors())}}Y.SYMBOL_WIDEST=[7,5,4,3,1],Y.EVEN_TOTAL_SUBSET=[4,20,52,104,204],Y.GSUM=[0,348,1388,2948,3988],Y.FINDER_PATTERNS=[Int32Array.from([1,8,4,1]),Int32Array.from([3,6,4,1]),Int32Array.from([3,4,6,1]),Int32Array.from([3,2,8,1]),Int32Array.from([2,6,5,1]),Int32Array.from([2,2,9,1])],Y.WEIGHTS=[[1,3,9,27,81,32,96,77],[20,60,180,118,143,7,21,63],[189,145,13,39,117,140,209,205],[193,157,49,147,19,57,171,91],[62,186,136,197,169,85,44,132],[185,133,188,142,4,12,36,108],[113,128,173,97,80,29,87,50],[150,28,84,41,123,158,52,156],[46,138,203,187,139,206,196,166],[76,17,51,153,37,111,122,155],[43,129,176,106,107,110,119,146],[16,48,144,10,30,90,59,177],[109,116,137,200,178,112,125,164],[70,210,208,202,184,130,179,115],[134,191,151,31,93,68,204,190],[148,22,66,198,172,94,71,2],[6,18,54,162,64,192,154,40],[120,149,25,75,14,42,126,167],[79,26,78,23,69,207,199,175],[103,98,83,38,114,131,182,124],[161,61,183,127,170,88,53,159],[55,165,73,8,24,72,5,15],[45,135,194,160,58,174,100,89]],Y.FINDER_PAT_A=0,Y.FINDER_PAT_B=1,Y.FINDER_PAT_C=2,Y.FINDER_PAT_D=3,Y.FINDER_PAT_E=4,Y.FINDER_PAT_F=5,Y.FINDER_PATTERN_SEQUENCES=[[Y.FINDER_PAT_A,Y.FINDER_PAT_A],[Y.FINDER_PAT_A,Y.FINDER_PAT_B,Y.FINDER_PAT_B],[Y.FINDER_PAT_A,Y.FINDER_PAT_C,Y.FINDER_PAT_B,Y.FINDER_PAT_D],[Y.FINDER_PAT_A,Y.FINDER_PAT_E,Y.FINDER_PAT_B,Y.FINDER_PAT_D,Y.FINDER_PAT_C],[Y.FINDER_PAT_A,Y.FINDER_PAT_E,Y.FINDER_PAT_B,Y.FINDER_PAT_D,Y.FINDER_PAT_D,Y.FINDER_PAT_F],[Y.FINDER_PAT_A,Y.FINDER_PAT_E,Y.FINDER_PAT_B,Y.FINDER_PAT_D,Y.FINDER_PAT_E,Y.FINDER_PAT_F,Y.FINDER_PAT_F],[Y.FINDER_PAT_A,Y.FINDER_PAT_A,Y.FINDER_PAT_B,Y.FINDER_PAT_B,Y.FINDER_PAT_C,Y.FINDER_PAT_C,Y.FINDER_PAT_D,Y.FINDER_PAT_D],[Y.FINDER_PAT_A,Y.FINDER_PAT_A,Y.FINDER_PAT_B,Y.FINDER_PAT_B,Y.FINDER_PAT_C,Y.FINDER_PAT_C,Y.FINDER_PAT_D,Y.FINDER_PAT_E,Y.FINDER_PAT_E],[Y.FINDER_PAT_A,Y.FINDER_PAT_A,Y.FINDER_PAT_B,Y.FINDER_PAT_B,Y.FINDER_PAT_C,Y.FINDER_PAT_C,Y.FINDER_PAT_D,Y.FINDER_PAT_E,Y.FINDER_PAT_F,Y.FINDER_PAT_F],[Y.FINDER_PAT_A,Y.FINDER_PAT_A,Y.FINDER_PAT_B,Y.FINDER_PAT_B,Y.FINDER_PAT_C,Y.FINDER_PAT_D,Y.FINDER_PAT_D,Y.FINDER_PAT_E,Y.FINDER_PAT_E,Y.FINDER_PAT_F,Y.FINDER_PAT_F]],Y.MAX_PAIRS=11;class In extends ze{constructor(e,t,r){super(e,t),this.count=0,this.finderPattern=r}getFinderPattern(){return this.finderPattern}getCount(){return this.count}incrementCount(){this.count++}}class xt extends $e{constructor(){super(...arguments),this.possibleLeftPairs=[],this.possibleRightPairs=[]}decodeRow(e,t,r){const s=this.decodePair(t,!1,e,r);xt.addOrTally(this.possibleLeftPairs,s),t.reverse();let n=this.decodePair(t,!0,e,r);xt.addOrTally(this.possibleRightPairs,n),t.reverse();for(let i of this.possibleLeftPairs)if(i.getCount()>1){for(let o of this.possibleRightPairs)if(o.getCount()>1&&xt.checkChecksum(i,o))return xt.constructResult(i,o)}throw new j}static addOrTally(e,t){if(t==null)return;let r=!1;for(let s of e)if(s.getValue()===t.getValue()){s.incrementCount(),r=!0;break}r||e.push(t)}reset(){this.possibleLeftPairs.length=0,this.possibleRightPairs.length=0}static constructResult(e,t){let r=4537077*e.getValue()+t.getValue(),s=new String(r).toString(),n=new ie;for(let c=13-s.length;c>0;c--)n.append("0");n.append(s);let i=0;for(let c=0;c<13;c++){let d=n.charAt(c).charCodeAt(0)-48;i+=(c&1)===0?3*d:d}i=10-i%10,i===10&&(i=0),n.append(i.toString());let o=e.getFinderPattern().getResultPoints(),l=t.getFinderPattern().getResultPoints();return new z(n.toString(),null,0,[o[0],o[1],l[0],l[1]],le.RSS_14,new Date().getTime())}static checkChecksum(e,t){let r=(e.getChecksumPortion()+16*t.getChecksumPortion())%79,s=9*e.getFinderPattern().getValue()+t.getFinderPattern().getValue();return s>72&&s--,s>8&&s--,r===s}decodePair(e,t,r,s){try{let n=this.findFinderPattern(e,t),i=this.parseFoundFinderPattern(e,r,t,n),o=s==null?null:s.get(re.NEED_RESULT_POINT_CALLBACK);if(o!=null){let d=(n[0]+n[1])/2;t&&(d=e.getSize()-1-d),o.foundPossibleResultPoint(new ue(d,r))}let l=this.decodeDataCharacter(e,i,!0),c=this.decodeDataCharacter(e,i,!1);return new In(1597*l.getValue()+c.getValue(),l.getChecksumPortion()+4*c.getChecksumPortion(),i)}catch{return null}}decodeDataCharacter(e,t,r){let s=this.getDataCharacterCounters();for(let O=0;O<s.length;O++)s[O]=0;if(r)lt.recordPatternInReverse(e,t.getStartEnd()[0],s);else{lt.recordPattern(e,t.getStartEnd()[1]+1,s);for(let O=0,F=s.length-1;O<F;O++,F--){let ee=s[O];s[O]=s[F],s[F]=ee}}let n=r?16:15,i=Be.sum(new Int32Array(s))/n,o=this.getOddCounts(),l=this.getEvenCounts(),c=this.getOddRoundingErrors(),d=this.getEvenRoundingErrors();for(let O=0;O<s.length;O++){let F=s[O]/i,ee=Math.floor(F+.5);ee<1?ee=1:ee>8&&(ee=8);let te=Math.floor(O/2);(O&1)===0?(o[te]=ee,c[te]=F-ee):(l[te]=ee,d[te]=F-ee)}this.adjustOddEvenCounts(r,n);let f=0,b=0;for(let O=o.length-1;O>=0;O--)b*=9,b+=o[O],f+=o[O];let y=0,A=0;for(let O=l.length-1;O>=0;O--)y*=9,y+=l[O],A+=l[O];let E=b+3*y;if(r){if((f&1)!==0||f>12||f<4)throw new j;let O=(12-f)/2,F=xt.OUTSIDE_ODD_WIDEST[O],ee=9-F,te=At.getRSSvalue(o,F,!1),Z=At.getRSSvalue(l,ee,!0),Le=xt.OUTSIDE_EVEN_TOTAL_SUBSET[O],Re=xt.OUTSIDE_GSUM[O];return new ze(te*Le+Z+Re,E)}else{if((A&1)!==0||A>10||A<4)throw new j;let O=(10-A)/2,F=xt.INSIDE_ODD_WIDEST[O],ee=9-F,te=At.getRSSvalue(o,F,!0),Z=At.getRSSvalue(l,ee,!1),Le=xt.INSIDE_ODD_TOTAL_SUBSET[O],Re=xt.INSIDE_GSUM[O];return new ze(Z*Le+te+Re,E)}}findFinderPattern(e,t){let r=this.getDecodeFinderCounters();r[0]=0,r[1]=0,r[2]=0,r[3]=0;let s=e.getSize(),n=!1,i=0;for(;i<s&&(n=!e.get(i),t!==n);)i++;let o=0,l=i;for(let c=i;c<s;c++)if(e.get(c)!==n)r[o]++;else{if(o===3){if($e.isFinderPattern(r))return[l,c];l+=r[0]+r[1],r[0]=r[2],r[1]=r[3],r[2]=0,r[3]=0,o--}else o++;r[o]=1,n=!n}throw new j}parseFoundFinderPattern(e,t,r,s){let n=e.get(s[0]),i=s[0]-1;for(;i>=0&&n!==e.get(i);)i--;i++;const o=s[0]-i,l=this.getDecodeFinderCounters(),c=new Int32Array(l.length);K.arraycopy(l,0,c,1,l.length-1),c[0]=o;const d=this.parseFinderValue(c,xt.FINDER_PATTERNS);let f=i,b=s[1];return r&&(f=e.getSize()-1-f,b=e.getSize()-1-b),new Mt(d,[i,s[1]],f,b,t)}adjustOddEvenCounts(e,t){let r=Be.sum(new Int32Array(this.getOddCounts())),s=Be.sum(new Int32Array(this.getEvenCounts())),n=!1,i=!1,o=!1,l=!1;e?(r>12?i=!0:r<4&&(n=!0),s>12?l=!0:s<4&&(o=!0)):(r>11?i=!0:r<5&&(n=!0),s>10?l=!0:s<4&&(o=!0));let c=r+s-t,d=(r&1)===(e?1:0),f=(s&1)===1;if(c===1)if(d){if(f)throw new j;i=!0}else{if(!f)throw new j;l=!0}else if(c===-1)if(d){if(f)throw new j;n=!0}else{if(!f)throw new j;o=!0}else if(c===0){if(d){if(!f)throw new j;r<s?(n=!0,l=!0):(i=!0,o=!0)}else if(f)throw new j}else throw new j;if(n){if(i)throw new j;$e.increment(this.getOddCounts(),this.getOddRoundingErrors())}if(i&&$e.decrement(this.getOddCounts(),this.getOddRoundingErrors()),o){if(l)throw new j;$e.increment(this.getEvenCounts(),this.getOddRoundingErrors())}l&&$e.decrement(this.getEvenCounts(),this.getEvenRoundingErrors())}}xt.OUTSIDE_EVEN_TOTAL_SUBSET=[1,10,34,70,126],xt.INSIDE_ODD_TOTAL_SUBSET=[4,20,48,81],xt.OUTSIDE_GSUM=[0,161,961,2015,2715],xt.INSIDE_GSUM=[0,336,1036,1516],xt.OUTSIDE_ODD_WIDEST=[8,6,4,3,1],xt.INSIDE_ODD_WIDEST=[2,4,6,8],xt.FINDER_PATTERNS=[Int32Array.from([3,8,2,1]),Int32Array.from([3,5,5,1]),Int32Array.from([3,3,7,1]),Int32Array.from([3,1,9,1]),Int32Array.from([2,7,4,1]),Int32Array.from([2,5,6,1]),Int32Array.from([2,3,8,1]),Int32Array.from([1,5,7,1]),Int32Array.from([1,3,9,1])];class kr extends lt{constructor(e,t){super(),this.readers=[],this.verbose=t===!0;const r=e?e.get(re.POSSIBLE_FORMATS):null,s=e&&e.get(re.ASSUME_CODE_39_CHECK_DIGIT)!==void 0;r?((r.includes(le.EAN_13)||r.includes(le.UPC_A)||r.includes(le.EAN_8)||r.includes(le.UPC_E))&&this.readers.push(new Vt(e)),r.includes(le.CODE_39)&&this.readers.push(new ut(s)),r.includes(le.CODE_128)&&this.readers.push(new ae),r.includes(le.ITF)&&this.readers.push(new v),r.includes(le.RSS_14)&&this.readers.push(new xt),r.includes(le.RSS_EXPANDED)&&this.readers.push(new Y(this.verbose))):(this.readers.push(new Vt(e)),this.readers.push(new ut),this.readers.push(new Vt(e)),this.readers.push(new ae),this.readers.push(new v),this.readers.push(new xt),this.readers.push(new Y(this.verbose)))}decodeRow(e,t,r){for(let s=0;s<this.readers.length;s++)try{return this.readers[s].decodeRow(e,t,r)}catch{}throw new j}reset(){this.readers.forEach(e=>e.reset())}}class Sn extends Je{constructor(e=500,t){super(new kr(t),e,t)}}class Xe{constructor(e,t,r){this.ecCodewords=e,this.ecBlocks=[t],r&&this.ecBlocks.push(r)}getECCodewords(){return this.ecCodewords}getECBlocks(){return this.ecBlocks}}class We{constructor(e,t){this.count=e,this.dataCodewords=t}getCount(){return this.count}getDataCodewords(){return this.dataCodewords}}class Fe{constructor(e,t,r,s,n,i){this.versionNumber=e,this.symbolSizeRows=t,this.symbolSizeColumns=r,this.dataRegionSizeRows=s,this.dataRegionSizeColumns=n,this.ecBlocks=i;let o=0;const l=i.getECCodewords(),c=i.getECBlocks();for(let d of c)o+=d.getCount()*(d.getDataCodewords()+l);this.totalCodewords=o}getVersionNumber(){return this.versionNumber}getSymbolSizeRows(){return this.symbolSizeRows}getSymbolSizeColumns(){return this.symbolSizeColumns}getDataRegionSizeRows(){return this.dataRegionSizeRows}getDataRegionSizeColumns(){return this.dataRegionSizeColumns}getTotalCodewords(){return this.totalCodewords}getECBlocks(){return this.ecBlocks}static getVersionForDimensions(e,t){if((e&1)!==0||(t&1)!==0)throw new S;for(let r of Fe.VERSIONS)if(r.symbolSizeRows===e&&r.symbolSizeColumns===t)return r;throw new S}toString(){return""+this.versionNumber}static buildVersions(){return[new Fe(1,10,10,8,8,new Xe(5,new We(1,3))),new Fe(2,12,12,10,10,new Xe(7,new We(1,5))),new Fe(3,14,14,12,12,new Xe(10,new We(1,8))),new Fe(4,16,16,14,14,new Xe(12,new We(1,12))),new Fe(5,18,18,16,16,new Xe(14,new We(1,18))),new Fe(6,20,20,18,18,new Xe(18,new We(1,22))),new Fe(7,22,22,20,20,new Xe(20,new We(1,30))),new Fe(8,24,24,22,22,new Xe(24,new We(1,36))),new Fe(9,26,26,24,24,new Xe(28,new We(1,44))),new Fe(10,32,32,14,14,new Xe(36,new We(1,62))),new Fe(11,36,36,16,16,new Xe(42,new We(1,86))),new Fe(12,40,40,18,18,new Xe(48,new We(1,114))),new Fe(13,44,44,20,20,new Xe(56,new We(1,144))),new Fe(14,48,48,22,22,new Xe(68,new We(1,174))),new Fe(15,52,52,24,24,new Xe(42,new We(2,102))),new Fe(16,64,64,14,14,new Xe(56,new We(2,140))),new Fe(17,72,72,16,16,new Xe(36,new We(4,92))),new Fe(18,80,80,18,18,new Xe(48,new We(4,114))),new Fe(19,88,88,20,20,new Xe(56,new We(4,144))),new Fe(20,96,96,22,22,new Xe(68,new We(4,174))),new Fe(21,104,104,24,24,new Xe(56,new We(6,136))),new Fe(22,120,120,18,18,new Xe(68,new We(6,175))),new Fe(23,132,132,20,20,new Xe(62,new We(8,163))),new Fe(24,144,144,22,22,new Xe(62,new We(8,156),new We(2,155))),new Fe(25,8,18,6,16,new Xe(7,new We(1,5))),new Fe(26,8,32,6,14,new Xe(11,new We(1,10))),new Fe(27,12,26,10,24,new Xe(14,new We(1,16))),new Fe(28,12,36,10,16,new Xe(18,new We(1,22))),new Fe(29,16,36,14,16,new Xe(24,new We(1,32))),new Fe(30,16,48,14,22,new Xe(28,new We(1,49)))]}}Fe.VERSIONS=Fe.buildVersions();class ds{constructor(e){const t=e.getHeight();if(t<8||t>144||(t&1)!==0)throw new S;this.version=ds.readVersion(e),this.mappingBitMatrix=this.extractDataRegion(e),this.readMappingMatrix=new ge(this.mappingBitMatrix.getWidth(),this.mappingBitMatrix.getHeight())}getVersion(){return this.version}static readVersion(e){const t=e.getHeight(),r=e.getWidth();return Fe.getVersionForDimensions(t,r)}readCodewords(){const e=new Int8Array(this.version.getTotalCodewords());let t=0,r=4,s=0;const n=this.mappingBitMatrix.getHeight(),i=this.mappingBitMatrix.getWidth();let o=!1,l=!1,c=!1,d=!1;do if(r===n&&s===0&&!o)e[t++]=this.readCorner1(n,i)&255,r-=2,s+=2,o=!0;else if(r===n-2&&s===0&&(i&3)!==0&&!l)e[t++]=this.readCorner2(n,i)&255,r-=2,s+=2,l=!0;else if(r===n+4&&s===2&&(i&7)===0&&!c)e[t++]=this.readCorner3(n,i)&255,r-=2,s+=2,c=!0;else if(r===n-2&&s===0&&(i&7)===4&&!d)e[t++]=this.readCorner4(n,i)&255,r-=2,s+=2,d=!0;else{do r<n&&s>=0&&!this.readMappingMatrix.get(s,r)&&(e[t++]=this.readUtah(r,s,n,i)&255),r-=2,s+=2;while(r>=0&&s<i);r+=1,s+=3;do r>=0&&s<i&&!this.readMappingMatrix.get(s,r)&&(e[t++]=this.readUtah(r,s,n,i)&255),r+=2,s-=2;while(r<n&&s>=0);r+=3,s+=1}while(r<n||s<i);if(t!==this.version.getTotalCodewords())throw new S;return e}readModule(e,t,r,s){return e<0&&(e+=r,t+=4-(r+4&7)),t<0&&(t+=s,e+=4-(s+4&7)),this.readMappingMatrix.set(t,e),this.mappingBitMatrix.get(t,e)}readUtah(e,t,r,s){let n=0;return this.readModule(e-2,t-2,r,s)&&(n|=1),n<<=1,this.readModule(e-2,t-1,r,s)&&(n|=1),n<<=1,this.readModule(e-1,t-2,r,s)&&(n|=1),n<<=1,this.readModule(e-1,t-1,r,s)&&(n|=1),n<<=1,this.readModule(e-1,t,r,s)&&(n|=1),n<<=1,this.readModule(e,t-2,r,s)&&(n|=1),n<<=1,this.readModule(e,t-1,r,s)&&(n|=1),n<<=1,this.readModule(e,t,r,s)&&(n|=1),n}readCorner1(e,t){let r=0;return this.readModule(e-1,0,e,t)&&(r|=1),r<<=1,this.readModule(e-1,1,e,t)&&(r|=1),r<<=1,this.readModule(e-1,2,e,t)&&(r|=1),r<<=1,this.readModule(0,t-2,e,t)&&(r|=1),r<<=1,this.readModule(0,t-1,e,t)&&(r|=1),r<<=1,this.readModule(1,t-1,e,t)&&(r|=1),r<<=1,this.readModule(2,t-1,e,t)&&(r|=1),r<<=1,this.readModule(3,t-1,e,t)&&(r|=1),r}readCorner2(e,t){let r=0;return this.readModule(e-3,0,e,t)&&(r|=1),r<<=1,this.readModule(e-2,0,e,t)&&(r|=1),r<<=1,this.readModule(e-1,0,e,t)&&(r|=1),r<<=1,this.readModule(0,t-4,e,t)&&(r|=1),r<<=1,this.readModule(0,t-3,e,t)&&(r|=1),r<<=1,this.readModule(0,t-2,e,t)&&(r|=1),r<<=1,this.readModule(0,t-1,e,t)&&(r|=1),r<<=1,this.readModule(1,t-1,e,t)&&(r|=1),r}readCorner3(e,t){let r=0;return this.readModule(e-1,0,e,t)&&(r|=1),r<<=1,this.readModule(e-1,t-1,e,t)&&(r|=1),r<<=1,this.readModule(0,t-3,e,t)&&(r|=1),r<<=1,this.readModule(0,t-2,e,t)&&(r|=1),r<<=1,this.readModule(0,t-1,e,t)&&(r|=1),r<<=1,this.readModule(1,t-3,e,t)&&(r|=1),r<<=1,this.readModule(1,t-2,e,t)&&(r|=1),r<<=1,this.readModule(1,t-1,e,t)&&(r|=1),r}readCorner4(e,t){let r=0;return this.readModule(e-3,0,e,t)&&(r|=1),r<<=1,this.readModule(e-2,0,e,t)&&(r|=1),r<<=1,this.readModule(e-1,0,e,t)&&(r|=1),r<<=1,this.readModule(0,t-2,e,t)&&(r|=1),r<<=1,this.readModule(0,t-1,e,t)&&(r|=1),r<<=1,this.readModule(1,t-1,e,t)&&(r|=1),r<<=1,this.readModule(2,t-1,e,t)&&(r|=1),r<<=1,this.readModule(3,t-1,e,t)&&(r|=1),r}extractDataRegion(e){const t=this.version.getSymbolSizeRows(),r=this.version.getSymbolSizeColumns();if(e.getHeight()!==t)throw new _("Dimension of bitMatrix must match the version size");const s=this.version.getDataRegionSizeRows(),n=this.version.getDataRegionSizeColumns(),i=t/s|0,o=r/n|0,l=i*s,c=o*n,d=new ge(c,l);for(let f=0;f<i;++f){const b=f*s;for(let y=0;y<o;++y){const A=y*n;for(let E=0;E<s;++E){const O=f*(s+2)+1+E,F=b+E;for(let ee=0;ee<n;++ee){const te=y*(n+2)+1+ee;if(e.get(te,O)){const Z=A+ee;d.set(Z,F)}}}}}return d}}class hs{constructor(e,t){this.numDataCodewords=e,this.codewords=t}static getDataBlocks(e,t){const r=t.getECBlocks();let s=0;const n=r.getECBlocks();for(let E of n)s+=E.getCount();const i=new Array(s);let o=0;for(let E of n)for(let O=0;O<E.getCount();O++){const F=E.getDataCodewords(),ee=r.getECCodewords()+F;i[o++]=new hs(F,new Uint8Array(ee))}const c=i[0].codewords.length-r.getECCodewords(),d=c-1;let f=0;for(let E=0;E<d;E++)for(let O=0;O<o;O++)i[O].codewords[E]=e[f++];const b=t.getVersionNumber()===24,y=b?8:o;for(let E=0;E<y;E++)i[E].codewords[c-1]=e[f++];const A=i[0].codewords.length;for(let E=c;E<A;E++)for(let O=0;O<o;O++){const F=b?(O+8)%o:O,ee=b&&F>7?E-1:E;i[F].codewords[ee]=e[f++]}if(f!==e.length)throw new _;return i}getNumDataCodewords(){return this.numDataCodewords}getCodewords(){return this.codewords}}class us{constructor(e){this.bytes=e,this.byteOffset=0,this.bitOffset=0}getBitOffset(){return this.bitOffset}getByteOffset(){return this.byteOffset}readBits(e){if(e<1||e>32||e>this.available())throw new _(""+e);let t=0,r=this.bitOffset,s=this.byteOffset;const n=this.bytes;if(r>0){const i=8-r,o=e<i?e:i,l=i-o,c=255>>8-o<<l;t=(n[s]&c)>>l,e-=o,r+=o,r===8&&(r=0,s++)}if(e>0){for(;e>=8;)t=t<<8|n[s]&255,s++,e-=8;if(e>0){const i=8-e,o=255>>i<<i;t=t<<e|(n[s]&o)>>i,r+=e}}return this.bitOffset=r,this.byteOffset=s,t}available(){return 8*(this.bytes.length-this.byteOffset)-this.bitOffset}}var Nt;(function(u){u[u.PAD_ENCODE=0]="PAD_ENCODE",u[u.ASCII_ENCODE=1]="ASCII_ENCODE",u[u.C40_ENCODE=2]="C40_ENCODE",u[u.TEXT_ENCODE=3]="TEXT_ENCODE",u[u.ANSIX12_ENCODE=4]="ANSIX12_ENCODE",u[u.EDIFACT_ENCODE=5]="EDIFACT_ENCODE",u[u.BASE256_ENCODE=6]="BASE256_ENCODE"})(Nt||(Nt={}));class or{static decode(e){const t=new us(e),r=new ie,s=new ie,n=new Array;let i=Nt.ASCII_ENCODE;do if(i===Nt.ASCII_ENCODE)i=this.decodeAsciiSegment(t,r,s);else{switch(i){case Nt.C40_ENCODE:this.decodeC40Segment(t,r);break;case Nt.TEXT_ENCODE:this.decodeTextSegment(t,r);break;case Nt.ANSIX12_ENCODE:this.decodeAnsiX12Segment(t,r);break;case Nt.EDIFACT_ENCODE:this.decodeEdifactSegment(t,r);break;case Nt.BASE256_ENCODE:this.decodeBase256Segment(t,r,n);break;default:throw new S}i=Nt.ASCII_ENCODE}while(i!==Nt.PAD_ENCODE&&t.available()>0);return s.length()>0&&r.append(s.toString()),new ot(e,r.toString(),n.length===0?null:n,null)}static decodeAsciiSegment(e,t,r){let s=!1;do{let n=e.readBits(8);if(n===0)throw new S;if(n<=128)return s&&(n+=128),t.append(String.fromCharCode(n-1)),Nt.ASCII_ENCODE;if(n===129)return Nt.PAD_ENCODE;if(n<=229){const i=n-130;i<10&&t.append("0"),t.append(""+i)}else switch(n){case 230:return Nt.C40_ENCODE;case 231:return Nt.BASE256_ENCODE;case 232:t.append("");break;case 233:case 234:break;case 235:s=!0;break;case 236:t.append("[)>05"),r.insert(0,"");break;case 237:t.append("[)>06"),r.insert(0,"");break;case 238:return Nt.ANSIX12_ENCODE;case 239:return Nt.TEXT_ENCODE;case 240:return Nt.EDIFACT_ENCODE;case 241:break;default:if(n!==254||e.available()!==0)throw new S;break}}while(e.available()>0);return Nt.ASCII_ENCODE}static decodeC40Segment(e,t){let r=!1;const s=[];let n=0;do{if(e.available()===8)return;const i=e.readBits(8);if(i===254)return;this.parseTwoBytes(i,e.readBits(8),s);for(let o=0;o<3;o++){const l=s[o];switch(n){case 0:if(l<3)n=l+1;else if(l<this.C40_BASIC_SET_CHARS.length){const c=this.C40_BASIC_SET_CHARS[l];r?(t.append(String.fromCharCode(c.charCodeAt(0)+128)),r=!1):t.append(c)}else throw new S;break;case 1:r?(t.append(String.fromCharCode(l+128)),r=!1):t.append(String.fromCharCode(l)),n=0;break;case 2:if(l<this.C40_SHIFT2_SET_CHARS.length){const c=this.C40_SHIFT2_SET_CHARS[l];r?(t.append(String.fromCharCode(c.charCodeAt(0)+128)),r=!1):t.append(c)}else switch(l){case 27:t.append("");break;case 30:r=!0;break;default:throw new S}n=0;break;case 3:r?(t.append(String.fromCharCode(l+224)),r=!1):t.append(String.fromCharCode(l+96)),n=0;break;default:throw new S}}}while(e.available()>0)}static decodeTextSegment(e,t){let r=!1,s=[],n=0;do{if(e.available()===8)return;const i=e.readBits(8);if(i===254)return;this.parseTwoBytes(i,e.readBits(8),s);for(let o=0;o<3;o++){const l=s[o];switch(n){case 0:if(l<3)n=l+1;else if(l<this.TEXT_BASIC_SET_CHARS.length){const c=this.TEXT_BASIC_SET_CHARS[l];r?(t.append(String.fromCharCode(c.charCodeAt(0)+128)),r=!1):t.append(c)}else throw new S;break;case 1:r?(t.append(String.fromCharCode(l+128)),r=!1):t.append(String.fromCharCode(l)),n=0;break;case 2:if(l<this.TEXT_SHIFT2_SET_CHARS.length){const c=this.TEXT_SHIFT2_SET_CHARS[l];r?(t.append(String.fromCharCode(c.charCodeAt(0)+128)),r=!1):t.append(c)}else switch(l){case 27:t.append("");break;case 30:r=!0;break;default:throw new S}n=0;break;case 3:if(l<this.TEXT_SHIFT3_SET_CHARS.length){const c=this.TEXT_SHIFT3_SET_CHARS[l];r?(t.append(String.fromCharCode(c.charCodeAt(0)+128)),r=!1):t.append(c),n=0}else throw new S;break;default:throw new S}}}while(e.available()>0)}static decodeAnsiX12Segment(e,t){const r=[];do{if(e.available()===8)return;const s=e.readBits(8);if(s===254)return;this.parseTwoBytes(s,e.readBits(8),r);for(let n=0;n<3;n++){const i=r[n];switch(i){case 0:t.append("\r");break;case 1:t.append("*");break;case 2:t.append(">");break;case 3:t.append(" ");break;default:if(i<14)t.append(String.fromCharCode(i+44));else if(i<40)t.append(String.fromCharCode(i+51));else throw new S;break}}}while(e.available()>0)}static parseTwoBytes(e,t,r){let s=(e<<8)+t-1,n=Math.floor(s/1600);r[0]=n,s-=n*1600,n=Math.floor(s/40),r[1]=n,r[2]=s-n*40}static decodeEdifactSegment(e,t){do{if(e.available()<=16)return;for(let r=0;r<4;r++){let s=e.readBits(6);if(s===31){const n=8-e.getBitOffset();n!==8&&e.readBits(n);return}(s&32)===0&&(s|=64),t.append(String.fromCharCode(s))}}while(e.available()>0)}static decodeBase256Segment(e,t,r){let s=1+e.getByteOffset();const n=this.unrandomize255State(e.readBits(8),s++);let i;if(n===0?i=e.available()/8|0:n<250?i=n:i=250*(n-249)+this.unrandomize255State(e.readBits(8),s++),i<0)throw new S;const o=new Uint8Array(i);for(let l=0;l<i;l++){if(e.available()<8)throw new S;o[l]=this.unrandomize255State(e.readBits(8),s++)}r.push(o);try{t.append(pe.decode(o,G.ISO88591))}catch(l){throw new _e("Platform does not support required encoding: "+l.message)}}static unrandomize255State(e,t){const r=149*t%255+1,s=e-r;return s>=0?s:s+256}}or.C40_BASIC_SET_CHARS=["*","*","*"," ","0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"],or.C40_SHIFT2_SET_CHARS=["!",'"',"#","$","%","&","'","(",")","*","+",",","-",".","/",":",";","<","=",">","?","@","[","\\","]","^","_"],or.TEXT_BASIC_SET_CHARS=["*","*","*"," ","0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"],or.TEXT_SHIFT2_SET_CHARS=or.C40_SHIFT2_SET_CHARS,or.TEXT_SHIFT3_SET_CHARS=["`","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","{","|","}","~",""];class Tn{constructor(){this.rsDecoder=new st(se.DATA_MATRIX_FIELD_256)}decode(e){const t=new ds(e),r=t.getVersion(),s=t.readCodewords(),n=hs.getDataBlocks(s,r);let i=0;for(let c of n)i+=c.getNumDataCodewords();const o=new Uint8Array(i),l=n.length;for(let c=0;c<l;c++){const d=n[c],f=d.getCodewords(),b=d.getNumDataCodewords();this.correctErrors(f,b);for(let y=0;y<b;y++)o[y*l+c]=f[y]}return or.decode(o)}correctErrors(e,t){const r=new Int32Array(e);try{this.rsDecoder.decode(r,e.length-t)}catch{throw new $}for(let s=0;s<t;s++)e[s]=r[s]}}class wt{constructor(e){this.image=e,this.rectangleDetector=new Kt(this.image)}detect(){const e=this.rectangleDetector.detect();let t=this.detectSolid1(e);if(t=this.detectSolid2(t),t[3]=this.correctTopRight(t),!t[3])throw new j;t=this.shiftToModuleCenter(t);const r=t[0],s=t[1],n=t[2],i=t[3];let o=this.transitionsBetween(r,i)+1,l=this.transitionsBetween(n,i)+1;(o&1)===1&&(o+=1),(l&1)===1&&(l+=1),4*o<7*l&&4*l<7*o&&(o=l=Math.max(o,l));let c=wt.sampleGrid(this.image,r,s,n,i,o,l);return new xr(c,[r,s,n,i])}static shiftPoint(e,t,r){let s=(t.getX()-e.getX())/(r+1),n=(t.getY()-e.getY())/(r+1);return new ue(e.getX()+s,e.getY()+n)}static moveAway(e,t,r){let s=e.getX(),n=e.getY();return s<t?s-=1:s+=1,n<r?n-=1:n+=1,new ue(s,n)}detectSolid1(e){let t=e[0],r=e[1],s=e[3],n=e[2],i=this.transitionsBetween(t,r),o=this.transitionsBetween(r,s),l=this.transitionsBetween(s,n),c=this.transitionsBetween(n,t),d=i,f=[n,t,r,s];return d>o&&(d=o,f[0]=t,f[1]=r,f[2]=s,f[3]=n),d>l&&(d=l,f[0]=r,f[1]=s,f[2]=n,f[3]=t),d>c&&(f[0]=s,f[1]=n,f[2]=t,f[3]=r),f}detectSolid2(e){let t=e[0],r=e[1],s=e[2],n=e[3],i=this.transitionsBetween(t,n),o=wt.shiftPoint(r,s,(i+1)*4),l=wt.shiftPoint(s,r,(i+1)*4),c=this.transitionsBetween(o,t),d=this.transitionsBetween(l,n);return c<d?(e[0]=t,e[1]=r,e[2]=s,e[3]=n):(e[0]=r,e[1]=s,e[2]=n,e[3]=t),e}correctTopRight(e){let t=e[0],r=e[1],s=e[2],n=e[3],i=this.transitionsBetween(t,n),o=this.transitionsBetween(r,n),l=wt.shiftPoint(t,r,(o+1)*4),c=wt.shiftPoint(s,r,(i+1)*4);i=this.transitionsBetween(l,n),o=this.transitionsBetween(c,n);let d=new ue(n.getX()+(s.getX()-r.getX())/(i+1),n.getY()+(s.getY()-r.getY())/(i+1)),f=new ue(n.getX()+(t.getX()-r.getX())/(o+1),n.getY()+(t.getY()-r.getY())/(o+1));if(!this.isValid(d))return this.isValid(f)?f:null;if(!this.isValid(f))return d;let b=this.transitionsBetween(l,d)+this.transitionsBetween(c,d),y=this.transitionsBetween(l,f)+this.transitionsBetween(c,f);return b>y?d:f}shiftToModuleCenter(e){let t=e[0],r=e[1],s=e[2],n=e[3],i=this.transitionsBetween(t,n)+1,o=this.transitionsBetween(s,n)+1,l=wt.shiftPoint(t,r,o*4),c=wt.shiftPoint(s,r,i*4);i=this.transitionsBetween(l,n)+1,o=this.transitionsBetween(c,n)+1,(i&1)===1&&(i+=1),(o&1)===1&&(o+=1);let d=(t.getX()+r.getX()+s.getX()+n.getX())/4,f=(t.getY()+r.getY()+s.getY()+n.getY())/4;t=wt.moveAway(t,d,f),r=wt.moveAway(r,d,f),s=wt.moveAway(s,d,f),n=wt.moveAway(n,d,f);let b,y;return l=wt.shiftPoint(t,r,o*4),l=wt.shiftPoint(l,n,i*4),b=wt.shiftPoint(r,t,o*4),b=wt.shiftPoint(b,s,i*4),c=wt.shiftPoint(s,n,o*4),c=wt.shiftPoint(c,r,i*4),y=wt.shiftPoint(n,s,o*4),y=wt.shiftPoint(y,t,i*4),[l,b,c,y]}isValid(e){return e.getX()>=0&&e.getX()<this.image.getWidth()&&e.getY()>0&&e.getY()<this.image.getHeight()}static sampleGrid(e,t,r,s,n,i,o){return Qt.getInstance().sampleGrid(e,i,o,.5,.5,i-.5,.5,i-.5,o-.5,.5,o-.5,t.getX(),t.getY(),n.getX(),n.getY(),s.getX(),s.getY(),r.getX(),r.getY())}transitionsBetween(e,t){let r=Math.trunc(e.getX()),s=Math.trunc(e.getY()),n=Math.trunc(t.getX()),i=Math.trunc(t.getY()),o=Math.abs(i-s)>Math.abs(n-r);if(o){let E=r;r=s,s=E,E=n,n=i,i=E}let l=Math.abs(n-r),c=Math.abs(i-s),d=-l/2,f=s<i?1:-1,b=r<n?1:-1,y=0,A=this.image.get(o?s:r,o?r:s);for(let E=r,O=s;E!==n;E+=b){let F=this.image.get(o?O:E,o?E:O);if(F!==A&&(y++,A=F),d+=c,d>0){if(O===i)break;O+=f,d-=l}}return y}}class lr{constructor(){this.decoder=new Tn}decode(e,t=null){let r,s;if(t!=null&&t.has(re.PURE_BARCODE)){const c=lr.extractPureBits(e.getBlackMatrix());r=this.decoder.decode(c),s=lr.NO_POINTS}else{const c=new wt(e.getBlackMatrix()).detect();r=this.decoder.decode(c.getBits()),s=c.getPoints()}const n=r.getRawBytes(),i=new z(r.getText(),n,8*n.length,s,le.DATA_MATRIX,K.currentTimeMillis()),o=r.getByteSegments();o!=null&&i.putMetadata(Ge.BYTE_SEGMENTS,o);const l=r.getECLevel();return l!=null&&i.putMetadata(Ge.ERROR_CORRECTION_LEVEL,l),i}reset(){}static extractPureBits(e){const t=e.getTopLeftOnBit(),r=e.getBottomRightOnBit();if(t==null||r==null)throw new j;const s=this.moduleSize(t,e);let n=t[1];const i=r[1];let o=t[0];const c=(r[0]-o+1)/s,d=(i-n+1)/s;if(c<=0||d<=0)throw new j;const f=s/2;n+=f,o+=f;const b=new ge(c,d);for(let y=0;y<d;y++){const A=n+y*s;for(let E=0;E<c;E++)e.get(o+E*s,A)&&b.set(E,y)}return b}static moduleSize(e,t){const r=t.getWidth();let s=e[0];const n=e[1];for(;s<r&&t.get(s,n);)s++;if(s===r)throw new j;const i=s-e[0];if(i===0)throw new j;return i}}lr.NO_POINTS=[];class _n extends Je{constructor(e=500){super(new lr,e)}}var vr;(function(u){u[u.L=0]="L",u[u.M=1]="M",u[u.Q=2]="Q",u[u.H=3]="H"})(vr||(vr={}));class tt{constructor(e,t,r){this.value=e,this.stringValue=t,this.bits=r,tt.FOR_BITS.set(r,this),tt.FOR_VALUE.set(e,this)}getValue(){return this.value}getBits(){return this.bits}static fromString(e){switch(e){case"L":return tt.L;case"M":return tt.M;case"Q":return tt.Q;case"H":return tt.H;default:throw new R(e+"not available")}}toString(){return this.stringValue}equals(e){if(!(e instanceof tt))return!1;const t=e;return this.value===t.value}static forBits(e){if(e<0||e>=tt.FOR_BITS.size)throw new _;return tt.FOR_BITS.get(e)}}tt.FOR_BITS=new Map,tt.FOR_VALUE=new Map,tt.L=new tt(vr.L,"L",1),tt.M=new tt(vr.M,"M",0),tt.Q=new tt(vr.Q,"Q",3),tt.H=new tt(vr.H,"H",2);class Ot{constructor(e){this.errorCorrectionLevel=tt.forBits(e>>3&3),this.dataMask=e&7}static numBitsDiffering(e,t){return I.bitCount(e^t)}static decodeFormatInformation(e,t){const r=Ot.doDecodeFormatInformation(e,t);return r!==null?r:Ot.doDecodeFormatInformation(e^Ot.FORMAT_INFO_MASK_QR,t^Ot.FORMAT_INFO_MASK_QR)}static doDecodeFormatInformation(e,t){let r=Number.MAX_SAFE_INTEGER,s=0;for(const n of Ot.FORMAT_INFO_DECODE_LOOKUP){const i=n[0];if(i===e||i===t)return new Ot(n[1]);let o=Ot.numBitsDiffering(e,i);o<r&&(s=n[1],r=o),e!==t&&(o=Ot.numBitsDiffering(t,i),o<r&&(s=n[1],r=o))}return r<=3?new Ot(s):null}getErrorCorrectionLevel(){return this.errorCorrectionLevel}getDataMask(){return this.dataMask}hashCode(){return this.errorCorrectionLevel.getBits()<<3|this.dataMask}equals(e){if(!(e instanceof Ot))return!1;const t=e;return this.errorCorrectionLevel===t.errorCorrectionLevel&&this.dataMask===t.dataMask}}Ot.FORMAT_INFO_MASK_QR=21522,Ot.FORMAT_INFO_DECODE_LOOKUP=[Int32Array.from([21522,0]),Int32Array.from([20773,1]),Int32Array.from([24188,2]),Int32Array.from([23371,3]),Int32Array.from([17913,4]),Int32Array.from([16590,5]),Int32Array.from([20375,6]),Int32Array.from([19104,7]),Int32Array.from([30660,8]),Int32Array.from([29427,9]),Int32Array.from([32170,10]),Int32Array.from([30877,11]),Int32Array.from([26159,12]),Int32Array.from([25368,13]),Int32Array.from([27713,14]),Int32Array.from([26998,15]),Int32Array.from([5769,16]),Int32Array.from([5054,17]),Int32Array.from([7399,18]),Int32Array.from([6608,19]),Int32Array.from([1890,20]),Int32Array.from([597,21]),Int32Array.from([3340,22]),Int32Array.from([2107,23]),Int32Array.from([13663,24]),Int32Array.from([12392,25]),Int32Array.from([16177,26]),Int32Array.from([14854,27]),Int32Array.from([9396,28]),Int32Array.from([8579,29]),Int32Array.from([11994,30]),Int32Array.from([11245,31])];class D{constructor(e,...t){this.ecCodewordsPerBlock=e,this.ecBlocks=t}getECCodewordsPerBlock(){return this.ecCodewordsPerBlock}getNumBlocks(){let e=0;const t=this.ecBlocks;for(const r of t)e+=r.getCount();return e}getTotalECCodewords(){return this.ecCodewordsPerBlock*this.getNumBlocks()}getECBlocks(){return this.ecBlocks}}class N{constructor(e,t){this.count=e,this.dataCodewords=t}getCount(){return this.count}getDataCodewords(){return this.dataCodewords}}class ye{constructor(e,t,...r){this.versionNumber=e,this.alignmentPatternCenters=t,this.ecBlocks=r;let s=0;const n=r[0].getECCodewordsPerBlock(),i=r[0].getECBlocks();for(const o of i)s+=o.getCount()*(o.getDataCodewords()+n);this.totalCodewords=s}getVersionNumber(){return this.versionNumber}getAlignmentPatternCenters(){return this.alignmentPatternCenters}getTotalCodewords(){return this.totalCodewords}getDimensionForVersion(){return 17+4*this.versionNumber}getECBlocksForLevel(e){return this.ecBlocks[e.getValue()]}static getProvisionalVersionForDimension(e){if(e%4!==1)throw new S;try{return this.getVersionForNumber((e-17)/4)}catch{throw new S}}static getVersionForNumber(e){if(e<1||e>40)throw new _;return ye.VERSIONS[e-1]}static decodeVersionInformation(e){let t=Number.MAX_SAFE_INTEGER,r=0;for(let s=0;s<ye.VERSION_DECODE_INFO.length;s++){const n=ye.VERSION_DECODE_INFO[s];if(n===e)return ye.getVersionForNumber(s+7);const i=Ot.numBitsDiffering(e,n);i<t&&(r=s+7,t=i)}return t<=3?ye.getVersionForNumber(r):null}buildFunctionPattern(){const e=this.getDimensionForVersion(),t=new ge(e);t.setRegion(0,0,9,9),t.setRegion(e-8,0,8,9),t.setRegion(0,e-8,9,8);const r=this.alignmentPatternCenters.length;for(let s=0;s<r;s++){const n=this.alignmentPatternCenters[s]-2;for(let i=0;i<r;i++)s===0&&(i===0||i===r-1)||s===r-1&&i===0||t.setRegion(this.alignmentPatternCenters[i]-2,n,5,5)}return t.setRegion(6,9,1,e-17),t.setRegion(9,6,e-17,1),this.versionNumber>6&&(t.setRegion(e-11,0,3,6),t.setRegion(0,e-11,6,3)),t}toString(){return""+this.versionNumber}}ye.VERSION_DECODE_INFO=Int32Array.from([31892,34236,39577,42195,48118,51042,55367,58893,63784,68472,70749,76311,79154,84390,87683,92361,96236,102084,102881,110507,110734,117786,119615,126325,127568,133589,136944,141498,145311,150283,152622,158308,161089,167017]),ye.VERSIONS=[new ye(1,new Int32Array(0),new D(7,new N(1,19)),new D(10,new N(1,16)),new D(13,new N(1,13)),new D(17,new N(1,9))),new ye(2,Int32Array.from([6,18]),new D(10,new N(1,34)),new D(16,new N(1,28)),new D(22,new N(1,22)),new D(28,new N(1,16))),new ye(3,Int32Array.from([6,22]),new D(15,new N(1,55)),new D(26,new N(1,44)),new D(18,new N(2,17)),new D(22,new N(2,13))),new ye(4,Int32Array.from([6,26]),new D(20,new N(1,80)),new D(18,new N(2,32)),new D(26,new N(2,24)),new D(16,new N(4,9))),new ye(5,Int32Array.from([6,30]),new D(26,new N(1,108)),new D(24,new N(2,43)),new D(18,new N(2,15),new N(2,16)),new D(22,new N(2,11),new N(2,12))),new ye(6,Int32Array.from([6,34]),new D(18,new N(2,68)),new D(16,new N(4,27)),new D(24,new N(4,19)),new D(28,new N(4,15))),new ye(7,Int32Array.from([6,22,38]),new D(20,new N(2,78)),new D(18,new N(4,31)),new D(18,new N(2,14),new N(4,15)),new D(26,new N(4,13),new N(1,14))),new ye(8,Int32Array.from([6,24,42]),new D(24,new N(2,97)),new D(22,new N(2,38),new N(2,39)),new D(22,new N(4,18),new N(2,19)),new D(26,new N(4,14),new N(2,15))),new ye(9,Int32Array.from([6,26,46]),new D(30,new N(2,116)),new D(22,new N(3,36),new N(2,37)),new D(20,new N(4,16),new N(4,17)),new D(24,new N(4,12),new N(4,13))),new ye(10,Int32Array.from([6,28,50]),new D(18,new N(2,68),new N(2,69)),new D(26,new N(4,43),new N(1,44)),new D(24,new N(6,19),new N(2,20)),new D(28,new N(6,15),new N(2,16))),new ye(11,Int32Array.from([6,30,54]),new D(20,new N(4,81)),new D(30,new N(1,50),new N(4,51)),new D(28,new N(4,22),new N(4,23)),new D(24,new N(3,12),new N(8,13))),new ye(12,Int32Array.from([6,32,58]),new D(24,new N(2,92),new N(2,93)),new D(22,new N(6,36),new N(2,37)),new D(26,new N(4,20),new N(6,21)),new D(28,new N(7,14),new N(4,15))),new ye(13,Int32Array.from([6,34,62]),new D(26,new N(4,107)),new D(22,new N(8,37),new N(1,38)),new D(24,new N(8,20),new N(4,21)),new D(22,new N(12,11),new N(4,12))),new ye(14,Int32Array.from([6,26,46,66]),new D(30,new N(3,115),new N(1,116)),new D(24,new N(4,40),new N(5,41)),new D(20,new N(11,16),new N(5,17)),new D(24,new N(11,12),new N(5,13))),new ye(15,Int32Array.from([6,26,48,70]),new D(22,new N(5,87),new N(1,88)),new D(24,new N(5,41),new N(5,42)),new D(30,new N(5,24),new N(7,25)),new D(24,new N(11,12),new N(7,13))),new ye(16,Int32Array.from([6,26,50,74]),new D(24,new N(5,98),new N(1,99)),new D(28,new N(7,45),new N(3,46)),new D(24,new N(15,19),new N(2,20)),new D(30,new N(3,15),new N(13,16))),new ye(17,Int32Array.from([6,30,54,78]),new D(28,new N(1,107),new N(5,108)),new D(28,new N(10,46),new N(1,47)),new D(28,new N(1,22),new N(15,23)),new D(28,new N(2,14),new N(17,15))),new ye(18,Int32Array.from([6,30,56,82]),new D(30,new N(5,120),new N(1,121)),new D(26,new N(9,43),new N(4,44)),new D(28,new N(17,22),new N(1,23)),new D(28,new N(2,14),new N(19,15))),new ye(19,Int32Array.from([6,30,58,86]),new D(28,new N(3,113),new N(4,114)),new D(26,new N(3,44),new N(11,45)),new D(26,new N(17,21),new N(4,22)),new D(26,new N(9,13),new N(16,14))),new ye(20,Int32Array.from([6,34,62,90]),new D(28,new N(3,107),new N(5,108)),new D(26,new N(3,41),new N(13,42)),new D(30,new N(15,24),new N(5,25)),new D(28,new N(15,15),new N(10,16))),new ye(21,Int32Array.from([6,28,50,72,94]),new D(28,new N(4,116),new N(4,117)),new D(26,new N(17,42)),new D(28,new N(17,22),new N(6,23)),new D(30,new N(19,16),new N(6,17))),new ye(22,Int32Array.from([6,26,50,74,98]),new D(28,new N(2,111),new N(7,112)),new D(28,new N(17,46)),new D(30,new N(7,24),new N(16,25)),new D(24,new N(34,13))),new ye(23,Int32Array.from([6,30,54,78,102]),new D(30,new N(4,121),new N(5,122)),new D(28,new N(4,47),new N(14,48)),new D(30,new N(11,24),new N(14,25)),new D(30,new N(16,15),new N(14,16))),new ye(24,Int32Array.from([6,28,54,80,106]),new D(30,new N(6,117),new N(4,118)),new D(28,new N(6,45),new N(14,46)),new D(30,new N(11,24),new N(16,25)),new D(30,new N(30,16),new N(2,17))),new ye(25,Int32Array.from([6,32,58,84,110]),new D(26,new N(8,106),new N(4,107)),new D(28,new N(8,47),new N(13,48)),new D(30,new N(7,24),new N(22,25)),new D(30,new N(22,15),new N(13,16))),new ye(26,Int32Array.from([6,30,58,86,114]),new D(28,new N(10,114),new N(2,115)),new D(28,new N(19,46),new N(4,47)),new D(28,new N(28,22),new N(6,23)),new D(30,new N(33,16),new N(4,17))),new ye(27,Int32Array.from([6,34,62,90,118]),new D(30,new N(8,122),new N(4,123)),new D(28,new N(22,45),new N(3,46)),new D(30,new N(8,23),new N(26,24)),new D(30,new N(12,15),new N(28,16))),new ye(28,Int32Array.from([6,26,50,74,98,122]),new D(30,new N(3,117),new N(10,118)),new D(28,new N(3,45),new N(23,46)),new D(30,new N(4,24),new N(31,25)),new D(30,new N(11,15),new N(31,16))),new ye(29,Int32Array.from([6,30,54,78,102,126]),new D(30,new N(7,116),new N(7,117)),new D(28,new N(21,45),new N(7,46)),new D(30,new N(1,23),new N(37,24)),new D(30,new N(19,15),new N(26,16))),new ye(30,Int32Array.from([6,26,52,78,104,130]),new D(30,new N(5,115),new N(10,116)),new D(28,new N(19,47),new N(10,48)),new D(30,new N(15,24),new N(25,25)),new D(30,new N(23,15),new N(25,16))),new ye(31,Int32Array.from([6,30,56,82,108,134]),new D(30,new N(13,115),new N(3,116)),new D(28,new N(2,46),new N(29,47)),new D(30,new N(42,24),new N(1,25)),new D(30,new N(23,15),new N(28,16))),new ye(32,Int32Array.from([6,34,60,86,112,138]),new D(30,new N(17,115)),new D(28,new N(10,46),new N(23,47)),new D(30,new N(10,24),new N(35,25)),new D(30,new N(19,15),new N(35,16))),new ye(33,Int32Array.from([6,30,58,86,114,142]),new D(30,new N(17,115),new N(1,116)),new D(28,new N(14,46),new N(21,47)),new D(30,new N(29,24),new N(19,25)),new D(30,new N(11,15),new N(46,16))),new ye(34,Int32Array.from([6,34,62,90,118,146]),new D(30,new N(13,115),new N(6,116)),new D(28,new N(14,46),new N(23,47)),new D(30,new N(44,24),new N(7,25)),new D(30,new N(59,16),new N(1,17))),new ye(35,Int32Array.from([6,30,54,78,102,126,150]),new D(30,new N(12,121),new N(7,122)),new D(28,new N(12,47),new N(26,48)),new D(30,new N(39,24),new N(14,25)),new D(30,new N(22,15),new N(41,16))),new ye(36,Int32Array.from([6,24,50,76,102,128,154]),new D(30,new N(6,121),new N(14,122)),new D(28,new N(6,47),new N(34,48)),new D(30,new N(46,24),new N(10,25)),new D(30,new N(2,15),new N(64,16))),new ye(37,Int32Array.from([6,28,54,80,106,132,158]),new D(30,new N(17,122),new N(4,123)),new D(28,new N(29,46),new N(14,47)),new D(30,new N(49,24),new N(10,25)),new D(30,new N(24,15),new N(46,16))),new ye(38,Int32Array.from([6,32,58,84,110,136,162]),new D(30,new N(4,122),new N(18,123)),new D(28,new N(13,46),new N(32,47)),new D(30,new N(48,24),new N(14,25)),new D(30,new N(42,15),new N(32,16))),new ye(39,Int32Array.from([6,26,54,82,110,138,166]),new D(30,new N(20,117),new N(4,118)),new D(28,new N(40,47),new N(7,48)),new D(30,new N(43,24),new N(22,25)),new D(30,new N(10,15),new N(67,16))),new ye(40,Int32Array.from([6,30,58,86,114,142,170]),new D(30,new N(19,118),new N(6,119)),new D(28,new N(18,47),new N(31,48)),new D(30,new N(34,24),new N(34,25)),new D(30,new N(20,15),new N(61,16)))];var Et;(function(u){u[u.DATA_MASK_000=0]="DATA_MASK_000",u[u.DATA_MASK_001=1]="DATA_MASK_001",u[u.DATA_MASK_010=2]="DATA_MASK_010",u[u.DATA_MASK_011=3]="DATA_MASK_011",u[u.DATA_MASK_100=4]="DATA_MASK_100",u[u.DATA_MASK_101=5]="DATA_MASK_101",u[u.DATA_MASK_110=6]="DATA_MASK_110",u[u.DATA_MASK_111=7]="DATA_MASK_111"})(Et||(Et={}));class zt{constructor(e,t){this.value=e,this.isMasked=t}unmaskBitMatrix(e,t){for(let r=0;r<t;r++)for(let s=0;s<t;s++)this.isMasked(r,s)&&e.flip(s,r)}}zt.values=new Map([[Et.DATA_MASK_000,new zt(Et.DATA_MASK_000,(u,e)=>(u+e&1)===0)],[Et.DATA_MASK_001,new zt(Et.DATA_MASK_001,(u,e)=>(u&1)===0)],[Et.DATA_MASK_010,new zt(Et.DATA_MASK_010,(u,e)=>e%3===0)],[Et.DATA_MASK_011,new zt(Et.DATA_MASK_011,(u,e)=>(u+e)%3===0)],[Et.DATA_MASK_100,new zt(Et.DATA_MASK_100,(u,e)=>(Math.floor(u/2)+Math.floor(e/3)&1)===0)],[Et.DATA_MASK_101,new zt(Et.DATA_MASK_101,(u,e)=>u*e%6===0)],[Et.DATA_MASK_110,new zt(Et.DATA_MASK_110,(u,e)=>u*e%6<3)],[Et.DATA_MASK_111,new zt(Et.DATA_MASK_111,(u,e)=>(u+e+u*e%3&1)===0)]]);class Rn{constructor(e){const t=e.getHeight();if(t<21||(t&3)!==1)throw new S;this.bitMatrix=e}readFormatInformation(){if(this.parsedFormatInfo!==null&&this.parsedFormatInfo!==void 0)return this.parsedFormatInfo;let e=0;for(let n=0;n<6;n++)e=this.copyBit(n,8,e);e=this.copyBit(7,8,e),e=this.copyBit(8,8,e),e=this.copyBit(8,7,e);for(let n=5;n>=0;n--)e=this.copyBit(8,n,e);const t=this.bitMatrix.getHeight();let r=0;const s=t-7;for(let n=t-1;n>=s;n--)r=this.copyBit(8,n,r);for(let n=t-8;n<t;n++)r=this.copyBit(n,8,r);if(this.parsedFormatInfo=Ot.decodeFormatInformation(e,r),this.parsedFormatInfo!==null)return this.parsedFormatInfo;throw new S}readVersion(){if(this.parsedVersion!==null&&this.parsedVersion!==void 0)return this.parsedVersion;const e=this.bitMatrix.getHeight(),t=Math.floor((e-17)/4);if(t<=6)return ye.getVersionForNumber(t);let r=0;const s=e-11;for(let i=5;i>=0;i--)for(let o=e-9;o>=s;o--)r=this.copyBit(o,i,r);let n=ye.decodeVersionInformation(r);if(n!==null&&n.getDimensionForVersion()===e)return this.parsedVersion=n,n;r=0;for(let i=5;i>=0;i--)for(let o=e-9;o>=s;o--)r=this.copyBit(i,o,r);if(n=ye.decodeVersionInformation(r),n!==null&&n.getDimensionForVersion()===e)return this.parsedVersion=n,n;throw new S}copyBit(e,t,r){return(this.isMirror?this.bitMatrix.get(t,e):this.bitMatrix.get(e,t))?r<<1|1:r<<1}readCodewords(){const e=this.readFormatInformation(),t=this.readVersion(),r=zt.values.get(e.getDataMask()),s=this.bitMatrix.getHeight();r.unmaskBitMatrix(this.bitMatrix,s);const n=t.buildFunctionPattern();let i=!0;const o=new Uint8Array(t.getTotalCodewords());let l=0,c=0,d=0;for(let f=s-1;f>0;f-=2){f===6&&f--;for(let b=0;b<s;b++){const y=i?s-1-b:b;for(let A=0;A<2;A++)n.get(f-A,y)||(d++,c<<=1,this.bitMatrix.get(f-A,y)&&(c|=1),d===8&&(o[l++]=c,d=0,c=0))}i=!i}if(l!==t.getTotalCodewords())throw new S;return o}remask(){if(this.parsedFormatInfo===null)return;const e=zt.values[this.parsedFormatInfo.getDataMask()],t=this.bitMatrix.getHeight();e.unmaskBitMatrix(this.bitMatrix,t)}setMirror(e){this.parsedVersion=null,this.parsedFormatInfo=null,this.isMirror=e}mirror(){const e=this.bitMatrix;for(let t=0,r=e.getWidth();t<r;t++)for(let s=t+1,n=e.getHeight();s<n;s++)e.get(t,s)!==e.get(s,t)&&(e.flip(s,t),e.flip(t,s))}}class xs{constructor(e,t){this.numDataCodewords=e,this.codewords=t}static getDataBlocks(e,t,r){if(e.length!==t.getTotalCodewords())throw new _;const s=t.getECBlocksForLevel(r);let n=0;const i=s.getECBlocks();for(const A of i)n+=A.getCount();const o=new Array(n);let l=0;for(const A of i)for(let E=0;E<A.getCount();E++){const O=A.getDataCodewords(),F=s.getECCodewordsPerBlock()+O;o[l++]=new xs(O,new Uint8Array(F))}const c=o[0].codewords.length;let d=o.length-1;for(;d>=0&&o[d].codewords.length!==c;)d--;d++;const f=c-s.getECCodewordsPerBlock();let b=0;for(let A=0;A<f;A++)for(let E=0;E<l;E++)o[E].codewords[A]=e[b++];for(let A=d;A<l;A++)o[A].codewords[f]=e[b++];const y=o[0].codewords.length;for(let A=f;A<y;A++)for(let E=0;E<l;E++){const O=E<d?A:A+1;o[E].codewords[O]=e[b++]}return o}getNumDataCodewords(){return this.numDataCodewords}getCodewords(){return this.codewords}}var Yt;(function(u){u[u.TERMINATOR=0]="TERMINATOR",u[u.NUMERIC=1]="NUMERIC",u[u.ALPHANUMERIC=2]="ALPHANUMERIC",u[u.STRUCTURED_APPEND=3]="STRUCTURED_APPEND",u[u.BYTE=4]="BYTE",u[u.ECI=5]="ECI",u[u.KANJI=6]="KANJI",u[u.FNC1_FIRST_POSITION=7]="FNC1_FIRST_POSITION",u[u.FNC1_SECOND_POSITION=8]="FNC1_SECOND_POSITION",u[u.HANZI=9]="HANZI"})(Yt||(Yt={}));class Ee{constructor(e,t,r,s){this.value=e,this.stringValue=t,this.characterCountBitsForVersions=r,this.bits=s,Ee.FOR_BITS.set(s,this),Ee.FOR_VALUE.set(e,this)}static forBits(e){const t=Ee.FOR_BITS.get(e);if(t===void 0)throw new _;return t}getCharacterCountBits(e){const t=e.getVersionNumber();let r;return t<=9?r=0:t<=26?r=1:r=2,this.characterCountBitsForVersions[r]}getValue(){return this.value}getBits(){return this.bits}equals(e){if(!(e instanceof Ee))return!1;const t=e;return this.value===t.value}toString(){return this.stringValue}}Ee.FOR_BITS=new Map,Ee.FOR_VALUE=new Map,Ee.TERMINATOR=new Ee(Yt.TERMINATOR,"TERMINATOR",Int32Array.from([0,0,0]),0),Ee.NUMERIC=new Ee(Yt.NUMERIC,"NUMERIC",Int32Array.from([10,12,14]),1),Ee.ALPHANUMERIC=new Ee(Yt.ALPHANUMERIC,"ALPHANUMERIC",Int32Array.from([9,11,13]),2),Ee.STRUCTURED_APPEND=new Ee(Yt.STRUCTURED_APPEND,"STRUCTURED_APPEND",Int32Array.from([0,0,0]),3),Ee.BYTE=new Ee(Yt.BYTE,"BYTE",Int32Array.from([8,16,16]),4),Ee.ECI=new Ee(Yt.ECI,"ECI",Int32Array.from([0,0,0]),7),Ee.KANJI=new Ee(Yt.KANJI,"KANJI",Int32Array.from([8,10,12]),8),Ee.FNC1_FIRST_POSITION=new Ee(Yt.FNC1_FIRST_POSITION,"FNC1_FIRST_POSITION",Int32Array.from([0,0,0]),5),Ee.FNC1_SECOND_POSITION=new Ee(Yt.FNC1_SECOND_POSITION,"FNC1_SECOND_POSITION",Int32Array.from([0,0,0]),9),Ee.HANZI=new Ee(Yt.HANZI,"HANZI",Int32Array.from([8,10,12]),13);class ct{static decode(e,t,r,s){const n=new us(e);let i=new ie;const o=new Array;let l=-1,c=-1;try{let d=null,f=!1,b;do{if(n.available()<4)b=Ee.TERMINATOR;else{const y=n.readBits(4);b=Ee.forBits(y)}switch(b){case Ee.TERMINATOR:break;case Ee.FNC1_FIRST_POSITION:case Ee.FNC1_SECOND_POSITION:f=!0;break;case Ee.STRUCTURED_APPEND:if(n.available()<16)throw new S;l=n.readBits(8),c=n.readBits(8);break;case Ee.ECI:const y=ct.parseECIValue(n);if(d=M.getCharacterSetECIByValue(y),d===null)throw new S;break;case Ee.HANZI:const A=n.readBits(4),E=n.readBits(b.getCharacterCountBits(t));A===ct.GB2312_SUBSET&&ct.decodeHanziSegment(n,i,E);break;default:const O=n.readBits(b.getCharacterCountBits(t));switch(b){case Ee.NUMERIC:ct.decodeNumericSegment(n,i,O);break;case Ee.ALPHANUMERIC:ct.decodeAlphanumericSegment(n,i,O,f);break;case Ee.BYTE:ct.decodeByteSegment(n,i,O,d,o,s);break;case Ee.KANJI:ct.decodeKanjiSegment(n,i,O);break;default:throw new S}break}}while(b!==Ee.TERMINATOR)}catch{throw new S}return new ot(e,i.toString(),o.length===0?null:o,r===null?null:r.toString(),l,c)}static decodeHanziSegment(e,t,r){if(r*13>e.available())throw new S;const s=new Uint8Array(2*r);let n=0;for(;r>0;){const i=e.readBits(13);let o=i/96<<8&4294967295|i%96;o<959?o+=41377:o+=42657,s[n]=o>>8&255,s[n+1]=o&255,n+=2,r--}try{t.append(pe.decode(s,G.GB2312))}catch(i){throw new S(i)}}static decodeKanjiSegment(e,t,r){if(r*13>e.available())throw new S;const s=new Uint8Array(2*r);let n=0;for(;r>0;){const i=e.readBits(13);let o=i/192<<8&4294967295|i%192;o<7936?o+=33088:o+=49472,s[n]=o>>8,s[n+1]=o,n+=2,r--}try{t.append(pe.decode(s,G.SHIFT_JIS))}catch(i){throw new S(i)}}static decodeByteSegment(e,t,r,s,n,i){if(8*r>e.available())throw new S;const o=new Uint8Array(r);for(let c=0;c<r;c++)o[c]=e.readBits(8);let l;s===null?l=G.guessEncoding(o,i):l=s.getName();try{t.append(pe.decode(o,l))}catch(c){throw new S(c)}n.push(o)}static toAlphaNumericChar(e){if(e>=ct.ALPHANUMERIC_CHARS.length)throw new S;return ct.ALPHANUMERIC_CHARS[e]}static decodeAlphanumericSegment(e,t,r,s){const n=t.length();for(;r>1;){if(e.available()<11)throw new S;const i=e.readBits(11);t.append(ct.toAlphaNumericChar(Math.floor(i/45))),t.append(ct.toAlphaNumericChar(i%45)),r-=2}if(r===1){if(e.available()<6)throw new S;t.append(ct.toAlphaNumericChar(e.readBits(6)))}if(s)for(let i=n;i<t.length();i++)t.charAt(i)==="%"&&(i<t.length()-1&&t.charAt(i+1)==="%"?t.deleteCharAt(i+1):t.setCharAt(i,""))}static decodeNumericSegment(e,t,r){for(;r>=3;){if(e.available()<10)throw new S;const s=e.readBits(10);if(s>=1e3)throw new S;t.append(ct.toAlphaNumericChar(Math.floor(s/100))),t.append(ct.toAlphaNumericChar(Math.floor(s/10)%10)),t.append(ct.toAlphaNumericChar(s%10)),r-=3}if(r===2){if(e.available()<7)throw new S;const s=e.readBits(7);if(s>=100)throw new S;t.append(ct.toAlphaNumericChar(Math.floor(s/10))),t.append(ct.toAlphaNumericChar(s%10))}else if(r===1){if(e.available()<4)throw new S;const s=e.readBits(4);if(s>=10)throw new S;t.append(ct.toAlphaNumericChar(s))}}static parseECIValue(e){const t=e.readBits(8);if((t&128)===0)return t&127;if((t&192)===128){const r=e.readBits(8);return(t&63)<<8&4294967295|r}if((t&224)===192){const r=e.readBits(16);return(t&31)<<16&4294967295|r}throw new S}}ct.ALPHANUMERIC_CHARS="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ $%*+-./:",ct.GB2312_SUBSET=1;class Ls{constructor(e){this.mirrored=e}isMirrored(){return this.mirrored}applyMirroredCorrection(e){if(!this.mirrored||e===null||e.length<3)return;const t=e[0];e[0]=e[2],e[2]=t}}class On{constructor(){this.rsDecoder=new st(se.QR_CODE_FIELD_256)}decodeBooleanArray(e,t){return this.decodeBitMatrix(ge.parseFromBooleanArray(e),t)}decodeBitMatrix(e,t){const r=new Rn(e);let s=null;try{return this.decodeBitMatrixParser(r,t)}catch(n){s=n}try{r.remask(),r.setMirror(!0),r.readVersion(),r.readFormatInformation(),r.mirror();const n=this.decodeBitMatrixParser(r,t);return n.setOther(new Ls(!0)),n}catch(n){throw s!==null?s:n}}decodeBitMatrixParser(e,t){const r=e.readVersion(),s=e.readFormatInformation().getErrorCorrectionLevel(),n=e.readCodewords(),i=xs.getDataBlocks(n,r,s);let o=0;for(const d of i)o+=d.getNumDataCodewords();const l=new Uint8Array(o);let c=0;for(const d of i){const f=d.getCodewords(),b=d.getNumDataCodewords();this.correctErrors(f,b);for(let y=0;y<b;y++)l[c++]=f[y]}return ct.decode(l,r,s,t)}correctErrors(e,t){const r=new Int32Array(e);try{this.rsDecoder.decode(r,e.length-t)}catch{throw new $}for(let s=0;s<t;s++)e[s]=r[s]}}class fs extends ue{constructor(e,t,r){super(e,t),this.estimatedModuleSize=r}aboutEquals(e,t,r){if(Math.abs(t-this.getY())<=e&&Math.abs(r-this.getX())<=e){const s=Math.abs(e-this.estimatedModuleSize);return s<=1||s<=this.estimatedModuleSize}return!1}combineEstimate(e,t,r){const s=(this.getX()+t)/2,n=(this.getY()+e)/2,i=(this.estimatedModuleSize+r)/2;return new fs(s,n,i)}}class Kr{constructor(e,t,r,s,n,i,o){this.image=e,this.startX=t,this.startY=r,this.width=s,this.height=n,this.moduleSize=i,this.resultPointCallback=o,this.possibleCenters=[],this.crossCheckStateCount=new Int32Array(3)}find(){const e=this.startX,t=this.height,r=this.width,s=e+r,n=this.startY+t/2,i=new Int32Array(3),o=this.image;for(let l=0;l<t;l++){const c=n+((l&1)===0?Math.floor((l+1)/2):-Math.floor((l+1)/2));i[0]=0,i[1]=0,i[2]=0;let d=e;for(;d<s&&!o.get(d,c);)d++;let f=0;for(;d<s;){if(o.get(d,c))if(f===1)i[1]++;else if(f===2){if(this.foundPatternCross(i)){const b=this.handlePossibleCenter(i,c,d);if(b!==null)return b}i[0]=i[2],i[1]=1,i[2]=0,f=1}else i[++f]++;else f===1&&f++,i[f]++;d++}if(this.foundPatternCross(i)){const b=this.handlePossibleCenter(i,c,s);if(b!==null)return b}}if(this.possibleCenters.length!==0)return this.possibleCenters[0];throw new j}static centerFromEnd(e,t){return t-e[2]-e[1]/2}foundPatternCross(e){const t=this.moduleSize,r=t/2;for(let s=0;s<3;s++)if(Math.abs(t-e[s])>=r)return!1;return!0}crossCheckVertical(e,t,r,s){const n=this.image,i=n.getHeight(),o=this.crossCheckStateCount;o[0]=0,o[1]=0,o[2]=0;let l=e;for(;l>=0&&n.get(t,l)&&o[1]<=r;)o[1]++,l--;if(l<0||o[1]>r)return NaN;for(;l>=0&&!n.get(t,l)&&o[0]<=r;)o[0]++,l--;if(o[0]>r)return NaN;for(l=e+1;l<i&&n.get(t,l)&&o[1]<=r;)o[1]++,l++;if(l===i||o[1]>r)return NaN;for(;l<i&&!n.get(t,l)&&o[2]<=r;)o[2]++,l++;if(o[2]>r)return NaN;const c=o[0]+o[1]+o[2];return 5*Math.abs(c-s)>=2*s?NaN:this.foundPatternCross(o)?Kr.centerFromEnd(o,l):NaN}handlePossibleCenter(e,t,r){const s=e[0]+e[1]+e[2],n=Kr.centerFromEnd(e,r),i=this.crossCheckVertical(t,n,2*e[1],s);if(!isNaN(i)){const o=(e[0]+e[1]+e[2])/3;for(const c of this.possibleCenters)if(c.aboutEquals(o,i,n))return c.combineEstimate(i,n,o);const l=new fs(n,i,o);this.possibleCenters.push(l),this.resultPointCallback!==null&&this.resultPointCallback!==void 0&&this.resultPointCallback.foundPossibleResultPoint(l)}return null}}class gs extends ue{constructor(e,t,r,s){super(e,t),this.estimatedModuleSize=r,this.count=s,s===void 0&&(this.count=1)}getEstimatedModuleSize(){return this.estimatedModuleSize}getCount(){return this.count}aboutEquals(e,t,r){if(Math.abs(t-this.getY())<=e&&Math.abs(r-this.getX())<=e){const s=Math.abs(e-this.estimatedModuleSize);return s<=1||s<=this.estimatedModuleSize}return!1}combineEstimate(e,t,r){const s=this.count+1,n=(this.count*this.getX()+t)/s,i=(this.count*this.getY()+e)/s,o=(this.count*this.estimatedModuleSize+r)/s;return new gs(n,i,o,s)}}class Mn{constructor(e){this.bottomLeft=e[0],this.topLeft=e[1],this.topRight=e[2]}getBottomLeft(){return this.bottomLeft}getTopLeft(){return this.topLeft}getTopRight(){return this.topRight}}class kt{constructor(e,t){this.image=e,this.resultPointCallback=t,this.possibleCenters=[],this.crossCheckStateCount=new Int32Array(5),this.resultPointCallback=t}getImage(){return this.image}getPossibleCenters(){return this.possibleCenters}find(e){const t=e!=null&&e.get(re.TRY_HARDER)!==void 0,r=e!=null&&e.get(re.PURE_BARCODE)!==void 0,s=this.image,n=s.getHeight(),i=s.getWidth();let o=Math.floor(3*n/(4*kt.MAX_MODULES));(o<kt.MIN_SKIP||t)&&(o=kt.MIN_SKIP);let l=!1;const c=new Int32Array(5);for(let f=o-1;f<n&&!l;f+=o){c[0]=0,c[1]=0,c[2]=0,c[3]=0,c[4]=0;let b=0;for(let y=0;y<i;y++)if(s.get(y,f))(b&1)===1&&b++,c[b]++;else if((b&1)===0)if(b===4)if(kt.foundPatternCross(c)){if(this.handlePossibleCenter(c,f,y,r)===!0)if(o=2,this.hasSkipped===!0)l=this.haveMultiplyConfirmedCenters();else{const E=this.findRowSkip();E>c[2]&&(f+=E-c[2]-o,y=i-1)}else{c[0]=c[2],c[1]=c[3],c[2]=c[4],c[3]=1,c[4]=0,b=3;continue}b=0,c[0]=0,c[1]=0,c[2]=0,c[3]=0,c[4]=0}else c[0]=c[2],c[1]=c[3],c[2]=c[4],c[3]=1,c[4]=0,b=3;else c[++b]++;else c[b]++;kt.foundPatternCross(c)&&this.handlePossibleCenter(c,f,i,r)===!0&&(o=c[0],this.hasSkipped&&(l=this.haveMultiplyConfirmedCenters()))}const d=this.selectBestPatterns();return ue.orderBestPatterns(d),new Mn(d)}static centerFromEnd(e,t){return t-e[4]-e[3]-e[2]/2}static foundPatternCross(e){let t=0;for(let n=0;n<5;n++){const i=e[n];if(i===0)return!1;t+=i}if(t<7)return!1;const r=t/7,s=r/2;return Math.abs(r-e[0])<s&&Math.abs(r-e[1])<s&&Math.abs(3*r-e[2])<3*s&&Math.abs(r-e[3])<s&&Math.abs(r-e[4])<s}getCrossCheckStateCount(){const e=this.crossCheckStateCount;return e[0]=0,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e}crossCheckDiagonal(e,t,r,s){const n=this.getCrossCheckStateCount();let i=0;const o=this.image;for(;e>=i&&t>=i&&o.get(t-i,e-i);)n[2]++,i++;if(e<i||t<i)return!1;for(;e>=i&&t>=i&&!o.get(t-i,e-i)&&n[1]<=r;)n[1]++,i++;if(e<i||t<i||n[1]>r)return!1;for(;e>=i&&t>=i&&o.get(t-i,e-i)&&n[0]<=r;)n[0]++,i++;if(n[0]>r)return!1;const l=o.getHeight(),c=o.getWidth();for(i=1;e+i<l&&t+i<c&&o.get(t+i,e+i);)n[2]++,i++;if(e+i>=l||t+i>=c)return!1;for(;e+i<l&&t+i<c&&!o.get(t+i,e+i)&&n[3]<r;)n[3]++,i++;if(e+i>=l||t+i>=c||n[3]>=r)return!1;for(;e+i<l&&t+i<c&&o.get(t+i,e+i)&&n[4]<r;)n[4]++,i++;if(n[4]>=r)return!1;const d=n[0]+n[1]+n[2]+n[3]+n[4];return Math.abs(d-s)<2*s&&kt.foundPatternCross(n)}crossCheckVertical(e,t,r,s){const n=this.image,i=n.getHeight(),o=this.getCrossCheckStateCount();let l=e;for(;l>=0&&n.get(t,l);)o[2]++,l--;if(l<0)return NaN;for(;l>=0&&!n.get(t,l)&&o[1]<=r;)o[1]++,l--;if(l<0||o[1]>r)return NaN;for(;l>=0&&n.get(t,l)&&o[0]<=r;)o[0]++,l--;if(o[0]>r)return NaN;for(l=e+1;l<i&&n.get(t,l);)o[2]++,l++;if(l===i)return NaN;for(;l<i&&!n.get(t,l)&&o[3]<r;)o[3]++,l++;if(l===i||o[3]>=r)return NaN;for(;l<i&&n.get(t,l)&&o[4]<r;)o[4]++,l++;if(o[4]>=r)return NaN;const c=o[0]+o[1]+o[2]+o[3]+o[4];return 5*Math.abs(c-s)>=2*s?NaN:kt.foundPatternCross(o)?kt.centerFromEnd(o,l):NaN}crossCheckHorizontal(e,t,r,s){const n=this.image,i=n.getWidth(),o=this.getCrossCheckStateCount();let l=e;for(;l>=0&&n.get(l,t);)o[2]++,l--;if(l<0)return NaN;for(;l>=0&&!n.get(l,t)&&o[1]<=r;)o[1]++,l--;if(l<0||o[1]>r)return NaN;for(;l>=0&&n.get(l,t)&&o[0]<=r;)o[0]++,l--;if(o[0]>r)return NaN;for(l=e+1;l<i&&n.get(l,t);)o[2]++,l++;if(l===i)return NaN;for(;l<i&&!n.get(l,t)&&o[3]<r;)o[3]++,l++;if(l===i||o[3]>=r)return NaN;for(;l<i&&n.get(l,t)&&o[4]<r;)o[4]++,l++;if(o[4]>=r)return NaN;const c=o[0]+o[1]+o[2]+o[3]+o[4];return 5*Math.abs(c-s)>=s?NaN:kt.foundPatternCross(o)?kt.centerFromEnd(o,l):NaN}handlePossibleCenter(e,t,r,s){const n=e[0]+e[1]+e[2]+e[3]+e[4];let i=kt.centerFromEnd(e,r),o=this.crossCheckVertical(t,Math.floor(i),e[2],n);if(!isNaN(o)&&(i=this.crossCheckHorizontal(Math.floor(i),Math.floor(o),e[2],n),!isNaN(i)&&(!s||this.crossCheckDiagonal(Math.floor(o),Math.floor(i),e[2],n)))){const l=n/7;let c=!1;const d=this.possibleCenters;for(let f=0,b=d.length;f<b;f++){const y=d[f];if(y.aboutEquals(l,o,i)){d[f]=y.combineEstimate(o,i,l),c=!0;break}}if(!c){const f=new gs(i,o,l);d.push(f),this.resultPointCallback!==null&&this.resultPointCallback!==void 0&&this.resultPointCallback.foundPossibleResultPoint(f)}return!0}return!1}findRowSkip(){if(this.possibleCenters.length<=1)return 0;let t=null;for(const r of this.possibleCenters)if(r.getCount()>=kt.CENTER_QUORUM)if(t==null)t=r;else return this.hasSkipped=!0,Math.floor((Math.abs(t.getX()-r.getX())-Math.abs(t.getY()-r.getY()))/2);return 0}haveMultiplyConfirmedCenters(){let e=0,t=0;const r=this.possibleCenters.length;for(const i of this.possibleCenters)i.getCount()>=kt.CENTER_QUORUM&&(e++,t+=i.getEstimatedModuleSize());if(e<3)return!1;const s=t/r;let n=0;for(const i of this.possibleCenters)n+=Math.abs(i.getEstimatedModuleSize()-s);return n<=.05*t}selectBestPatterns(){const e=this.possibleCenters.length;if(e<3)throw new j;const t=this.possibleCenters;let r;if(e>3){let s=0,n=0;for(const l of this.possibleCenters){const c=l.getEstimatedModuleSize();s+=c,n+=c*c}r=s/e;let i=Math.sqrt(n/e-r*r);t.sort((l,c)=>{const d=Math.abs(c.getEstimatedModuleSize()-r),f=Math.abs(l.getEstimatedModuleSize()-r);return d<f?-1:d>f?1:0});const o=Math.max(.2*r,i);for(let l=0;l<t.length&&t.length>3;l++){const c=t[l];Math.abs(c.getEstimatedModuleSize()-r)>o&&(t.splice(l,1),l--)}}if(t.length>3){let s=0;for(const n of t)s+=n.getEstimatedModuleSize();r=s/t.length,t.sort((n,i)=>{if(i.getCount()===n.getCount()){const o=Math.abs(i.getEstimatedModuleSize()-r),l=Math.abs(n.getEstimatedModuleSize()-r);return o<l?1:o>l?-1:0}else return i.getCount()-n.getCount()}),t.splice(3)}return[t[0],t[1],t[2]]}}kt.CENTER_QUORUM=2,kt.MIN_SKIP=3,kt.MAX_MODULES=57;class jr{constructor(e){this.image=e}getImage(){return this.image}getResultPointCallback(){return this.resultPointCallback}detect(e){this.resultPointCallback=e==null?null:e.get(re.NEED_RESULT_POINT_CALLBACK);const r=new kt(this.image,this.resultPointCallback).find(e);return this.processFinderPatternInfo(r)}processFinderPatternInfo(e){const t=e.getTopLeft(),r=e.getTopRight(),s=e.getBottomLeft(),n=this.calculateModuleSize(t,r,s);if(n<1)throw new j("No pattern found in proccess finder.");const i=jr.computeDimension(t,r,s,n),o=ye.getProvisionalVersionForDimension(i),l=o.getDimensionForVersion()-7;let c=null;if(o.getAlignmentPatternCenters().length>0){const y=r.getX()-t.getX()+s.getX(),A=r.getY()-t.getY()+s.getY(),E=1-3/l,O=Math.floor(t.getX()+E*(y-t.getX())),F=Math.floor(t.getY()+E*(A-t.getY()));for(let ee=4;ee<=16;ee<<=1)try{c=this.findAlignmentInRegion(n,O,F,ee);break}catch(te){if(!(te instanceof j))throw te}}const d=jr.createTransform(t,r,s,c,i),f=jr.sampleGrid(this.image,d,i);let b;return c===null?b=[s,t,r]:b=[s,t,r,c],new xr(f,b)}static createTransform(e,t,r,s,n){const i=n-3.5;let o,l,c,d;return s!==null?(o=s.getX(),l=s.getY(),c=i-3,d=c):(o=t.getX()-e.getX()+r.getX(),l=t.getY()-e.getY()+r.getY(),c=i,d=i),Ut.quadrilateralToQuadrilateral(3.5,3.5,i,3.5,c,d,3.5,i,e.getX(),e.getY(),t.getX(),t.getY(),o,l,r.getX(),r.getY())}static sampleGrid(e,t,r){return Qt.getInstance().sampleGridWithTransform(e,r,r,t)}static computeDimension(e,t,r,s){const n=Be.round(ue.distance(e,t)/s),i=Be.round(ue.distance(e,r)/s);let o=Math.floor((n+i)/2)+7;switch(o&3){case 0:o++;break;case 2:o--;break;case 3:throw new j("Dimensions could be not found.")}return o}calculateModuleSize(e,t,r){return(this.calculateModuleSizeOneWay(e,t)+this.calculateModuleSizeOneWay(e,r))/2}calculateModuleSizeOneWay(e,t){const r=this.sizeOfBlackWhiteBlackRunBothWays(Math.floor(e.getX()),Math.floor(e.getY()),Math.floor(t.getX()),Math.floor(t.getY())),s=this.sizeOfBlackWhiteBlackRunBothWays(Math.floor(t.getX()),Math.floor(t.getY()),Math.floor(e.getX()),Math.floor(e.getY()));return isNaN(r)?s/7:isNaN(s)?r/7:(r+s)/14}sizeOfBlackWhiteBlackRunBothWays(e,t,r,s){let n=this.sizeOfBlackWhiteBlackRun(e,t,r,s),i=1,o=e-(r-e);o<0?(i=e/(e-o),o=0):o>=this.image.getWidth()&&(i=(this.image.getWidth()-1-e)/(o-e),o=this.image.getWidth()-1);let l=Math.floor(t-(s-t)*i);return i=1,l<0?(i=t/(t-l),l=0):l>=this.image.getHeight()&&(i=(this.image.getHeight()-1-t)/(l-t),l=this.image.getHeight()-1),o=Math.floor(e+(o-e)*i),n+=this.sizeOfBlackWhiteBlackRun(e,t,o,l),n-1}sizeOfBlackWhiteBlackRun(e,t,r,s){const n=Math.abs(s-t)>Math.abs(r-e);if(n){let y=e;e=t,t=y,y=r,r=s,s=y}const i=Math.abs(r-e),o=Math.abs(s-t);let l=-i/2;const c=e<r?1:-1,d=t<s?1:-1;let f=0;const b=r+c;for(let y=e,A=t;y!==b;y+=c){const E=n?A:y,O=n?y:A;if(f===1===this.image.get(E,O)){if(f===2)return Be.distance(y,A,e,t);f++}if(l+=o,l>0){if(A===s)break;A+=d,l-=i}}return f===2?Be.distance(r+c,s,e,t):NaN}findAlignmentInRegion(e,t,r,s){const n=Math.floor(s*e),i=Math.max(0,t-n),o=Math.min(this.image.getWidth()-1,t+n);if(o-i<e*3)throw new j("Alignment top exceeds estimated module size.");const l=Math.max(0,r-n),c=Math.min(this.image.getHeight()-1,r+n);if(c-l<e*3)throw new j("Alignment bottom exceeds estimated module size.");return new Kr(this.image,i,l,o-i,c-l,e,this.resultPointCallback).find()}}class cr{constructor(){this.decoder=new On}getDecoder(){return this.decoder}decode(e,t){let r,s;if(t!=null&&t.get(re.PURE_BARCODE)!==void 0){const l=cr.extractPureBits(e.getBlackMatrix());r=this.decoder.decodeBitMatrix(l,t),s=cr.NO_POINTS}else{const l=new jr(e.getBlackMatrix()).detect(t);r=this.decoder.decodeBitMatrix(l.getBits(),t),s=l.getPoints()}r.getOther()instanceof Ls&&r.getOther().applyMirroredCorrection(s);const n=new z(r.getText(),r.getRawBytes(),void 0,s,le.QR_CODE,void 0),i=r.getByteSegments();i!==null&&n.putMetadata(Ge.BYTE_SEGMENTS,i);const o=r.getECLevel();return o!==null&&n.putMetadata(Ge.ERROR_CORRECTION_LEVEL,o),r.hasStructuredAppend()&&(n.putMetadata(Ge.STRUCTURED_APPEND_SEQUENCE,r.getStructuredAppendSequenceNumber()),n.putMetadata(Ge.STRUCTURED_APPEND_PARITY,r.getStructuredAppendParity())),n}reset(){}static extractPureBits(e){const t=e.getTopLeftOnBit(),r=e.getBottomRightOnBit();if(t===null||r===null)throw new j;const s=this.moduleSize(t,e);let n=t[1],i=r[1],o=t[0],l=r[0];if(o>=l||n>=i)throw new j;if(i-n!==l-o&&(l=o+(i-n),l>=e.getWidth()))throw new j;const c=Math.round((l-o+1)/s),d=Math.round((i-n+1)/s);if(c<=0||d<=0)throw new j;if(d!==c)throw new j;const f=Math.floor(s/2);n+=f,o+=f;const b=o+Math.floor((c-1)*s)-l;if(b>0){if(b>f)throw new j;o-=b}const y=n+Math.floor((d-1)*s)-i;if(y>0){if(y>f)throw new j;n-=y}const A=new ge(c,d);for(let E=0;E<d;E++){const O=n+Math.floor(E*s);for(let F=0;F<c;F++)e.get(o+Math.floor(F*s),O)&&A.set(F,E)}return A}static moduleSize(e,t){const r=t.getHeight(),s=t.getWidth();let n=e[0],i=e[1],o=!0,l=0;for(;n<s&&i<r;){if(o!==t.get(n,i)){if(++l===5)break;o=!o}n++,i++}if(n===s||i===r)throw new j;return(n-e[0])/7}}cr.NO_POINTS=new Array;class Ie{PDF417Common(){}static getBitCountSum(e){return Be.sum(e)}static toIntArray(e){if(e==null||!e.length)return Ie.EMPTY_INT_ARRAY;const t=new Int32Array(e.length);let r=0;for(const s of e)t[r++]=s;return t}static getCodeword(e){const t=X.binarySearch(Ie.SYMBOL_TABLE,e&262143);return t<0?-1:(Ie.CODEWORD_TABLE[t]-1)%Ie.NUMBER_OF_CODEWORDS}}Ie.NUMBER_OF_CODEWORDS=929,Ie.MAX_CODEWORDS_IN_BARCODE=Ie.NUMBER_OF_CODEWORDS-1,Ie.MIN_ROWS_IN_BARCODE=3,Ie.MAX_ROWS_IN_BARCODE=90,Ie.MODULES_IN_CODEWORD=17,Ie.MODULES_IN_STOP_PATTERN=18,Ie.BARS_IN_MODULE=8,Ie.EMPTY_INT_ARRAY=new Int32Array([]),Ie.SYMBOL_TABLE=Int32Array.from([66142,66170,66206,66236,66290,66292,66350,66382,66396,66454,66470,66476,66594,66600,66614,66626,66628,66632,66640,66654,66662,66668,66682,66690,66718,66720,66748,66758,66776,66798,66802,66804,66820,66824,66832,66846,66848,66876,66880,66936,66950,66956,66968,66992,67006,67022,67036,67042,67044,67048,67062,67118,67150,67164,67214,67228,67256,67294,67322,67350,67366,67372,67398,67404,67416,67438,67474,67476,67490,67492,67496,67510,67618,67624,67650,67656,67664,67678,67686,67692,67706,67714,67716,67728,67742,67744,67772,67782,67788,67800,67822,67826,67828,67842,67848,67870,67872,67900,67904,67960,67974,67992,68016,68030,68046,68060,68066,68068,68072,68086,68104,68112,68126,68128,68156,68160,68216,68336,68358,68364,68376,68400,68414,68448,68476,68494,68508,68536,68546,68548,68552,68560,68574,68582,68588,68654,68686,68700,68706,68708,68712,68726,68750,68764,68792,68802,68804,68808,68816,68830,68838,68844,68858,68878,68892,68920,68976,68990,68994,68996,69e3,69008,69022,69024,69052,69062,69068,69080,69102,69106,69108,69142,69158,69164,69190,69208,69230,69254,69260,69272,69296,69310,69326,69340,69386,69394,69396,69410,69416,69430,69442,69444,69448,69456,69470,69478,69484,69554,69556,69666,69672,69698,69704,69712,69726,69754,69762,69764,69776,69790,69792,69820,69830,69836,69848,69870,69874,69876,69890,69918,69920,69948,69952,70008,70022,70040,70064,70078,70094,70108,70114,70116,70120,70134,70152,70174,70176,70264,70384,70412,70448,70462,70496,70524,70542,70556,70584,70594,70600,70608,70622,70630,70636,70664,70672,70686,70688,70716,70720,70776,70896,71136,71180,71192,71216,71230,71264,71292,71360,71416,71452,71480,71536,71550,71554,71556,71560,71568,71582,71584,71612,71622,71628,71640,71662,71726,71732,71758,71772,71778,71780,71784,71798,71822,71836,71864,71874,71880,71888,71902,71910,71916,71930,71950,71964,71992,72048,72062,72066,72068,72080,72094,72096,72124,72134,72140,72152,72174,72178,72180,72206,72220,72248,72304,72318,72416,72444,72456,72464,72478,72480,72508,72512,72568,72588,72600,72624,72638,72654,72668,72674,72676,72680,72694,72726,72742,72748,72774,72780,72792,72814,72838,72856,72880,72894,72910,72924,72930,72932,72936,72950,72966,72972,72984,73008,73022,73056,73084,73102,73116,73144,73156,73160,73168,73182,73190,73196,73210,73226,73234,73236,73250,73252,73256,73270,73282,73284,73296,73310,73318,73324,73346,73348,73352,73360,73374,73376,73404,73414,73420,73432,73454,73498,73518,73522,73524,73550,73564,73570,73572,73576,73590,73800,73822,73858,73860,73872,73886,73888,73916,73944,73970,73972,73992,74014,74016,74044,74048,74104,74118,74136,74160,74174,74210,74212,74216,74230,74244,74256,74270,74272,74360,74480,74502,74508,74544,74558,74592,74620,74638,74652,74680,74690,74696,74704,74726,74732,74782,74784,74812,74992,75232,75288,75326,75360,75388,75456,75512,75576,75632,75646,75650,75652,75664,75678,75680,75708,75718,75724,75736,75758,75808,75836,75840,75896,76016,76256,76736,76824,76848,76862,76896,76924,76992,77048,77296,77340,77368,77424,77438,77536,77564,77572,77576,77584,77600,77628,77632,77688,77702,77708,77720,77744,77758,77774,77788,77870,77902,77916,77922,77928,77966,77980,78008,78018,78024,78032,78046,78060,78074,78094,78136,78192,78206,78210,78212,78224,78238,78240,78268,78278,78284,78296,78322,78324,78350,78364,78448,78462,78560,78588,78600,78622,78624,78652,78656,78712,78726,78744,78768,78782,78798,78812,78818,78820,78824,78838,78862,78876,78904,78960,78974,79072,79100,79296,79352,79368,79376,79390,79392,79420,79424,79480,79600,79628,79640,79664,79678,79712,79740,79772,79800,79810,79812,79816,79824,79838,79846,79852,79894,79910,79916,79942,79948,79960,79982,79988,80006,80024,80048,80062,80078,80092,80098,80100,80104,80134,80140,80176,80190,80224,80252,80270,80284,80312,80328,80336,80350,80358,80364,80378,80390,80396,80408,80432,80446,80480,80508,80576,80632,80654,80668,80696,80752,80766,80776,80784,80798,80800,80828,80844,80856,80878,80882,80884,80914,80916,80930,80932,80936,80950,80962,80968,80976,80990,80998,81004,81026,81028,81040,81054,81056,81084,81094,81100,81112,81134,81154,81156,81160,81168,81182,81184,81212,81216,81272,81286,81292,81304,81328,81342,81358,81372,81380,81384,81398,81434,81454,81458,81460,81486,81500,81506,81508,81512,81526,81550,81564,81592,81602,81604,81608,81616,81630,81638,81644,81702,81708,81722,81734,81740,81752,81774,81778,81780,82050,82078,82080,82108,82180,82184,82192,82206,82208,82236,82240,82296,82316,82328,82352,82366,82402,82404,82408,82440,82448,82462,82464,82492,82496,82552,82672,82694,82700,82712,82736,82750,82784,82812,82830,82882,82884,82888,82896,82918,82924,82952,82960,82974,82976,83004,83008,83064,83184,83424,83468,83480,83504,83518,83552,83580,83648,83704,83740,83768,83824,83838,83842,83844,83848,83856,83872,83900,83910,83916,83928,83950,83984,84e3,84028,84032,84088,84208,84448,84928,85040,85054,85088,85116,85184,85240,85488,85560,85616,85630,85728,85756,85764,85768,85776,85790,85792,85820,85824,85880,85894,85900,85912,85936,85966,85980,86048,86080,86136,86256,86496,86976,88160,88188,88256,88312,88560,89056,89200,89214,89312,89340,89536,89592,89608,89616,89632,89664,89720,89840,89868,89880,89904,89952,89980,89998,90012,90040,90190,90204,90254,90268,90296,90306,90308,90312,90334,90382,90396,90424,90480,90494,90500,90504,90512,90526,90528,90556,90566,90572,90584,90610,90612,90638,90652,90680,90736,90750,90848,90876,90884,90888,90896,90910,90912,90940,90944,91e3,91014,91020,91032,91056,91070,91086,91100,91106,91108,91112,91126,91150,91164,91192,91248,91262,91360,91388,91584,91640,91664,91678,91680,91708,91712,91768,91888,91928,91952,91966,92e3,92028,92046,92060,92088,92098,92100,92104,92112,92126,92134,92140,92188,92216,92272,92384,92412,92608,92664,93168,93200,93214,93216,93244,93248,93304,93424,93664,93720,93744,93758,93792,93820,93888,93944,93980,94008,94064,94078,94084,94088,94096,94110,94112,94140,94150,94156,94168,94246,94252,94278,94284,94296,94318,94342,94348,94360,94384,94398,94414,94428,94440,94470,94476,94488,94512,94526,94560,94588,94606,94620,94648,94658,94660,94664,94672,94686,94694,94700,94714,94726,94732,94744,94768,94782,94816,94844,94912,94968,94990,95004,95032,95088,95102,95112,95120,95134,95136,95164,95180,95192,95214,95218,95220,95244,95256,95280,95294,95328,95356,95424,95480,95728,95758,95772,95800,95856,95870,95968,95996,96008,96016,96030,96032,96060,96064,96120,96152,96176,96190,96220,96226,96228,96232,96290,96292,96296,96310,96322,96324,96328,96336,96350,96358,96364,96386,96388,96392,96400,96414,96416,96444,96454,96460,96472,96494,96498,96500,96514,96516,96520,96528,96542,96544,96572,96576,96632,96646,96652,96664,96688,96702,96718,96732,96738,96740,96744,96758,96772,96776,96784,96798,96800,96828,96832,96888,97008,97030,97036,97048,97072,97086,97120,97148,97166,97180,97208,97220,97224,97232,97246,97254,97260,97326,97330,97332,97358,97372,97378,97380,97384,97398,97422,97436,97464,97474,97476,97480,97488,97502,97510,97516,97550,97564,97592,97648,97666,97668,97672,97680,97694,97696,97724,97734,97740,97752,97774,97830,97836,97850,97862,97868,97880,97902,97906,97908,97926,97932,97944,97968,97998,98012,98018,98020,98024,98038,98618,98674,98676,98838,98854,98874,98892,98904,98926,98930,98932,98968,99006,99042,99044,99048,99062,99166,99194,99246,99286,99350,99366,99372,99386,99398,99416,99438,99442,99444,99462,99504,99518,99534,99548,99554,99556,99560,99574,99590,99596,99608,99632,99646,99680,99708,99726,99740,99768,99778,99780,99784,99792,99806,99814,99820,99834,99858,99860,99874,99880,99894,99906,99920,99934,99962,99970,99972,99976,99984,99998,1e5,100028,100038,100044,100056,100078,100082,100084,100142,100174,100188,100246,100262,100268,100306,100308,100390,100396,100410,100422,100428,100440,100462,100466,100468,100486,100504,100528,100542,100558,100572,100578,100580,100584,100598,100620,100656,100670,100704,100732,100750,100792,100802,100808,100816,100830,100838,100844,100858,100888,100912,100926,100960,100988,101056,101112,101148,101176,101232,101246,101250,101252,101256,101264,101278,101280,101308,101318,101324,101336,101358,101362,101364,101410,101412,101416,101430,101442,101448,101456,101470,101478,101498,101506,101508,101520,101534,101536,101564,101580,101618,101620,101636,101640,101648,101662,101664,101692,101696,101752,101766,101784,101838,101858,101860,101864,101934,101938,101940,101966,101980,101986,101988,101992,102030,102044,102072,102082,102084,102088,102096,102138,102166,102182,102188,102214,102220,102232,102254,102282,102290,102292,102306,102308,102312,102326,102444,102458,102470,102476,102488,102514,102516,102534,102552,102576,102590,102606,102620,102626,102632,102646,102662,102668,102704,102718,102752,102780,102798,102812,102840,102850,102856,102864,102878,102886,102892,102906,102936,102974,103008,103036,103104,103160,103224,103280,103294,103298,103300,103312,103326,103328,103356,103366,103372,103384,103406,103410,103412,103472,103486,103520,103548,103616,103672,103920,103992,104048,104062,104160,104188,104194,104196,104200,104208,104224,104252,104256,104312,104326,104332,104344,104368,104382,104398,104412,104418,104420,104424,104482,104484,104514,104520,104528,104542,104550,104570,104578,104580,104592,104606,104608,104636,104652,104690,104692,104706,104712,104734,104736,104764,104768,104824,104838,104856,104910,104930,104932,104936,104968,104976,104990,104992,105020,105024,105080,105200,105240,105278,105312,105372,105410,105412,105416,105424,105446,105518,105524,105550,105564,105570,105572,105576,105614,105628,105656,105666,105672,105680,105702,105722,105742,105756,105784,105840,105854,105858,105860,105864,105872,105888,105932,105970,105972,106006,106022,106028,106054,106060,106072,106100,106118,106124,106136,106160,106174,106190,106210,106212,106216,106250,106258,106260,106274,106276,106280,106306,106308,106312,106320,106334,106348,106394,106414,106418,106420,106566,106572,106610,106612,106630,106636,106648,106672,106686,106722,106724,106728,106742,106758,106764,106776,106800,106814,106848,106876,106894,106908,106936,106946,106948,106952,106960,106974,106982,106988,107032,107056,107070,107104,107132,107200,107256,107292,107320,107376,107390,107394,107396,107400,107408,107422,107424,107452,107462,107468,107480,107502,107506,107508,107544,107568,107582,107616,107644,107712,107768,108016,108060,108088,108144,108158,108256,108284,108290,108292,108296,108304,108318,108320,108348,108352,108408,108422,108428,108440,108464,108478,108494,108508,108514,108516,108520,108592,108640,108668,108736,108792,109040,109536,109680,109694,109792,109820,110016,110072,110084,110088,110096,110112,110140,110144,110200,110320,110342,110348,110360,110384,110398,110432,110460,110478,110492,110520,110532,110536,110544,110558,110658,110686,110714,110722,110724,110728,110736,110750,110752,110780,110796,110834,110836,110850,110852,110856,110864,110878,110880,110908,110912,110968,110982,111e3,111054,111074,111076,111080,111108,111112,111120,111134,111136,111164,111168,111224,111344,111372,111422,111456,111516,111554,111556,111560,111568,111590,111632,111646,111648,111676,111680,111736,111856,112096,112152,112224,112252,112320,112440,112514,112516,112520,112528,112542,112544,112588,112686,112718,112732,112782,112796,112824,112834,112836,112840,112848,112870,112890,112910,112924,112952,113008,113022,113026,113028,113032,113040,113054,113056,113100,113138,113140,113166,113180,113208,113264,113278,113376,113404,113416,113424,113440,113468,113472,113560,113614,113634,113636,113640,113686,113702,113708,113734,113740,113752,113778,113780,113798,113804,113816,113840,113854,113870,113890,113892,113896,113926,113932,113944,113968,113982,114016,114044,114076,114114,114116,114120,114128,114150,114170,114194,114196,114210,114212,114216,114242,114244,114248,114256,114270,114278,114306,114308,114312,114320,114334,114336,114364,114380,114420,114458,114478,114482,114484,114510,114524,114530,114532,114536,114842,114866,114868,114970,114994,114996,115042,115044,115048,115062,115130,115226,115250,115252,115278,115292,115298,115300,115304,115318,115342,115394,115396,115400,115408,115422,115430,115436,115450,115478,115494,115514,115526,115532,115570,115572,115738,115758,115762,115764,115790,115804,115810,115812,115816,115830,115854,115868,115896,115906,115912,115920,115934,115942,115948,115962,115996,116024,116080,116094,116098,116100,116104,116112,116126,116128,116156,116166,116172,116184,116206,116210,116212,116246,116262,116268,116282,116294,116300,116312,116334,116338,116340,116358,116364,116376,116400,116414,116430,116444,116450,116452,116456,116498,116500,116514,116520,116534,116546,116548,116552,116560,116574,116582,116588,116602,116654,116694,116714,116762,116782,116786,116788,116814,116828,116834,116836,116840,116854,116878,116892,116920,116930,116936,116944,116958,116966,116972,116986,117006,117048,117104,117118,117122,117124,117136,117150,117152,117180,117190,117196,117208,117230,117234,117236,117304,117360,117374,117472,117500,117506,117508,117512,117520,117536,117564,117568,117624,117638,117644,117656,117680,117694,117710,117724,117730,117732,117736,117750,117782,117798,117804,117818,117830,117848,117874,117876,117894,117936,117950,117966,117986,117988,117992,118022,118028,118040,118064,118078,118112,118140,118172,118210,118212,118216,118224,118238,118246,118266,118306,118312,118338,118352,118366,118374,118394,118402,118404,118408,118416,118430,118432,118460,118476,118514,118516,118574,118578,118580,118606,118620,118626,118628,118632,118678,118694,118700,118730,118738,118740,118830,118834,118836,118862,118876,118882,118884,118888,118902,118926,118940,118968,118978,118980,118984,118992,119006,119014,119020,119034,119068,119096,119152,119166,119170,119172,119176,119184,119198,119200,119228,119238,119244,119256,119278,119282,119284,119324,119352,119408,119422,119520,119548,119554,119556,119560,119568,119582,119584,119612,119616,119672,119686,119692,119704,119728,119742,119758,119772,119778,119780,119784,119798,119920,119934,120032,120060,120256,120312,120324,120328,120336,120352,120384,120440,120560,120582,120588,120600,120624,120638,120672,120700,120718,120732,120760,120770,120772,120776,120784,120798,120806,120812,120870,120876,120890,120902,120908,120920,120946,120948,120966,120972,120984,121008,121022,121038,121058,121060,121064,121078,121100,121112,121136,121150,121184,121212,121244,121282,121284,121288,121296,121318,121338,121356,121368,121392,121406,121440,121468,121536,121592,121656,121730,121732,121736,121744,121758,121760,121804,121842,121844,121890,121922,121924,121928,121936,121950,121958,121978,121986,121988,121992,122e3,122014,122016,122044,122060,122098,122100,122116,122120,122128,122142,122144,122172,122176,122232,122246,122264,122318,122338,122340,122344,122414,122418,122420,122446,122460,122466,122468,122472,122510,122524,122552,122562,122564,122568,122576,122598,122618,122646,122662,122668,122694,122700,122712,122738,122740,122762,122770,122772,122786,122788,122792,123018,123026,123028,123042,123044,123048,123062,123098,123146,123154,123156,123170,123172,123176,123190,123202,123204,123208,123216,123238,123244,123258,123290,123314,123316,123402,123410,123412,123426,123428,123432,123446,123458,123464,123472,123486,123494,123500,123514,123522,123524,123528,123536,123552,123580,123590,123596,123608,123630,123634,123636,123674,123698,123700,123740,123746,123748,123752,123834,123914,123922,123924,123938,123944,123958,123970,123976,123984,123998,124006,124012,124026,124034,124036,124048,124062,124064,124092,124102,124108,124120,124142,124146,124148,124162,124164,124168,124176,124190,124192,124220,124224,124280,124294,124300,124312,124336,124350,124366,124380,124386,124388,124392,124406,124442,124462,124466,124468,124494,124508,124514,124520,124558,124572,124600,124610,124612,124616,124624,124646,124666,124694,124710,124716,124730,124742,124748,124760,124786,124788,124818,124820,124834,124836,124840,124854,124946,124948,124962,124964,124968,124982,124994,124996,125e3,125008,125022,125030,125036,125050,125058,125060,125064,125072,125086,125088,125116,125126,125132,125144,125166,125170,125172,125186,125188,125192,125200,125216,125244,125248,125304,125318,125324,125336,125360,125374,125390,125404,125410,125412,125416,125430,125444,125448,125456,125472,125504,125560,125680,125702,125708,125720,125744,125758,125792,125820,125838,125852,125880,125890,125892,125896,125904,125918,125926,125932,125978,125998,126002,126004,126030,126044,126050,126052,126056,126094,126108,126136,126146,126148,126152,126160,126182,126202,126222,126236,126264,126320,126334,126338,126340,126344,126352,126366,126368,126412,126450,126452,126486,126502,126508,126522,126534,126540,126552,126574,126578,126580,126598,126604,126616,126640,126654,126670,126684,126690,126692,126696,126738,126754,126756,126760,126774,126786,126788,126792,126800,126814,126822,126828,126842,126894,126898,126900,126934,127126,127142,127148,127162,127178,127186,127188,127254,127270,127276,127290,127302,127308,127320,127342,127346,127348,127370,127378,127380,127394,127396,127400,127450,127510,127526,127532,127546,127558,127576,127598,127602,127604,127622,127628,127640,127664,127678,127694,127708,127714,127716,127720,127734,127754,127762,127764,127778,127784,127810,127812,127816,127824,127838,127846,127866,127898,127918,127922,127924,128022,128038,128044,128058,128070,128076,128088,128110,128114,128116,128134,128140,128152,128176,128190,128206,128220,128226,128228,128232,128246,128262,128268,128280,128304,128318,128352,128380,128398,128412,128440,128450,128452,128456,128464,128478,128486,128492,128506,128522,128530,128532,128546,128548,128552,128566,128578,128580,128584,128592,128606,128614,128634,128642,128644,128648,128656,128670,128672,128700,128716,128754,128756,128794,128814,128818,128820,128846,128860,128866,128868,128872,128886,128918,128934,128940,128954,128978,128980,129178,129198,129202,129204,129238,129258,129306,129326,129330,129332,129358,129372,129378,129380,129384,129398,129430,129446,129452,129466,129482,129490,129492,129562,129582,129586,129588,129614,129628,129634,129636,129640,129654,129678,129692,129720,129730,129732,129736,129744,129758,129766,129772,129814,129830,129836,129850,129862,129868,129880,129902,129906,129908,129930,129938,129940,129954,129956,129960,129974,130010]),Ie.CODEWORD_TABLE=Int32Array.from([2627,1819,2622,2621,1813,1812,2729,2724,2723,2779,2774,2773,902,896,908,868,865,861,859,2511,873,871,1780,835,2493,825,2491,842,837,844,1764,1762,811,810,809,2483,807,2482,806,2480,815,814,813,812,2484,817,816,1745,1744,1742,1746,2655,2637,2635,2626,2625,2623,2628,1820,2752,2739,2737,2728,2727,2725,2730,2785,2783,2778,2777,2775,2780,787,781,747,739,736,2413,754,752,1719,692,689,681,2371,678,2369,700,697,694,703,1688,1686,642,638,2343,631,2341,627,2338,651,646,643,2345,654,652,1652,1650,1647,1654,601,599,2322,596,2321,594,2319,2317,611,610,608,606,2324,603,2323,615,614,612,1617,1616,1614,1612,616,1619,1618,2575,2538,2536,905,901,898,909,2509,2507,2504,870,867,864,860,2512,875,872,1781,2490,2489,2487,2485,1748,836,834,832,830,2494,827,2492,843,841,839,845,1765,1763,2701,2676,2674,2653,2648,2656,2634,2633,2631,2629,1821,2638,2636,2770,2763,2761,2750,2745,2753,2736,2735,2733,2731,1848,2740,2738,2786,2784,591,588,576,569,566,2296,1590,537,534,526,2276,522,2274,545,542,539,548,1572,1570,481,2245,466,2242,462,2239,492,485,482,2249,496,494,1534,1531,1528,1538,413,2196,406,2191,2188,425,419,2202,415,2199,432,430,427,1472,1467,1464,433,1476,1474,368,367,2160,365,2159,362,2157,2155,2152,378,377,375,2166,372,2165,369,2162,383,381,379,2168,1419,1418,1416,1414,385,1411,384,1423,1422,1420,1424,2461,802,2441,2439,790,786,783,794,2409,2406,2403,750,742,738,2414,756,753,1720,2367,2365,2362,2359,1663,693,691,684,2373,680,2370,702,699,696,704,1690,1687,2337,2336,2334,2332,1624,2329,1622,640,637,2344,634,2342,630,2340,650,648,645,2346,655,653,1653,1651,1649,1655,2612,2597,2595,2571,2568,2565,2576,2534,2529,2526,1787,2540,2537,907,904,900,910,2503,2502,2500,2498,1768,2495,1767,2510,2508,2506,869,866,863,2513,876,874,1782,2720,2713,2711,2697,2694,2691,2702,2672,2670,2664,1828,2678,2675,2647,2646,2644,2642,1823,2639,1822,2654,2652,2650,2657,2771,1855,2765,2762,1850,1849,2751,2749,2747,2754,353,2148,344,342,336,2142,332,2140,345,1375,1373,306,2130,299,2128,295,2125,319,314,311,2132,1354,1352,1349,1356,262,257,2101,253,2096,2093,274,273,267,2107,263,2104,280,278,275,1316,1311,1308,1320,1318,2052,202,2050,2044,2040,219,2063,212,2060,208,2055,224,221,2066,1260,1258,1252,231,1248,229,1266,1264,1261,1268,155,1998,153,1996,1994,1991,1988,165,164,2007,162,2006,159,2003,2e3,172,171,169,2012,166,2010,1186,1184,1182,1179,175,1176,173,1192,1191,1189,1187,176,1194,1193,2313,2307,2305,592,589,2294,2292,2289,578,572,568,2297,580,1591,2272,2267,2264,1547,538,536,529,2278,525,2275,547,544,541,1574,1571,2237,2235,2229,1493,2225,1489,478,2247,470,2244,465,2241,493,488,484,2250,498,495,1536,1533,1530,1539,2187,2186,2184,2182,1432,2179,1430,2176,1427,414,412,2197,409,2195,405,2193,2190,426,424,421,2203,418,2201,431,429,1473,1471,1469,1466,434,1477,1475,2478,2472,2470,2459,2457,2454,2462,803,2437,2432,2429,1726,2443,2440,792,789,785,2401,2399,2393,1702,2389,1699,2411,2408,2405,745,741,2415,758,755,1721,2358,2357,2355,2353,1661,2350,1660,2347,1657,2368,2366,2364,2361,1666,690,687,2374,683,2372,701,698,705,1691,1689,2619,2617,2610,2608,2605,2613,2593,2588,2585,1803,2599,2596,2563,2561,2555,1797,2551,1795,2573,2570,2567,2577,2525,2524,2522,2520,1786,2517,1785,2514,1783,2535,2533,2531,2528,1788,2541,2539,906,903,911,2721,1844,2715,2712,1838,1836,2699,2696,2693,2703,1827,1826,1824,2673,2671,2669,2666,1829,2679,2677,1858,1857,2772,1854,1853,1851,1856,2766,2764,143,1987,139,1986,135,133,131,1984,128,1983,125,1981,138,137,136,1985,1133,1132,1130,112,110,1974,107,1973,104,1971,1969,122,121,119,117,1977,114,1976,124,1115,1114,1112,1110,1117,1116,84,83,1953,81,1952,78,1950,1948,1945,94,93,91,1959,88,1958,85,1955,99,97,95,1961,1086,1085,1083,1081,1078,100,1090,1089,1087,1091,49,47,1917,44,1915,1913,1910,1907,59,1926,56,1925,53,1922,1919,66,64,1931,61,1929,1042,1040,1038,71,1035,70,1032,68,1048,1047,1045,1043,1050,1049,12,10,1869,1867,1864,1861,21,1880,19,1877,1874,1871,28,1888,25,1886,22,1883,982,980,977,974,32,30,991,989,987,984,34,995,994,992,2151,2150,2147,2146,2144,356,355,354,2149,2139,2138,2136,2134,1359,343,341,338,2143,335,2141,348,347,346,1376,1374,2124,2123,2121,2119,1326,2116,1324,310,308,305,2131,302,2129,298,2127,320,318,316,313,2133,322,321,1355,1353,1351,1357,2092,2091,2089,2087,1276,2084,1274,2081,1271,259,2102,256,2100,252,2098,2095,272,269,2108,266,2106,281,279,277,1317,1315,1313,1310,282,1321,1319,2039,2037,2035,2032,1203,2029,1200,1197,207,2053,205,2051,201,2049,2046,2043,220,218,2064,215,2062,211,2059,228,226,223,2069,1259,1257,1254,232,1251,230,1267,1265,1263,2316,2315,2312,2311,2309,2314,2304,2303,2301,2299,1593,2308,2306,590,2288,2287,2285,2283,1578,2280,1577,2295,2293,2291,579,577,574,571,2298,582,581,1592,2263,2262,2260,2258,1545,2255,1544,2252,1541,2273,2271,2269,2266,1550,535,532,2279,528,2277,546,543,549,1575,1573,2224,2222,2220,1486,2217,1485,2214,1482,1479,2238,2236,2234,2231,1496,2228,1492,480,477,2248,473,2246,469,2243,490,487,2251,497,1537,1535,1532,2477,2476,2474,2479,2469,2468,2466,2464,1730,2473,2471,2453,2452,2450,2448,1729,2445,1728,2460,2458,2456,2463,805,804,2428,2427,2425,2423,1725,2420,1724,2417,1722,2438,2436,2434,2431,1727,2444,2442,793,791,788,795,2388,2386,2384,1697,2381,1696,2378,1694,1692,2402,2400,2398,2395,1703,2392,1701,2412,2410,2407,751,748,744,2416,759,757,1807,2620,2618,1806,1805,2611,2609,2607,2614,1802,1801,1799,2594,2592,2590,2587,1804,2600,2598,1794,1793,1791,1789,2564,2562,2560,2557,1798,2554,1796,2574,2572,2569,2578,1847,1846,2722,1843,1842,1840,1845,2716,2714,1835,1834,1832,1830,1839,1837,2700,2698,2695,2704,1817,1811,1810,897,862,1777,829,826,838,1760,1758,808,2481,1741,1740,1738,1743,2624,1818,2726,2776,782,740,737,1715,686,679,695,1682,1680,639,628,2339,647,644,1645,1643,1640,1648,602,600,597,595,2320,593,2318,609,607,604,1611,1610,1608,1606,613,1615,1613,2328,926,924,892,886,899,857,850,2505,1778,824,823,821,819,2488,818,2486,833,831,828,840,1761,1759,2649,2632,2630,2746,2734,2732,2782,2781,570,567,1587,531,527,523,540,1566,1564,476,467,463,2240,486,483,1524,1521,1518,1529,411,403,2192,399,2189,423,416,1462,1457,1454,428,1468,1465,2210,366,363,2158,360,2156,357,2153,376,373,370,2163,1410,1409,1407,1405,382,1402,380,1417,1415,1412,1421,2175,2174,777,774,771,784,732,725,722,2404,743,1716,676,674,668,2363,665,2360,685,1684,1681,626,624,622,2335,620,2333,617,2330,641,635,649,1646,1644,1642,2566,928,925,2530,2527,894,891,888,2501,2499,2496,858,856,854,851,1779,2692,2668,2665,2645,2643,2640,2651,2768,2759,2757,2744,2743,2741,2748,352,1382,340,337,333,1371,1369,307,300,296,2126,315,312,1347,1342,1350,261,258,250,2097,246,2094,271,268,264,1306,1301,1298,276,1312,1309,2115,203,2048,195,2045,191,2041,213,209,2056,1246,1244,1238,225,1234,222,1256,1253,1249,1262,2080,2079,154,1997,150,1995,147,1992,1989,163,160,2004,156,2001,1175,1174,1172,1170,1167,170,1164,167,1185,1183,1180,1177,174,1190,1188,2025,2024,2022,587,586,564,559,556,2290,573,1588,520,518,512,2268,508,2265,530,1568,1565,461,457,2233,450,2230,446,2226,479,471,489,1526,1523,1520,397,395,2185,392,2183,389,2180,2177,410,2194,402,422,1463,1461,1459,1456,1470,2455,799,2433,2430,779,776,773,2397,2394,2390,734,728,724,746,1717,2356,2354,2351,2348,1658,677,675,673,670,667,688,1685,1683,2606,2589,2586,2559,2556,2552,927,2523,2521,2518,2515,1784,2532,895,893,890,2718,2709,2707,2689,2687,2684,2663,2662,2660,2658,1825,2667,2769,1852,2760,2758,142,141,1139,1138,134,132,129,126,1982,1129,1128,1126,1131,113,111,108,105,1972,101,1970,120,118,115,1109,1108,1106,1104,123,1113,1111,82,79,1951,75,1949,72,1946,92,89,86,1956,1077,1076,1074,1072,98,1069,96,1084,1082,1079,1088,1968,1967,48,45,1916,42,1914,39,1911,1908,60,57,54,1923,50,1920,1031,1030,1028,1026,67,1023,65,1020,62,1041,1039,1036,1033,69,1046,1044,1944,1943,1941,11,9,1868,7,1865,1862,1859,20,1878,16,1875,13,1872,970,968,966,963,29,960,26,23,983,981,978,975,33,971,31,990,988,985,1906,1904,1902,993,351,2145,1383,331,330,328,326,2137,323,2135,339,1372,1370,294,293,291,289,2122,286,2120,283,2117,309,303,317,1348,1346,1344,245,244,242,2090,239,2088,236,2085,2082,260,2099,249,270,1307,1305,1303,1300,1314,189,2038,186,2036,183,2033,2030,2026,206,198,2047,194,216,1247,1245,1243,1240,227,1237,1255,2310,2302,2300,2286,2284,2281,565,563,561,558,575,1589,2261,2259,2256,2253,1542,521,519,517,514,2270,511,533,1569,1567,2223,2221,2218,2215,1483,2211,1480,459,456,453,2232,449,474,491,1527,1525,1522,2475,2467,2465,2451,2449,2446,801,800,2426,2424,2421,2418,1723,2435,780,778,775,2387,2385,2382,2379,1695,2375,1693,2396,735,733,730,727,749,1718,2616,2615,2604,2603,2601,2584,2583,2581,2579,1800,2591,2550,2549,2547,2545,1792,2542,1790,2558,929,2719,1841,2710,2708,1833,1831,2690,2688,2686,1815,1809,1808,1774,1756,1754,1737,1736,1734,1739,1816,1711,1676,1674,633,629,1638,1636,1633,1641,598,1605,1604,1602,1600,605,1609,1607,2327,887,853,1775,822,820,1757,1755,1584,524,1560,1558,468,464,1514,1511,1508,1519,408,404,400,1452,1447,1444,417,1458,1455,2208,364,361,358,2154,1401,1400,1398,1396,374,1393,371,1408,1406,1403,1413,2173,2172,772,726,723,1712,672,669,666,682,1678,1675,625,623,621,618,2331,636,632,1639,1637,1635,920,918,884,880,889,849,848,847,846,2497,855,852,1776,2641,2742,2787,1380,334,1367,1365,301,297,1340,1338,1335,1343,255,251,247,1296,1291,1288,265,1302,1299,2113,204,196,192,2042,1232,1230,1224,214,1220,210,1242,1239,1235,1250,2077,2075,151,148,1993,144,1990,1163,1162,1160,1158,1155,161,1152,157,1173,1171,1168,1165,168,1181,1178,2021,2020,2018,2023,585,560,557,1585,516,509,1562,1559,458,447,2227,472,1516,1513,1510,398,396,393,390,2181,386,2178,407,1453,1451,1449,1446,420,1460,2209,769,764,720,712,2391,729,1713,664,663,661,659,2352,656,2349,671,1679,1677,2553,922,919,2519,2516,885,883,881,2685,2661,2659,2767,2756,2755,140,1137,1136,130,127,1125,1124,1122,1127,109,106,102,1103,1102,1100,1098,116,1107,1105,1980,80,76,73,1947,1068,1067,1065,1063,90,1060,87,1075,1073,1070,1080,1966,1965,46,43,40,1912,36,1909,1019,1018,1016,1014,58,1011,55,1008,51,1029,1027,1024,1021,63,1037,1034,1940,1939,1937,1942,8,1866,4,1863,1,1860,956,954,952,949,946,17,14,969,967,964,961,27,957,24,979,976,972,1901,1900,1898,1896,986,1905,1903,350,349,1381,329,327,324,1368,1366,292,290,287,284,2118,304,1341,1339,1337,1345,243,240,237,2086,233,2083,254,1297,1295,1293,1290,1304,2114,190,187,184,2034,180,2031,177,2027,199,1233,1231,1229,1226,217,1223,1241,2078,2076,584,555,554,552,550,2282,562,1586,507,506,504,502,2257,499,2254,515,1563,1561,445,443,441,2219,438,2216,435,2212,460,454,475,1517,1515,1512,2447,798,797,2422,2419,770,768,766,2383,2380,2376,721,719,717,714,731,1714,2602,2582,2580,2548,2546,2543,923,921,2717,2706,2705,2683,2682,2680,1771,1752,1750,1733,1732,1731,1735,1814,1707,1670,1668,1631,1629,1626,1634,1599,1598,1596,1594,1603,1601,2326,1772,1753,1751,1581,1554,1552,1504,1501,1498,1509,1442,1437,1434,401,1448,1445,2206,1392,1391,1389,1387,1384,359,1399,1397,1394,1404,2171,2170,1708,1672,1669,619,1632,1630,1628,1773,1378,1363,1361,1333,1328,1336,1286,1281,1278,248,1292,1289,2111,1218,1216,1210,197,1206,193,1228,1225,1221,1236,2073,2071,1151,1150,1148,1146,152,1143,149,1140,145,1161,1159,1156,1153,158,1169,1166,2017,2016,2014,2019,1582,510,1556,1553,452,448,1506,1500,394,391,387,1443,1441,1439,1436,1450,2207,765,716,713,1709,662,660,657,1673,1671,916,914,879,878,877,882,1135,1134,1121,1120,1118,1123,1097,1096,1094,1092,103,1101,1099,1979,1059,1058,1056,1054,77,1051,74,1066,1064,1061,1071,1964,1963,1007,1006,1004,1002,999,41,996,37,1017,1015,1012,1009,52,1025,1022,1936,1935,1933,1938,942,940,938,935,932,5,2,955,953,950,947,18,943,15,965,962,958,1895,1894,1892,1890,973,1899,1897,1379,325,1364,1362,288,285,1334,1332,1330,241,238,234,1287,1285,1283,1280,1294,2112,188,185,181,178,2028,1219,1217,1215,1212,200,1209,1227,2074,2072,583,553,551,1583,505,503,500,513,1557,1555,444,442,439,436,2213,455,451,1507,1505,1502,796,763,762,760,767,711,710,708,706,2377,718,715,1710,2544,917,915,2681,1627,1597,1595,2325,1769,1749,1747,1499,1438,1435,2204,1390,1388,1385,1395,2169,2167,1704,1665,1662,1625,1623,1620,1770,1329,1282,1279,2109,1214,1207,1222,2068,2065,1149,1147,1144,1141,146,1157,1154,2013,2011,2008,2015,1579,1549,1546,1495,1487,1433,1431,1428,1425,388,1440,2205,1705,658,1667,1664,1119,1095,1093,1978,1057,1055,1052,1062,1962,1960,1005,1003,1e3,997,38,1013,1010,1932,1930,1927,1934,941,939,936,933,6,930,3,951,948,944,1889,1887,1884,1881,959,1893,1891,35,1377,1360,1358,1327,1325,1322,1331,1277,1275,1272,1269,235,1284,2110,1205,1204,1201,1198,182,1195,179,1213,2070,2067,1580,501,1551,1548,440,437,1497,1494,1490,1503,761,709,707,1706,913,912,2198,1386,2164,2161,1621,1766,2103,1208,2058,2054,1145,1142,2005,2002,1999,2009,1488,1429,1426,2200,1698,1659,1656,1975,1053,1957,1954,1001,998,1924,1921,1918,1928,937,934,931,1879,1876,1873,1870,945,1885,1882,1323,1273,1270,2105,1202,1199,1196,1211,2061,2057,1576,1543,1540,1484,1481,1478,1491,1700]);class jn{constructor(e,t){this.bits=e,this.points=t}getBits(){return this.bits}getPoints(){return this.points}}class Me{static detectMultiple(e,t,r){let s=e.getBlackMatrix(),n=Me.detect(r,s);return n.length||(s=s.clone(),s.rotate180(),n=Me.detect(r,s)),new jn(s,n)}static detect(e,t){const r=new Array;let s=0,n=0,i=!1;for(;s<t.getHeight();){const o=Me.findVertices(t,s,n);if(o[0]==null&&o[3]==null){if(!i)break;i=!1,n=0;for(const l of r)l[1]!=null&&(s=Math.trunc(Math.max(s,l[1].getY()))),l[3]!=null&&(s=Math.max(s,Math.trunc(l[3].getY())));s+=Me.ROW_STEP;continue}if(i=!0,r.push(o),!e)break;o[2]!=null?(n=Math.trunc(o[2].getX()),s=Math.trunc(o[2].getY())):(n=Math.trunc(o[4].getX()),s=Math.trunc(o[4].getY()))}return r}static findVertices(e,t,r){const s=e.getHeight(),n=e.getWidth(),i=new Array(8);return Me.copyToResult(i,Me.findRowsWithPattern(e,s,n,t,r,Me.START_PATTERN),Me.INDEXES_START_PATTERN),i[4]!=null&&(r=Math.trunc(i[4].getX()),t=Math.trunc(i[4].getY())),Me.copyToResult(i,Me.findRowsWithPattern(e,s,n,t,r,Me.STOP_PATTERN),Me.INDEXES_STOP_PATTERN),i}static copyToResult(e,t,r){for(let s=0;s<r.length;s++)e[r[s]]=t[s]}static findRowsWithPattern(e,t,r,s,n,i){const o=new Array(4);let l=!1;const c=new Int32Array(i.length);for(;s<t;s+=Me.ROW_STEP){let f=Me.findGuardPattern(e,n,s,r,!1,i,c);if(f!=null){for(;s>0;){const b=Me.findGuardPattern(e,n,--s,r,!1,i,c);if(b!=null)f=b;else{s++;break}}o[0]=new ue(f[0],s),o[1]=new ue(f[1],s),l=!0;break}}let d=s+1;if(l){let f=0,b=Int32Array.from([Math.trunc(o[0].getX()),Math.trunc(o[1].getX())]);for(;d<t;d++){const y=Me.findGuardPattern(e,b[0],d,r,!1,i,c);if(y!=null&&Math.abs(b[0]-y[0])<Me.MAX_PATTERN_DRIFT&&Math.abs(b[1]-y[1])<Me.MAX_PATTERN_DRIFT)b=y,f=0;else{if(f>Me.SKIPPED_ROW_COUNT_MAX)break;f++}}d-=f+1,o[2]=new ue(b[0],d),o[3]=new ue(b[1],d)}return d-s<Me.BARCODE_MIN_HEIGHT&&X.fill(o,null),o}static findGuardPattern(e,t,r,s,n,i,o){X.fillWithin(o,0,o.length,0);let l=t,c=0;for(;e.get(l,r)&&l>0&&c++<Me.MAX_PIXEL_DRIFT;)l--;let d=l,f=0,b=i.length;for(let y=n;d<s;d++)if(e.get(d,r)!==y)o[f]++;else{if(f===b-1){if(Me.patternMatchVariance(o,i,Me.MAX_INDIVIDUAL_VARIANCE)<Me.MAX_AVG_VARIANCE)return new Int32Array([l,d]);l+=o[0]+o[1],K.arraycopy(o,2,o,0,f-1),o[f-1]=0,o[f]=0,f--}else f++;o[f]=1,y=!y}return f===b-1&&Me.patternMatchVariance(o,i,Me.MAX_INDIVIDUAL_VARIANCE)<Me.MAX_AVG_VARIANCE?new Int32Array([l,d-1]):null}static patternMatchVariance(e,t,r){let s=e.length,n=0,i=0;for(let c=0;c<s;c++)n+=e[c],i+=t[c];if(n<i)return 1/0;let o=n/i;r*=o;let l=0;for(let c=0;c<s;c++){let d=e[c],f=t[c]*o,b=d>f?d-f:f-d;if(b>r)return 1/0;l+=b}return l/n}}Me.INDEXES_START_PATTERN=Int32Array.from([0,4,1,5]),Me.INDEXES_STOP_PATTERN=Int32Array.from([6,2,7,3]),Me.MAX_AVG_VARIANCE=.42,Me.MAX_INDIVIDUAL_VARIANCE=.8,Me.START_PATTERN=Int32Array.from([8,1,1,1,1,1,1,3]),Me.STOP_PATTERN=Int32Array.from([7,1,1,3,1,1,1,2,1]),Me.MAX_PIXEL_DRIFT=3,Me.MAX_PATTERN_DRIFT=5,Me.SKIPPED_ROW_COUNT_MAX=25,Me.ROW_STEP=5,Me.BARCODE_MIN_HEIGHT=10;class It{constructor(e,t){if(t.length===0)throw new _;this.field=e;let r=t.length;if(r>1&&t[0]===0){let s=1;for(;s<r&&t[s]===0;)s++;s===r?this.coefficients=new Int32Array([0]):(this.coefficients=new Int32Array(r-s),K.arraycopy(t,s,this.coefficients,0,this.coefficients.length))}else this.coefficients=t}getCoefficients(){return this.coefficients}getDegree(){return this.coefficients.length-1}isZero(){return this.coefficients[0]===0}getCoefficient(e){return this.coefficients[this.coefficients.length-1-e]}evaluateAt(e){if(e===0)return this.getCoefficient(0);if(e===1){let s=0;for(let n of this.coefficients)s=this.field.add(s,n);return s}let t=this.coefficients[0],r=this.coefficients.length;for(let s=1;s<r;s++)t=this.field.add(this.field.multiply(e,t),this.coefficients[s]);return t}add(e){if(!this.field.equals(e.field))throw new _("ModulusPolys do not have same ModulusGF field");if(this.isZero())return e;if(e.isZero())return this;let t=this.coefficients,r=e.coefficients;if(t.length>r.length){let i=t;t=r,r=i}let s=new Int32Array(r.length),n=r.length-t.length;K.arraycopy(r,0,s,0,n);for(let i=n;i<r.length;i++)s[i]=this.field.add(t[i-n],r[i]);return new It(this.field,s)}subtract(e){if(!this.field.equals(e.field))throw new _("ModulusPolys do not have same ModulusGF field");return e.isZero()?this:this.add(e.negative())}multiply(e){return e instanceof It?this.multiplyOther(e):this.multiplyScalar(e)}multiplyOther(e){if(!this.field.equals(e.field))throw new _("ModulusPolys do not have same ModulusGF field");if(this.isZero()||e.isZero())return new It(this.field,new Int32Array([0]));let t=this.coefficients,r=t.length,s=e.coefficients,n=s.length,i=new Int32Array(r+n-1);for(let o=0;o<r;o++){let l=t[o];for(let c=0;c<n;c++)i[o+c]=this.field.add(i[o+c],this.field.multiply(l,s[c]))}return new It(this.field,i)}negative(){let e=this.coefficients.length,t=new Int32Array(e);for(let r=0;r<e;r++)t[r]=this.field.subtract(0,this.coefficients[r]);return new It(this.field,t)}multiplyScalar(e){if(e===0)return new It(this.field,new Int32Array([0]));if(e===1)return this;let t=this.coefficients.length,r=new Int32Array(t);for(let s=0;s<t;s++)r[s]=this.field.multiply(this.coefficients[s],e);return new It(this.field,r)}multiplyByMonomial(e,t){if(e<0)throw new _;if(t===0)return new It(this.field,new Int32Array([0]));let r=this.coefficients.length,s=new Int32Array(r+e);for(let n=0;n<r;n++)s[n]=this.field.multiply(this.coefficients[n],t);return new It(this.field,s)}toString(){let e=new ie;for(let t=this.getDegree();t>=0;t--){let r=this.getCoefficient(t);r!==0&&(r<0?(e.append(" - "),r=-r):e.length()>0&&e.append(" + "),(t===0||r!==1)&&e.append(r),t!==0&&(t===1?e.append("x"):(e.append("x^"),e.append(t))))}return e.toString()}}class Dn{add(e,t){return(e+t)%this.modulus}subtract(e,t){return(this.modulus+e-t)%this.modulus}exp(e){return this.expTable[e]}log(e){if(e===0)throw new _;return this.logTable[e]}inverse(e){if(e===0)throw new de;return this.expTable[this.modulus-this.logTable[e]-1]}multiply(e,t){return e===0||t===0?0:this.expTable[(this.logTable[e]+this.logTable[t])%(this.modulus-1)]}getSize(){return this.modulus}equals(e){return e===this}}class ms extends Dn{constructor(e,t){super(),this.modulus=e,this.expTable=new Int32Array(e),this.logTable=new Int32Array(e);let r=1;for(let s=0;s<e;s++)this.expTable[s]=r,r=r*t%e;for(let s=0;s<e-1;s++)this.logTable[this.expTable[s]]=s;this.zero=new It(this,new Int32Array([0])),this.one=new It(this,new Int32Array([1]))}getZero(){return this.zero}getOne(){return this.one}buildMonomial(e,t){if(e<0)throw new _;if(t===0)return this.zero;let r=new Int32Array(e+1);return r[0]=t,new It(this,r)}}ms.PDF417_GF=new ms(Ie.NUMBER_OF_CODEWORDS,3);class Fs{constructor(){this.field=ms.PDF417_GF}decode(e,t,r){let s=new It(this.field,e),n=new Int32Array(t),i=!1;for(let A=t;A>0;A--){let E=s.evaluateAt(this.field.exp(A));n[t-A]=E,E!==0&&(i=!0)}if(!i)return 0;let o=this.field.getOne();if(r!=null)for(const A of r){let E=this.field.exp(e.length-1-A),O=new It(this.field,new Int32Array([this.field.subtract(0,E),1]));o=o.multiply(O)}let l=new It(this.field,n),c=this.runEuclideanAlgorithm(this.field.buildMonomial(t,1),l,t),d=c[0],f=c[1],b=this.findErrorLocations(d),y=this.findErrorMagnitudes(f,d,b);for(let A=0;A<b.length;A++){let E=e.length-1-this.field.log(b[A]);if(E<0)throw $.getChecksumInstance();e[E]=this.field.subtract(e[E],y[A])}return b.length}runEuclideanAlgorithm(e,t,r){if(e.getDegree()<t.getDegree()){let b=e;e=t,t=b}let s=e,n=t,i=this.field.getZero(),o=this.field.getOne();for(;n.getDegree()>=Math.round(r/2);){let b=s,y=i;if(s=n,i=o,s.isZero())throw $.getChecksumInstance();n=b;let A=this.field.getZero(),E=s.getCoefficient(s.getDegree()),O=this.field.inverse(E);for(;n.getDegree()>=s.getDegree()&&!n.isZero();){let F=n.getDegree()-s.getDegree(),ee=this.field.multiply(n.getCoefficient(n.getDegree()),O);A=A.add(this.field.buildMonomial(F,ee)),n=n.subtract(s.multiplyByMonomial(F,ee))}o=A.multiply(i).subtract(y).negative()}let l=o.getCoefficient(0);if(l===0)throw $.getChecksumInstance();let c=this.field.inverse(l),d=o.multiply(c),f=n.multiply(c);return[d,f]}findErrorLocations(e){let t=e.getDegree(),r=new Int32Array(t),s=0;for(let n=1;n<this.field.getSize()&&s<t;n++)e.evaluateAt(n)===0&&(r[s]=this.field.inverse(n),s++);if(s!==t)throw $.getChecksumInstance();return r}findErrorMagnitudes(e,t,r){let s=t.getDegree(),n=new Int32Array(s);for(let c=1;c<=s;c++)n[s-c]=this.field.multiply(c,t.getCoefficient(c));let i=new It(this.field,n),o=r.length,l=new Int32Array(o);for(let c=0;c<o;c++){let d=this.field.inverse(r[c]),f=this.field.subtract(0,e.evaluateAt(d)),b=this.field.inverse(i.evaluateAt(d));l[c]=this.field.multiply(f,b)}return l}}class gr{constructor(e,t,r,s,n){e instanceof gr?this.constructor_2(e):this.constructor_1(e,t,r,s,n)}constructor_1(e,t,r,s,n){const i=t==null||r==null,o=s==null||n==null;if(i&&o)throw new j;i?(t=new ue(0,s.getY()),r=new ue(0,n.getY())):o&&(s=new ue(e.getWidth()-1,t.getY()),n=new ue(e.getWidth()-1,r.getY())),this.image=e,this.topLeft=t,this.bottomLeft=r,this.topRight=s,this.bottomRight=n,this.minX=Math.trunc(Math.min(t.getX(),r.getX())),this.maxX=Math.trunc(Math.max(s.getX(),n.getX())),this.minY=Math.trunc(Math.min(t.getY(),s.getY())),this.maxY=Math.trunc(Math.max(r.getY(),n.getY()))}constructor_2(e){this.image=e.image,this.topLeft=e.getTopLeft(),this.bottomLeft=e.getBottomLeft(),this.topRight=e.getTopRight(),this.bottomRight=e.getBottomRight(),this.minX=e.getMinX(),this.maxX=e.getMaxX(),this.minY=e.getMinY(),this.maxY=e.getMaxY()}static merge(e,t){return e==null?t:t==null?e:new gr(e.image,e.topLeft,e.bottomLeft,t.topRight,t.bottomRight)}addMissingRows(e,t,r){let s=this.topLeft,n=this.bottomLeft,i=this.topRight,o=this.bottomRight;if(e>0){let l=r?this.topLeft:this.topRight,c=Math.trunc(l.getY()-e);c<0&&(c=0);let d=new ue(l.getX(),c);r?s=d:i=d}if(t>0){let l=r?this.bottomLeft:this.bottomRight,c=Math.trunc(l.getY()+t);c>=this.image.getHeight()&&(c=this.image.getHeight()-1);let d=new ue(l.getX(),c);r?n=d:o=d}return new gr(this.image,s,n,i,o)}getMinX(){return this.minX}getMaxX(){return this.maxX}getMinY(){return this.minY}getMaxY(){return this.maxY}getTopLeft(){return this.topLeft}getTopRight(){return this.topRight}getBottomLeft(){return this.bottomLeft}getBottomRight(){return this.bottomRight}}class Pn{constructor(e,t,r,s){this.columnCount=e,this.errorCorrectionLevel=s,this.rowCountUpperPart=t,this.rowCountLowerPart=r,this.rowCount=t+r}getColumnCount(){return this.columnCount}getErrorCorrectionLevel(){return this.errorCorrectionLevel}getRowCount(){return this.rowCount}getRowCountUpperPart(){return this.rowCountUpperPart}getRowCountLowerPart(){return this.rowCountLowerPart}}class Dr{constructor(){this.buffer=""}static form(e,t){let r=-1;function s(i,o,l,c,d,f){if(i==="%%")return"%";if(t[++r]===void 0)return;i=c?parseInt(c.substr(1)):void 0;let b=d?parseInt(d.substr(1)):void 0,y;switch(f){case"s":y=t[r];break;case"c":y=t[r][0];break;case"f":y=parseFloat(t[r]).toFixed(i);break;case"p":y=parseFloat(t[r]).toPrecision(i);break;case"e":y=parseFloat(t[r]).toExponential(i);break;case"x":y=parseInt(t[r]).toString(b||16);break;case"d":y=parseFloat(parseInt(t[r],b||10).toPrecision(i)).toFixed(0);break}y=typeof y=="object"?JSON.stringify(y):(+y).toString(b);let A=parseInt(l),E=l&&l[0]+""=="0"?"0":" ";for(;y.length<A;)y=o!==void 0?y+E:E+y;return y}let n=/%(-)?(0?[0-9]+)?([.][0-9]+)?([#][0-9]+)?([scfpexd%])/g;return e.replace(n,s)}format(e,...t){this.buffer+=Dr.form(e,t)}toString(){return this.buffer}}class Pr{constructor(e){this.boundingBox=new gr(e),this.codewords=new Array(e.getMaxY()-e.getMinY()+1)}getCodewordNearby(e){let t=this.getCodeword(e);if(t!=null)return t;for(let r=1;r<Pr.MAX_NEARBY_DISTANCE;r++){let s=this.imageRowToCodewordIndex(e)-r;if(s>=0&&(t=this.codewords[s],t!=null)||(s=this.imageRowToCodewordIndex(e)+r,s<this.codewords.length&&(t=this.codewords[s],t!=null)))return t}return null}imageRowToCodewordIndex(e){return e-this.boundingBox.getMinY()}setCodeword(e,t){this.codewords[this.imageRowToCodewordIndex(e)]=t}getCodeword(e){return this.codewords[this.imageRowToCodewordIndex(e)]}getBoundingBox(){return this.boundingBox}getCodewords(){return this.codewords}toString(){const e=new Dr;let t=0;for(const r of this.codewords){if(r==null){e.format("%3d:    |   %n",t++);continue}e.format("%3d: %3d|%3d%n",t++,r.getRowNumber(),r.getValue())}return e.toString()}}Pr.MAX_NEARBY_DISTANCE=5;class Br{constructor(){this.values=new Map}setValue(e){e=Math.trunc(e);let t=this.values.get(e);t==null&&(t=0),t++,this.values.set(e,t)}getValue(){let e=-1,t=new Array;for(const[r,s]of this.values.entries()){const n={getKey:()=>r,getValue:()=>s};n.getValue()>e?(e=n.getValue(),t=[],t.push(n.getKey())):n.getValue()===e&&t.push(n.getKey())}return Ie.toIntArray(t)}getConfidence(e){return this.values.get(e)}}class Us extends Pr{constructor(e,t){super(e),this._isLeft=t}setRowNumbers(){for(let e of this.getCodewords())e!=null&&e.setRowNumberAsRowIndicatorColumn()}adjustCompleteIndicatorColumnRowNumbers(e){let t=this.getCodewords();this.setRowNumbers(),this.removeIncorrectCodewords(t,e);let r=this.getBoundingBox(),s=this._isLeft?r.getTopLeft():r.getTopRight(),n=this._isLeft?r.getBottomLeft():r.getBottomRight(),i=this.imageRowToCodewordIndex(Math.trunc(s.getY())),o=this.imageRowToCodewordIndex(Math.trunc(n.getY())),l=-1,c=1,d=0;for(let f=i;f<o;f++){if(t[f]==null)continue;let b=t[f],y=b.getRowNumber()-l;if(y===0)d++;else if(y===1)c=Math.max(c,d),d=1,l=b.getRowNumber();else if(y<0||b.getRowNumber()>=e.getRowCount()||y>f)t[f]=null;else{let A;c>2?A=(c-2)*y:A=y;let E=A>=f;for(let O=1;O<=A&&!E;O++)E=t[f-O]!=null;E?t[f]=null:(l=b.getRowNumber(),d=1)}}}getRowHeights(){let e=this.getBarcodeMetadata();if(e==null)return null;this.adjustIncompleteIndicatorColumnRowNumbers(e);let t=new Int32Array(e.getRowCount());for(let r of this.getCodewords())if(r!=null){let s=r.getRowNumber();if(s>=t.length)continue;t[s]++}return t}adjustIncompleteIndicatorColumnRowNumbers(e){let t=this.getBoundingBox(),r=this._isLeft?t.getTopLeft():t.getTopRight(),s=this._isLeft?t.getBottomLeft():t.getBottomRight(),n=this.imageRowToCodewordIndex(Math.trunc(r.getY())),i=this.imageRowToCodewordIndex(Math.trunc(s.getY())),o=this.getCodewords(),l=-1;for(let c=n;c<i;c++){if(o[c]==null)continue;let d=o[c];d.setRowNumberAsRowIndicatorColumn();let f=d.getRowNumber()-l;f===0||(f===1?l=d.getRowNumber():d.getRowNumber()>=e.getRowCount()?o[c]=null:l=d.getRowNumber())}}getBarcodeMetadata(){let e=this.getCodewords(),t=new Br,r=new Br,s=new Br,n=new Br;for(let o of e){if(o==null)continue;o.setRowNumberAsRowIndicatorColumn();let l=o.getValue()%30,c=o.getRowNumber();switch(this._isLeft||(c+=2),c%3){case 0:r.setValue(l*3+1);break;case 1:n.setValue(l/3),s.setValue(l%3);break;case 2:t.setValue(l+1);break}}if(t.getValue().length===0||r.getValue().length===0||s.getValue().length===0||n.getValue().length===0||t.getValue()[0]<1||r.getValue()[0]+s.getValue()[0]<Ie.MIN_ROWS_IN_BARCODE||r.getValue()[0]+s.getValue()[0]>Ie.MAX_ROWS_IN_BARCODE)return null;let i=new Pn(t.getValue()[0],r.getValue()[0],s.getValue()[0],n.getValue()[0]);return this.removeIncorrectCodewords(e,i),i}removeIncorrectCodewords(e,t){for(let r=0;r<e.length;r++){let s=e[r];if(e[r]==null)continue;let n=s.getValue()%30,i=s.getRowNumber();if(i>t.getRowCount()){e[r]=null;continue}switch(this._isLeft||(i+=2),i%3){case 0:n*3+1!==t.getRowCountUpperPart()&&(e[r]=null);break;case 1:(Math.trunc(n/3)!==t.getErrorCorrectionLevel()||n%3!==t.getRowCountLowerPart())&&(e[r]=null);break;case 2:n+1!==t.getColumnCount()&&(e[r]=null);break}}}isLeft(){return this._isLeft}toString(){return"IsLeft: "+this._isLeft+`
`+super.toString()}}class Lr{constructor(e,t){this.ADJUST_ROW_NUMBER_SKIP=2,this.barcodeMetadata=e,this.barcodeColumnCount=e.getColumnCount(),this.boundingBox=t,this.detectionResultColumns=new Array(this.barcodeColumnCount+2)}getDetectionResultColumns(){this.adjustIndicatorColumnRowNumbers(this.detectionResultColumns[0]),this.adjustIndicatorColumnRowNumbers(this.detectionResultColumns[this.barcodeColumnCount+1]);let e=Ie.MAX_CODEWORDS_IN_BARCODE,t;do t=e,e=this.adjustRowNumbersAndGetCount();while(e>0&&e<t);return this.detectionResultColumns}adjustIndicatorColumnRowNumbers(e){e!=null&&e.adjustCompleteIndicatorColumnRowNumbers(this.barcodeMetadata)}adjustRowNumbersAndGetCount(){let e=this.adjustRowNumbersByRow();if(e===0)return 0;for(let t=1;t<this.barcodeColumnCount+1;t++){let r=this.detectionResultColumns[t].getCodewords();for(let s=0;s<r.length;s++)r[s]!=null&&(r[s].hasValidRowNumber()||this.adjustRowNumbers(t,s,r))}return e}adjustRowNumbersByRow(){return this.adjustRowNumbersFromBothRI(),this.adjustRowNumbersFromLRI()+this.adjustRowNumbersFromRRI()}adjustRowNumbersFromBothRI(){if(this.detectionResultColumns[0]==null||this.detectionResultColumns[this.barcodeColumnCount+1]==null)return;let e=this.detectionResultColumns[0].getCodewords(),t=this.detectionResultColumns[this.barcodeColumnCount+1].getCodewords();for(let r=0;r<e.length;r++)if(e[r]!=null&&t[r]!=null&&e[r].getRowNumber()===t[r].getRowNumber())for(let s=1;s<=this.barcodeColumnCount;s++){let n=this.detectionResultColumns[s].getCodewords()[r];n!=null&&(n.setRowNumber(e[r].getRowNumber()),n.hasValidRowNumber()||(this.detectionResultColumns[s].getCodewords()[r]=null))}}adjustRowNumbersFromRRI(){if(this.detectionResultColumns[this.barcodeColumnCount+1]==null)return 0;let e=0,t=this.detectionResultColumns[this.barcodeColumnCount+1].getCodewords();for(let r=0;r<t.length;r++){if(t[r]==null)continue;let s=t[r].getRowNumber(),n=0;for(let i=this.barcodeColumnCount+1;i>0&&n<this.ADJUST_ROW_NUMBER_SKIP;i--){let o=this.detectionResultColumns[i].getCodewords()[r];o!=null&&(n=Lr.adjustRowNumberIfValid(s,n,o),o.hasValidRowNumber()||e++)}}return e}adjustRowNumbersFromLRI(){if(this.detectionResultColumns[0]==null)return 0;let e=0,t=this.detectionResultColumns[0].getCodewords();for(let r=0;r<t.length;r++){if(t[r]==null)continue;let s=t[r].getRowNumber(),n=0;for(let i=1;i<this.barcodeColumnCount+1&&n<this.ADJUST_ROW_NUMBER_SKIP;i++){let o=this.detectionResultColumns[i].getCodewords()[r];o!=null&&(n=Lr.adjustRowNumberIfValid(s,n,o),o.hasValidRowNumber()||e++)}}return e}static adjustRowNumberIfValid(e,t,r){return r==null||r.hasValidRowNumber()||(r.isValidRowNumber(e)?(r.setRowNumber(e),t=0):++t),t}adjustRowNumbers(e,t,r){if(!this.detectionResultColumns[e-1])return;let s=r[t],n=this.detectionResultColumns[e-1].getCodewords(),i=n;this.detectionResultColumns[e+1]!=null&&(i=this.detectionResultColumns[e+1].getCodewords());let o=new Array(14);o[2]=n[t],o[3]=i[t],t>0&&(o[0]=r[t-1],o[4]=n[t-1],o[5]=i[t-1]),t>1&&(o[8]=r[t-2],o[10]=n[t-2],o[11]=i[t-2]),t<r.length-1&&(o[1]=r[t+1],o[6]=n[t+1],o[7]=i[t+1]),t<r.length-2&&(o[9]=r[t+2],o[12]=n[t+2],o[13]=i[t+2]);for(let l of o)if(Lr.adjustRowNumber(s,l))return}static adjustRowNumber(e,t){return t==null?!1:t.hasValidRowNumber()&&t.getBucket()===e.getBucket()?(e.setRowNumber(t.getRowNumber()),!0):!1}getBarcodeColumnCount(){return this.barcodeColumnCount}getBarcodeRowCount(){return this.barcodeMetadata.getRowCount()}getBarcodeECLevel(){return this.barcodeMetadata.getErrorCorrectionLevel()}setBoundingBox(e){this.boundingBox=e}getBoundingBox(){return this.boundingBox}setDetectionResultColumn(e,t){this.detectionResultColumns[e]=t}getDetectionResultColumn(e){return this.detectionResultColumns[e]}toString(){let e=this.detectionResultColumns[0];e==null&&(e=this.detectionResultColumns[this.barcodeColumnCount+1]);let t=new Dr;for(let r=0;r<e.getCodewords().length;r++){t.format("CW %3d:",r);for(let s=0;s<this.barcodeColumnCount+2;s++){if(this.detectionResultColumns[s]==null){t.format("    |   ");continue}let n=this.detectionResultColumns[s].getCodewords()[r];if(n==null){t.format("    |   ");continue}t.format(" %3d|%3d",n.getRowNumber(),n.getValue())}t.format("%n")}return t.toString()}}class Fr{constructor(e,t,r,s){this.rowNumber=Fr.BARCODE_ROW_UNKNOWN,this.startX=Math.trunc(e),this.endX=Math.trunc(t),this.bucket=Math.trunc(r),this.value=Math.trunc(s)}hasValidRowNumber(){return this.isValidRowNumber(this.rowNumber)}isValidRowNumber(e){return e!==Fr.BARCODE_ROW_UNKNOWN&&this.bucket===e%3*3}setRowNumberAsRowIndicatorColumn(){this.rowNumber=Math.trunc(Math.trunc(this.value/30)*3+Math.trunc(this.bucket/3))}getWidth(){return this.endX-this.startX}getStartX(){return this.startX}getEndX(){return this.endX}getBucket(){return this.bucket}getValue(){return this.value}getRowNumber(){return this.rowNumber}setRowNumber(e){this.rowNumber=e}toString(){return this.rowNumber+"|"+this.value}}Fr.BARCODE_ROW_UNKNOWN=-1;class Bt{static initialize(){for(let e=0;e<Ie.SYMBOL_TABLE.length;e++){let t=Ie.SYMBOL_TABLE[e],r=t&1;for(let s=0;s<Ie.BARS_IN_MODULE;s++){let n=0;for(;(t&1)===r;)n+=1,t>>=1;r=t&1,Bt.RATIOS_TABLE[e]||(Bt.RATIOS_TABLE[e]=new Array(Ie.BARS_IN_MODULE)),Bt.RATIOS_TABLE[e][Ie.BARS_IN_MODULE-s-1]=Math.fround(n/Ie.MODULES_IN_CODEWORD)}}this.bSymbolTableReady=!0}static getDecodedValue(e){let t=Bt.getDecodedCodewordValue(Bt.sampleBitCounts(e));return t!==-1?t:Bt.getClosestDecodedValue(e)}static sampleBitCounts(e){let t=Be.sum(e),r=new Int32Array(Ie.BARS_IN_MODULE),s=0,n=0;for(let i=0;i<Ie.MODULES_IN_CODEWORD;i++){let o=t/(2*Ie.MODULES_IN_CODEWORD)+i*t/Ie.MODULES_IN_CODEWORD;n+e[s]<=o&&(n+=e[s],s++),r[s]++}return r}static getDecodedCodewordValue(e){let t=Bt.getBitValue(e);return Ie.getCodeword(t)===-1?-1:t}static getBitValue(e){let t=0;for(let r=0;r<e.length;r++)for(let s=0;s<e[r];s++)t=t<<1|(r%2===0?1:0);return Math.trunc(t)}static getClosestDecodedValue(e){let t=Be.sum(e),r=new Array(Ie.BARS_IN_MODULE);if(t>1)for(let i=0;i<r.length;i++)r[i]=Math.fround(e[i]/t);let s=Cr.MAX_VALUE,n=-1;this.bSymbolTableReady||Bt.initialize();for(let i=0;i<Bt.RATIOS_TABLE.length;i++){let o=0,l=Bt.RATIOS_TABLE[i];for(let c=0;c<Ie.BARS_IN_MODULE;c++){let d=Math.fround(l[c]-r[c]);if(o+=Math.fround(d*d),o>=s)break}o<s&&(s=o,n=Ie.SYMBOL_TABLE[i])}return n}}Bt.bSymbolTableReady=!1,Bt.RATIOS_TABLE=new Array(Ie.SYMBOL_TABLE.length).map(u=>new Array(Ie.BARS_IN_MODULE));class Vs{constructor(){this.segmentCount=-1,this.fileSize=-1,this.timestamp=-1,this.checksum=-1}getSegmentIndex(){return this.segmentIndex}setSegmentIndex(e){this.segmentIndex=e}getFileId(){return this.fileId}setFileId(e){this.fileId=e}getOptionalData(){return this.optionalData}setOptionalData(e){this.optionalData=e}isLastSegment(){return this.lastSegment}setLastSegment(e){this.lastSegment=e}getSegmentCount(){return this.segmentCount}setSegmentCount(e){this.segmentCount=e}getSender(){return this.sender||null}setSender(e){this.sender=e}getAddressee(){return this.addressee||null}setAddressee(e){this.addressee=e}getFileName(){return this.fileName}setFileName(e){this.fileName=e}getFileSize(){return this.fileSize}setFileSize(e){this.fileSize=e}getChecksum(){return this.checksum}setChecksum(e){this.checksum=e}getTimestamp(){return this.timestamp}setTimestamp(e){this.timestamp=e}}class Hs{static parseLong(e,t=void 0){return parseInt(e,t)}}class Gs extends C{}Gs.kind="NullPointerException";class Bn{writeBytes(e){this.writeBytesOffset(e,0,e.length)}writeBytesOffset(e,t,r){if(e==null)throw new Gs;if(t<0||t>e.length||r<0||t+r>e.length||t+r<0)throw new ce;if(r===0)return;for(let s=0;s<r;s++)this.write(e[t+s])}flush(){}close(){}}class Ln extends C{}class Fn extends Bn{constructor(e=32){if(super(),this.count=0,e<0)throw new _("Negative initial size: "+e);this.buf=new Uint8Array(e)}ensureCapacity(e){e-this.buf.length>0&&this.grow(e)}grow(e){let r=this.buf.length<<1;if(r-e<0&&(r=e),r<0){if(e<0)throw new Ln;r=I.MAX_VALUE}this.buf=X.copyOfUint8Array(this.buf,r)}write(e){this.ensureCapacity(this.count+1),this.buf[this.count]=e,this.count+=1}writeBytesOffset(e,t,r){if(t<0||t>e.length||r<0||t+r-e.length>0)throw new ce;this.ensureCapacity(this.count+r),K.arraycopy(e,t,this.buf,this.count,r),this.count+=r}writeTo(e){e.writeBytesOffset(this.buf,0,this.count)}reset(){this.count=0}toByteArray(){return X.copyOfUint8Array(this.buf,this.count)}size(){return this.count}toString(e){return e?typeof e=="string"?this.toString_string(e):this.toString_number(e):this.toString_void()}toString_void(){return new String(this.buf).toString()}toString_string(e){return new String(this.buf).toString()}toString_number(e){return new String(this.buf).toString()}close(){}}var Ye;(function(u){u[u.ALPHA=0]="ALPHA",u[u.LOWER=1]="LOWER",u[u.MIXED=2]="MIXED",u[u.PUNCT=3]="PUNCT",u[u.ALPHA_SHIFT=4]="ALPHA_SHIFT",u[u.PUNCT_SHIFT=5]="PUNCT_SHIFT"})(Ye||(Ye={}));function Ws(){if(typeof window<"u")return window.BigInt||null;if(typeof ts<"u")return ts.BigInt||null;if(typeof self<"u")return self.BigInt||null;throw new Error("Can't search globals for BigInt!")}let Zr;function dr(u){if(typeof Zr>"u"&&(Zr=Ws()),Zr===null)throw new Error("BigInt is not supported!");return Zr(u)}function Un(){let u=[];u[0]=dr(1);let e=dr(900);u[1]=e;for(let t=2;t<16;t++)u[t]=u[t-1]*e;return u}class L{static decode(e,t){let r=new ie(""),s=M.ISO8859_1;r.enableDecoding(s);let n=1,i=e[n++],o=new Vs;for(;n<e[0];){switch(i){case L.TEXT_COMPACTION_MODE_LATCH:n=L.textCompaction(e,n,r);break;case L.BYTE_COMPACTION_MODE_LATCH:case L.BYTE_COMPACTION_MODE_LATCH_6:n=L.byteCompaction(i,e,s,n,r);break;case L.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:r.append(e[n++]);break;case L.NUMERIC_COMPACTION_MODE_LATCH:n=L.numericCompaction(e,n,r);break;case L.ECI_CHARSET:M.getCharacterSetECIByValue(e[n++]);break;case L.ECI_GENERAL_PURPOSE:n+=2;break;case L.ECI_USER_DEFINED:n++;break;case L.BEGIN_MACRO_PDF417_CONTROL_BLOCK:n=L.decodeMacroBlock(e,n,o);break;case L.BEGIN_MACRO_PDF417_OPTIONAL_FIELD:case L.MACRO_PDF417_TERMINATOR:throw new S;default:n--,n=L.textCompaction(e,n,r);break}if(n<e.length)i=e[n++];else throw S.getFormatInstance()}if(r.length()===0)throw S.getFormatInstance();let l=new ot(null,r.toString(),null,t);return l.setOther(o),l}static decodeMacroBlock(e,t,r){if(t+L.NUMBER_OF_SEQUENCE_CODEWORDS>e[0])throw S.getFormatInstance();let s=new Int32Array(L.NUMBER_OF_SEQUENCE_CODEWORDS);for(let o=0;o<L.NUMBER_OF_SEQUENCE_CODEWORDS;o++,t++)s[o]=e[t];r.setSegmentIndex(I.parseInt(L.decodeBase900toBase10(s,L.NUMBER_OF_SEQUENCE_CODEWORDS)));let n=new ie;t=L.textCompaction(e,t,n),r.setFileId(n.toString());let i=-1;for(e[t]===L.BEGIN_MACRO_PDF417_OPTIONAL_FIELD&&(i=t+1);t<e[0];)switch(e[t]){case L.BEGIN_MACRO_PDF417_OPTIONAL_FIELD:switch(t++,e[t]){case L.MACRO_PDF417_OPTIONAL_FIELD_FILE_NAME:let o=new ie;t=L.textCompaction(e,t+1,o),r.setFileName(o.toString());break;case L.MACRO_PDF417_OPTIONAL_FIELD_SENDER:let l=new ie;t=L.textCompaction(e,t+1,l),r.setSender(l.toString());break;case L.MACRO_PDF417_OPTIONAL_FIELD_ADDRESSEE:let c=new ie;t=L.textCompaction(e,t+1,c),r.setAddressee(c.toString());break;case L.MACRO_PDF417_OPTIONAL_FIELD_SEGMENT_COUNT:let d=new ie;t=L.numericCompaction(e,t+1,d),r.setSegmentCount(I.parseInt(d.toString()));break;case L.MACRO_PDF417_OPTIONAL_FIELD_TIME_STAMP:let f=new ie;t=L.numericCompaction(e,t+1,f),r.setTimestamp(Hs.parseLong(f.toString()));break;case L.MACRO_PDF417_OPTIONAL_FIELD_CHECKSUM:let b=new ie;t=L.numericCompaction(e,t+1,b),r.setChecksum(I.parseInt(b.toString()));break;case L.MACRO_PDF417_OPTIONAL_FIELD_FILE_SIZE:let y=new ie;t=L.numericCompaction(e,t+1,y),r.setFileSize(Hs.parseLong(y.toString()));break;default:throw S.getFormatInstance()}break;case L.MACRO_PDF417_TERMINATOR:t++,r.setLastSegment(!0);break;default:throw S.getFormatInstance()}if(i!==-1){let o=t-i;r.isLastSegment()&&o--,r.setOptionalData(X.copyOfRange(e,i,i+o))}return t}static textCompaction(e,t,r){let s=new Int32Array((e[0]-t)*2),n=new Int32Array((e[0]-t)*2),i=0,o=!1;for(;t<e[0]&&!o;){let l=e[t++];if(l<L.TEXT_COMPACTION_MODE_LATCH)s[i]=l/30,s[i+1]=l%30,i+=2;else switch(l){case L.TEXT_COMPACTION_MODE_LATCH:s[i++]=L.TEXT_COMPACTION_MODE_LATCH;break;case L.BYTE_COMPACTION_MODE_LATCH:case L.BYTE_COMPACTION_MODE_LATCH_6:case L.NUMERIC_COMPACTION_MODE_LATCH:case L.BEGIN_MACRO_PDF417_CONTROL_BLOCK:case L.BEGIN_MACRO_PDF417_OPTIONAL_FIELD:case L.MACRO_PDF417_TERMINATOR:t--,o=!0;break;case L.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:s[i]=L.MODE_SHIFT_TO_BYTE_COMPACTION_MODE,l=e[t++],n[i]=l,i++;break}}return L.decodeTextCompaction(s,n,i,r),t}static decodeTextCompaction(e,t,r,s){let n=Ye.ALPHA,i=Ye.ALPHA,o=0;for(;o<r;){let l=e[o],c="";switch(n){case Ye.ALPHA:if(l<26)c=String.fromCharCode(65+l);else switch(l){case 26:c=" ";break;case L.LL:n=Ye.LOWER;break;case L.ML:n=Ye.MIXED;break;case L.PS:i=n,n=Ye.PUNCT_SHIFT;break;case L.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:s.append(t[o]);break;case L.TEXT_COMPACTION_MODE_LATCH:n=Ye.ALPHA;break}break;case Ye.LOWER:if(l<26)c=String.fromCharCode(97+l);else switch(l){case 26:c=" ";break;case L.AS:i=n,n=Ye.ALPHA_SHIFT;break;case L.ML:n=Ye.MIXED;break;case L.PS:i=n,n=Ye.PUNCT_SHIFT;break;case L.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:s.append(t[o]);break;case L.TEXT_COMPACTION_MODE_LATCH:n=Ye.ALPHA;break}break;case Ye.MIXED:if(l<L.PL)c=L.MIXED_CHARS[l];else switch(l){case L.PL:n=Ye.PUNCT;break;case 26:c=" ";break;case L.LL:n=Ye.LOWER;break;case L.AL:n=Ye.ALPHA;break;case L.PS:i=n,n=Ye.PUNCT_SHIFT;break;case L.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:s.append(t[o]);break;case L.TEXT_COMPACTION_MODE_LATCH:n=Ye.ALPHA;break}break;case Ye.PUNCT:if(l<L.PAL)c=L.PUNCT_CHARS[l];else switch(l){case L.PAL:n=Ye.ALPHA;break;case L.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:s.append(t[o]);break;case L.TEXT_COMPACTION_MODE_LATCH:n=Ye.ALPHA;break}break;case Ye.ALPHA_SHIFT:if(n=i,l<26)c=String.fromCharCode(65+l);else switch(l){case 26:c=" ";break;case L.TEXT_COMPACTION_MODE_LATCH:n=Ye.ALPHA;break}break;case Ye.PUNCT_SHIFT:if(n=i,l<L.PAL)c=L.PUNCT_CHARS[l];else switch(l){case L.PAL:n=Ye.ALPHA;break;case L.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:s.append(t[o]);break;case L.TEXT_COMPACTION_MODE_LATCH:n=Ye.ALPHA;break}break}c!==""&&s.append(c),o++}}static byteCompaction(e,t,r,s,n){let i=new Fn,o=0,l=0,c=!1;switch(e){case L.BYTE_COMPACTION_MODE_LATCH:let d=new Int32Array(6),f=t[s++];for(;s<t[0]&&!c;)switch(d[o++]=f,l=900*l+f,f=t[s++],f){case L.TEXT_COMPACTION_MODE_LATCH:case L.BYTE_COMPACTION_MODE_LATCH:case L.NUMERIC_COMPACTION_MODE_LATCH:case L.BYTE_COMPACTION_MODE_LATCH_6:case L.BEGIN_MACRO_PDF417_CONTROL_BLOCK:case L.BEGIN_MACRO_PDF417_OPTIONAL_FIELD:case L.MACRO_PDF417_TERMINATOR:s--,c=!0;break;default:if(o%5===0&&o>0){for(let b=0;b<6;++b)i.write(Number(dr(l)>>dr(8*(5-b))));l=0,o=0}break}s===t[0]&&f<L.TEXT_COMPACTION_MODE_LATCH&&(d[o++]=f);for(let b=0;b<o;b++)i.write(d[b]);break;case L.BYTE_COMPACTION_MODE_LATCH_6:for(;s<t[0]&&!c;){let b=t[s++];if(b<L.TEXT_COMPACTION_MODE_LATCH)o++,l=900*l+b;else switch(b){case L.TEXT_COMPACTION_MODE_LATCH:case L.BYTE_COMPACTION_MODE_LATCH:case L.NUMERIC_COMPACTION_MODE_LATCH:case L.BYTE_COMPACTION_MODE_LATCH_6:case L.BEGIN_MACRO_PDF417_CONTROL_BLOCK:case L.BEGIN_MACRO_PDF417_OPTIONAL_FIELD:case L.MACRO_PDF417_TERMINATOR:s--,c=!0;break}if(o%5===0&&o>0){for(let y=0;y<6;++y)i.write(Number(dr(l)>>dr(8*(5-y))));l=0,o=0}}break}return n.append(pe.decode(i.toByteArray(),r)),s}static numericCompaction(e,t,r){let s=0,n=!1,i=new Int32Array(L.MAX_NUMERIC_CODEWORDS);for(;t<e[0]&&!n;){let o=e[t++];if(t===e[0]&&(n=!0),o<L.TEXT_COMPACTION_MODE_LATCH)i[s]=o,s++;else switch(o){case L.TEXT_COMPACTION_MODE_LATCH:case L.BYTE_COMPACTION_MODE_LATCH:case L.BYTE_COMPACTION_MODE_LATCH_6:case L.BEGIN_MACRO_PDF417_CONTROL_BLOCK:case L.BEGIN_MACRO_PDF417_OPTIONAL_FIELD:case L.MACRO_PDF417_TERMINATOR:t--,n=!0;break}(s%L.MAX_NUMERIC_CODEWORDS===0||o===L.NUMERIC_COMPACTION_MODE_LATCH||n)&&s>0&&(r.append(L.decodeBase900toBase10(i,s)),s=0)}return t}static decodeBase900toBase10(e,t){let r=dr(0);for(let n=0;n<t;n++)r+=L.EXP900[t-n-1]*dr(e[n]);let s=r.toString();if(s.charAt(0)!=="1")throw new S;return s.substring(1)}}L.TEXT_COMPACTION_MODE_LATCH=900,L.BYTE_COMPACTION_MODE_LATCH=901,L.NUMERIC_COMPACTION_MODE_LATCH=902,L.BYTE_COMPACTION_MODE_LATCH_6=924,L.ECI_USER_DEFINED=925,L.ECI_GENERAL_PURPOSE=926,L.ECI_CHARSET=927,L.BEGIN_MACRO_PDF417_CONTROL_BLOCK=928,L.BEGIN_MACRO_PDF417_OPTIONAL_FIELD=923,L.MACRO_PDF417_TERMINATOR=922,L.MODE_SHIFT_TO_BYTE_COMPACTION_MODE=913,L.MAX_NUMERIC_CODEWORDS=15,L.MACRO_PDF417_OPTIONAL_FIELD_FILE_NAME=0,L.MACRO_PDF417_OPTIONAL_FIELD_SEGMENT_COUNT=1,L.MACRO_PDF417_OPTIONAL_FIELD_TIME_STAMP=2,L.MACRO_PDF417_OPTIONAL_FIELD_SENDER=3,L.MACRO_PDF417_OPTIONAL_FIELD_ADDRESSEE=4,L.MACRO_PDF417_OPTIONAL_FIELD_FILE_SIZE=5,L.MACRO_PDF417_OPTIONAL_FIELD_CHECKSUM=6,L.PL=25,L.LL=27,L.AS=27,L.ML=28,L.AL=28,L.PS=29,L.PAL=29,L.PUNCT_CHARS=`;<>@[\\]_\`~!\r	,:
-.$/"|*()?{}'`,L.MIXED_CHARS="0123456789&\r	,:#-.$/+%*=^",L.EXP900=Ws()?Un():[],L.NUMBER_OF_SEQUENCE_CODEWORDS=2;class je{constructor(){}static decode(e,t,r,s,n,i,o){let l=new gr(e,t,r,s,n),c=null,d=null,f;for(let A=!0;;A=!1){if(t!=null&&(c=je.getRowIndicatorColumn(e,l,t,!0,i,o)),s!=null&&(d=je.getRowIndicatorColumn(e,l,s,!1,i,o)),f=je.merge(c,d),f==null)throw j.getNotFoundInstance();let E=f.getBoundingBox();if(A&&E!=null&&(E.getMinY()<l.getMinY()||E.getMaxY()>l.getMaxY()))l=E;else break}f.setBoundingBox(l);let b=f.getBarcodeColumnCount()+1;f.setDetectionResultColumn(0,c),f.setDetectionResultColumn(b,d);let y=c!=null;for(let A=1;A<=b;A++){let E=y?A:b-A;if(f.getDetectionResultColumn(E)!==void 0)continue;let O;E===0||E===b?O=new Us(l,E===0):O=new Pr(l),f.setDetectionResultColumn(E,O);let F=-1,ee=F;for(let te=l.getMinY();te<=l.getMaxY();te++){if(F=je.getStartColumn(f,E,te,y),F<0||F>l.getMaxX()){if(ee===-1)continue;F=ee}let Z=je.detectCodeword(e,l.getMinX(),l.getMaxX(),y,F,te,i,o);Z!=null&&(O.setCodeword(te,Z),ee=F,i=Math.min(i,Z.getWidth()),o=Math.max(o,Z.getWidth()))}}return je.createDecoderResult(f)}static merge(e,t){if(e==null&&t==null)return null;let r=je.getBarcodeMetadata(e,t);if(r==null)return null;let s=gr.merge(je.adjustBoundingBox(e),je.adjustBoundingBox(t));return new Lr(r,s)}static adjustBoundingBox(e){if(e==null)return null;let t=e.getRowHeights();if(t==null)return null;let r=je.getMax(t),s=0;for(let o of t)if(s+=r-o,o>0)break;let n=e.getCodewords();for(let o=0;s>0&&n[o]==null;o++)s--;let i=0;for(let o=t.length-1;o>=0&&(i+=r-t[o],!(t[o]>0));o--);for(let o=n.length-1;i>0&&n[o]==null;o--)i--;return e.getBoundingBox().addMissingRows(s,i,e.isLeft())}static getMax(e){let t=-1;for(let r of e)t=Math.max(t,r);return t}static getBarcodeMetadata(e,t){let r;if(e==null||(r=e.getBarcodeMetadata())==null)return t==null?null:t.getBarcodeMetadata();let s;return t==null||(s=t.getBarcodeMetadata())==null?r:r.getColumnCount()!==s.getColumnCount()&&r.getErrorCorrectionLevel()!==s.getErrorCorrectionLevel()&&r.getRowCount()!==s.getRowCount()?null:r}static getRowIndicatorColumn(e,t,r,s,n,i){let o=new Us(t,s);for(let l=0;l<2;l++){let c=l===0?1:-1,d=Math.trunc(Math.trunc(r.getX()));for(let f=Math.trunc(Math.trunc(r.getY()));f<=t.getMaxY()&&f>=t.getMinY();f+=c){let b=je.detectCodeword(e,0,e.getWidth(),s,d,f,n,i);b!=null&&(o.setCodeword(f,b),s?d=b.getStartX():d=b.getEndX())}}return o}static adjustCodewordCount(e,t){let r=t[0][1],s=r.getValue(),n=e.getBarcodeColumnCount()*e.getBarcodeRowCount()-je.getNumberOfECCodeWords(e.getBarcodeECLevel());if(s.length===0){if(n<1||n>Ie.MAX_CODEWORDS_IN_BARCODE)throw j.getNotFoundInstance();r.setValue(n)}else s[0]!==n&&r.setValue(n)}static createDecoderResult(e){let t=je.createBarcodeMatrix(e);je.adjustCodewordCount(e,t);let r=new Array,s=new Int32Array(e.getBarcodeRowCount()*e.getBarcodeColumnCount()),n=[],i=new Array;for(let l=0;l<e.getBarcodeRowCount();l++)for(let c=0;c<e.getBarcodeColumnCount();c++){let d=t[l][c+1].getValue(),f=l*e.getBarcodeColumnCount()+c;d.length===0?r.push(f):d.length===1?s[f]=d[0]:(i.push(f),n.push(d))}let o=new Array(n.length);for(let l=0;l<o.length;l++)o[l]=n[l];return je.createDecoderResultFromAmbiguousValues(e.getBarcodeECLevel(),s,Ie.toIntArray(r),Ie.toIntArray(i),o)}static createDecoderResultFromAmbiguousValues(e,t,r,s,n){let i=new Int32Array(s.length),o=100;for(;o-- >0;){for(let l=0;l<i.length;l++)t[s[l]]=n[l][i[l]];try{return je.decodeCodewords(t,e,r)}catch(l){if(!(l instanceof $))throw l}if(i.length===0)throw $.getChecksumInstance();for(let l=0;l<i.length;l++)if(i[l]<n[l].length-1){i[l]++;break}else if(i[l]=0,l===i.length-1)throw $.getChecksumInstance()}throw $.getChecksumInstance()}static createBarcodeMatrix(e){let t=Array.from({length:e.getBarcodeRowCount()},()=>new Array(e.getBarcodeColumnCount()+2));for(let s=0;s<t.length;s++)for(let n=0;n<t[s].length;n++)t[s][n]=new Br;let r=0;for(let s of e.getDetectionResultColumns()){if(s!=null){for(let n of s.getCodewords())if(n!=null){let i=n.getRowNumber();if(i>=0){if(i>=t.length)continue;t[i][r].setValue(n.getValue())}}}r++}return t}static isValidBarcodeColumn(e,t){return t>=0&&t<=e.getBarcodeColumnCount()+1}static getStartColumn(e,t,r,s){let n=s?1:-1,i=null;if(je.isValidBarcodeColumn(e,t-n)&&(i=e.getDetectionResultColumn(t-n).getCodeword(r)),i!=null)return s?i.getEndX():i.getStartX();if(i=e.getDetectionResultColumn(t).getCodewordNearby(r),i!=null)return s?i.getStartX():i.getEndX();if(je.isValidBarcodeColumn(e,t-n)&&(i=e.getDetectionResultColumn(t-n).getCodewordNearby(r)),i!=null)return s?i.getEndX():i.getStartX();let o=0;for(;je.isValidBarcodeColumn(e,t-n);){t-=n;for(let l of e.getDetectionResultColumn(t).getCodewords())if(l!=null)return(s?l.getEndX():l.getStartX())+n*o*(l.getEndX()-l.getStartX());o++}return s?e.getBoundingBox().getMinX():e.getBoundingBox().getMaxX()}static detectCodeword(e,t,r,s,n,i,o,l){n=je.adjustCodewordStartColumn(e,t,r,s,n,i);let c=je.getModuleBitCount(e,t,r,s,n,i);if(c==null)return null;let d,f=Be.sum(c);if(s)d=n+f;else{for(let A=0;A<c.length/2;A++){let E=c[A];c[A]=c[c.length-1-A],c[c.length-1-A]=E}d=n,n=d-f}if(!je.checkCodewordSkew(f,o,l))return null;let b=Bt.getDecodedValue(c),y=Ie.getCodeword(b);return y===-1?null:new Fr(n,d,je.getCodewordBucketNumber(b),y)}static getModuleBitCount(e,t,r,s,n,i){let o=n,l=new Int32Array(8),c=0,d=s?1:-1,f=s;for(;(s?o<r:o>=t)&&c<l.length;)e.get(o,i)===f?(l[c]++,o+=d):(c++,f=!f);return c===l.length||o===(s?r:t)&&c===l.length-1?l:null}static getNumberOfECCodeWords(e){return 2<<e}static adjustCodewordStartColumn(e,t,r,s,n,i){let o=n,l=s?-1:1;for(let c=0;c<2;c++){for(;(s?o>=t:o<r)&&s===e.get(o,i);){if(Math.abs(n-o)>je.CODEWORD_SKEW_SIZE)return n;o+=l}l=-l,s=!s}return o}static checkCodewordSkew(e,t,r){return t-je.CODEWORD_SKEW_SIZE<=e&&e<=r+je.CODEWORD_SKEW_SIZE}static decodeCodewords(e,t,r){if(e.length===0)throw S.getFormatInstance();let s=1<<t+1,n=je.correctErrors(e,r,s);je.verifyCodewordCount(e,s);let i=L.decode(e,""+t);return i.setErrorsCorrected(n),i.setErasures(r.length),i}static correctErrors(e,t,r){if(t!=null&&t.length>r/2+je.MAX_ERRORS||r<0||r>je.MAX_EC_CODEWORDS)throw $.getChecksumInstance();return je.errorCorrection.decode(e,r,t)}static verifyCodewordCount(e,t){if(e.length<4)throw S.getFormatInstance();let r=e[0];if(r>e.length)throw S.getFormatInstance();if(r===0)if(t<e.length)e[0]=e.length-t;else throw S.getFormatInstance()}static getBitCountForCodeword(e){let t=new Int32Array(8),r=0,s=t.length-1;for(;!((e&1)!==r&&(r=e&1,s--,s<0));)t[s]++,e>>=1;return t}static getCodewordBucketNumber(e){return e instanceof Int32Array?this.getCodewordBucketNumber_Int32Array(e):this.getCodewordBucketNumber_number(e)}static getCodewordBucketNumber_number(e){return je.getCodewordBucketNumber(je.getBitCountForCodeword(e))}static getCodewordBucketNumber_Int32Array(e){return(e[0]-e[2]+e[4]-e[6]+9)%9}static toString(e){let t=new Dr;for(let r=0;r<e.length;r++){t.format("Row %2d: ",r);for(let s=0;s<e[r].length;s++){let n=e[r][s];n.getValue().length===0?t.format("        ",null):t.format("%4d(%2d)",n.getValue()[0],n.getConfidence(n.getValue()[0]))}t.format("%n")}return t.toString()}}je.CODEWORD_SKEW_SIZE=2,je.MAX_ERRORS=3,je.MAX_EC_CODEWORDS=512,je.errorCorrection=new Fs;class St{decode(e,t=null){let r=St.decode(e,t,!1);if(r==null||r.length===0||r[0]==null)throw j.getNotFoundInstance();return r[0]}decodeMultiple(e,t=null){try{return St.decode(e,t,!0)}catch(r){throw r instanceof S||r instanceof $?j.getNotFoundInstance():r}}static decode(e,t,r){const s=new Array,n=Me.detectMultiple(e,t,r);for(const i of n.getPoints()){const o=je.decode(n.getBits(),i[4],i[5],i[6],i[7],St.getMinCodewordWidth(i),St.getMaxCodewordWidth(i)),l=new z(o.getText(),o.getRawBytes(),void 0,i,le.PDF_417);l.putMetadata(Ge.ERROR_CORRECTION_LEVEL,o.getECLevel());const c=o.getOther();c!=null&&l.putMetadata(Ge.PDF417_EXTRA_METADATA,c),s.push(l)}return s.map(i=>i)}static getMaxWidth(e,t){return e==null||t==null?0:Math.trunc(Math.abs(e.getX()-t.getX()))}static getMinWidth(e,t){return e==null||t==null?I.MAX_VALUE:Math.trunc(Math.abs(e.getX()-t.getX()))}static getMaxCodewordWidth(e){return Math.floor(Math.max(Math.max(St.getMaxWidth(e[0],e[4]),St.getMaxWidth(e[6],e[2])*Ie.MODULES_IN_CODEWORD/Ie.MODULES_IN_STOP_PATTERN),Math.max(St.getMaxWidth(e[1],e[5]),St.getMaxWidth(e[7],e[3])*Ie.MODULES_IN_CODEWORD/Ie.MODULES_IN_STOP_PATTERN)))}static getMinCodewordWidth(e){return Math.floor(Math.min(Math.min(St.getMinWidth(e[0],e[4]),St.getMinWidth(e[6],e[2])*Ie.MODULES_IN_CODEWORD/Ie.MODULES_IN_STOP_PATTERN),Math.min(St.getMinWidth(e[1],e[5]),St.getMinWidth(e[7],e[3])*Ie.MODULES_IN_CODEWORD/Ie.MODULES_IN_STOP_PATTERN)))}reset(){}}class Qr extends C{}Qr.kind="ReaderException";class Xs{constructor(e,t){this.verbose=e===!0,t&&this.setHints(t)}decode(e,t){return t&&this.setHints(t),this.decodeInternal(e)}decodeWithState(e){return(this.readers===null||this.readers===void 0)&&this.setHints(null),this.decodeInternal(e)}setHints(e){this.hints=e;const t=!p(e)&&e.get(re.TRY_HARDER)===!0,r=p(e)?null:e.get(re.POSSIBLE_FORMATS),s=new Array;if(!p(r)){const n=r.some(i=>i===le.UPC_A||i===le.UPC_E||i===le.EAN_13||i===le.EAN_8||i===le.CODABAR||i===le.CODE_39||i===le.CODE_93||i===le.CODE_128||i===le.ITF||i===le.RSS_14||i===le.RSS_EXPANDED);n&&!t&&s.push(new kr(e,this.verbose)),r.includes(le.QR_CODE)&&s.push(new cr),r.includes(le.DATA_MATRIX)&&s.push(new lr),r.includes(le.AZTEC)&&s.push(new Ar),r.includes(le.PDF_417)&&s.push(new St),n&&t&&s.push(new kr(e,this.verbose))}s.length===0&&(t||s.push(new kr(e,this.verbose)),s.push(new cr),s.push(new lr),s.push(new Ar),s.push(new St),t&&s.push(new kr(e,this.verbose))),this.readers=s}reset(){if(this.readers!==null)for(const e of this.readers)e.reset()}decodeInternal(e){if(this.readers===null)throw new Qr("No readers where selected, nothing can be read.");for(const t of this.readers)try{return t.decode(e,this.hints)}catch(r){if(r instanceof Qr)continue}throw new j("No MultiFormat Readers were able to detect the code.")}}class Vn extends Je{constructor(e=null,t=500){const r=new Xs;r.setHints(e),super(r,t)}decodeBitmap(e){return this.reader.decodeWithState(e)}}class Hn extends Je{constructor(e=500){super(new St,e)}}class Gn extends Je{constructor(e=500){super(new cr,e)}}var bs;(function(u){u[u.ERROR_CORRECTION=0]="ERROR_CORRECTION",u[u.CHARACTER_SET=1]="CHARACTER_SET",u[u.DATA_MATRIX_SHAPE=2]="DATA_MATRIX_SHAPE",u[u.MIN_SIZE=3]="MIN_SIZE",u[u.MAX_SIZE=4]="MAX_SIZE",u[u.MARGIN=5]="MARGIN",u[u.PDF417_COMPACT=6]="PDF417_COMPACT",u[u.PDF417_COMPACTION=7]="PDF417_COMPACTION",u[u.PDF417_DIMENSIONS=8]="PDF417_DIMENSIONS",u[u.AZTEC_LAYERS=9]="AZTEC_LAYERS",u[u.QR_VERSION=10]="QR_VERSION"})(bs||(bs={}));var yt=bs;class ps{constructor(e){this.field=e,this.cachedGenerators=[],this.cachedGenerators.push(new T(e,Int32Array.from([1])))}buildGenerator(e){const t=this.cachedGenerators;if(e>=t.length){let r=t[t.length-1];const s=this.field;for(let n=t.length;n<=e;n++){const i=r.multiply(new T(s,Int32Array.from([1,s.exp(n-1+s.getGeneratorBase())])));t.push(i),r=i}}return t[e]}encode(e,t){if(t===0)throw new _("No error correction bytes");const r=e.length-t;if(r<=0)throw new _("No data bytes provided");const s=this.buildGenerator(t),n=new Int32Array(r);K.arraycopy(e,0,n,0,r);let i=new T(this.field,n);i=i.multiplyByMonomial(t,1);const l=i.divide(s)[1].getCoefficients(),c=t-l.length;for(let d=0;d<c;d++)e[r+d]=0;K.arraycopy(l,0,e,r+c,l.length)}}class ft{constructor(){}static applyMaskPenaltyRule1(e){return ft.applyMaskPenaltyRule1Internal(e,!0)+ft.applyMaskPenaltyRule1Internal(e,!1)}static applyMaskPenaltyRule2(e){let t=0;const r=e.getArray(),s=e.getWidth(),n=e.getHeight();for(let i=0;i<n-1;i++){const o=r[i];for(let l=0;l<s-1;l++){const c=o[l];c===o[l+1]&&c===r[i+1][l]&&c===r[i+1][l+1]&&t++}}return ft.N2*t}static applyMaskPenaltyRule3(e){let t=0;const r=e.getArray(),s=e.getWidth(),n=e.getHeight();for(let i=0;i<n;i++)for(let o=0;o<s;o++){const l=r[i];o+6<s&&l[o]===1&&l[o+1]===0&&l[o+2]===1&&l[o+3]===1&&l[o+4]===1&&l[o+5]===0&&l[o+6]===1&&(ft.isWhiteHorizontal(l,o-4,o)||ft.isWhiteHorizontal(l,o+7,o+11))&&t++,i+6<n&&r[i][o]===1&&r[i+1][o]===0&&r[i+2][o]===1&&r[i+3][o]===1&&r[i+4][o]===1&&r[i+5][o]===0&&r[i+6][o]===1&&(ft.isWhiteVertical(r,o,i-4,i)||ft.isWhiteVertical(r,o,i+7,i+11))&&t++}return t*ft.N3}static isWhiteHorizontal(e,t,r){t=Math.max(t,0),r=Math.min(r,e.length);for(let s=t;s<r;s++)if(e[s]===1)return!1;return!0}static isWhiteVertical(e,t,r,s){r=Math.max(r,0),s=Math.min(s,e.length);for(let n=r;n<s;n++)if(e[n][t]===1)return!1;return!0}static applyMaskPenaltyRule4(e){let t=0;const r=e.getArray(),s=e.getWidth(),n=e.getHeight();for(let l=0;l<n;l++){const c=r[l];for(let d=0;d<s;d++)c[d]===1&&t++}const i=e.getHeight()*e.getWidth();return Math.floor(Math.abs(t*2-i)*10/i)*ft.N4}static getDataMaskBit(e,t,r){let s,n;switch(e){case 0:s=r+t&1;break;case 1:s=r&1;break;case 2:s=t%3;break;case 3:s=(r+t)%3;break;case 4:s=Math.floor(r/2)+Math.floor(t/3)&1;break;case 5:n=r*t,s=(n&1)+n%3;break;case 6:n=r*t,s=(n&1)+n%3&1;break;case 7:n=r*t,s=n%3+(r+t&1)&1;break;default:throw new _("Invalid mask pattern: "+e)}return s===0}static applyMaskPenaltyRule1Internal(e,t){let r=0;const s=t?e.getHeight():e.getWidth(),n=t?e.getWidth():e.getHeight(),i=e.getArray();for(let o=0;o<s;o++){let l=0,c=-1;for(let d=0;d<n;d++){const f=t?i[o][d]:i[d][o];f===c?l++:(l>=5&&(r+=ft.N1+(l-5)),l=1,c=f)}l>=5&&(r+=ft.N1+(l-5))}return r}}ft.N1=3,ft.N2=3,ft.N3=40,ft.N4=10;class Jr{constructor(e,t){this.width=e,this.height=t;const r=new Array(t);for(let s=0;s!==t;s++)r[s]=new Uint8Array(e);this.bytes=r}getHeight(){return this.height}getWidth(){return this.width}get(e,t){return this.bytes[t][e]}getArray(){return this.bytes}setNumber(e,t,r){this.bytes[t][e]=r}setBoolean(e,t,r){this.bytes[t][e]=r?1:0}clear(e){for(const t of this.bytes)X.fill(t,e)}equals(e){if(!(e instanceof Jr))return!1;const t=e;if(this.width!==t.width||this.height!==t.height)return!1;for(let r=0,s=this.height;r<s;++r){const n=this.bytes[r],i=t.bytes[r];for(let o=0,l=this.width;o<l;++o)if(n[o]!==i[o])return!1}return!0}toString(){const e=new ie;for(let t=0,r=this.height;t<r;++t){const s=this.bytes[t];for(let n=0,i=this.width;n<i;++n)switch(s[n]){case 0:e.append(" 0");break;case 1:e.append(" 1");break;default:e.append("  ");break}e.append(`
`)}return e.toString()}}class mr{constructor(){this.maskPattern=-1}getMode(){return this.mode}getECLevel(){return this.ecLevel}getVersion(){return this.version}getMaskPattern(){return this.maskPattern}getMatrix(){return this.matrix}toString(){const e=new ie;return e.append(`<<
`),e.append(" mode: "),e.append(this.mode?this.mode.toString():"null"),e.append(`
 ecLevel: `),e.append(this.ecLevel?this.ecLevel.toString():"null"),e.append(`
 version: `),e.append(this.version?this.version.toString():"null"),e.append(`
 maskPattern: `),e.append(this.maskPattern.toString()),this.matrix?(e.append(`
 matrix:
`),e.append(this.matrix.toString())):e.append(`
 matrix: null
`),e.append(`>>
`),e.toString()}setMode(e){this.mode=e}setECLevel(e){this.ecLevel=e}setVersion(e){this.version=e}setMaskPattern(e){this.maskPattern=e}setMatrix(e){this.matrix=e}static isValidMaskPattern(e){return e>=0&&e<mr.NUM_MASK_PATTERNS}}mr.NUM_MASK_PATTERNS=8;class Ke extends C{}Ke.kind="WriterException";class ve{constructor(){}static clearMatrix(e){e.clear(255)}static buildMatrix(e,t,r,s,n){ve.clearMatrix(n),ve.embedBasicPatterns(r,n),ve.embedTypeInfo(t,s,n),ve.maybeEmbedVersionInfo(r,n),ve.embedDataBits(e,s,n)}static embedBasicPatterns(e,t){ve.embedPositionDetectionPatternsAndSeparators(t),ve.embedDarkDotAtLeftBottomCorner(t),ve.maybeEmbedPositionAdjustmentPatterns(e,t),ve.embedTimingPatterns(t)}static embedTypeInfo(e,t,r){const s=new W;ve.makeTypeInfoBits(e,t,s);for(let n=0,i=s.getSize();n<i;++n){const o=s.get(s.getSize()-1-n),l=ve.TYPE_INFO_COORDINATES[n],c=l[0],d=l[1];if(r.setBoolean(c,d,o),n<8){const f=r.getWidth()-n-1;r.setBoolean(f,8,o)}else{const b=r.getHeight()-7+(n-8);r.setBoolean(8,b,o)}}}static maybeEmbedVersionInfo(e,t){if(e.getVersionNumber()<7)return;const r=new W;ve.makeVersionInfoBits(e,r);let s=17;for(let n=0;n<6;++n)for(let i=0;i<3;++i){const o=r.get(s);s--,t.setBoolean(n,t.getHeight()-11+i,o),t.setBoolean(t.getHeight()-11+i,n,o)}}static embedDataBits(e,t,r){let s=0,n=-1,i=r.getWidth()-1,o=r.getHeight()-1;for(;i>0;){for(i===6&&(i-=1);o>=0&&o<r.getHeight();){for(let l=0;l<2;++l){const c=i-l;if(!ve.isEmpty(r.get(c,o)))continue;let d;s<e.getSize()?(d=e.get(s),++s):d=!1,t!==255&&ft.getDataMaskBit(t,c,o)&&(d=!d),r.setBoolean(c,o,d)}o+=n}n=-n,o+=n,i-=2}if(s!==e.getSize())throw new Ke("Not all bits consumed: "+s+"/"+e.getSize())}static findMSBSet(e){return 32-I.numberOfLeadingZeros(e)}static calculateBCHCode(e,t){if(t===0)throw new _("0 polynomial");const r=ve.findMSBSet(t);for(e<<=r-1;ve.findMSBSet(e)>=r;)e^=t<<ve.findMSBSet(e)-r;return e}static makeTypeInfoBits(e,t,r){if(!mr.isValidMaskPattern(t))throw new Ke("Invalid mask pattern");const s=e.getBits()<<3|t;r.appendBits(s,5);const n=ve.calculateBCHCode(s,ve.TYPE_INFO_POLY);r.appendBits(n,10);const i=new W;if(i.appendBits(ve.TYPE_INFO_MASK_PATTERN,15),r.xor(i),r.getSize()!==15)throw new Ke("should not happen but we got: "+r.getSize())}static makeVersionInfoBits(e,t){t.appendBits(e.getVersionNumber(),6);const r=ve.calculateBCHCode(e.getVersionNumber(),ve.VERSION_INFO_POLY);if(t.appendBits(r,12),t.getSize()!==18)throw new Ke("should not happen but we got: "+t.getSize())}static isEmpty(e){return e===255}static embedTimingPatterns(e){for(let t=8;t<e.getWidth()-8;++t){const r=(t+1)%2;ve.isEmpty(e.get(t,6))&&e.setNumber(t,6,r),ve.isEmpty(e.get(6,t))&&e.setNumber(6,t,r)}}static embedDarkDotAtLeftBottomCorner(e){if(e.get(8,e.getHeight()-8)===0)throw new Ke;e.setNumber(8,e.getHeight()-8,1)}static embedHorizontalSeparationPattern(e,t,r){for(let s=0;s<8;++s){if(!ve.isEmpty(r.get(e+s,t)))throw new Ke;r.setNumber(e+s,t,0)}}static embedVerticalSeparationPattern(e,t,r){for(let s=0;s<7;++s){if(!ve.isEmpty(r.get(e,t+s)))throw new Ke;r.setNumber(e,t+s,0)}}static embedPositionAdjustmentPattern(e,t,r){for(let s=0;s<5;++s){const n=ve.POSITION_ADJUSTMENT_PATTERN[s];for(let i=0;i<5;++i)r.setNumber(e+i,t+s,n[i])}}static embedPositionDetectionPattern(e,t,r){for(let s=0;s<7;++s){const n=ve.POSITION_DETECTION_PATTERN[s];for(let i=0;i<7;++i)r.setNumber(e+i,t+s,n[i])}}static embedPositionDetectionPatternsAndSeparators(e){const t=ve.POSITION_DETECTION_PATTERN[0].length;ve.embedPositionDetectionPattern(0,0,e),ve.embedPositionDetectionPattern(e.getWidth()-t,0,e),ve.embedPositionDetectionPattern(0,e.getWidth()-t,e);const r=8;ve.embedHorizontalSeparationPattern(0,r-1,e),ve.embedHorizontalSeparationPattern(e.getWidth()-r,r-1,e),ve.embedHorizontalSeparationPattern(0,e.getWidth()-r,e);const s=7;ve.embedVerticalSeparationPattern(s,0,e),ve.embedVerticalSeparationPattern(e.getHeight()-s-1,0,e),ve.embedVerticalSeparationPattern(s,e.getHeight()-s,e)}static maybeEmbedPositionAdjustmentPatterns(e,t){if(e.getVersionNumber()<2)return;const r=e.getVersionNumber()-1,s=ve.POSITION_ADJUSTMENT_PATTERN_COORDINATE_TABLE[r];for(let n=0,i=s.length;n!==i;n++){const o=s[n];if(o>=0)for(let l=0;l!==i;l++){const c=s[l];c>=0&&ve.isEmpty(t.get(c,o))&&ve.embedPositionAdjustmentPattern(c-2,o-2,t)}}}}ve.POSITION_DETECTION_PATTERN=Array.from([Int32Array.from([1,1,1,1,1,1,1]),Int32Array.from([1,0,0,0,0,0,1]),Int32Array.from([1,0,1,1,1,0,1]),Int32Array.from([1,0,1,1,1,0,1]),Int32Array.from([1,0,1,1,1,0,1]),Int32Array.from([1,0,0,0,0,0,1]),Int32Array.from([1,1,1,1,1,1,1])]),ve.POSITION_ADJUSTMENT_PATTERN=Array.from([Int32Array.from([1,1,1,1,1]),Int32Array.from([1,0,0,0,1]),Int32Array.from([1,0,1,0,1]),Int32Array.from([1,0,0,0,1]),Int32Array.from([1,1,1,1,1])]),ve.POSITION_ADJUSTMENT_PATTERN_COORDINATE_TABLE=Array.from([Int32Array.from([-1,-1,-1,-1,-1,-1,-1]),Int32Array.from([6,18,-1,-1,-1,-1,-1]),Int32Array.from([6,22,-1,-1,-1,-1,-1]),Int32Array.from([6,26,-1,-1,-1,-1,-1]),Int32Array.from([6,30,-1,-1,-1,-1,-1]),Int32Array.from([6,34,-1,-1,-1,-1,-1]),Int32Array.from([6,22,38,-1,-1,-1,-1]),Int32Array.from([6,24,42,-1,-1,-1,-1]),Int32Array.from([6,26,46,-1,-1,-1,-1]),Int32Array.from([6,28,50,-1,-1,-1,-1]),Int32Array.from([6,30,54,-1,-1,-1,-1]),Int32Array.from([6,32,58,-1,-1,-1,-1]),Int32Array.from([6,34,62,-1,-1,-1,-1]),Int32Array.from([6,26,46,66,-1,-1,-1]),Int32Array.from([6,26,48,70,-1,-1,-1]),Int32Array.from([6,26,50,74,-1,-1,-1]),Int32Array.from([6,30,54,78,-1,-1,-1]),Int32Array.from([6,30,56,82,-1,-1,-1]),Int32Array.from([6,30,58,86,-1,-1,-1]),Int32Array.from([6,34,62,90,-1,-1,-1]),Int32Array.from([6,28,50,72,94,-1,-1]),Int32Array.from([6,26,50,74,98,-1,-1]),Int32Array.from([6,30,54,78,102,-1,-1]),Int32Array.from([6,28,54,80,106,-1,-1]),Int32Array.from([6,32,58,84,110,-1,-1]),Int32Array.from([6,30,58,86,114,-1,-1]),Int32Array.from([6,34,62,90,118,-1,-1]),Int32Array.from([6,26,50,74,98,122,-1]),Int32Array.from([6,30,54,78,102,126,-1]),Int32Array.from([6,26,52,78,104,130,-1]),Int32Array.from([6,30,56,82,108,134,-1]),Int32Array.from([6,34,60,86,112,138,-1]),Int32Array.from([6,30,58,86,114,142,-1]),Int32Array.from([6,34,62,90,118,146,-1]),Int32Array.from([6,30,54,78,102,126,150]),Int32Array.from([6,24,50,76,102,128,154]),Int32Array.from([6,28,54,80,106,132,158]),Int32Array.from([6,32,58,84,110,136,162]),Int32Array.from([6,26,54,82,110,138,166]),Int32Array.from([6,30,58,86,114,142,170])]),ve.TYPE_INFO_COORDINATES=Array.from([Int32Array.from([8,0]),Int32Array.from([8,1]),Int32Array.from([8,2]),Int32Array.from([8,3]),Int32Array.from([8,4]),Int32Array.from([8,5]),Int32Array.from([8,7]),Int32Array.from([8,8]),Int32Array.from([7,8]),Int32Array.from([5,8]),Int32Array.from([4,8]),Int32Array.from([3,8]),Int32Array.from([2,8]),Int32Array.from([1,8]),Int32Array.from([0,8])]),ve.VERSION_INFO_POLY=7973,ve.TYPE_INFO_POLY=1335,ve.TYPE_INFO_MASK_PATTERN=21522;class Wn{constructor(e,t){this.dataBytes=e,this.errorCorrectionBytes=t}getDataBytes(){return this.dataBytes}getErrorCorrectionBytes(){return this.errorCorrectionBytes}}class nt{constructor(){}static calculateMaskPenalty(e){return ft.applyMaskPenaltyRule1(e)+ft.applyMaskPenaltyRule2(e)+ft.applyMaskPenaltyRule3(e)+ft.applyMaskPenaltyRule4(e)}static encode(e,t,r=null){let s=nt.DEFAULT_BYTE_MODE_ENCODING;const n=r!==null&&r.get(yt.CHARACTER_SET)!==void 0;n&&(s=r.get(yt.CHARACTER_SET).toString());const i=this.chooseMode(e,s),o=new W;if(i===Ee.BYTE&&(n||nt.DEFAULT_BYTE_MODE_ENCODING!==s)){const te=M.getCharacterSetECIByName(s);te!==void 0&&this.appendECI(te,o)}this.appendModeInfo(i,o);const l=new W;this.appendBytes(e,i,l,s);let c;if(r!==null&&r.get(yt.QR_VERSION)!==void 0){const te=Number.parseInt(r.get(yt.QR_VERSION).toString(),10);c=ye.getVersionForNumber(te);const Z=this.calculateBitsNeeded(i,o,l,c);if(!this.willFit(Z,c,t))throw new Ke("Data too big for requested version")}else c=this.recommendVersion(t,i,o,l);const d=new W;d.appendBitArray(o);const f=i===Ee.BYTE?l.getSizeInBytes():e.length;this.appendLengthInfo(f,c,i,d),d.appendBitArray(l);const b=c.getECBlocksForLevel(t),y=c.getTotalCodewords()-b.getTotalECCodewords();this.terminateBits(y,d);const A=this.interleaveWithECBytes(d,c.getTotalCodewords(),y,b.getNumBlocks()),E=new mr;E.setECLevel(t),E.setMode(i),E.setVersion(c);const O=c.getDimensionForVersion(),F=new Jr(O,O),ee=this.chooseMaskPattern(A,t,c,F);return E.setMaskPattern(ee),ve.buildMatrix(A,t,c,ee,F),E.setMatrix(F),E}static recommendVersion(e,t,r,s){const n=this.calculateBitsNeeded(t,r,s,ye.getVersionForNumber(1)),i=this.chooseVersion(n,e),o=this.calculateBitsNeeded(t,r,s,i);return this.chooseVersion(o,e)}static calculateBitsNeeded(e,t,r,s){return t.getSize()+e.getCharacterCountBits(s)+r.getSize()}static getAlphanumericCode(e){return e<nt.ALPHANUMERIC_TABLE.length?nt.ALPHANUMERIC_TABLE[e]:-1}static chooseMode(e,t=null){if(M.SJIS.getName()===t&&this.isOnlyDoubleByteKanji(e))return Ee.KANJI;let r=!1,s=!1;for(let n=0,i=e.length;n<i;++n){const o=e.charAt(n);if(nt.isDigit(o))r=!0;else if(this.getAlphanumericCode(o.charCodeAt(0))!==-1)s=!0;else return Ee.BYTE}return s?Ee.ALPHANUMERIC:r?Ee.NUMERIC:Ee.BYTE}static isOnlyDoubleByteKanji(e){let t;try{t=pe.encode(e,M.SJIS)}catch{return!1}const r=t.length;if(r%2!==0)return!1;for(let s=0;s<r;s+=2){const n=t[s]&255;if((n<129||n>159)&&(n<224||n>235))return!1}return!0}static chooseMaskPattern(e,t,r,s){let n=Number.MAX_SAFE_INTEGER,i=-1;for(let o=0;o<mr.NUM_MASK_PATTERNS;o++){ve.buildMatrix(e,t,r,o,s);let l=this.calculateMaskPenalty(s);l<n&&(n=l,i=o)}return i}static chooseVersion(e,t){for(let r=1;r<=40;r++){const s=ye.getVersionForNumber(r);if(nt.willFit(e,s,t))return s}throw new Ke("Data too big")}static willFit(e,t,r){const s=t.getTotalCodewords(),i=t.getECBlocksForLevel(r).getTotalECCodewords(),o=s-i,l=(e+7)/8;return o>=l}static terminateBits(e,t){const r=e*8;if(t.getSize()>r)throw new Ke("data bits cannot fit in the QR Code"+t.getSize()+" > "+r);for(let i=0;i<4&&t.getSize()<r;++i)t.appendBit(!1);const s=t.getSize()&7;if(s>0)for(let i=s;i<8;i++)t.appendBit(!1);const n=e-t.getSizeInBytes();for(let i=0;i<n;++i)t.appendBits((i&1)===0?236:17,8);if(t.getSize()!==r)throw new Ke("Bits size does not equal capacity")}static getNumDataBytesAndNumECBytesForBlockID(e,t,r,s,n,i){if(s>=r)throw new Ke("Block ID too large");const o=e%r,l=r-o,c=Math.floor(e/r),d=c+1,f=Math.floor(t/r),b=f+1,y=c-f,A=d-b;if(y!==A)throw new Ke("EC bytes mismatch");if(r!==l+o)throw new Ke("RS blocks mismatch");if(e!==(f+y)*l+(b+A)*o)throw new Ke("Total bytes mismatch");s<l?(n[0]=f,i[0]=y):(n[0]=b,i[0]=A)}static interleaveWithECBytes(e,t,r,s){if(e.getSizeInBytes()!==r)throw new Ke("Number of bits and data bytes does not match");let n=0,i=0,o=0;const l=new Array;for(let d=0;d<s;++d){const f=new Int32Array(1),b=new Int32Array(1);nt.getNumDataBytesAndNumECBytesForBlockID(t,r,s,d,f,b);const y=f[0],A=new Uint8Array(y);e.toBytes(8*n,A,0,y);const E=nt.generateECBytes(A,b[0]);l.push(new Wn(A,E)),i=Math.max(i,y),o=Math.max(o,E.length),n+=f[0]}if(r!==n)throw new Ke("Data bytes does not match offset");const c=new W;for(let d=0;d<i;++d)for(const f of l){const b=f.getDataBytes();d<b.length&&c.appendBits(b[d],8)}for(let d=0;d<o;++d)for(const f of l){const b=f.getErrorCorrectionBytes();d<b.length&&c.appendBits(b[d],8)}if(t!==c.getSizeInBytes())throw new Ke("Interleaving error: "+t+" and "+c.getSizeInBytes()+" differ.");return c}static generateECBytes(e,t){const r=e.length,s=new Int32Array(r+t);for(let i=0;i<r;i++)s[i]=e[i]&255;new ps(se.QR_CODE_FIELD_256).encode(s,t);const n=new Uint8Array(t);for(let i=0;i<t;i++)n[i]=s[r+i];return n}static appendModeInfo(e,t){t.appendBits(e.getBits(),4)}static appendLengthInfo(e,t,r,s){const n=r.getCharacterCountBits(t);if(e>=1<<n)throw new Ke(e+" is bigger than "+((1<<n)-1));s.appendBits(e,n)}static appendBytes(e,t,r,s){switch(t){case Ee.NUMERIC:nt.appendNumericBytes(e,r);break;case Ee.ALPHANUMERIC:nt.appendAlphanumericBytes(e,r);break;case Ee.BYTE:nt.append8BitBytes(e,r,s);break;case Ee.KANJI:nt.appendKanjiBytes(e,r);break;default:throw new Ke("Invalid mode: "+t)}}static getDigit(e){return e.charCodeAt(0)-48}static isDigit(e){const t=nt.getDigit(e);return t>=0&&t<=9}static appendNumericBytes(e,t){const r=e.length;let s=0;for(;s<r;){const n=nt.getDigit(e.charAt(s));if(s+2<r){const i=nt.getDigit(e.charAt(s+1)),o=nt.getDigit(e.charAt(s+2));t.appendBits(n*100+i*10+o,10),s+=3}else if(s+1<r){const i=nt.getDigit(e.charAt(s+1));t.appendBits(n*10+i,7),s+=2}else t.appendBits(n,4),s++}}static appendAlphanumericBytes(e,t){const r=e.length;let s=0;for(;s<r;){const n=nt.getAlphanumericCode(e.charCodeAt(s));if(n===-1)throw new Ke;if(s+1<r){const i=nt.getAlphanumericCode(e.charCodeAt(s+1));if(i===-1)throw new Ke;t.appendBits(n*45+i,11),s+=2}else t.appendBits(n,6),s++}}static append8BitBytes(e,t,r){let s;try{s=pe.encode(e,r)}catch(n){throw new Ke(n)}for(let n=0,i=s.length;n!==i;n++){const o=s[n];t.appendBits(o,8)}}static appendKanjiBytes(e,t){let r;try{r=pe.encode(e,M.SJIS)}catch(n){throw new Ke(n)}const s=r.length;for(let n=0;n<s;n+=2){const i=r[n]&255,o=r[n+1]&255,l=i<<8&4294967295|o;let c=-1;if(l>=33088&&l<=40956?c=l-33088:l>=57408&&l<=60351&&(c=l-49472),c===-1)throw new Ke("Invalid byte sequence");const d=(c>>8)*192+(c&255);t.appendBits(d,13)}}static appendECI(e,t){t.appendBits(Ee.ECI.getBits(),4),t.appendBits(e.getValue(),8)}}nt.ALPHANUMERIC_TABLE=Int32Array.from([-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,36,-1,-1,-1,37,38,-1,-1,-1,-1,39,40,-1,41,42,43,0,1,2,3,4,5,6,7,8,9,44,-1,-1,-1,-1,-1,-1,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,-1,-1,-1,-1,-1]),nt.DEFAULT_BYTE_MODE_ENCODING=M.UTF8.getName();class br{write(e,t,r,s=null){if(e.length===0)throw new _("Found empty contents");if(t<0||r<0)throw new _("Requested dimensions are too small: "+t+"x"+r);let n=tt.L,i=br.QUIET_ZONE_SIZE;s!==null&&(s.get(yt.ERROR_CORRECTION)!==void 0&&(n=tt.fromString(s.get(yt.ERROR_CORRECTION).toString())),s.get(yt.MARGIN)!==void 0&&(i=Number.parseInt(s.get(yt.MARGIN).toString(),10)));const o=nt.encode(e,n,s);return this.renderResult(o,t,r,i)}writeToDom(e,t,r,s,n=null){typeof e=="string"&&(e=document.querySelector(e));const i=this.write(t,r,s,n);e&&e.appendChild(i)}renderResult(e,t,r,s){const n=e.getMatrix();if(n===null)throw new _e;const i=n.getWidth(),o=n.getHeight(),l=i+s*2,c=o+s*2,d=Math.max(t,l),f=Math.max(r,c),b=Math.min(Math.floor(d/l),Math.floor(f/c)),y=Math.floor((d-i*b)/2),A=Math.floor((f-o*b)/2),E=this.createSVGElement(d,f);for(let O=0,F=A;O<o;O++,F+=b)for(let ee=0,te=y;ee<i;ee++,te+=b)if(n.get(ee,O)===1){const Z=this.createSvgRectElement(te,F,b,b);E.appendChild(Z)}return E}createSVGElement(e,t){const r=document.createElementNS(br.SVG_NS,"svg");return r.setAttributeNS(null,"height",e.toString()),r.setAttributeNS(null,"width",t.toString()),r}createSvgRectElement(e,t,r,s){const n=document.createElementNS(br.SVG_NS,"rect");return n.setAttributeNS(null,"x",e.toString()),n.setAttributeNS(null,"y",t.toString()),n.setAttributeNS(null,"height",r.toString()),n.setAttributeNS(null,"width",s.toString()),n.setAttributeNS(null,"fill","#000000"),n}}br.QUIET_ZONE_SIZE=4,br.SVG_NS="http://www.w3.org/2000/svg";class Ir{encode(e,t,r,s,n){if(e.length===0)throw new _("Found empty contents");if(t!==le.QR_CODE)throw new _("Can only encode QR_CODE, but got "+t);if(r<0||s<0)throw new _(`Requested dimensions are too small: ${r}x${s}`);let i=tt.L,o=Ir.QUIET_ZONE_SIZE;n!==null&&(n.get(yt.ERROR_CORRECTION)!==void 0&&(i=tt.fromString(n.get(yt.ERROR_CORRECTION).toString())),n.get(yt.MARGIN)!==void 0&&(o=Number.parseInt(n.get(yt.MARGIN).toString(),10)));const l=nt.encode(e,i,n);return Ir.renderResult(l,r,s,o)}static renderResult(e,t,r,s){const n=e.getMatrix();if(n===null)throw new _e;const i=n.getWidth(),o=n.getHeight(),l=i+s*2,c=o+s*2,d=Math.max(t,l),f=Math.max(r,c),b=Math.min(Math.floor(d/l),Math.floor(f/c)),y=Math.floor((d-i*b)/2),A=Math.floor((f-o*b)/2),E=new ge(d,f);for(let O=0,F=A;O<o;O++,F+=b)for(let ee=0,te=y;ee<i;ee++,te+=b)n.get(ee,O)===1&&E.setRegion(te,F,b,b);return E}}Ir.QUIET_ZONE_SIZE=4;class Xn{encode(e,t,r,s,n){let i;switch(t){case le.QR_CODE:i=new Ir;break;default:throw new _("No encoder available for format "+t)}return i.encode(e,t,r,s,n)}}class tr extends Ne{constructor(e,t,r,s,n,i,o,l){if(super(i,o),this.yuvData=e,this.dataWidth=t,this.dataHeight=r,this.left=s,this.top=n,s+i>t||n+o>r)throw new _("Crop rectangle does not fit within image data.");l&&this.reverseHorizontal(i,o)}getRow(e,t){if(e<0||e>=this.getHeight())throw new _("Requested row is outside the image: "+e);const r=this.getWidth();(t==null||t.length<r)&&(t=new Uint8ClampedArray(r));const s=(e+this.top)*this.dataWidth+this.left;return K.arraycopy(this.yuvData,s,t,0,r),t}getMatrix(){const e=this.getWidth(),t=this.getHeight();if(e===this.dataWidth&&t===this.dataHeight)return this.yuvData;const r=e*t,s=new Uint8ClampedArray(r);let n=this.top*this.dataWidth+this.left;if(e===this.dataWidth)return K.arraycopy(this.yuvData,n,s,0,r),s;for(let i=0;i<t;i++){const o=i*e;K.arraycopy(this.yuvData,n,s,o,e),n+=this.dataWidth}return s}isCropSupported(){return!0}crop(e,t,r,s){return new tr(this.yuvData,this.dataWidth,this.dataHeight,this.left+e,this.top+t,r,s,!1)}renderThumbnail(){const e=this.getWidth()/tr.THUMBNAIL_SCALE_FACTOR,t=this.getHeight()/tr.THUMBNAIL_SCALE_FACTOR,r=new Int32Array(e*t),s=this.yuvData;let n=this.top*this.dataWidth+this.left;for(let i=0;i<t;i++){const o=i*e;for(let l=0;l<e;l++){const c=s[n+l*tr.THUMBNAIL_SCALE_FACTOR]&255;r[o+l]=4278190080|c*65793}n+=this.dataWidth*tr.THUMBNAIL_SCALE_FACTOR}return r}getThumbnailWidth(){return this.getWidth()/tr.THUMBNAIL_SCALE_FACTOR}getThumbnailHeight(){return this.getHeight()/tr.THUMBNAIL_SCALE_FACTOR}reverseHorizontal(e,t){const r=this.yuvData;for(let s=0,n=this.top*this.dataWidth+this.left;s<t;s++,n+=this.dataWidth){const i=n+e/2;for(let o=n,l=n+e-1;o<i;o++,l--){const c=r[o];r[o]=r[l],r[l]=c}}}invert(){return new Oe(this)}}tr.THUMBNAIL_SCALE_FACTOR=2;class ws extends Ne{constructor(e,t,r,s,n,i,o){if(super(t,r),this.dataWidth=s,this.dataHeight=n,this.left=i,this.top=o,e.BYTES_PER_ELEMENT===4){const l=t*r,c=new Uint8ClampedArray(l);for(let d=0;d<l;d++){const f=e[d],b=f>>16&255,y=f>>7&510,A=f&255;c[d]=(b+y+A)/4&255}this.luminances=c}else this.luminances=e;if(s===void 0&&(this.dataWidth=t),n===void 0&&(this.dataHeight=r),i===void 0&&(this.left=0),o===void 0&&(this.top=0),this.left+t>this.dataWidth||this.top+r>this.dataHeight)throw new _("Crop rectangle does not fit within image data.")}getRow(e,t){if(e<0||e>=this.getHeight())throw new _("Requested row is outside the image: "+e);const r=this.getWidth();(t==null||t.length<r)&&(t=new Uint8ClampedArray(r));const s=(e+this.top)*this.dataWidth+this.left;return K.arraycopy(this.luminances,s,t,0,r),t}getMatrix(){const e=this.getWidth(),t=this.getHeight();if(e===this.dataWidth&&t===this.dataHeight)return this.luminances;const r=e*t,s=new Uint8ClampedArray(r);let n=this.top*this.dataWidth+this.left;if(e===this.dataWidth)return K.arraycopy(this.luminances,n,s,0,r),s;for(let i=0;i<t;i++){const o=i*e;K.arraycopy(this.luminances,n,s,o,e),n+=this.dataWidth}return s}isCropSupported(){return!0}crop(e,t,r,s){return new ws(this.luminances,r,s,this.dataWidth,this.dataHeight,this.left+e,this.top+t)}invert(){return new Oe(this)}}class zs extends M{static forName(e){return this.getCharacterSetECIByName(e)}}class Cs{}Cs.ISO_8859_1=M.ISO8859_1;class Ys{isCompact(){return this.compact}setCompact(e){this.compact=e}getSize(){return this.size}setSize(e){this.size=e}getLayers(){return this.layers}setLayers(e){this.layers=e}getCodeWords(){return this.codeWords}setCodeWords(e){this.codeWords=e}getMatrix(){return this.matrix}setMatrix(e){this.matrix=e}}class qs{static singletonList(e){return[e]}static min(e,t){return e.sort(t)[0]}}class zn{constructor(e){this.previous=e}getPrevious(){return this.previous}}class Sr extends zn{constructor(e,t,r){super(e),this.value=t,this.bitCount=r}appendTo(e,t){e.appendBits(this.value,this.bitCount)}add(e,t){return new Sr(this,e,t)}addBinaryShift(e,t){return console.warn("addBinaryShift on SimpleToken, this simply returns a copy of this token"),new Sr(this,e,t)}toString(){let e=this.value&(1<<this.bitCount)-1;return e|=1<<this.bitCount,"<"+I.toBinaryString(e|1<<this.bitCount).substring(1)+">"}}class Ns extends Sr{constructor(e,t,r){super(e,0,0),this.binaryShiftStart=t,this.binaryShiftByteCount=r}appendTo(e,t){for(let r=0;r<this.binaryShiftByteCount;r++)(r===0||r===31&&this.binaryShiftByteCount<=62)&&(e.appendBits(31,5),this.binaryShiftByteCount>62?e.appendBits(this.binaryShiftByteCount-31,16):r===0?e.appendBits(Math.min(this.binaryShiftByteCount,31),5):e.appendBits(this.binaryShiftByteCount-31,5)),e.appendBits(t[this.binaryShiftStart+r],8)}addBinaryShift(e,t){return new Ns(this,e,t)}toString(){return"<"+this.binaryShiftStart+"::"+(this.binaryShiftStart+this.binaryShiftByteCount-1)+">"}}function Yn(u,e,t){return new Ns(u,e,t)}function Ur(u,e,t){return new Sr(u,e,t)}const qn=["UPPER","LOWER","DIGIT","MIXED","PUNCT"],hr=0,$r=1,qt=2,Ks=3,rr=4,Kn=new Sr(null,0,0),ys=[Int32Array.from([0,(5<<16)+28,(5<<16)+30,(5<<16)+29,656318]),Int32Array.from([(9<<16)+480+14,0,(5<<16)+30,(5<<16)+29,656318]),Int32Array.from([(4<<16)+14,(9<<16)+448+28,0,(9<<16)+448+29,932798]),Int32Array.from([(5<<16)+29,(5<<16)+28,656318,0,(5<<16)+30]),Int32Array.from([(5<<16)+31,656380,656382,656381,0])];function Zn(u){for(let e of u)X.fill(e,-1);return u[hr][rr]=0,u[$r][rr]=0,u[$r][hr]=28,u[Ks][rr]=0,u[qt][rr]=0,u[qt][hr]=15,u}const Zs=Zn(X.createInt32Array(6,6));class sr{constructor(e,t,r,s){this.token=e,this.mode=t,this.binaryShiftByteCount=r,this.bitCount=s}getMode(){return this.mode}getToken(){return this.token}getBinaryShiftByteCount(){return this.binaryShiftByteCount}getBitCount(){return this.bitCount}latchAndAppend(e,t){let r=this.bitCount,s=this.token;if(e!==this.mode){let i=ys[this.mode][e];s=Ur(s,i&65535,i>>16),r+=i>>16}let n=e===qt?4:5;return s=Ur(s,t,n),new sr(s,e,0,r+n)}shiftAndAppend(e,t){let r=this.token,s=this.mode===qt?4:5;return r=Ur(r,Zs[this.mode][e],s),r=Ur(r,t,5),new sr(r,this.mode,0,this.bitCount+s+5)}addBinaryShiftChar(e){let t=this.token,r=this.mode,s=this.bitCount;if(this.mode===rr||this.mode===qt){let o=ys[r][hr];t=Ur(t,o&65535,o>>16),s+=o>>16,r=hr}let n=this.binaryShiftByteCount===0||this.binaryShiftByteCount===31?18:this.binaryShiftByteCount===62?9:8,i=new sr(t,r,this.binaryShiftByteCount+1,s+n);return i.binaryShiftByteCount===2078&&(i=i.endBinaryShift(e+1)),i}endBinaryShift(e){if(this.binaryShiftByteCount===0)return this;let t=this.token;return t=Yn(t,e-this.binaryShiftByteCount,this.binaryShiftByteCount),new sr(t,this.mode,0,this.bitCount)}isBetterThanOrEqualTo(e){let t=this.bitCount+(ys[this.mode][e.mode]>>16);return this.binaryShiftByteCount<e.binaryShiftByteCount?t+=sr.calculateBinaryShiftCost(e)-sr.calculateBinaryShiftCost(this):this.binaryShiftByteCount>e.binaryShiftByteCount&&e.binaryShiftByteCount>0&&(t+=10),t<=e.bitCount}toBitArray(e){let t=[];for(let s=this.endBinaryShift(e.length).token;s!==null;s=s.getPrevious())t.unshift(s);let r=new W;for(const s of t)s.appendTo(r,e);return r}toString(){return G.format("%s bits=%d bytes=%d",qn[this.mode],this.bitCount,this.binaryShiftByteCount)}static calculateBinaryShiftCost(e){return e.binaryShiftByteCount>62?21:e.binaryShiftByteCount>31?20:e.binaryShiftByteCount>0?10:0}}sr.INITIAL_STATE=new sr(Kn,hr,0,0);function Qn(u){const e=G.getCharCode(" "),t=G.getCharCode("."),r=G.getCharCode(",");u[hr][e]=1;const s=G.getCharCode("Z"),n=G.getCharCode("A");for(let b=n;b<=s;b++)u[hr][b]=b-n+2;u[$r][e]=1;const i=G.getCharCode("z"),o=G.getCharCode("a");for(let b=o;b<=i;b++)u[$r][b]=b-o+2;u[qt][e]=1;const l=G.getCharCode("9"),c=G.getCharCode("0");for(let b=c;b<=l;b++)u[qt][b]=b-c+2;u[qt][r]=12,u[qt][t]=13;const d=["\0"," ","","","","","","","\x07","\b","	",`
`,"\v","\f","\r","\x1B","","","","","@","\\","^","_","`","|","~",""];for(let b=0;b<d.length;b++)u[Ks][G.getCharCode(d[b])]=b;const f=["\0","\r","\0","\0","\0","\0","!","'","#","$","%","&","'","(",")","*","+",",","-",".","/",":",";","<","=",">","?","[","]","{","}"];for(let b=0;b<f.length;b++)G.getCharCode(f[b])>0&&(u[rr][G.getCharCode(f[b])]=b);return u}const As=Qn(X.createInt32Array(5,256));class Vr{constructor(e){this.text=e}encode(){const e=G.getCharCode(" "),t=G.getCharCode(`
`);let r=qs.singletonList(sr.INITIAL_STATE);for(let n=0;n<this.text.length;n++){let i,o=n+1<this.text.length?this.text[n+1]:0;switch(this.text[n]){case G.getCharCode("\r"):i=o===t?2:0;break;case G.getCharCode("."):i=o===e?3:0;break;case G.getCharCode(","):i=o===e?4:0;break;case G.getCharCode(":"):i=o===e?5:0;break;default:i=0}i>0?(r=Vr.updateStateListForPair(r,n,i),n++):r=this.updateStateListForChar(r,n)}return qs.min(r,(n,i)=>n.getBitCount()-i.getBitCount()).toBitArray(this.text)}updateStateListForChar(e,t){const r=[];for(let s of e)this.updateStateForChar(s,t,r);return Vr.simplifyStates(r)}updateStateForChar(e,t,r){let s=this.text[t]&255,n=As[e.getMode()][s]>0,i=null;for(let o=0;o<=rr;o++){let l=As[o][s];if(l>0){if(i==null&&(i=e.endBinaryShift(t)),!n||o===e.getMode()||o===qt){const c=i.latchAndAppend(o,l);r.push(c)}if(!n&&Zs[e.getMode()][o]>=0){const c=i.shiftAndAppend(o,l);r.push(c)}}}if(e.getBinaryShiftByteCount()>0||As[e.getMode()][s]===0){let o=e.addBinaryShiftChar(t);r.push(o)}}static updateStateListForPair(e,t,r){const s=[];for(let n of e)this.updateStateForPair(n,t,r,s);return this.simplifyStates(s)}static updateStateForPair(e,t,r,s){let n=e.endBinaryShift(t);if(s.push(n.latchAndAppend(rr,r)),e.getMode()!==rr&&s.push(n.shiftAndAppend(rr,r)),r===3||r===4){let i=n.latchAndAppend(qt,16-r).latchAndAppend(qt,1);s.push(i)}if(e.getBinaryShiftByteCount()>0){let i=e.addBinaryShiftChar(t).addBinaryShiftChar(t+1);s.push(i)}}static simplifyStates(e){let t=[];for(const r of e){let s=!0;for(const n of t){if(n.isBetterThanOrEqualTo(r)){s=!1;break}r.isBetterThanOrEqualTo(n)&&(t=t.filter(i=>i!==n))}s&&t.push(r)}return t}}class He{constructor(){}static encodeBytes(e){return He.encode(e,He.DEFAULT_EC_PERCENT,He.DEFAULT_AZTEC_LAYERS)}static encode(e,t,r){let s=new Vr(e).encode(),n=I.truncDivision(s.getSize()*t,100)+11,i=s.getSize()+n,o,l,c,d,f;if(r!==He.DEFAULT_AZTEC_LAYERS){if(o=r<0,l=Math.abs(r),l>(o?He.MAX_NB_BITS_COMPACT:He.MAX_NB_BITS))throw new _(G.format("Illegal value %s for layers",r));c=He.totalBitsInLayer(l,o),d=He.WORD_SIZE[l];let Z=c-c%d;if(f=He.stuffBits(s,d),f.getSize()+n>Z)throw new _("Data to large for user specified layer");if(o&&f.getSize()>d*64)throw new _("Data to large for user specified layer")}else{d=0,f=null;for(let Z=0;;Z++){if(Z>He.MAX_NB_BITS)throw new _("Data too large for an Aztec code");if(o=Z<=3,l=o?Z+1:Z,c=He.totalBitsInLayer(l,o),i>c)continue;(f==null||d!==He.WORD_SIZE[l])&&(d=He.WORD_SIZE[l],f=He.stuffBits(s,d));let Le=c-c%d;if(!(o&&f.getSize()>d*64)&&f.getSize()+n<=Le)break}}let b=He.generateCheckWords(f,c,d),y=f.getSize()/d,A=He.generateModeMessage(o,l,y),E=(o?11:14)+l*4,O=new Int32Array(E),F;if(o){F=E;for(let Z=0;Z<O.length;Z++)O[Z]=Z}else{F=E+1+2*I.truncDivision(I.truncDivision(E,2)-1,15);let Z=I.truncDivision(E,2),Le=I.truncDivision(F,2);for(let Re=0;Re<Z;Re++){let Lt=Re+I.truncDivision(Re,15);O[Z-Re-1]=Le-Lt-1,O[Z+Re]=Le+Lt+1}}let ee=new ge(F);for(let Z=0,Le=0;Z<l;Z++){let Re=(l-Z)*4+(o?9:12);for(let Lt=0;Lt<Re;Lt++){let Zt=Lt*2;for(let Ft=0;Ft<2;Ft++)b.get(Le+Zt+Ft)&&ee.set(O[Z*2+Ft],O[Z*2+Lt]),b.get(Le+Re*2+Zt+Ft)&&ee.set(O[Z*2+Lt],O[E-1-Z*2-Ft]),b.get(Le+Re*4+Zt+Ft)&&ee.set(O[E-1-Z*2-Ft],O[E-1-Z*2-Lt]),b.get(Le+Re*6+Zt+Ft)&&ee.set(O[E-1-Z*2-Lt],O[Z*2+Ft])}Le+=Re*8}if(He.drawModeMessage(ee,o,F,A),o)He.drawBullsEye(ee,I.truncDivision(F,2),5);else{He.drawBullsEye(ee,I.truncDivision(F,2),7);for(let Z=0,Le=0;Z<I.truncDivision(E,2)-1;Z+=15,Le+=16)for(let Re=I.truncDivision(F,2)&1;Re<F;Re+=2)ee.set(I.truncDivision(F,2)-Le,Re),ee.set(I.truncDivision(F,2)+Le,Re),ee.set(Re,I.truncDivision(F,2)-Le),ee.set(Re,I.truncDivision(F,2)+Le)}let te=new Ys;return te.setCompact(o),te.setSize(F),te.setLayers(l),te.setCodeWords(y),te.setMatrix(ee),te}static drawBullsEye(e,t,r){for(let s=0;s<r;s+=2)for(let n=t-s;n<=t+s;n++)e.set(n,t-s),e.set(n,t+s),e.set(t-s,n),e.set(t+s,n);e.set(t-r,t-r),e.set(t-r+1,t-r),e.set(t-r,t-r+1),e.set(t+r,t-r),e.set(t+r,t-r+1),e.set(t+r,t+r-1)}static generateModeMessage(e,t,r){let s=new W;return e?(s.appendBits(t-1,2),s.appendBits(r-1,6),s=He.generateCheckWords(s,28,4)):(s.appendBits(t-1,5),s.appendBits(r-1,11),s=He.generateCheckWords(s,40,4)),s}static drawModeMessage(e,t,r,s){let n=I.truncDivision(r,2);if(t)for(let i=0;i<7;i++){let o=n-3+i;s.get(i)&&e.set(o,n-5),s.get(i+7)&&e.set(n+5,o),s.get(20-i)&&e.set(o,n+5),s.get(27-i)&&e.set(n-5,o)}else for(let i=0;i<10;i++){let o=n-5+i+I.truncDivision(i,5);s.get(i)&&e.set(o,n-7),s.get(i+10)&&e.set(n+7,o),s.get(29-i)&&e.set(o,n+7),s.get(39-i)&&e.set(n-7,o)}}static generateCheckWords(e,t,r){let s=e.getSize()/r,n=new ps(He.getGF(r)),i=I.truncDivision(t,r),o=He.bitsToWords(e,r,i);n.encode(o,i-s);let l=t%r,c=new W;c.appendBits(0,l);for(const d of Array.from(o))c.appendBits(d,r);return c}static bitsToWords(e,t,r){let s=new Int32Array(r),n,i;for(n=0,i=e.getSize()/t;n<i;n++){let o=0;for(let l=0;l<t;l++)o|=e.get(n*t+l)?1<<t-l-1:0;s[n]=o}return s}static getGF(e){switch(e){case 4:return se.AZTEC_PARAM;case 6:return se.AZTEC_DATA_6;case 8:return se.AZTEC_DATA_8;case 10:return se.AZTEC_DATA_10;case 12:return se.AZTEC_DATA_12;default:throw new _("Unsupported word size "+e)}}static stuffBits(e,t){let r=new W,s=e.getSize(),n=(1<<t)-2;for(let i=0;i<s;i+=t){let o=0;for(let l=0;l<t;l++)(i+l>=s||e.get(i+l))&&(o|=1<<t-1-l);(o&n)===n?(r.appendBits(o&n,t),i--):(o&n)===0?(r.appendBits(o|1,t),i--):r.appendBits(o,t)}return r}static totalBitsInLayer(e,t){return((t?88:112)+16*e)*e}}He.DEFAULT_EC_PERCENT=33,He.DEFAULT_AZTEC_LAYERS=0,He.MAX_NB_BITS=32,He.MAX_NB_BITS_COMPACT=4,He.WORD_SIZE=Int32Array.from([4,6,6,8,8,8,8,8,8,10,10,10,10,10,10,10,10,10,10,10,10,10,10,12,12,12,12,12,12,12,12,12,12]);class es{encode(e,t,r,s){return this.encodeWithHints(e,t,r,s,null)}encodeWithHints(e,t,r,s,n){let i=Cs.ISO_8859_1,o=He.DEFAULT_EC_PERCENT,l=He.DEFAULT_AZTEC_LAYERS;return n!=null&&(n.has(yt.CHARACTER_SET)&&(i=zs.forName(n.get(yt.CHARACTER_SET).toString())),n.has(yt.ERROR_CORRECTION)&&(o=I.parseInt(n.get(yt.ERROR_CORRECTION).toString())),n.has(yt.AZTEC_LAYERS)&&(l=I.parseInt(n.get(yt.AZTEC_LAYERS).toString()))),es.encodeLayers(e,t,r,s,i,o,l)}static encodeLayers(e,t,r,s,n,i,o){if(t!==le.AZTEC)throw new _("Can only encode AZTEC, but got "+t);let l=He.encode(G.getBytes(e,n),i,o);return es.renderResult(l,r,s)}static renderResult(e,t,r){let s=e.getMatrix();if(s==null)throw new _e;let n=s.getWidth(),i=s.getHeight(),o=Math.max(t,n),l=Math.max(r,i),c=Math.min(o/n,l/i),d=(o-n*c)/2,f=(l-i*c)/2,b=new ge(o,l);for(let y=0,A=f;y<i;y++,A+=c)for(let E=0,O=d;E<n;E++,O+=c)s.get(E,y)&&b.setRegion(O,A,c,c);return b}}h.AbstractExpandedDecoder=Rt,h.ArgumentException=R,h.ArithmeticException=de,h.AztecCode=Ys,h.AztecCodeReader=Ar,h.AztecCodeWriter=es,h.AztecDecoder=De,h.AztecDetector=Mr,h.AztecDetectorResult=zr,h.AztecEncoder=He,h.AztecHighLevelEncoder=Vr,h.AztecPoint=vt,h.BarcodeFormat=le,h.Binarizer=q,h.BinaryBitmap=ne,h.BitArray=W,h.BitMatrix=ge,h.BitSource=us,h.BrowserAztecCodeReader=ls,h.BrowserBarcodeReader=Sn,h.BrowserCodeReader=Je,h.BrowserDatamatrixCodeReader=_n,h.BrowserMultiFormatReader=Vn,h.BrowserPDF417Reader=Hn,h.BrowserQRCodeReader=Gn,h.BrowserQRCodeSvgWriter=br,h.CharacterSetECI=M,h.ChecksumException=$,h.Code128Reader=ae,h.Code39Reader=ut,h.DataMatrixDecodedBitStreamParser=or,h.DataMatrixReader=lr,h.DecodeHintType=re,h.DecoderResult=ot,h.DefaultGridSampler=yr,h.DetectorResult=xr,h.EAN13Reader=Ct,h.EncodeHintType=yt,h.Exception=C,h.FormatException=S,h.GenericGF=se,h.GenericGFPoly=T,h.GlobalHistogramBinarizer=Ce,h.GridSampler=Nr,h.GridSamplerInstance=Qt,h.HTMLCanvasElementLuminanceSource=Qe,h.HybridBinarizer=J,h.ITFReader=v,h.IllegalArgumentException=_,h.IllegalStateException=_e,h.InvertedLuminanceSource=Oe,h.LuminanceSource=Ne,h.MathUtils=Be,h.MultiFormatOneDReader=kr,h.MultiFormatReader=Xs,h.MultiFormatWriter=Xn,h.NotFoundException=j,h.OneDReader=lt,h.PDF417DecodedBitStreamParser=L,h.PDF417DecoderErrorCorrection=Fs,h.PDF417Reader=St,h.PDF417ResultMetadata=Vs,h.PerspectiveTransform=Ut,h.PlanarYUVLuminanceSource=tr,h.QRCodeByteMatrix=Jr,h.QRCodeDataMask=zt,h.QRCodeDecodedBitStreamParser=ct,h.QRCodeDecoderErrorCorrectionLevel=tt,h.QRCodeDecoderFormatInformation=Ot,h.QRCodeEncoder=nt,h.QRCodeEncoderQRCode=mr,h.QRCodeMaskUtil=ft,h.QRCodeMatrixUtil=ve,h.QRCodeMode=Ee,h.QRCodeReader=cr,h.QRCodeVersion=ye,h.QRCodeWriter=Ir,h.RGBLuminanceSource=ws,h.RSS14Reader=xt,h.RSSExpandedReader=Y,h.ReaderException=Qr,h.ReedSolomonDecoder=st,h.ReedSolomonEncoder=ps,h.ReedSolomonException=ke,h.Result=z,h.ResultMetadataType=Ge,h.ResultPoint=ue,h.StringUtils=G,h.UnsupportedOperationException=xe,h.VideoInputDevice=rt,h.WhiteRectangleDetector=Kt,h.WriterException=Ke,h.ZXingArrays=X,h.ZXingCharset=zs,h.ZXingInteger=I,h.ZXingStandardCharsets=Cs,h.ZXingStringBuilder=ie,h.ZXingStringEncoding=pe,h.ZXingSystem=K,h.createAbstractExpandedDecoder=Bs,Object.defineProperty(h,"__esModule",{value:!0})}))})(Hr,Hr.exports)),Hr.exports}var it=ji();const Di=si(it),Pi=mi({__proto__:null,default:Di},[it]);var an=(function(){function x(g,h,p){if(this.formatMap=new Map([[fe.QR_CODE,it.BarcodeFormat.QR_CODE],[fe.AZTEC,it.BarcodeFormat.AZTEC],[fe.CODABAR,it.BarcodeFormat.CODABAR],[fe.CODE_39,it.BarcodeFormat.CODE_39],[fe.CODE_93,it.BarcodeFormat.CODE_93],[fe.CODE_128,it.BarcodeFormat.CODE_128],[fe.DATA_MATRIX,it.BarcodeFormat.DATA_MATRIX],[fe.MAXICODE,it.BarcodeFormat.MAXICODE],[fe.ITF,it.BarcodeFormat.ITF],[fe.EAN_13,it.BarcodeFormat.EAN_13],[fe.EAN_8,it.BarcodeFormat.EAN_8],[fe.PDF_417,it.BarcodeFormat.PDF_417],[fe.RSS_14,it.BarcodeFormat.RSS_14],[fe.RSS_EXPANDED,it.BarcodeFormat.RSS_EXPANDED],[fe.UPC_A,it.BarcodeFormat.UPC_A],[fe.UPC_E,it.BarcodeFormat.UPC_E],[fe.UPC_EAN_EXTENSION,it.BarcodeFormat.UPC_EAN_EXTENSION]]),this.reverseFormatMap=this.createReverseFormatMap(),!Pi)throw"Use html5qrcode.min.js without edit, ZXing not found.";this.verbose=h,this.logger=p;var w=this.createZXingFormats(g),m=new Map;m.set(it.DecodeHintType.POSSIBLE_FORMATS,w),m.set(it.DecodeHintType.TRY_HARDER,!1),this.hints=m}return x.prototype.decodeAsync=function(g){var h=this;return new Promise(function(p,w){try{p(h.decode(g))}catch(m){w(m)}})},x.prototype.decode=function(g){var h=new it.MultiFormatReader(this.verbose,this.hints),p=new it.HTMLCanvasElementLuminanceSource(g),w=new it.BinaryBitmap(new it.HybridBinarizer(p)),m=h.decode(w);return{text:m.text,format:Nn.create(this.toHtml5QrcodeSupportedFormats(m.format)),debugData:this.createDebugData()}},x.prototype.createReverseFormatMap=function(){var g=new Map;return this.formatMap.forEach(function(h,p,w){g.set(h,p)}),g},x.prototype.toHtml5QrcodeSupportedFormats=function(g){if(!this.reverseFormatMap.has(g))throw"reverseFormatMap doesn't have ".concat(g);return this.reverseFormatMap.get(g)},x.prototype.createZXingFormats=function(g){for(var h=[],p=0,w=g;p<w.length;p++){var m=w[p];this.formatMap.has(m)?h.push(this.formatMap.get(m)):this.logger.logError("".concat(m," is not supported by")+"ZXingHtml5QrcodeShim")}return h},x.prototype.createDebugData=function(){return{decoderName:"zxing-js"}},x})(),Bi=function(x,g,h,p){function w(m){return m instanceof h?m:new h(function(k){k(m)})}return new(h||(h=Promise))(function(m,k){function P(R){try{C(p.next(R))}catch(_){k(_)}}function B(R){try{C(p.throw(R))}catch(_){k(_)}}function C(R){R.done?m(R.value):w(R.value).then(P,B)}C((p=p.apply(x,g||[])).next())})},Li=function(x,g){var h={label:0,sent:function(){if(m[0]&1)throw m[1];return m[1]},trys:[],ops:[]},p,w,m,k;return k={next:P(0),throw:P(1),return:P(2)},typeof Symbol=="function"&&(k[Symbol.iterator]=function(){return this}),k;function P(C){return function(R){return B([C,R])}}function B(C){if(p)throw new TypeError("Generator is already executing.");for(;k&&(k=0,C[0]&&(h=0)),h;)try{if(p=1,w&&(m=C[0]&2?w.return:C[0]?w.throw||((m=w.return)&&m.call(w),0):w.next)&&!(m=m.call(w,C[1])).done)return m;switch(w=0,m&&(C=[C[0]&2,m.value]),C[0]){case 0:case 1:m=C;break;case 4:return h.label++,{value:C[1],done:!1};case 5:h.label++,w=C[1],C=[0];continue;case 7:C=h.ops.pop(),h.trys.pop();continue;default:if(m=h.trys,!(m=m.length>0&&m[m.length-1])&&(C[0]===6||C[0]===2)){h=0;continue}if(C[0]===3&&(!m||C[1]>m[0]&&C[1]<m[3])){h.label=C[1];break}if(C[0]===6&&h.label<m[1]){h.label=m[1],m=C;break}if(m&&h.label<m[2]){h.label=m[2],h.ops.push(C);break}m[2]&&h.ops.pop(),h.trys.pop();continue}C=g.call(x,h)}catch(R){C=[6,R],w=0}finally{p=m=0}if(C[0]&5)throw C[1];return{value:C[0]?C[1]:void 0,done:!0}}},on=(function(){function x(g,h,p){if(this.formatMap=new Map([[fe.QR_CODE,"qr_code"],[fe.AZTEC,"aztec"],[fe.CODABAR,"codabar"],[fe.CODE_39,"code_39"],[fe.CODE_93,"code_93"],[fe.CODE_128,"code_128"],[fe.DATA_MATRIX,"data_matrix"],[fe.ITF,"itf"],[fe.EAN_13,"ean_13"],[fe.EAN_8,"ean_8"],[fe.PDF_417,"pdf417"],[fe.UPC_A,"upc_a"],[fe.UPC_E,"upc_e"]]),this.reverseFormatMap=this.createReverseFormatMap(),!x.isSupported())throw"Use html5qrcode.min.js without edit, Use BarcodeDetectorDelegate only if it isSupported();";this.verbose=h,this.logger=p;var w=this.createBarcodeDetectorFormats(g);if(this.detector=new BarcodeDetector(w),!this.detector)throw"BarcodeDetector detector not supported"}return x.isSupported=function(){if(!("BarcodeDetector"in window))return!1;var g=new BarcodeDetector({formats:["qr_code"]});return typeof g<"u"},x.prototype.decodeAsync=function(g){return Bi(this,void 0,void 0,function(){var h,p;return Li(this,function(w){switch(w.label){case 0:return[4,this.detector.detect(g)];case 1:if(h=w.sent(),!h||h.length===0)throw"No barcode or QR code detected.";return p=this.selectLargestBarcode(h),[2,{text:p.rawValue,format:Nn.create(this.toHtml5QrcodeSupportedFormats(p.format)),debugData:this.createDebugData()}]}})})},x.prototype.selectLargestBarcode=function(g){for(var h=null,p=0,w=0,m=g;w<m.length;w++){var k=m[w],P=k.boundingBox.width*k.boundingBox.height;P>p&&(p=P,h=k)}if(!h)throw"No largest barcode found";return h},x.prototype.createBarcodeDetectorFormats=function(g){for(var h=[],p=0,w=g;p<w.length;p++){var m=w[p];this.formatMap.has(m)?h.push(this.formatMap.get(m)):this.logger.warn("".concat(m," is not supported by")+"BarcodeDetectorDelegate")}return{formats:h}},x.prototype.toHtml5QrcodeSupportedFormats=function(g){if(!this.reverseFormatMap.has(g))throw"reverseFormatMap doesn't have ".concat(g);return this.reverseFormatMap.get(g)},x.prototype.createReverseFormatMap=function(){var g=new Map;return this.formatMap.forEach(function(h,p,w){g.set(h,p)}),g},x.prototype.createDebugData=function(){return{decoderName:"BarcodeDetector"}},x})(),ln=function(x,g,h,p){function w(m){return m instanceof h?m:new h(function(k){k(m)})}return new(h||(h=Promise))(function(m,k){function P(R){try{C(p.next(R))}catch(_){k(_)}}function B(R){try{C(p.throw(R))}catch(_){k(_)}}function C(R){R.done?m(R.value):w(R.value).then(P,B)}C((p=p.apply(x,g||[])).next())})},cn=function(x,g){var h={label:0,sent:function(){if(m[0]&1)throw m[1];return m[1]},trys:[],ops:[]},p,w,m,k;return k={next:P(0),throw:P(1),return:P(2)},typeof Symbol=="function"&&(k[Symbol.iterator]=function(){return this}),k;function P(C){return function(R){return B([C,R])}}function B(C){if(p)throw new TypeError("Generator is already executing.");for(;k&&(k=0,C[0]&&(h=0)),h;)try{if(p=1,w&&(m=C[0]&2?w.return:C[0]?w.throw||((m=w.return)&&m.call(w),0):w.next)&&!(m=m.call(w,C[1])).done)return m;switch(w=0,m&&(C=[C[0]&2,m.value]),C[0]){case 0:case 1:m=C;break;case 4:return h.label++,{value:C[1],done:!1};case 5:h.label++,w=C[1],C=[0];continue;case 7:C=h.ops.pop(),h.trys.pop();continue;default:if(m=h.trys,!(m=m.length>0&&m[m.length-1])&&(C[0]===6||C[0]===2)){h=0;continue}if(C[0]===3&&(!m||C[1]>m[0]&&C[1]<m[3])){h.label=C[1];break}if(C[0]===6&&h.label<m[1]){h.label=m[1],m=C;break}if(m&&h.label<m[2]){h.label=m[2],h.ops.push(C);break}m[2]&&h.ops.pop(),h.trys.pop();continue}C=g.call(x,h)}catch(R){C=[6,R],w=0}finally{p=m=0}if(C[0]&5)throw C[1];return{value:C[0]?C[1]:void 0,done:!0}}},Fi=(function(){function x(g,h,p,w){this.EXECUTIONS_TO_REPORT_PERFORMANCE=100,this.executions=0,this.executionResults=[],this.wasPrimaryDecoderUsedInLastDecode=!1,this.verbose=p,h&&on.isSupported()?(this.primaryDecoder=new on(g,p,w),this.secondaryDecoder=new an(g,p,w)):this.primaryDecoder=new an(g,p,w)}return x.prototype.decodeAsync=function(g){return ln(this,void 0,void 0,function(){var h;return cn(this,function(p){switch(p.label){case 0:h=performance.now(),p.label=1;case 1:return p.trys.push([1,,3,4]),[4,this.getDecoder().decodeAsync(g)];case 2:return[2,p.sent()];case 3:return this.possiblyLogPerformance(h),[7];case 4:return[2]}})})},x.prototype.decodeRobustlyAsync=function(g){return ln(this,void 0,void 0,function(){var h,p;return cn(this,function(w){switch(w.label){case 0:h=performance.now(),w.label=1;case 1:return w.trys.push([1,3,4,5]),[4,this.primaryDecoder.decodeAsync(g)];case 2:return[2,w.sent()];case 3:if(p=w.sent(),this.secondaryDecoder)return[2,this.secondaryDecoder.decodeAsync(g)];throw p;case 4:return this.possiblyLogPerformance(h),[7];case 5:return[2]}})})},x.prototype.getDecoder=function(){return this.secondaryDecoder?this.wasPrimaryDecoderUsedInLastDecode===!1?(this.wasPrimaryDecoderUsedInLastDecode=!0,this.primaryDecoder):(this.wasPrimaryDecoderUsedInLastDecode=!1,this.secondaryDecoder):this.primaryDecoder},x.prototype.possiblyLogPerformance=function(g){if(this.verbose){var h=performance.now()-g;this.executionResults.push(h),this.executions++,this.possiblyFlushPerformanceReport()}},x.prototype.possiblyFlushPerformanceReport=function(){if(!(this.executions<this.EXECUTIONS_TO_REPORT_PERFORMANCE)){for(var g=0,h=0,p=this.executionResults;h<p.length;h++){var w=p[h];g+=w}var m=g/this.executionResults.length;console.log("".concat(m," ms for ").concat(this.executionResults.length," last runs.")),this.executions=0,this.executionResults=[]}},x})(),Ps=(function(){var x=function(g,h){return x=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(p,w){p.__proto__=w}||function(p,w){for(var m in w)Object.prototype.hasOwnProperty.call(w,m)&&(p[m]=w[m])},x(g,h)};return function(g,h){if(typeof h!="function"&&h!==null)throw new TypeError("Class extends value "+String(h)+" is not a constructor or null");x(g,h);function p(){this.constructor=g}g.prototype=h===null?Object.create(h):(p.prototype=h.prototype,new p)}})(),is=function(x,g,h,p){function w(m){return m instanceof h?m:new h(function(k){k(m)})}return new(h||(h=Promise))(function(m,k){function P(R){try{C(p.next(R))}catch(_){k(_)}}function B(R){try{C(p.throw(R))}catch(_){k(_)}}function C(R){R.done?m(R.value):w(R.value).then(P,B)}C((p=p.apply(x,g||[])).next())})},as=function(x,g){var h={label:0,sent:function(){if(m[0]&1)throw m[1];return m[1]},trys:[],ops:[]},p,w,m,k;return k={next:P(0),throw:P(1),return:P(2)},typeof Symbol=="function"&&(k[Symbol.iterator]=function(){return this}),k;function P(C){return function(R){return B([C,R])}}function B(C){if(p)throw new TypeError("Generator is already executing.");for(;k&&(k=0,C[0]&&(h=0)),h;)try{if(p=1,w&&(m=C[0]&2?w.return:C[0]?w.throw||((m=w.return)&&m.call(w),0):w.next)&&!(m=m.call(w,C[1])).done)return m;switch(w=0,m&&(C=[C[0]&2,m.value]),C[0]){case 0:case 1:m=C;break;case 4:return h.label++,{value:C[1],done:!1};case 5:h.label++,w=C[1],C=[0];continue;case 7:C=h.ops.pop(),h.trys.pop();continue;default:if(m=h.trys,!(m=m.length>0&&m[m.length-1])&&(C[0]===6||C[0]===2)){h=0;continue}if(C[0]===3&&(!m||C[1]>m[0]&&C[1]<m[3])){h.label=C[1];break}if(C[0]===6&&h.label<m[1]){h.label=m[1],m=C;break}if(m&&h.label<m[2]){h.label=m[2],h.ops.push(C);break}m[2]&&h.ops.pop(),h.trys.pop();continue}C=g.call(x,h)}catch(R){C=[6,R],w=0}finally{p=m=0}if(C[0]&5)throw C[1];return{value:C[0]?C[1]:void 0,done:!0}}},An=(function(){function x(g,h){this.name=g,this.track=h}return x.prototype.isSupported=function(){return this.track.getCapabilities?this.name in this.track.getCapabilities():!1},x.prototype.apply=function(g){var h={};h[this.name]=g;var p={advanced:[h]};return this.track.applyConstraints(p)},x.prototype.value=function(){var g=this.track.getSettings();if(this.name in g){var h=g[this.name];return h}return null},x})(),Ui=(function(x){Ps(g,x);function g(h,p){return x.call(this,h,p)||this}return g.prototype.min=function(){return this.getCapabilities().min},g.prototype.max=function(){return this.getCapabilities().max},g.prototype.step=function(){return this.getCapabilities().step},g.prototype.apply=function(h){var p={};p[this.name]=h;var w={advanced:[p]};return this.track.applyConstraints(w)},g.prototype.getCapabilities=function(){this.failIfNotSupported();var h=this.track.getCapabilities(),p=h[this.name];return{min:p.min,max:p.max,step:p.step}},g.prototype.failIfNotSupported=function(){if(!this.isSupported())throw new Error("".concat(this.name," capability not supported"))},g})(An),Vi=(function(x){Ps(g,x);function g(h){return x.call(this,"zoom",h)||this}return g})(Ui),Hi=(function(x){Ps(g,x);function g(h){return x.call(this,"torch",h)||this}return g})(An),Gi=(function(){function x(g){this.track=g}return x.prototype.zoomFeature=function(){return new Vi(this.track)},x.prototype.torchFeature=function(){return new Hi(this.track)},x})(),Wi=(function(){function x(g,h,p){this.isClosed=!1,this.parentElement=g,this.mediaStream=h,this.callbacks=p,this.surface=this.createVideoElement(this.parentElement.clientWidth),g.append(this.surface)}return x.prototype.createVideoElement=function(g){var h=document.createElement("video");return h.style.width="".concat(g,"px"),h.style.display="block",h.muted=!0,h.setAttribute("muted","true"),h.playsInline=!0,h},x.prototype.setupSurface=function(){var g=this;this.surface.onabort=function(){throw"RenderedCameraImpl video surface onabort() called"},this.surface.onerror=function(){throw"RenderedCameraImpl video surface onerror() called"};var h=function(){var p=g.surface.clientWidth,w=g.surface.clientHeight;g.callbacks.onRenderSurfaceReady(p,w),g.surface.removeEventListener("playing",h)};this.surface.addEventListener("playing",h),this.surface.srcObject=this.mediaStream,this.surface.play()},x.create=function(g,h,p,w){return is(this,void 0,void 0,function(){var m,k;return as(this,function(P){switch(P.label){case 0:return m=new x(g,h,w),p.aspectRatio?(k={aspectRatio:p.aspectRatio},[4,m.getFirstTrackOrFail().applyConstraints(k)]):[3,2];case 1:P.sent(),P.label=2;case 2:return m.setupSurface(),[2,m]}})})},x.prototype.failIfClosed=function(){if(this.isClosed)throw"The RenderedCamera has already been closed."},x.prototype.getFirstTrackOrFail=function(){if(this.failIfClosed(),this.mediaStream.getVideoTracks().length===0)throw"No video tracks found";return this.mediaStream.getVideoTracks()[0]},x.prototype.pause=function(){this.failIfClosed(),this.surface.pause()},x.prototype.resume=function(g){this.failIfClosed();var h=this,p=function(){setTimeout(g,200),h.surface.removeEventListener("playing",p)};this.surface.addEventListener("playing",p),this.surface.play()},x.prototype.isPaused=function(){return this.failIfClosed(),this.surface.paused},x.prototype.getSurface=function(){return this.failIfClosed(),this.surface},x.prototype.getRunningTrackCapabilities=function(){return this.getFirstTrackOrFail().getCapabilities()},x.prototype.getRunningTrackSettings=function(){return this.getFirstTrackOrFail().getSettings()},x.prototype.applyVideoConstraints=function(g){return is(this,void 0,void 0,function(){return as(this,function(h){if("aspectRatio"in g)throw"Changing 'aspectRatio' in run-time is not yet supported.";return[2,this.getFirstTrackOrFail().applyConstraints(g)]})})},x.prototype.close=function(){if(this.isClosed)return Promise.resolve();var g=this;return new Promise(function(h,p){var w=g.mediaStream.getVideoTracks(),m=w.length,k=0;g.mediaStream.getVideoTracks().forEach(function(P){g.mediaStream.removeTrack(P),P.stop(),++k,k>=m&&(g.isClosed=!0,g.parentElement.removeChild(g.surface),h())})})},x.prototype.getCapabilities=function(){return new Gi(this.getFirstTrackOrFail())},x})(),Xi=(function(){function x(g){this.mediaStream=g}return x.prototype.render=function(g,h,p){return is(this,void 0,void 0,function(){return as(this,function(w){return[2,Wi.create(g,this.mediaStream,h,p)]})})},x.create=function(g){return is(this,void 0,void 0,function(){var h,p;return as(this,function(w){switch(w.label){case 0:if(!navigator.mediaDevices)throw"navigator.mediaDevices not supported";return h={audio:!1,video:g},[4,navigator.mediaDevices.getUserMedia(h)];case 1:return p=w.sent(),[2,new x(p)]}})})},x})(),dn=function(x,g,h,p){function w(m){return m instanceof h?m:new h(function(k){k(m)})}return new(h||(h=Promise))(function(m,k){function P(R){try{C(p.next(R))}catch(_){k(_)}}function B(R){try{C(p.throw(R))}catch(_){k(_)}}function C(R){R.done?m(R.value):w(R.value).then(P,B)}C((p=p.apply(x,g||[])).next())})},hn=function(x,g){var h={label:0,sent:function(){if(m[0]&1)throw m[1];return m[1]},trys:[],ops:[]},p,w,m,k;return k={next:P(0),throw:P(1),return:P(2)},typeof Symbol=="function"&&(k[Symbol.iterator]=function(){return this}),k;function P(C){return function(R){return B([C,R])}}function B(C){if(p)throw new TypeError("Generator is already executing.");for(;k&&(k=0,C[0]&&(h=0)),h;)try{if(p=1,w&&(m=C[0]&2?w.return:C[0]?w.throw||((m=w.return)&&m.call(w),0):w.next)&&!(m=m.call(w,C[1])).done)return m;switch(w=0,m&&(C=[C[0]&2,m.value]),C[0]){case 0:case 1:m=C;break;case 4:return h.label++,{value:C[1],done:!1};case 5:h.label++,w=C[1],C=[0];continue;case 7:C=h.ops.pop(),h.trys.pop();continue;default:if(m=h.trys,!(m=m.length>0&&m[m.length-1])&&(C[0]===6||C[0]===2)){h=0;continue}if(C[0]===3&&(!m||C[1]>m[0]&&C[1]<m[3])){h.label=C[1];break}if(C[0]===6&&h.label<m[1]){h.label=m[1],m=C;break}if(m&&h.label<m[2]){h.label=m[2],h.ops.push(C);break}m[2]&&h.ops.pop(),h.trys.pop();continue}C=g.call(x,h)}catch(R){C=[6,R],w=0}finally{p=m=0}if(C[0]&5)throw C[1];return{value:C[0]?C[1]:void 0,done:!0}}},zi=(function(){function x(){}return x.failIfNotSupported=function(){return dn(this,void 0,void 0,function(){return hn(this,function(g){if(!navigator.mediaDevices)throw"navigator.mediaDevices not supported";return[2,new x]})})},x.prototype.create=function(g){return dn(this,void 0,void 0,function(){return hn(this,function(h){return[2,Xi.create(g)]})})},x})(),Yi=function(x,g,h,p){function w(m){return m instanceof h?m:new h(function(k){k(m)})}return new(h||(h=Promise))(function(m,k){function P(R){try{C(p.next(R))}catch(_){k(_)}}function B(R){try{C(p.throw(R))}catch(_){k(_)}}function C(R){R.done?m(R.value):w(R.value).then(P,B)}C((p=p.apply(x,g||[])).next())})},qi=function(x,g){var h={label:0,sent:function(){if(m[0]&1)throw m[1];return m[1]},trys:[],ops:[]},p,w,m,k;return k={next:P(0),throw:P(1),return:P(2)},typeof Symbol=="function"&&(k[Symbol.iterator]=function(){return this}),k;function P(C){return function(R){return B([C,R])}}function B(C){if(p)throw new TypeError("Generator is already executing.");for(;k&&(k=0,C[0]&&(h=0)),h;)try{if(p=1,w&&(m=C[0]&2?w.return:C[0]?w.throw||((m=w.return)&&m.call(w),0):w.next)&&!(m=m.call(w,C[1])).done)return m;switch(w=0,m&&(C=[C[0]&2,m.value]),C[0]){case 0:case 1:m=C;break;case 4:return h.label++,{value:C[1],done:!1};case 5:h.label++,w=C[1],C=[0];continue;case 7:C=h.ops.pop(),h.trys.pop();continue;default:if(m=h.trys,!(m=m.length>0&&m[m.length-1])&&(C[0]===6||C[0]===2)){h=0;continue}if(C[0]===3&&(!m||C[1]>m[0]&&C[1]<m[3])){h.label=C[1];break}if(C[0]===6&&h.label<m[1]){h.label=m[1],m=C;break}if(m&&h.label<m[2]){h.label=m[2],h.ops.push(C);break}m[2]&&h.ops.pop(),h.trys.pop();continue}C=g.call(x,h)}catch(R){C=[6,R],w=0}finally{p=m=0}if(C[0]&5)throw C[1];return{value:C[0]?C[1]:void 0,done:!0}}},Ki=(function(){function x(){}return x.retrieve=function(){if(navigator.mediaDevices)return x.getCamerasFromMediaDevices();var g=MediaStreamTrack;return MediaStreamTrack&&g.getSources?x.getCamerasFromMediaStreamTrack():x.rejectWithError()},x.rejectWithError=function(){var g=Rr.unableToQuerySupportedDevices();return x.isHttpsOrLocalhost()||(g=Rr.insecureContextCameraQueryError()),Promise.reject(g)},x.isHttpsOrLocalhost=function(){if(location.protocol==="https:")return!0;var g=location.host.split(":")[0];return g==="127.0.0.1"||g==="localhost"},x.getCamerasFromMediaDevices=function(){return Yi(this,void 0,void 0,function(){var g,h,p,w,m,k,P;return qi(this,function(B){switch(B.label){case 0:return g=function(C){for(var R=C.getVideoTracks(),_=0,ne=R;_<ne.length;_++){var $=ne[_];$.enabled=!1,$.stop(),C.removeTrack($)}},[4,navigator.mediaDevices.getUserMedia({audio:!1,video:!0})];case 1:return h=B.sent(),[4,navigator.mediaDevices.enumerateDevices()];case 2:for(p=B.sent(),w=[],m=0,k=p;m<k.length;m++)P=k[m],P.kind==="videoinput"&&w.push({id:P.deviceId,label:P.label});return g(h),[2,w]}})})},x.getCamerasFromMediaStreamTrack=function(){return new Promise(function(g,h){var p=function(m){for(var k=[],P=0,B=m;P<B.length;P++){var C=B[P];C.kind==="video"&&k.push({id:C.id,label:C.label})}g(k)},w=MediaStreamTrack;w.getSources(p)})},x})(),gt;(function(x){x[x.UNKNOWN=0]="UNKNOWN",x[x.NOT_STARTED=1]="NOT_STARTED",x[x.SCANNING=2]="SCANNING",x[x.PAUSED=3]="PAUSED"})(gt||(gt={}));var Zi=(function(){function x(){this.state=gt.NOT_STARTED,this.onGoingTransactionNewState=gt.UNKNOWN}return x.prototype.directTransition=function(g){this.failIfTransitionOngoing(),this.validateTransition(g),this.state=g},x.prototype.startTransition=function(g){return this.failIfTransitionOngoing(),this.validateTransition(g),this.onGoingTransactionNewState=g,this},x.prototype.execute=function(){if(this.onGoingTransactionNewState===gt.UNKNOWN)throw"Transaction is already cancelled, cannot execute().";var g=this.onGoingTransactionNewState;this.onGoingTransactionNewState=gt.UNKNOWN,this.directTransition(g)},x.prototype.cancel=function(){if(this.onGoingTransactionNewState===gt.UNKNOWN)throw"Transaction is already cancelled, cannot cancel().";this.onGoingTransactionNewState=gt.UNKNOWN},x.prototype.getState=function(){return this.state},x.prototype.failIfTransitionOngoing=function(){if(this.onGoingTransactionNewState!==gt.UNKNOWN)throw"Cannot transition to a new state, already under transition"},x.prototype.validateTransition=function(g){switch(this.state){case gt.UNKNOWN:throw"Transition from unknown is not allowed";case gt.NOT_STARTED:this.failIfNewStateIs(g,[gt.PAUSED]);break;case gt.SCANNING:break;case gt.PAUSED:break}},x.prototype.failIfNewStateIs=function(g,h){for(var p=0,w=h;p<w.length;p++){var m=w[p];if(g===m)throw"Cannot transition from ".concat(this.state," to ").concat(g)}},x})(),Qi=(function(){function x(g){this.stateManager=g}return x.prototype.startTransition=function(g){return this.stateManager.startTransition(g)},x.prototype.directTransition=function(g){this.stateManager.directTransition(g)},x.prototype.getState=function(){return this.stateManager.getState()},x.prototype.canScanFile=function(){return this.stateManager.getState()===gt.NOT_STARTED},x.prototype.isScanning=function(){return this.stateManager.getState()!==gt.NOT_STARTED},x.prototype.isStrictlyScanning=function(){return this.stateManager.getState()===gt.SCANNING},x.prototype.isPaused=function(){return this.stateManager.getState()===gt.PAUSED},x})(),Ji=(function(){function x(){}return x.create=function(){return new Qi(new Zi)},x})(),$i=(function(){var x=function(g,h){return x=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(p,w){p.__proto__=w}||function(p,w){for(var m in w)Object.prototype.hasOwnProperty.call(w,m)&&(p[m]=w[m])},x(g,h)};return function(g,h){if(typeof h!="function"&&h!==null)throw new TypeError("Class extends value "+String(h)+" is not a constructor or null");x(g,h);function p(){this.constructor=g}g.prototype=h===null?Object.create(h):(p.prototype=h.prototype,new p)}})(),Gt=(function(x){$i(g,x);function g(){return x!==null&&x.apply(this,arguments)||this}return g.DEFAULT_WIDTH=300,g.DEFAULT_WIDTH_OFFSET=2,g.FILE_SCAN_MIN_HEIGHT=300,g.FILE_SCAN_HIDDEN_CANVAS_PADDING=100,g.MIN_QR_BOX_SIZE=50,g.SHADED_LEFT=1,g.SHADED_RIGHT=2,g.SHADED_TOP=3,g.SHADED_BOTTOM=4,g.SHADED_REGION_ELEMENT_ID="qr-shaded-region",g.VERBOSE=!1,g.BORDER_SHADER_DEFAULT_COLOR="#ffffff",g.BORDER_SHADER_MATCH_COLOR="rgb(90, 193, 56)",g})(_i),ea=(function(){function x(g,h){this.logger=h,this.fps=Gt.SCAN_DEFAULT_FPS,g?(g.fps&&(this.fps=g.fps),this.disableFlip=g.disableFlip===!0,this.qrbox=g.qrbox,this.aspectRatio=g.aspectRatio,this.videoConstraints=g.videoConstraints):this.disableFlip=Gt.DEFAULT_DISABLE_FLIP}return x.prototype.isMediaStreamConstraintsValid=function(){return this.videoConstraints?yn.isMediaStreamConstraintsValid(this.videoConstraints,this.logger):(this.logger.logError("Empty videoConstraints",!0),!1)},x.prototype.isShadedBoxEnabled=function(){return!nr(this.qrbox)},x.create=function(g,h){return new x(g,h)},x})(),ta=(function(){function x(g,h){if(this.element=null,this.canvasElement=null,this.scannerPausedUiElement=null,this.hasBorderShaders=null,this.borderShaders=null,this.qrMatch=null,this.renderedCamera=null,this.qrRegion=null,this.context=null,this.lastScanImageFile=null,this.isScanning=!1,!document.getElementById(g))throw"HTML Element with id=".concat(g," not found");this.elementId=g,this.verbose=!1;var p;typeof h=="boolean"?this.verbose=h===!0:h&&(p=h,this.verbose=p.verbose===!0,p.experimentalFeatures),this.logger=new Oi(this.verbose),this.qrcode=new Fi(this.getSupportedFormats(h),this.getUseBarCodeDetectorIfSupported(p),this.verbose,this.logger),this.foreverScanTimeout,this.shouldScan=!0,this.stateManagerProxy=Ji.create()}return x.prototype.start=function(g,h,p,w){var m=this;if(!g)throw"cameraIdOrConfig is required";if(!p||typeof p!="function")throw"qrCodeSuccessCallback is required and should be a function.";var k;w?k=w:k=this.verbose?this.logger.log:function(){};var P=ea.create(h,this.logger);this.clearElement();var B=!1;P.videoConstraints&&(P.isMediaStreamConstraintsValid()?B=!0:this.logger.logError("'videoConstraints' is not valid 'MediaStreamConstraints, it will be ignored.'",!0));var C=B,R=document.getElementById(this.elementId);R.clientWidth?R.clientWidth:Gt.DEFAULT_WIDTH,R.style.position="relative",this.shouldScan=!0,this.element=R;var _=this,ne=this.stateManagerProxy.startTransition(gt.SCANNING);return new Promise(function($,q){var K=C?P.videoConstraints:_.createVideoConstraints(g);if(!K){ne.cancel(),q("videoConstraints should be defined");return}var ce={};(!C||P.aspectRatio)&&(ce.aspectRatio=P.aspectRatio);var he={onRenderSurfaceReady:function(X,I){_.setupUi(X,I,P),_.isScanning=!0,_.foreverScan(P,p,k)}};zi.failIfNotSupported().then(function(X){X.create(K).then(function(I){return I.render(m.element,ce,he).then(function(W){_.renderedCamera=W,ne.execute(),$(null)}).catch(function(W){ne.cancel(),q(W)})}).catch(function(I){ne.cancel(),q(Rr.errorGettingUserMedia(I))})}).catch(function(X){ne.cancel(),q(Rr.cameraStreamingNotSupported())})})},x.prototype.pause=function(g){if(!this.stateManagerProxy.isStrictlyScanning())throw"Cannot pause, scanner is not scanning.";this.stateManagerProxy.directTransition(gt.PAUSED),this.showPausedState(),(nr(g)||g!==!0)&&(g=!1),g&&this.renderedCamera&&this.renderedCamera.pause()},x.prototype.resume=function(){if(!this.stateManagerProxy.isPaused())throw"Cannot result, scanner is not paused.";if(!this.renderedCamera)throw"renderedCamera doesn't exist while trying resume()";var g=this,h=function(){g.stateManagerProxy.directTransition(gt.SCANNING),g.hidePausedState()};if(!this.renderedCamera.isPaused()){h();return}this.renderedCamera.resume(function(){h()})},x.prototype.getState=function(){return this.stateManagerProxy.getState()},x.prototype.stop=function(){var g=this;if(!this.stateManagerProxy.isScanning())throw"Cannot stop, scanner is not running or paused.";var h=this.stateManagerProxy.startTransition(gt.NOT_STARTED);this.shouldScan=!1,this.foreverScanTimeout&&clearTimeout(this.foreverScanTimeout);var p=function(){if(g.element){var m=document.getElementById(Gt.SHADED_REGION_ELEMENT_ID);m&&g.element.removeChild(m)}},w=this;return this.renderedCamera.close().then(function(){return w.renderedCamera=null,w.element&&(w.element.removeChild(w.canvasElement),w.canvasElement=null),p(),w.qrRegion&&(w.qrRegion=null),w.context&&(w.context=null),h.execute(),w.hidePausedState(),w.isScanning=!1,Promise.resolve()})},x.prototype.scanFile=function(g,h){return this.scanFileV2(g,h).then(function(p){return p.decodedText})},x.prototype.scanFileV2=function(g,h){var p=this;if(!g||!(g instanceof File))throw"imageFile argument is mandatory and should be instance of File. Use 'event.target.files[0]'.";if(nr(h)&&(h=!0),!this.stateManagerProxy.canScanFile())throw"Cannot start file scan - ongoing camera scan";return new Promise(function(w,m){p.possiblyCloseLastScanImageFile(),p.clearElement(),p.lastScanImageFile=URL.createObjectURL(g);var k=new Image;k.onload=function(){var P=k.width,B=k.height,C=document.getElementById(p.elementId),R=C.clientWidth?C.clientWidth:Gt.DEFAULT_WIDTH,_=Math.max(C.clientHeight?C.clientHeight:B,Gt.FILE_SCAN_MIN_HEIGHT),ne=p.computeCanvasDrawConfig(P,B,R,_);if(h){var $=p.createCanvasElement(R,_,"qr-canvas-visible");$.style.display="inline-block",C.appendChild($);var q=$.getContext("2d");if(!q)throw"Unable to get 2d context from canvas";q.canvas.width=R,q.canvas.height=_,q.drawImage(k,0,0,P,B,ne.x,ne.y,ne.width,ne.height)}var K=Gt.FILE_SCAN_HIDDEN_CANVAS_PADDING,ce=Math.max(k.width,ne.width),he=Math.max(k.height,ne.height),X=ce+2*K,I=he+2*K,W=p.createCanvasElement(X,I);C.appendChild(W);var oe=W.getContext("2d");if(!oe)throw"Unable to get 2d context from canvas";oe.canvas.width=X,oe.canvas.height=I,oe.drawImage(k,0,0,P,B,K,K,ce,he);try{p.qrcode.decodeRobustlyAsync(W).then(function(re){w(sn.createFromQrcodeResult(re))}).catch(m)}catch(re){m("QR code parse error, error = ".concat(re))}},k.onerror=m,k.onabort=m,k.onstalled=m,k.onsuspend=m,k.src=URL.createObjectURL(g)})},x.prototype.clear=function(){this.clearElement()},x.getCameras=function(){return Ki.retrieve()},x.prototype.getRunningTrackCapabilities=function(){return this.getRenderedCameraOrFail().getRunningTrackCapabilities()},x.prototype.getRunningTrackSettings=function(){return this.getRenderedCameraOrFail().getRunningTrackSettings()},x.prototype.getRunningTrackCameraCapabilities=function(){return this.getRenderedCameraOrFail().getCapabilities()},x.prototype.applyVideoConstraints=function(g){if(g){if(!yn.isMediaStreamConstraintsValid(g,this.logger))throw"invalid videoConstaints passed, check logs for more details"}else throw"videoConstaints is required argument.";return this.getRenderedCameraOrFail().applyVideoConstraints(g)},x.prototype.getRenderedCameraOrFail=function(){if(this.renderedCamera==null)throw"Scanning is not in running state, call this API only when QR code scanning using camera is in running state.";return this.renderedCamera},x.prototype.getSupportedFormats=function(g){var h=[fe.QR_CODE,fe.AZTEC,fe.CODABAR,fe.CODE_39,fe.CODE_93,fe.CODE_128,fe.DATA_MATRIX,fe.MAXICODE,fe.ITF,fe.EAN_13,fe.EAN_8,fe.PDF_417,fe.RSS_14,fe.RSS_EXPANDED,fe.UPC_A,fe.UPC_E,fe.UPC_EAN_EXTENSION];if(!g||typeof g=="boolean"||!g.formatsToSupport)return h;if(!Array.isArray(g.formatsToSupport))throw"configOrVerbosityFlag.formatsToSupport should be undefined or an array.";if(g.formatsToSupport.length===0)throw"Atleast 1 formatsToSupport is needed.";for(var p=[],w=0,m=g.formatsToSupport;w<m.length;w++){var k=m[w];Ti(k)?p.push(k):this.logger.warn("Invalid format: ".concat(k," passed in config, ignoring."))}if(p.length===0)throw"None of formatsToSupport match supported values.";return p},x.prototype.getUseBarCodeDetectorIfSupported=function(g){if(nr(g))return!0;if(!nr(g.useBarCodeDetectorIfSupported))return g.useBarCodeDetectorIfSupported!==!1;if(nr(g.experimentalFeatures))return!0;var h=g.experimentalFeatures;return nr(h.useBarCodeDetectorIfSupported)?!0:h.useBarCodeDetectorIfSupported!==!1},x.prototype.validateQrboxSize=function(g,h,p){var w=this,m=p.qrbox;this.validateQrboxConfig(m);var k=this.toQrdimensions(g,h,m),P=function(C){if(C<Gt.MIN_QR_BOX_SIZE)throw"minimum size of 'config.qrbox' dimension value is"+" ".concat(Gt.MIN_QR_BOX_SIZE,"px.")},B=function(C){return C>g&&(w.logger.warn("`qrbox.width` or `qrbox` is larger than the width of the root element. The width will be truncated to the width of root element."),C=g),C};P(k.width),P(k.height),k.width=B(k.width)},x.prototype.validateQrboxConfig=function(g){if(typeof g!="number"&&typeof g!="function"&&(g.width===void 0||g.height===void 0))throw"Invalid instance of QrDimensions passed for 'config.qrbox'. Both 'width' and 'height' should be set."},x.prototype.toQrdimensions=function(g,h,p){if(typeof p=="number")return{width:p,height:p};if(typeof p=="function")try{return p(g,h)}catch(w){throw new Error("qrbox config was passed as a function but it failed with unknown error"+w)}return p},x.prototype.setupUi=function(g,h,p){p.isShadedBoxEnabled()&&this.validateQrboxSize(g,h,p);var w=nr(p.qrbox)?{width:g,height:h}:p.qrbox;this.validateQrboxConfig(w);var m=this.toQrdimensions(g,h,w);m.height>h&&this.logger.warn("[Html5Qrcode] config.qrbox has height that isgreater than the height of the video stream. Shading will be ignored");var k=p.isShadedBoxEnabled()&&m.height<=h,P={x:0,y:0,width:g,height:h},B=k?this.getShadedRegionBounds(g,h,m):P,C=this.createCanvasElement(B.width,B.height),R={willReadFrequently:!0},_=C.getContext("2d",R);_.canvas.width=B.width,_.canvas.height=B.height,this.element.append(C),k&&this.possiblyInsertShadingElement(this.element,g,h,m),this.createScannerPausedUiElement(this.element),this.qrRegion=B,this.context=_,this.canvasElement=C},x.prototype.createScannerPausedUiElement=function(g){var h=document.createElement("div");h.innerText=Rr.scannerPaused(),h.style.display="none",h.style.position="absolute",h.style.top="0px",h.style.zIndex="1",h.style.background="rgba(9, 9, 9, 0.46)",h.style.color="#FFECEC",h.style.textAlign="center",h.style.width="100%",g.appendChild(h),this.scannerPausedUiElement=h},x.prototype.scanContext=function(g,h){var p=this;return this.stateManagerProxy.isPaused()?Promise.resolve(!1):this.qrcode.decodeAsync(this.canvasElement).then(function(w){return g(w.text,sn.createFromQrcodeResult(w)),p.possiblyUpdateShaders(!0),!0}).catch(function(w){p.possiblyUpdateShaders(!1);var m=Rr.codeParseError(w);return h(m,Ri.createFrom(m)),!1})},x.prototype.foreverScan=function(g,h,p){var w=this;if(this.shouldScan&&this.renderedCamera){var m=this.renderedCamera.getSurface(),k=m.videoWidth/m.clientWidth,P=m.videoHeight/m.clientHeight;if(!this.qrRegion)throw"qrRegion undefined when localMediaStream is ready.";var B=this.qrRegion.width*k,C=this.qrRegion.height*P,R=this.qrRegion.x*k,_=this.qrRegion.y*P;this.context.drawImage(m,R,_,B,C,0,0,this.qrRegion.width,this.qrRegion.height);var ne=function(){w.foreverScanTimeout=setTimeout(function(){w.foreverScan(g,h,p)},w.getTimeoutFps(g.fps))};this.scanContext(h,p).then(function($){!$&&g.disableFlip!==!0?(w.context.translate(w.context.canvas.width,0),w.context.scale(-1,1),w.scanContext(h,p).finally(function(){ne()})):ne()}).catch(function($){w.logger.logError("Error happend while scanning context",$),ne()})}},x.prototype.createVideoConstraints=function(g){if(typeof g=="string")return{deviceId:{exact:g}};if(typeof g=="object"){var h="facingMode",p="deviceId",w={user:!0,environment:!0},m="exact",k=function(q){if(q in w)return!0;throw"config has invalid 'facingMode' value = "+"'".concat(q,"'")},P=Object.keys(g);if(P.length!==1)throw"'cameraIdOrConfig' object should have exactly 1 key,"+" if passed as an object, found ".concat(P.length," keys");var B=Object.keys(g)[0];if(B!==h&&B!==p)throw"Only '".concat(h,"' and '").concat(p,"' ")+" are supported for 'cameraIdOrConfig'";if(B===h){var C=g.facingMode;if(typeof C=="string"){if(k(C))return{facingMode:C}}else if(typeof C=="object")if(m in C){if(k(C["".concat(m)]))return{facingMode:{exact:C["".concat(m)]}}}else throw"'facingMode' should be string or object with"+" ".concat(m," as key.");else{var R=typeof C;throw"Invalid type of 'facingMode' = ".concat(R)}}else{var _=g.deviceId;if(typeof _=="string")return{deviceId:_};if(typeof _=="object"){if(m in _)return{deviceId:{exact:_["".concat(m)]}};throw"'deviceId' should be string or object with"+" ".concat(m," as key.")}else{var ne=typeof _;throw"Invalid type of 'deviceId' = ".concat(ne)}}}var $=typeof g;throw"Invalid type of 'cameraIdOrConfig' = ".concat($)},x.prototype.computeCanvasDrawConfig=function(g,h,p,w){if(g<=p&&h<=w){var m=(p-g)/2,k=(w-h)/2;return{x:m,y:k,width:g,height:h}}else{var P=g,B=h;return g>p&&(h=p/g*h,g=p),h>w&&(g=w/h*g,h=w),this.logger.log("Image downsampled from "+"".concat(P,"X").concat(B)+" to ".concat(g,"X").concat(h,".")),this.computeCanvasDrawConfig(g,h,p,w)}},x.prototype.clearElement=function(){if(this.stateManagerProxy.isScanning())throw"Cannot clear while scan is ongoing, close it first.";var g=document.getElementById(this.elementId);g&&(g.innerHTML="")},x.prototype.possiblyUpdateShaders=function(g){this.qrMatch!==g&&(this.hasBorderShaders&&this.borderShaders&&this.borderShaders.length&&this.borderShaders.forEach(function(h){h.style.backgroundColor=g?Gt.BORDER_SHADER_MATCH_COLOR:Gt.BORDER_SHADER_DEFAULT_COLOR}),this.qrMatch=g)},x.prototype.possiblyCloseLastScanImageFile=function(){this.lastScanImageFile&&(URL.revokeObjectURL(this.lastScanImageFile),this.lastScanImageFile=null)},x.prototype.createCanvasElement=function(g,h,p){var w=g,m=h,k=document.createElement("canvas");return k.style.width="".concat(w,"px"),k.style.height="".concat(m,"px"),k.style.display="none",k.id=nr(p)?"qr-canvas":p,k},x.prototype.getShadedRegionBounds=function(g,h,p){if(p.width>g||p.height>h)throw"'config.qrbox' dimensions should not be greater than the dimensions of the root HTML element.";return{x:(g-p.width)/2,y:(h-p.height)/2,width:p.width,height:p.height}},x.prototype.possiblyInsertShadingElement=function(g,h,p,w){if(!(h-w.width<1||p-w.height<1)){var m=document.createElement("div");m.style.position="absolute";var k=(h-w.width)/2,P=(p-w.height)/2;if(m.style.borderLeft="".concat(k,"px solid rgba(0, 0, 0, 0.48)"),m.style.borderRight="".concat(k,"px solid rgba(0, 0, 0, 0.48)"),m.style.borderTop="".concat(P,"px solid rgba(0, 0, 0, 0.48)"),m.style.borderBottom="".concat(P,"px solid rgba(0, 0, 0, 0.48)"),m.style.boxSizing="border-box",m.style.top="0px",m.style.bottom="0px",m.style.left="0px",m.style.right="0px",m.id="".concat(Gt.SHADED_REGION_ELEMENT_ID),h-w.width<11||p-w.height<11)this.hasBorderShaders=!1;else{var B=5,C=40;this.insertShaderBorders(m,C,B,-B,null,0,!0),this.insertShaderBorders(m,C,B,-B,null,0,!1),this.insertShaderBorders(m,C,B,null,-B,0,!0),this.insertShaderBorders(m,C,B,null,-B,0,!1),this.insertShaderBorders(m,B,C+B,-B,null,-B,!0),this.insertShaderBorders(m,B,C+B,null,-B,-B,!0),this.insertShaderBorders(m,B,C+B,-B,null,-B,!1),this.insertShaderBorders(m,B,C+B,null,-B,-B,!1),this.hasBorderShaders=!0}g.append(m)}},x.prototype.insertShaderBorders=function(g,h,p,w,m,k,P){var B=document.createElement("div");B.style.position="absolute",B.style.backgroundColor=Gt.BORDER_SHADER_DEFAULT_COLOR,B.style.width="".concat(h,"px"),B.style.height="".concat(p,"px"),w!==null&&(B.style.top="".concat(w,"px")),m!==null&&(B.style.bottom="".concat(m,"px")),P?B.style.left="".concat(k,"px"):B.style.right="".concat(k,"px"),this.borderShaders||(this.borderShaders=[]),this.borderShaders.push(B),g.appendChild(B)},x.prototype.showPausedState=function(){if(!this.scannerPausedUiElement)throw"[internal error] scanner paused UI element not found";this.scannerPausedUiElement.style.display="block"},x.prototype.hidePausedState=function(){if(!this.scannerPausedUiElement)throw"[internal error] scanner paused UI element not found";this.scannerPausedUiElement.style.display="none"},x.prototype.getTimeoutFps=function(g){return 1e3/g},x})(),un;(function(x){x[x.STATUS_DEFAULT=0]="STATUS_DEFAULT",x[x.STATUS_SUCCESS=1]="STATUS_SUCCESS",x[x.STATUS_WARNING=2]="STATUS_WARNING",x[x.STATUS_REQUESTING_PERMISSION=3]="STATUS_REQUESTING_PERMISSION"})(un||(un={}));const ra=({isOpen:x,onClose:g,onScan:h})=>{const p=V.useRef(null),[w,m]=V.useState(!1),[k,P]=V.useState("");return V.useEffect(()=>{if(!x)return;const B=async()=>{try{const R=new ta("barcode-reader");p.current=R,await R.start({facingMode:"environment"},{fps:10,qrbox:{width:250,height:250}},_=>{h(_),C()},_=>{}),m(!0),P("")}catch(R){console.error("Error starting scanner:",R),P("Kh√¥ng th·ªÉ truy c·∫≠p camera. Vui l√≤ng c·∫•p quy·ªÅn camera trong c√†i ƒë·∫∑t tr√¨nh duy·ªát.")}},C=async()=>{if(p.current&&w)try{await p.current.stop(),p.current.clear()}catch(R){console.error("Error stopping scanner:",R)}m(!1),g()};return B(),()=>{p.current&&w&&p.current.stop().then(()=>{var R;(R=p.current)==null||R.clear()}).catch(console.error)}},[x]),x?a.jsxs("div",{className:"fixed inset-0 bg-black/90 z-[200] flex flex-col items-center justify-center p-4",children:[a.jsxs("div",{className:"w-full max-w-md mb-4 flex items-center justify-between",children:[a.jsxs("h2",{className:"text-xl font-bold text-white flex items-center gap-2",children:[a.jsx(bi,{className:"w-6 h-6"}),"Qu√©t m√£ v·∫°ch"]}),a.jsx("button",{onClick:g,className:"w-10 h-10 flex items-center justify-center bg-white/10 hover:bg-white/20 rounded-full text-white transition-colors",children:a.jsx(ni,{className:"w-6 h-6"})})]}),a.jsx("div",{className:"w-full max-w-md bg-white rounded-2xl overflow-hidden shadow-2xl",children:a.jsx("div",{id:"barcode-reader",className:"w-full"})}),k&&a.jsxs("div",{className:"mt-4 p-4 bg-red-500/20 border border-red-500 rounded-xl text-white text-sm max-w-md",children:[a.jsx("p",{className:"font-semibold mb-1",children:"‚ö†Ô∏è L·ªói camera"}),a.jsx("p",{children:k})]}),a.jsxs("div",{className:"mt-6 text-center text-white/70 text-sm max-w-md",children:[a.jsx("p",{children:"üì∏ ƒê∆∞a camera v√†o m√£ v·∫°ch ƒë·ªÉ qu√©t t·ª± ƒë·ªông"}),a.jsx("p",{className:"mt-2",children:"M√£ v·∫°ch s·∫Ω ƒë∆∞·ª£c th√™m v√†o gi·ªè h√†ng ngay l·∫≠p t·ª©c"})]})]}):null},sa=({isOpen:x,onClose:g,parts:h,receiptItems:p,setReceiptItems:w,selectedSupplier:m,setSelectedSupplier:k,searchTerm:P,setSearchTerm:B,onSave:C,discount:R,setDiscount:_,discountType:ne,setDiscountType:$,paymentMethod:q,setPaymentMethod:K,paymentType:ce,setPaymentType:he,partialAmount:X,setPartialAmount:I,showAddProductModal:W,setShowAddProductModal:oe,onAddNewProduct:re,currentBranchId:S})=>{var Ge,ot,Wt;const[U,M]=V.useState(1),[xe,pe]=V.useState(!1),[G,ie]=V.useState(""),ge=V.useRef(null),[j,Ce]=V.useState(!1),{data:J=[]}=Ds();console.log("üîç GoodsReceiptMobileModal - parts:",(h==null?void 0:h.length)||0,h==null?void 0:h.slice(0,2)),console.log("üîç searchTerm:",P);const Ne=(h==null?void 0:h.filter(T=>{var se,ke;if(!P||P.trim()==="")return!0;const de=P.toLowerCase().trim();return((se=T.name)==null?void 0:se.toLowerCase().includes(de))||((ke=T.sku)==null?void 0:ke.toLowerCase().includes(de))}))||[];console.log("üîç filteredParts:",(Ne==null?void 0:Ne.length)||0);const Oe=T=>{p.find(se=>se.partId===T.id)?(w(se=>se.map(ke=>ke.partId===T.id?{...ke,quantity:ke.quantity+1}:ke)),be.success(`ƒê√£ tƒÉng s·ªë l∆∞·ª£ng ${T.name}`)):(w(se=>{var ke,_e,st;return[...se,{partId:T.id,partName:T.name,sku:T.sku,quantity:1,importPrice:((ke=T.costPrice)==null?void 0:ke[S])||0,sellingPrice:((_e=T.retailPrice)==null?void 0:_e[S])||0,wholesalePrice:((st=T.wholesalePrice)==null?void 0:st[S])||0}]}),be.success(`ƒê√£ th√™m ${T.name} v√†o phi·∫øu nh·∫≠p`)),B(""),setTimeout(()=>{var se;return(se=ge.current)==null?void 0:se.focus()},100)},Qe=T=>{if(T.preventDefault(),!G.trim())return;const de=G.trim(),se=h.find(ke=>{var _e,st;return((_e=ke.sku)==null?void 0:_e.toLowerCase())===de.toLowerCase()||((st=ke.name)==null?void 0:st.toLowerCase().includes(de.toLowerCase()))});se?(Oe(se),ie("")):(be.info(`S·∫£n ph·∫©m m√£ ${de} ch∆∞a c√≥. Vui l√≤ng th√™m th√¥ng tin s·∫£n ph·∫©m m·ªõi.`,{autoClose:3e3}),setTimeout(()=>{oe(!0)},500))},rt=T=>{const de=h.find(se=>{var ke,_e;return((ke=se.sku)==null?void 0:ke.toLowerCase())===T.toLowerCase()||((_e=se.name)==null?void 0:_e.toLowerCase().includes(T.toLowerCase()))});Ce(!1),de?Oe(de):(be.info(`S·∫£n ph·∫©m m√£ ${T} ch∆∞a c√≥. Vui l√≤ng th√™m th√¥ng tin s·∫£n ph·∫©m m·ªõi.`),ie(T),setTimeout(()=>{oe(!0)},500))};V.useEffect(()=>{x&&U===1&&setTimeout(()=>{var T;return(T=ge.current)==null?void 0:T.focus()},300)},[x,U]);const Ue=T=>{w(de=>de.filter((se,ke)=>ke!==T))},Je=p.reduce((T,de)=>T+de.quantity*de.importPrice,0),z=ne==="percent"?Math.round(Je*R/100):R,Ae=Math.max(0,Je-z),le=()=>{if(!m){alert("Vui l√≤ng ch·ªçn nh√† cung c·∫•p");return}M(2)},Ve=()=>{alert("Ch·ª©c nƒÉng l∆∞u nh√°p ƒëang ph√°t tri·ªÉn")};return x?a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"fixed inset-0 bg-black/50 z-[100] flex items-end justify-center sm:hidden",children:a.jsx("div",{className:"bg-white dark:bg-slate-800 w-full h-[95vh] rounded-t-3xl overflow-hidden flex flex-col",children:U===1?a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"bg-gradient-to-r from-blue-600 to-blue-700 p-4 flex items-center justify-between flex-shrink-0",children:a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("button",{onClick:g,className:"text-white text-2xl leading-none",children:"√ó"}),a.jsx("h2",{className:"text-lg font-bold text-white",children:"T·∫°o phi·∫øu nh·∫≠p kho"})]})}),a.jsx("div",{className:"p-3 bg-slate-50 dark:bg-slate-900 border-b border-slate-200 dark:border-slate-700 flex-shrink-0",children:a.jsx("div",{onClick:()=>pe(!0),className:`p-4 rounded-xl border-2 cursor-pointer active:scale-98 transition-transform ${m?"border-blue-500 bg-blue-50 dark:bg-blue-900/20":"border-dashed border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-800"}`,children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx("div",{className:"flex-1",children:m?a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"text-xs text-slate-500 dark:text-slate-400 mb-1",children:"NH√Ä CUNG C·∫§P"}),a.jsx("div",{className:"font-bold text-slate-900 dark:text-slate-100",children:((Ge=J.find(T=>T.id===m))==null?void 0:Ge.name)||""}),((ot=J.find(T=>T.id===m))==null?void 0:ot.phone)&&a.jsx("div",{className:"text-sm text-slate-600 dark:text-slate-400 mt-1",children:(Wt=J.find(T=>T.id===m))==null?void 0:Wt.phone})]}):a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("span",{className:"text-2xl",children:"üë§"}),a.jsx("span",{className:"text-slate-500 dark:text-slate-400",children:"Ch·ªçn nh√† cung c·∫•p"})]})}),a.jsx("svg",{className:"w-5 h-5 text-slate-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})]})})}),a.jsxs("div",{className:"p-3 bg-white dark:bg-slate-800 border-b border-slate-200 dark:border-slate-700 sticky top-0 z-10 flex-shrink-0 space-y-2",children:[a.jsxs("form",{onSubmit:Qe,className:"flex gap-2",children:[a.jsxs("div",{className:"relative flex-1",children:[a.jsx("svg",{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-blue-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v1m6 11h2m-6 0h-2v4m0-11v3m0 0h.01M12 12h4.01M16 20h4M4 12h4m12 0h.01M5 8h2a1 1 0 001-1V5a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1zm12 0h2a1 1 0 001-1V5a1 1 0 00-1-1h-2a1 1 0 00-1 1v2a1 1 0 001 1zM5 20h2a1 1 0 001-1v-2a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1z"})}),a.jsx("input",{ref:ge,type:"text",placeholder:"Nh·∫≠p SKU ho·∫∑c qu√©t...",value:G,onChange:T=>ie(T.target.value),className:"w-full px-4 py-3 pl-11 border-2 border-blue-400 dark:border-blue-600 rounded-xl bg-blue-50 dark:bg-blue-900/20 text-slate-900 dark:text-slate-100 text-base font-mono placeholder:text-blue-500/70"}),G&&a.jsx("button",{type:"button",onClick:()=>ie(""),className:"absolute right-3 top-1/2 -translate-y-1/2 text-slate-400 hover:text-slate-600 dark:hover:text-slate-300",children:a.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),a.jsx("button",{type:"button",onClick:()=>Ce(!0),className:"w-14 h-[50px] flex items-center justify-center bg-gradient-to-br from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white rounded-xl shadow-lg transition-all active:scale-95",children:a.jsxs("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"}),a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 13a3 3 0 11-6 0 3 3 0 016 0z"})]})})]}),a.jsxs("div",{className:"relative",children:[a.jsx("input",{type:"text",placeholder:"Ho·∫∑c t√¨m ki·∫øm th·ªß c√¥ng...",value:P,onChange:T=>B(T.target.value),className:"w-full px-4 py-3 pl-10 border border-slate-300 dark:border-slate-600 rounded-xl bg-slate-50 dark:bg-slate-900 text-slate-900 dark:text-slate-100"}),a.jsx("svg",{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-slate-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})]})]}),a.jsxs("div",{className:"flex-1 overflow-y-auto p-3 bg-slate-50 dark:bg-slate-900",children:[!h||h.length===0?a.jsxs("div",{className:"text-center text-slate-500 py-12",children:[a.jsx("div",{className:"text-5xl mb-3",children:"‚è≥"}),a.jsx("div",{children:"ƒêang t·∫£i danh s√°ch s·∫£n ph·∫©m..."})]}):Ne.length===0?a.jsxs("div",{className:"text-center text-slate-500 py-12",children:[a.jsx("div",{className:"text-5xl mb-3",children:"üì¶"}),a.jsx("div",{children:"Kh√¥ng t√¨m th·∫•y s·∫£n ph·∫©m"}),P&&a.jsxs("div",{className:"text-sm mt-2",children:['T√¨m ki·∫øm: "',P,'"']})]}):a.jsx("div",{className:"space-y-2",children:Ne.map(T=>{var se,ke;const de=p.find(_e=>_e.partId===T.id);return a.jsx("div",{className:"bg-white dark:bg-slate-800 rounded-xl p-4 border border-slate-200 dark:border-slate-700",children:a.jsxs("div",{className:"flex items-start justify-between gap-3",children:[a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsx("div",{className:"font-bold text-slate-900 dark:text-slate-100 text-base leading-tight mb-1",children:T.name}),a.jsxs("div",{className:"text-sm text-slate-500 dark:text-slate-400",children:["SKU: ",T.sku]}),a.jsxs("div",{className:"mt-2 flex gap-3 text-xs",children:[a.jsxs("div",{children:[a.jsxs("span",{className:"text-slate-500 dark:text-slate-400",children:["Nh·∫≠p:"," "]}),a.jsx("span",{className:"font-medium text-orange-600 dark:text-orange-400",children:Se(((se=T.costPrice)==null?void 0:se[S])||0)})]}),a.jsxs("div",{children:[a.jsxs("span",{className:"text-slate-500 dark:text-slate-400",children:["B√°n:"," "]}),a.jsx("span",{className:"font-medium text-green-600 dark:text-green-400",children:Se(((ke=T.retailPrice)==null?void 0:ke[S])||0)})]})]}),de&&a.jsx("div",{className:"mt-2 text-sm",children:a.jsxs("span",{className:"text-blue-600 dark:text-blue-400 font-medium",children:["ƒê√£ th√™m: ",de.quantity," √ó"," ",Se(de.importPrice)]})})]}),a.jsx("button",{onClick:()=>Oe(T),className:"flex-shrink-0 w-10 h-10 rounded-full bg-blue-600 text-white flex items-center justify-center text-2xl leading-none active:scale-95 transition-transform",children:"+"})]})},T.id)})}),a.jsxs("button",{onClick:()=>oe(!0),className:"w-full mt-3 py-4 border-2 border-dashed border-slate-300 dark:border-slate-600 rounded-xl text-slate-500 dark:text-slate-400 hover:border-blue-400 hover:text-blue-600 transition-colors flex items-center justify-center gap-2",children:[a.jsx("span",{className:"text-2xl",children:"+"}),a.jsx("span",{className:"font-medium",children:"T·∫°o s·∫£n ph·∫©m m·ªõi"})]})]}),p.length>0&&a.jsx("div",{className:"flex-shrink-0 bg-gradient-to-t from-white via-white dark:from-slate-800 dark:via-slate-800 to-transparent pt-6 pb-safe pb-4 px-3",children:a.jsxs("button",{onClick:le,className:"w-full bg-blue-600 hover:bg-blue-700 active:scale-98 text-white py-4 rounded-xl font-bold text-lg flex items-center justify-between px-6 shadow-lg transition-transform",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("div",{className:"bg-white/20 rounded-full w-8 h-8 flex items-center justify-center font-bold",children:p.reduce((T,de)=>T+de.quantity,0)}),a.jsx("span",{children:"Ti·∫øp t·ª•c"})]}),a.jsx("span",{className:"font-bold",children:Se(Je)})]})})]}):a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"bg-gradient-to-r from-blue-600 to-blue-700 p-4 flex items-center justify-between flex-shrink-0",children:a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("button",{onClick:()=>M(1),className:"text-white text-xl leading-none",children:"‚Üê"}),a.jsx("h2",{className:"text-lg font-bold text-white",children:"X√°c nh·∫≠n nh·∫≠p kho"})]})}),a.jsxs("div",{className:"flex-1 overflow-y-auto bg-slate-50 dark:bg-slate-900",children:[a.jsx("div",{className:"p-3 space-y-2",children:p.map((T,de)=>a.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl p-4 border border-slate-200 dark:border-slate-700",children:[a.jsxs("div",{className:"flex items-start justify-between gap-3 mb-3",children:[a.jsxs("div",{className:"flex-1",children:[a.jsx("div",{className:"font-bold text-slate-900 dark:text-slate-100 leading-tight",children:T.partName}),a.jsxs("div",{className:"text-sm text-slate-500 dark:text-slate-400 mt-1",children:["SKU: ",T.sku]})]}),a.jsx("button",{onClick:()=>Ue(de),className:"text-red-500 hover:text-red-600 text-xl",children:"√ó"})]}),a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("button",{onClick:()=>{if(T.quantity>1){const se=[...p];se[de].quantity-=1,w(se)}},className:"w-8 h-8 rounded-lg border-2 border-slate-300 dark:border-slate-600 flex items-center justify-center text-slate-600 dark:text-slate-400 font-bold active:scale-95 transition-transform",children:"‚àí"}),a.jsx("div",{className:"w-12 text-center font-bold text-lg text-slate-900 dark:text-slate-100",children:T.quantity}),a.jsx("button",{onClick:()=>{const se=[...p];se[de].quantity+=1,w(se)},className:"w-8 h-8 rounded-lg border-2 border-blue-500 flex items-center justify-center text-blue-600 font-bold active:scale-95 transition-transform",children:"+"})]}),a.jsxs("div",{className:"text-right",children:[a.jsxs("div",{className:"text-sm text-slate-500 dark:text-slate-400",children:[Se(T.importPrice)," / c√°i"]}),a.jsx("div",{className:"font-bold text-orange-600 dark:text-orange-400",children:Se(T.quantity*T.importPrice)})]})]})]},de))}),a.jsx("div",{className:"p-3",children:a.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl p-4 border border-slate-200 dark:border-slate-700 space-y-3",children:[a.jsxs("div",{className:"flex justify-between text-slate-700 dark:text-slate-300",children:[a.jsx("span",{children:"T·ªïng ti·ªÅn h√†ng"}),a.jsx("span",{className:"font-medium",children:Se(Je)})]}),a.jsxs("div",{className:"flex justify-between items-center",children:[a.jsx("span",{className:"text-slate-700 dark:text-slate-300",children:"Gi·∫£m gi√°"}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("input",{type:"number",inputMode:"numeric",value:R,onChange:T=>_(Number(T.target.value)),placeholder:"0",className:"w-24 px-3 py-1.5 border border-slate-300 dark:border-slate-600 rounded-lg text-right bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100"}),a.jsxs("select",{value:ne,onChange:T=>$(T.target.value),className:"px-2 py-1.5 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100 text-sm",children:[a.jsx("option",{value:"amount",children:"‚Ç´"}),a.jsx("option",{value:"percent",children:"%"})]})]})]}),a.jsxs("div",{className:"flex justify-between items-center pt-3 border-t-2 border-slate-200 dark:border-slate-700",children:[a.jsx("span",{className:"text-lg font-bold text-slate-900 dark:text-slate-100",children:"C·∫¶N THANH TO√ÅN"}),a.jsx("span",{className:"text-xl font-bold text-red-600 dark:text-red-400",children:Se(Ae)})]})]})}),a.jsxs("div",{className:"p-3",children:[a.jsx("div",{className:"text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:"Ph∆∞∆°ng th·ª©c thanh to√°n"}),a.jsxs("div",{className:"flex gap-2",children:[a.jsx("button",{onClick:()=>K("cash"),className:`flex-1 py-3 rounded-xl font-medium transition-all ${q==="cash"?"bg-green-600 text-white shadow-lg":"bg-white dark:bg-slate-800 text-slate-700 dark:text-slate-300 border border-slate-300 dark:border-slate-600"}`,children:"üíµ Ti·ªÅn m·∫∑t"}),a.jsx("button",{onClick:()=>K("bank"),className:`flex-1 py-3 rounded-xl font-medium transition-all ${q==="bank"?"bg-blue-600 text-white shadow-lg":"bg-white dark:bg-slate-800 text-slate-700 dark:text-slate-300 border border-slate-300 dark:border-slate-600"}`,children:"üè¶ Chuy·ªÉn kho·∫£n"})]})]}),a.jsx("div",{className:"p-3",children:a.jsxs("div",{className:"bg-slate-200 dark:bg-slate-700 rounded-xl p-1 flex gap-1",children:[a.jsx("button",{onClick:()=>{he("full"),I(0)},className:`flex-1 py-2.5 rounded-lg font-medium transition-all ${ce==="full"?"bg-white dark:bg-slate-800 text-slate-900 dark:text-slate-100 shadow":"text-slate-600 dark:text-slate-400"}`,children:"ƒê·ªß"}),a.jsx("button",{onClick:()=>he("partial"),className:`flex-1 py-2.5 rounded-lg font-medium transition-all ${ce==="partial"?"bg-white dark:bg-slate-800 text-slate-900 dark:text-slate-100 shadow":"text-slate-600 dark:text-slate-400"}`,children:"1 Ph·∫ßn"}),a.jsx("button",{onClick:()=>{he("note"),I(0)},className:`flex-1 py-2.5 rounded-lg font-medium transition-all ${ce==="note"?"bg-white dark:bg-slate-800 text-slate-900 dark:text-slate-100 shadow":"text-slate-600 dark:text-slate-400"}`,children:"N·ª£"})]})}),ce==="partial"&&a.jsx("div",{className:"p-3",children:a.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl p-4 border border-slate-300 dark:border-slate-600",children:[a.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:"Ti·ªÅn tr·∫£ NCC"}),a.jsx("input",{type:"number",inputMode:"numeric",value:X,onChange:T=>{const de=Number(T.target.value);de<=Ae?I(de):alert("S·ªë ti·ªÅn tr·∫£ kh√¥ng ƒë∆∞·ª£c v∆∞·ª£t qu√° t·ªïng ti·ªÅn")},placeholder:"Nh·∫≠p s·ªë ti·ªÅn",className:"w-full px-4 py-3 border border-slate-300 dark:border-slate-600 rounded-lg text-right text-lg font-bold bg-slate-50 dark:bg-slate-900 text-slate-900 dark:text-slate-100"}),a.jsxs("div",{className:"mt-2 text-sm text-red-600 dark:text-red-400",children:["C√≤n n·ª£: ",Se(Ae-X)]})]})}),ce==="note"&&a.jsx("div",{className:"p-3",children:a.jsxs("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-xl p-4",children:[a.jsx("div",{className:"text-sm text-red-700 dark:text-red-400 mb-1",children:"S·ªë ti·ªÅn n·ª£"}),a.jsx("div",{className:"text-2xl font-bold text-red-600 dark:text-red-400",children:Se(Ae)})]})})]}),a.jsx("div",{className:"p-3 bg-white dark:bg-slate-800 border-t border-slate-200 dark:border-slate-700 space-y-2 flex-shrink-0",children:a.jsxs("div",{className:"flex gap-2",children:[a.jsx("button",{onClick:Ve,className:"flex-1 py-3 border-2 border-slate-300 dark:border-slate-600 text-slate-700 dark:text-slate-300 rounded-xl font-medium active:scale-98 transition-transform",children:"üíæ L∆∞u Nh√°p"}),a.jsx("button",{onClick:C,disabled:!m||p.length===0,className:"flex-1 py-3 bg-blue-600 hover:bg-blue-700 disabled:bg-slate-300 dark:disabled:bg-slate-600 text-white rounded-xl font-bold active:scale-98 transition-transform disabled:cursor-not-allowed",children:"‚úÖ NH·∫¨P KHO"})]})})]})})}),a.jsx(Si,{isOpen:xe,onClose:()=>pe(!1),selectedSupplierId:m,onSelectSupplier:k}),a.jsx(ra,{isOpen:j,onClose:()=>Ce(!1),onScan:rt})]}):null},na=({transactions:x})=>{const{currentBranchId:g}=os(),{data:h=[]}=wn(),[p,w]=V.useState("7days"),[m,k]=V.useState(Or(new Date,!0)),[P,B]=V.useState(Or(new Date,!0)),[C,R]=V.useState(""),[_,ne]=V.useState(!1),[$,q]=V.useState(null),K=V.useMemo(()=>{let X=x.filter(W=>W.type==="Nh·∫≠p kho");const I=new Date;switch(p){case"7days":const W=new Date(I.getTime()-6048e5);X=X.filter(S=>new Date(S.date)>=W);break;case"30days":const oe=new Date(I.getTime()-720*60*60*1e3);X=X.filter(S=>new Date(S.date)>=oe);break;case"thisMonth":const re=new Date(I.getFullYear(),I.getMonth(),1);X=X.filter(S=>new Date(S.date)>=re);break;case"custom":X=X.filter(S=>{const U=new Date(S.date);return U>=new Date(m)&&U<=new Date(P)});break}if(C){const W=C.toLowerCase();X=X.filter(oe=>oe.partName.toLowerCase().includes(W)||oe.notes&&oe.notes.toLowerCase().includes(W))}return X.sort((W,oe)=>new Date(oe.date).getTime()-new Date(W.date).getTime())},[x,p,m,P,C]),ce=V.useMemo(()=>K.reduce((X,I)=>X+I.totalPrice,0),[K]),he=V.useMemo(()=>{const X=new Map;return K.forEach(I=>{var U,M;const W=new Date(I.date),oe=`${W.getFullYear()}-${String(W.getMonth()+1).padStart(2,"0")}-${String(W.getDate()).padStart(2,"0")}`,re=(U=I.notes)!=null&&U.includes("NCC:")?(M=I.notes.split("NCC:")[1])==null?void 0:M.trim():"Kh√¥ng x√°c ƒë·ªãnh",S=`${oe}_${re}_${W.getHours()}_${W.getMinutes()}`;X.has(S)||X.set(S,[]),X.get(S).push(I)}),Array.from(X.entries()).map(([I,W],oe)=>{var M,xe,pe;const re=W[0],S=new Date(re.date);let U="";if(re.notes){const G=re.notes.match(/NH-\d{8}-\d{3}/);G&&(U=G[0])}return U||(U=`NH-${`${S.getFullYear()}${String(S.getMonth()+1).padStart(2,"0")}${String(S.getDate()).padStart(2,"0")}`}-${String(X.size-oe).padStart(3,"0")}`),{receiptCode:U,date:re.date,supplier:(M=re.notes)!=null&&M.includes("NCC:")?(pe=(xe=re.notes.split("NCC:")[1])==null?void 0:xe.split("|")[0])==null?void 0:pe.trim():"Kh√¥ng x√°c ƒë·ªãnh",items:W,total:W.reduce((G,ie)=>G+ie.totalPrice,0)}}).sort((I,W)=>new Date(W.date).getTime()-new Date(I.date).getTime())},[K]);return a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"flex flex-col h-full bg-slate-50 dark:bg-[#0f172a]",children:[a.jsxs("div",{className:"sticky top-0 z-10 bg-white dark:bg-[#1e293b] border-b border-slate-200 dark:border-slate-700 p-3 space-y-2",children:[a.jsx("input",{type:"text",value:C,onChange:X=>R(X.target.value),placeholder:"T√¨m NCC, ph·ª• t√πng...",className:"w-full px-4 py-2.5 border border-slate-300 dark:border-slate-600 rounded-lg dark:bg-slate-700 dark:text-slate-100 placeholder-slate-400 text-sm"}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsxs("button",{onClick:()=>ne(!0),className:"flex-1 flex items-center justify-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg text-sm font-medium",children:[a.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z"})}),"B·ªô l·ªçc"]}),a.jsx("div",{className:"px-4 py-2 bg-slate-100 dark:bg-slate-700 rounded-lg text-sm font-medium text-slate-700 dark:text-slate-300",children:he.length})]})]}),a.jsx("div",{className:"px-3 py-3 bg-blue-50 dark:bg-blue-900/20 border-b border-blue-100 dark:border-blue-800",children:a.jsxs("div",{className:"flex justify-between items-center",children:[a.jsx("div",{className:"text-xs text-blue-600 dark:text-blue-400",children:"T·ªïng gi√° tr·ªã nh·∫≠p"}),a.jsx("div",{className:"text-xl font-bold text-blue-600 dark:text-blue-400",children:Se(ce)})]})}),a.jsx("div",{className:"flex-1 overflow-auto",children:he.length===0?a.jsxs("div",{className:"flex flex-col items-center justify-center h-full p-8 text-center",children:[a.jsx("div",{className:"text-6xl mb-4",children:"üì¶"}),a.jsx("h3",{className:"text-lg font-semibold text-slate-900 dark:text-slate-100 mb-2",children:"Kh√¥ng c√≥ d·ªØ li·ªáu"}),a.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400",children:"Th·ª≠ thay ƒë·ªïi b·ªô l·ªçc ho·∫∑c th·ªùi gian"})]}):a.jsx("div",{className:"divide-y divide-slate-200 dark:divide-slate-700",children:he.map(X=>{const I=new Date(X.date),W=I.toLocaleDateString("vi-VN",{day:"2-digit",month:"2-digit",year:"numeric"}),oe=I.toLocaleTimeString("vi-VN",{hour:"2-digit",minute:"2-digit"}),re=h.find(M=>{var xe;return(xe=M.description)==null?void 0:xe.includes(X.receiptCode)}),S=(re==null?void 0:re.remainingAmount)||0,U=S>0;return a.jsxs("button",{onClick:()=>q({...X,date:new Date(X.date)}),className:"w-full p-4 bg-white dark:bg-[#1e293b] hover:bg-slate-50 dark:hover:bg-slate-700/50 transition-colors text-left",children:[a.jsxs("div",{className:"flex items-start justify-between gap-3 mb-3",children:[a.jsxs("div",{children:[a.jsx("div",{className:"text-sm font-bold text-cyan-600 dark:text-cyan-400",children:X.receiptCode}),a.jsxs("div",{className:"text-xs text-slate-500 dark:text-slate-400 mt-0.5",children:[W," ¬∑ ",oe]})]}),a.jsxs("div",{className:"text-right",children:[a.jsx("div",{className:"text-xs text-slate-500 dark:text-slate-400",children:"T·ªïng ti·ªÅn"}),a.jsx("div",{className:"text-base font-bold text-slate-900 dark:text-white",children:Se(X.total)})]})]}),a.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[a.jsx("div",{className:"w-8 h-8 rounded-full bg-orange-100 dark:bg-orange-900/30 flex items-center justify-center text-lg",children:"üè¢"}),a.jsx("div",{className:"text-sm font-medium text-slate-900 dark:text-white",children:X.supplier})]}),a.jsxs("div",{className:"text-xs text-slate-600 dark:text-slate-400",children:[X.items.length," s·∫£n ph·∫©m"]}),U&&a.jsx("div",{className:"mt-2",children:a.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium bg-orange-100 text-orange-700 dark:bg-orange-900/30 dark:text-orange-200",children:["‚ö†Ô∏è C√≤n n·ª£ ",Se(S)]})})]},X.receiptCode)})})})]}),_&&a.jsxs("div",{className:"fixed inset-0 z-50 flex items-end",children:[a.jsx("div",{className:"absolute inset-0 bg-black/50",onClick:()=>ne(!1)}),a.jsxs("div",{className:"relative bg-white dark:bg-[#1e293b] rounded-t-2xl w-full max-h-[80vh] overflow-hidden flex flex-col",children:[a.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-slate-200 dark:border-slate-700",children:[a.jsx("h3",{className:"text-lg font-semibold text-slate-900 dark:text-slate-100",children:"B·ªô l·ªçc th·ªùi gian"}),a.jsx("button",{onClick:()=>ne(!1),className:"p-2 hover:bg-slate-100 dark:hover:bg-slate-700 rounded-lg",children:a.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),a.jsxs("div",{className:"flex-1 overflow-auto p-4 space-y-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:"Th·ªùi gian"}),a.jsx("div",{className:"grid grid-cols-2 gap-2",children:[{key:"7days",label:"7 ng√†y qua"},{key:"30days",label:"30 ng√†y qua"},{key:"thisMonth",label:"Th√°ng n√†y"},{key:"custom",label:"T√πy ch·ªçn"}].map(X=>a.jsx("button",{onClick:()=>w(X.key),className:`px-4 py-2.5 rounded-lg text-sm font-medium transition-colors ${p===X.key?"bg-blue-600 text-white":"bg-slate-100 dark:bg-slate-700 text-slate-700 dark:text-slate-300"}`,children:X.label},X.key))})]}),p==="custom"&&a.jsxs("div",{className:"space-y-3",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"T·ª´ ng√†y"}),a.jsx("input",{type:"date",value:m,onChange:X=>k(X.target.value),className:"w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg dark:bg-slate-700 dark:text-slate-100"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"ƒê·∫øn ng√†y"}),a.jsx("input",{type:"date",value:P,onChange:X=>B(X.target.value),className:"w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg dark:bg-slate-700 dark:text-slate-100"})]})]})]}),a.jsx("div",{className:"p-4 border-t border-slate-200 dark:border-slate-700",children:a.jsx("button",{onClick:()=>ne(!1),className:"w-full px-4 py-2.5 bg-blue-600 text-white rounded-lg text-sm font-medium",children:"√Åp d·ª•ng"})})]})]}),$&&a.jsxs("div",{className:"fixed inset-0 z-50 flex items-end",children:[a.jsx("div",{className:"absolute inset-0 bg-black/50",onClick:()=>q(null)}),a.jsxs("div",{className:"relative bg-white dark:bg-[#1e293b] rounded-t-2xl w-full max-h-[85vh] overflow-hidden flex flex-col",children:[a.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-slate-200 dark:border-slate-700",children:[a.jsx("h3",{className:"text-lg font-semibold text-slate-900 dark:text-slate-100",children:"Chi ti·∫øt phi·∫øu nh·∫≠p"}),a.jsx("button",{onClick:()=>q(null),className:"p-2 hover:bg-slate-100 dark:hover:bg-slate-700 rounded-lg",children:a.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),a.jsxs("div",{className:"flex-1 overflow-auto p-4 space-y-4",children:[a.jsxs("div",{className:"bg-cyan-50 dark:bg-cyan-900/20 rounded-lg p-3",children:[a.jsx("div",{className:"text-xs text-cyan-600 dark:text-cyan-400 mb-1",children:"M√£ phi·∫øu"}),a.jsx("div",{className:"text-lg font-bold text-cyan-600 dark:text-cyan-400",children:$.receiptCode})]}),a.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[a.jsxs("div",{className:"bg-slate-50 dark:bg-slate-800 rounded-lg p-3",children:[a.jsx("div",{className:"text-xs text-slate-500 dark:text-slate-400 mb-1",children:"Ng√†y nh·∫≠p"}),a.jsx("div",{className:"text-sm font-medium text-slate-900 dark:text-white",children:Or(new Date($.date))})]}),a.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 rounded-lg p-3",children:[a.jsx("div",{className:"text-xs text-blue-600 dark:text-blue-400 mb-1",children:"T·ªïng ti·ªÅn"}),a.jsx("div",{className:"text-lg font-bold text-blue-600 dark:text-blue-400",children:Se($.total)})]})]}),a.jsxs("div",{className:"bg-orange-50 dark:bg-orange-900/20 rounded-lg p-3",children:[a.jsx("div",{className:"text-xs text-orange-600 dark:text-orange-400 mb-1",children:"Nh√† cung c·∫•p"}),a.jsx("div",{className:"text-base font-semibold text-orange-900 dark:text-orange-100",children:$.supplier})]}),a.jsxs("div",{children:[a.jsxs("h4",{className:"text-sm font-semibold text-slate-900 dark:text-slate-100 mb-2",children:["Danh s√°ch s·∫£n ph·∫©m (",$.items.length,")"]}),a.jsx("div",{className:"space-y-2",children:$.items.map(X=>a.jsxs("div",{className:"flex items-start justify-between p-3 bg-slate-50 dark:bg-slate-800 rounded-lg",children:[a.jsxs("div",{className:"flex-1",children:[a.jsxs("div",{className:"text-sm font-medium text-slate-900 dark:text-white",children:[X.quantity," x ",X.partName]}),a.jsxs("div",{className:"text-xs text-slate-500 dark:text-slate-400 mt-0.5",children:[Se(X.unitPrice||0)," / SP"]})]}),a.jsx("div",{className:"text-sm font-bold text-slate-900 dark:text-white",children:Se(X.quantity*(X.unitPrice||0))})]},X.id))})]})]})]})]})]})},ur=5,xn={neutral:{buttonActive:"border-blue-500 bg-blue-500/10 shadow-[0_5px_25px_rgba(59,130,246,0.15)] text-primary-text",buttonInactive:"border-primary-border bg-primary-bg hover:border-blue-300/70",badgeActive:"border-blue-500 text-blue-600 bg-white/60 dark:bg-slate-900/40 dark:text-blue-400",badgeInactive:"border-secondary-border text-secondary-text"},success:{buttonActive:"border-emerald-500 bg-emerald-50 shadow-[0_5px_25px_rgba(16,185,129,0.2)] text-emerald-900 dark:bg-emerald-950/50 dark:text-emerald-200",buttonInactive:"border-emerald-200 bg-emerald-50/40 hover:border-emerald-400/70 dark:border-emerald-800 dark:bg-emerald-950/20",badgeActive:"border-emerald-500 text-emerald-700 bg-emerald-50 dark:bg-emerald-950/50 dark:text-emerald-300 dark:border-emerald-600",badgeInactive:"border-emerald-200 text-emerald-600 dark:border-emerald-700 dark:text-emerald-400"},warning:{buttonActive:"border-amber-500 bg-amber-50 shadow-[0_5px_25px_rgba(245,158,11,0.25)] text-amber-900 dark:bg-amber-950/50 dark:text-amber-200",buttonInactive:"border-amber-200 bg-amber-50/40 hover:border-amber-400/70 dark:border-amber-800 dark:bg-amber-950/20",badgeActive:"border-amber-500 text-amber-700 bg-amber-50 dark:bg-amber-950/50 dark:text-amber-300 dark:border-amber-600",badgeInactive:"border-amber-200 text-amber-600 dark:border-amber-700 dark:text-amber-400"},danger:{buttonActive:"border-red-500 bg-red-50 shadow-[0_5px_25px_rgba(239,68,68,0.25)] text-red-900 dark:bg-red-950/50 dark:text-red-200",buttonInactive:"border-red-200 bg-red-50/40 hover:border-red-400/70 dark:border-red-800 dark:bg-red-950/20",badgeActive:"border-red-500 text-red-700 bg-red-50 dark:bg-red-950/50 dark:text-red-300 dark:border-red-700",badgeInactive:"border-red-200 text-red-600 dark:border-red-700 dark:text-red-400"}},En=({isOpen:x,onClose:g,onSave:h})=>{const[p,w]=V.useState(""),[m,k]=V.useState(""),[P,B]=V.useState(""),[C,R]=V.useState(1),[_,ne]=V.useState(0),[$,q]=V.useState(0),[K,ce]=V.useState(1),[he,X]=V.useState("th√°ng"),[I,W]=V.useState(!1),{data:oe=[]}=js(),re=pn(),[S,U]=V.useState(!1),[M,xe]=V.useState(""),pe=()=>{if(!p.trim()){be.warning("Vui l√≤ng nh·∫≠p t√™n s·∫£n ph·∫©m");return}h({name:p.trim(),description:m.trim(),category:P||"Ch∆∞a ph√¢n lo·∫°i",quantity:Number(C)||1,importPrice:Number(_)||0,retailPrice:Number($)||0,warranty:Number(K)||0,warrantyUnit:he}),w(""),k(""),B(""),R(1),ne(0),q(0),ce(1),W(!1),X("th√°ng")};return x?a.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-[60] p-4",children:a.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-lg w-full max-w-2xl max-h-[90vh] overflow-hidden flex flex-col",children:[a.jsxs("div",{className:"flex justify-between items-center p-6 border-b border-slate-200 dark:border-slate-700",children:[a.jsx("h2",{className:"text-xl font-bold text-slate-900 dark:text-slate-100",children:"Th√™m s·∫£n ph·∫©m m·ªõi"}),a.jsx("button",{onClick:g,className:"text-slate-500 hover:text-slate-700 dark:hover:text-slate-300 text-2xl",children:"√ó"})]}),a.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{children:[a.jsxs("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:["T√™n s·∫£n ph·∫©m ",a.jsx("span",{className:"text-red-500",children:"*"})]}),a.jsx("input",{type:"text",value:p,onChange:G=>w(G.target.value),className:"w-full px-4 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100",placeholder:"Nh·∫≠p t√™n s·∫£n ph·∫©m"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"M√¥ t·∫£"}),a.jsx("textarea",{value:m,onChange:G=>k(G.target.value),rows:3,className:"w-full px-4 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100",placeholder:"M√¥ t·∫£ s·∫£n ph·∫©m"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"Danh m·ª•c s·∫£n ph·∫©m"}),a.jsxs("div",{className:"flex flex-col gap-2",children:[a.jsxs("div",{className:"flex gap-2",children:[a.jsxs("select",{value:P,onChange:G=>B(G.target.value),className:"flex-1 px-4 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100",children:[a.jsx("option",{value:"",children:"-- Ch·ªçn ho·∫∑c t·∫°o m·ªõi --"}),oe.map(G=>a.jsx("option",{value:G.name,children:G.name},G.id))]}),a.jsx("button",{type:"button",onClick:()=>U(!0),className:"w-10 h-10 flex items-center justify-center bg-white dark:bg-slate-700 border border-slate-300 dark:border-slate-600 rounded-lg hover:bg-slate-50 dark:hover:bg-slate-600","aria-label":"Th√™m danh m·ª•c m·ªõi",children:a.jsx("span",{className:"text-xl text-slate-600 dark:text-slate-300",children:"+"})})]}),S&&a.jsxs("form",{onSubmit:async G=>{G.preventDefault();const ie=M.trim();if(!ie){be.warning("Vui l√≤ng nh·∫≠p t√™n danh m·ª•c");return}if(ie.length<2){be.warning("T√™n qu√° ng·∫Øn");return}try{const ge=await re.mutateAsync({name:ie});B(ge.name),xe(""),U(!1)}catch(ge){be.error((ge==null?void 0:ge.message)||"L·ªói t·∫°o danh m·ª•c")}},className:"flex gap-2",children:[a.jsx("input",{autoFocus:!0,type:"text",value:M,onChange:G=>xe(G.target.value),placeholder:"Nh·∫≠p t√™n danh m·ª•c m·ªõi",className:"flex-1 px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-sm text-slate-900 dark:text-slate-100"}),a.jsx("button",{type:"submit",className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg text-sm font-medium",children:"L∆∞u"}),a.jsx("button",{type:"button",onClick:()=>{U(!1),xe("")},className:"px-4 py-2 border border-slate-300 dark:border-slate-600 rounded-lg text-sm bg-white dark:bg-slate-700 text-slate-700 dark:text-slate-300 hover:bg-slate-50 dark:hover:bg-slate-600",children:"H·ªßy"})]})]})]}),a.jsxs("div",{className:"border-t border-slate-200 dark:border-slate-700 pt-4",children:[a.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-3",children:"Th√¥ng tin nh·∫≠p kho:"}),a.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm text-slate-600 dark:text-slate-400 mb-1",children:"S·ªë l∆∞·ª£ng:"}),a.jsx(ir,{value:C,onValue:G=>{const ie=Ts(_,G);ie.warnings.length&&ie.warnings.forEach(ge=>be.warning(ge)),R(Math.max(1,ie.clean.quantity))},className:"w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100 text-right"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm text-slate-600 dark:text-slate-400 mb-1",children:"Gi√° nh·∫≠p:"}),a.jsx(ir,{value:_,onValue:G=>{const ie=Ts(G,C);ie.warnings.length&&ie.warnings.forEach(ge=>be.warning(ge)),ne(ie.clean.importPrice),I||q(Math.round(ie.clean.importPrice*1.5))},className:"w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100 text-right"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm text-slate-600 dark:text-slate-400 mb-1",children:"Gi√° b√°n l·∫ª:"}),a.jsx(ir,{value:$,onValue:G=>{q(Math.max(0,Math.round(G))),W(!0)},className:"w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100 text-right"})]})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"B·∫£o h√†nh"}),a.jsxs("div",{className:"flex gap-2",children:[a.jsx(ir,{value:K,onValue:G=>ce(Math.max(0,Math.floor(G))),className:"w-24 px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100 text-right"}),a.jsxs("select",{value:he,onChange:G=>X(G.target.value),className:"px-4 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100",children:[a.jsx("option",{value:"th√°ng",children:"th√°ng"}),a.jsx("option",{value:"nƒÉm",children:"nƒÉm"}),a.jsx("option",{value:"ng√†y",children:"ng√†y"})]})]})]})]})}),a.jsx("div",{className:"p-6 border-t border-slate-200 dark:border-slate-700",children:a.jsx("button",{onClick:pe,className:"w-full bg-orange-500 hover:bg-orange-600 text-white px-4 py-3 rounded-lg font-medium",children:"L∆∞u v√† Th√™m v√†o gi·ªè h√†ng"})})]})}):null},ia=({isOpen:x,onClose:g,parts:h,currentBranchId:p,onSave:w})=>{const[m,k]=V.useState([]),[P,B]=V.useState(""),[C,R]=V.useState(""),[_,ne]=V.useState(0),[$,q]=V.useState("amount"),[K,ce]=V.useState("cash"),[he,X]=V.useState("full"),[I,W]=V.useState(0),[oe,re]=V.useState(!1),S=Ms();console.log("üì¶ GoodsReceiptMobileWrapper - parts received:",(h==null?void 0:h.length)||0,h==null?void 0:h.slice(0,2)),console.log("üì¶ currentBranchId:",p),V.useEffect(()=>{x||(k([]),B(""),R(""),ne(0),q("amount"),ce("cash"),X("full"),W(0))},[x]);const U=xe=>{(async()=>{var pe;try{const G=await S.mutateAsync({name:xe.name,sku:xe.sku||`SKU-${Date.now()}`,category:xe.category,stock:{[p]:xe.quantity},costPrice:{[p]:xe.importPrice},retailPrice:{[p]:xe.retailPrice},wholesalePrice:{[p]:xe.wholesalePrice||0}});if(!G.ok)throw new Error(((pe=G.error)==null?void 0:pe.message)||"Failed to create part");k(ie=>[...ie,{partId:G.data.id,partName:xe.name,sku:xe.sku||`SKU-${Date.now()}`,quantity:xe.quantity,importPrice:xe.importPrice,sellingPrice:xe.retailPrice,wholesalePrice:xe.wholesalePrice||0}]),be.success("ƒê√£ t·∫°o ph·ª• t√πng m·ªõi v√† th√™m v√†o phi·∫øu nh·∫≠p")}catch(G){be.error((G==null?void 0:G.message)||"L·ªói t·∫°o ph·ª• t√πng m·ªõi")}finally{re(!1)}})()},M=()=>{if(!P){be.error("Vui l√≤ng ch·ªçn nh√† cung c·∫•p");return}if(m.length===0){be.error("Vui l√≤ng th√™m s·∫£n ph·∫©m");return}const xe=m.reduce((ge,j)=>ge+j.quantity*j.importPrice,0),pe=$==="percent"?Math.round(xe*_/100):_,G=Math.max(0,xe-pe);let ie=0;he==="full"?ie=G:he==="partial"&&(ie=I),w(m,P,G,"",{paymentMethod:K,paymentType:he,paidAmount:ie,discount:pe}),g()};return a.jsxs(a.Fragment,{children:[a.jsx(sa,{isOpen:x,onClose:g,parts:h,receiptItems:m,setReceiptItems:k,selectedSupplier:P,setSelectedSupplier:B,searchTerm:C,setSearchTerm:R,onSave:M,discount:_,setDiscount:ne,discountType:$,setDiscountType:q,paymentMethod:K,setPaymentMethod:ce,paymentType:he,setPaymentType:X,partialAmount:I,setPartialAmount:W,showAddProductModal:oe,setShowAddProductModal:re,onAddNewProduct:U,currentBranchId:p}),a.jsx(En,{isOpen:oe,onClose:()=>re(!1),onSave:U})]})},aa=({isOpen:x,onClose:g,parts:h,currentBranchId:p,onSave:w})=>{const[m,k]=V.useState(""),[P,B]=V.useState(""),C=V.useRef(null),[R,_]=V.useState(""),[ne,$]=V.useState(1),{data:q=[]}=Ds(),K=Cn(),[ce,he]=V.useState(!1),[X,I]=V.useState({name:"",phone:"",address:"",note:""}),W=Ms(),[oe,re]=V.useState(!1),[S,U]=V.useState([]),[M,xe]=V.useState(null),[pe,G]=V.useState(null),[ie,ge]=V.useState(0),[j,Ce]=V.useState(0),[J,Ne]=V.useState("amount"),[Oe,Qe]=V.useState(0),rt=V.useMemo(()=>{if(console.log("üîç Desktop Modal - parts:",(h==null?void 0:h.length)||0,h==null?void 0:h.slice(0,2)),console.log("üîç Desktop Modal - searchTerm:",m),!h||h.length===0)return console.log("‚ö†Ô∏è parts is empty or undefined"),[];if(!m||m.trim()==="")return console.log("‚úÖ Showing all parts:",h.length),h;const T=m.toLowerCase().trim(),de=h.filter(se=>{var ke,_e;return((ke=se.name)==null?void 0:ke.toLowerCase().includes(T))||((_e=se.sku)==null?void 0:_e.toLowerCase().includes(T))});return console.log("‚úÖ Filtered results:",de.length),de},[h,m]),Ue=T=>{var se,ke;S.find(_e=>_e.partId===T.id)?(U(_e=>_e.map(st=>st.partId===T.id?{...st,quantity:st.quantity+1}:st)),be.success(`ƒê√£ tƒÉng s·ªë l∆∞·ª£ng ${T.name}`)):(U([...S,{partId:T.id,partName:T.name,sku:T.sku,quantity:1,importPrice:((se=T.costPrice)==null?void 0:se[p])||0,sellingPrice:T.retailPrice[p]||0,wholesalePrice:((ke=T.wholesalePrice)==null?void 0:ke[p])||0}]),be.success(`ƒê√£ th√™m ${T.name} v√†o phi·∫øu nh·∫≠p`)),k(""),setTimeout(()=>{var _e;return(_e=C.current)==null?void 0:_e.focus()},100)},Je=T=>{if(T.preventDefault(),!P.trim())return;const de=P.trim(),se=h.find(ke=>{var _e,st;return((_e=ke.sku)==null?void 0:_e.toLowerCase())===de.toLowerCase()||((st=ke.name)==null?void 0:st.toLowerCase().includes(de.toLowerCase()))});se?(Ue(se),B("")):(be.error(`Kh√¥ng t√¨m th·∫•y s·∫£n ph·∫©m c√≥ m√£: ${de}`),B(""))};V.useEffect(()=>{x&&setTimeout(()=>{var T;return(T=C.current)==null?void 0:T.focus()},300)},[x]);const z=(T,de,se)=>{U(ke=>ke.map(_e=>_e.partId===T?{..._e,[de]:se}:_e))},Ae=T=>{U(de=>de.filter(se=>se.partId!==T))},le=V.useMemo(()=>S.reduce((T,de)=>T+de.importPrice*de.quantity,0),[S]),Ve=V.useMemo(()=>Math.max(0,le-j),[le,j]),{profile:Ge}=mn(),ot=()=>{var de;if(!oi(Ge==null?void 0:Ge.role,"part.update_price")){be.error("B·∫°n kh√¥ng c√≥ quy·ªÅn c·∫≠p nh·∫≠t gi√°");return}if(S.length===0){be.warning("Vui l√≤ng ch·ªçn s·∫£n ph·∫©m nh·∫≠p kho");return}(de=q.find(se=>se.id===R))!=null&&de.name,w(S,R,Ve,"",{paymentMethod:M||"cash",paymentType:pe||"full",paidAmount:pe==="full"?Ve:pe==="partial"?ie:0,discount:j}),U([]),_(""),k(""),Ce(0),Qe(0),Ne("amount")},Wt=T=>{(async()=>{try{const de=await W.mutateAsync({name:T.name,sku:`SKU-${Date.now()}`,category:T.category,description:T.description,stock:{[p]:T.quantity},retailPrice:{[p]:T.retailPrice},wholesalePrice:{[p]:Math.round(T.retailPrice*.9)}});U(se=>[...se,{partId:de.id,partName:T.name,sku:de.sku,quantity:T.quantity,importPrice:T.importPrice,sellingPrice:T.retailPrice,wholesalePrice:T.wholesalePrice||0}]),be.success("ƒê√£ t·∫°o ph·ª• t√πng m·ªõi v√† th√™m v√†o phi·∫øu nh·∫≠p")}catch(de){be.error((de==null?void 0:de.message)||"L·ªói t·∫°o ph·ª• t√πng m·ªõi")}finally{re(!1)}})()};return x?a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:a.jsxs("div",{className:"bg-gradient-to-br from-slate-50 to-slate-100 dark:from-slate-900 dark:to-slate-800 w-full max-w-7xl h-[92vh] rounded-2xl shadow-2xl overflow-hidden flex",children:[a.jsxs("div",{className:"w-1/2 flex flex-col bg-white/80 dark:bg-slate-900/80 backdrop-blur-sm border-r border-slate-200/50 dark:border-slate-700/50",children:[a.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-slate-200/50 dark:border-slate-700/50 bg-gradient-to-r from-blue-50/50 to-indigo-50/50 dark:from-slate-800/50 dark:to-slate-800/50",children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("button",{onClick:g,className:"w-9 h-9 flex items-center justify-center hover:bg-white/80 dark:hover:bg-slate-700/80 rounded-lg text-slate-600 dark:text-slate-400 transition-all hover:scale-105",children:a.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),a.jsxs("div",{children:[a.jsx("h2",{className:"text-base font-bold text-slate-900 dark:text-slate-100",children:"Danh m·ª•c s·∫£n ph·∫©m"}),a.jsx("p",{className:"text-[10px] text-slate-500 dark:text-slate-400",children:"Ch·ªçn ƒë·ªÉ th√™m v√†o gi·ªè"})]})]}),a.jsxs("button",{onClick:()=>re(!0),className:"flex items-center gap-2 bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800 text-white px-3 py-2 rounded-lg text-xs font-semibold shadow-lg shadow-blue-500/30 transition-all hover:scale-105",children:[a.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),a.jsx("span",{children:"Th√™m m·ªõi"})]})]}),a.jsxs("div",{className:"p-3 bg-white/50 dark:bg-slate-800/50 space-y-2",children:[a.jsx("form",{onSubmit:Je,children:a.jsxs("div",{className:"relative",children:[a.jsx("svg",{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-blue-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v1m6 11h2m-6 0h-2v4m0-11v3m0 0h.01M12 12h4.01M16 20h4M4 12h4m12 0h.01M5 8h2a1 1 0 001-1V5a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1zm12 0h2a1 1 0 001-1V5a1 1 0 00-1-1h-2a1 1 0 00-1 1v2a1 1 0 001 1zM5 20h2a1 1 0 001-1v-2a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1z"})}),a.jsx("input",{ref:C,type:"text",placeholder:"Qu√©t m√£ v·∫°ch ho·∫∑c nh·∫≠p SKU ƒë·ªÉ th√™m nhanh...",value:P,onChange:T=>B(T.target.value),className:"w-full pl-10 pr-4 py-2.5 border-2 border-blue-300 dark:border-blue-600 rounded-xl bg-blue-50/50 dark:bg-blue-900/20 text-slate-900 dark:text-slate-100 text-sm placeholder:text-blue-500/60 dark:placeholder:text-blue-400/60 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all font-mono"}),P&&a.jsx("button",{type:"button",onClick:()=>B(""),className:"absolute right-3 top-1/2 -translate-y-1/2 text-slate-400 hover:text-slate-600 dark:hover:text-slate-300",children:a.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})}),a.jsxs("div",{className:"relative",children:[a.jsx("svg",{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})}),a.jsx("input",{type:"text",placeholder:"Ho·∫∑c t√¨m ki·∫øm th·ªß c√¥ng...",value:m,onChange:T=>k(T.target.value),className:"w-full pl-10 pr-4 py-2.5 border border-slate-300 dark:border-slate-600 rounded-xl bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100 text-sm placeholder:text-slate-400 focus:ring-2 focus:ring-blue-500/50 focus:border-blue-500 transition-all"})]})]}),a.jsx("div",{className:"flex-1 overflow-y-auto p-3",children:rt.length===0?a.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-slate-400",children:[a.jsx("svg",{className:"w-16 h-16 mb-3 opacity-30",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4"})}),a.jsx("p",{className:"text-sm font-medium",children:"Kh√¥ng t√¨m th·∫•y s·∫£n ph·∫©m"}),a.jsx("p",{className:"text-xs mt-1",children:"Th·ª≠ t√¨m ki·∫øm v·ªõi t·ª´ kh√≥a kh√°c"})]}):a.jsx("div",{className:"space-y-2",children:rt.map(T=>a.jsx("div",{onClick:()=>Ue(T),className:"group p-3 bg-white dark:bg-slate-800 rounded-xl hover:shadow-lg hover:shadow-blue-500/10 cursor-pointer border border-slate-200 dark:border-slate-700 hover:border-blue-400 dark:hover:border-blue-600 transition-all duration-200 hover:scale-[1.02]",children:a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-blue-100 to-indigo-100 dark:from-blue-900/30 dark:to-indigo-900/30 rounded-lg flex items-center justify-center flex-shrink-0 group-hover:scale-110 transition-transform",children:a.jsx("svg",{className:"w-5 h-5 text-blue-600 dark:text-blue-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"})})}),a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsx("div",{className:"font-semibold text-sm text-slate-900 dark:text-slate-100 line-clamp-1 group-hover:text-blue-600 dark:group-hover:text-blue-400 transition-colors",children:T.name}),a.jsxs("div",{className:"text-[10px] text-slate-500 dark:text-slate-400 mt-0.5",children:["SKU: ",a.jsx("span",{className:"font-mono",children:T.sku})]})]}),a.jsx("svg",{className:"w-5 h-5 text-slate-300 dark:text-slate-600 group-hover:text-blue-600 dark:group-hover:text-blue-400 transition-colors",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})]})},T.id))})})]}),a.jsxs("div",{className:"w-1/2 bg-white dark:bg-slate-800 flex flex-col",children:[a.jsxs("div",{className:"p-4 border-b border-slate-200 dark:border-slate-700 bg-gradient-to-r from-emerald-50/30 to-teal-50/30 dark:from-slate-800/50 dark:to-slate-800/50",children:[a.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[a.jsx("svg",{className:"w-4 h-4 text-emerald-600 dark:text-emerald-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"})}),a.jsx("label",{className:"text-sm font-semibold text-slate-700 dark:text-slate-300",children:"Nh√† cung c·∫•p"}),a.jsxs("button",{onClick:()=>{I({name:"",phone:"",address:"",note:""}),he(!0)},className:"ml-auto flex items-center gap-1 text-xs px-2 py-1 rounded-lg bg-emerald-100 text-emerald-700 hover:bg-emerald-200 dark:bg-emerald-900/30 dark:text-emerald-400 dark:hover:bg-emerald-900/50 font-medium transition-all",children:[a.jsx("svg",{className:"w-3.5 h-3.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),"Th√™m NCC"]})]}),a.jsxs("select",{value:R,onChange:T=>_(T.target.value),className:"w-full px-4 py-2.5 border border-slate-300 dark:border-slate-600 rounded-xl bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100 text-sm font-medium focus:ring-2 focus:ring-emerald-500/50 focus:border-emerald-500 transition-all",children:[a.jsx("option",{value:"",children:"Ch·ªçn nh√† cung c·∫•p..."}),q.map(T=>a.jsxs("option",{value:T.id,children:[T.name," ",T.phone?`‚Ä¢ ${T.phone}`:""]},T.id))]})]}),ce&&a.jsx("div",{className:"fixed inset-0 z-[60] flex items-center justify-center bg-black/50",children:a.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-lg shadow-xl w-full max-w-md p-6 space-y-4",children:[a.jsx("h3",{className:"text-lg font-semibold text-slate-800 dark:text-slate-100",children:"Th√™m nh√† cung c·∫•p"}),a.jsxs("div",{className:"space-y-3",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-xs font-medium mb-1 text-slate-600 dark:text-slate-400",children:"T√™n *"}),a.jsx("input",{autoFocus:!0,value:X.name,onChange:T=>I(de=>({...de,name:T.target.value})),className:"w-full px-3 py-2 rounded border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700 text-sm",placeholder:"T√™n nh√† cung c·∫•p"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-xs font-medium mb-1 text-slate-600 dark:text-slate-400",children:"ƒêi·ªán tho·∫°i"}),a.jsx("input",{value:X.phone,onChange:T=>I(de=>({...de,phone:T.target.value})),className:"w-full px-3 py-2 rounded border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700 text-sm",placeholder:"SƒêT"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-xs font-medium mb-1 text-slate-600 dark:text-slate-400",children:"ƒê·ªãa ch·ªâ"}),a.jsx("textarea",{rows:2,value:X.address,onChange:T=>I(de=>({...de,address:T.target.value})),className:"w-full px-3 py-2 rounded border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700 text-sm resize-none",placeholder:"ƒê·ªãa ch·ªâ nh√† cung c·∫•p"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-xs font-medium mb-1 text-slate-600 dark:text-slate-400",children:"Ghi ch√∫"}),a.jsx("textarea",{rows:2,value:X.note,onChange:T=>I(de=>({...de,note:T.target.value})),className:"w-full px-3 py-2 rounded border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700 text-sm resize-none",placeholder:"Th√¥ng tin th√™m (t√πy ch·ªçn)"})]})]}),a.jsxs("div",{className:"flex justify-end gap-2 pt-2",children:[a.jsx("button",{onClick:()=>he(!1),className:"px-4 py-2 text-sm rounded border border-slate-300 dark:border-slate-600 hover:bg-slate-100 dark:hover:bg-slate-700",children:"H·ªßy"}),a.jsx("button",{onClick:async()=>{var T,de;if(!X.name.trim()){be.warning("Nh·∫≠p t√™n nh√† cung c·∫•p");return}try{const se=await K.mutateAsync({name:X.name.trim(),phone:((T=X.phone)==null?void 0:T.trim())||void 0,address:((de=X.address)==null?void 0:de.trim())||void 0});_(se.id),he(!1)}catch{}},className:"px-4 py-2 text-sm rounded bg-blue-600 text-white hover:bg-blue-700 disabled:opacity-60",disabled:K.isPending,children:K.isPending?"ƒêang l∆∞u...":"L∆∞u"})]})]})}),a.jsxs("div",{className:"flex-1 overflow-y-auto p-4",children:[a.jsxs("div",{className:"flex items-center justify-between mb-3",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("svg",{className:"w-5 h-5 text-blue-600 dark:text-blue-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z"})}),a.jsx("h3",{className:"text-base font-bold text-slate-900 dark:text-slate-100",children:"Gi·ªè h√†ng nh·∫≠p"})]}),a.jsxs("span",{className:"text-xs text-white bg-gradient-to-r from-blue-600 to-indigo-600 px-3 py-1 rounded-full font-semibold shadow-lg",children:[S.length," s·∫£n ph·∫©m"]})]}),S.length===0?a.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-slate-400",children:[a.jsx("div",{className:"w-24 h-24 bg-gradient-to-br from-slate-100 to-slate-200 dark:from-slate-800 dark:to-slate-700 rounded-2xl flex items-center justify-center mb-4",children:a.jsx("svg",{className:"w-12 h-12 text-slate-300 dark:text-slate-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z"})})}),a.jsx("p",{className:"text-sm font-semibold text-slate-500 dark:text-slate-400",children:"Gi·ªè h√†ng tr·ªëng"}),a.jsx("p",{className:"text-xs text-slate-400 mt-1",children:"Ch·ªçn s·∫£n ph·∫©m b√™n tr√°i ƒë·ªÉ th√™m v√†o"})]}):a.jsx("div",{className:"space-y-3",children:S.map((T,de)=>a.jsxs("div",{className:"bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded-lg p-2.5 hover:shadow-md transition-shadow",children:[a.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[a.jsx("div",{className:"w-6 h-6 bg-blue-600 rounded flex items-center justify-center flex-shrink-0",children:a.jsxs("span",{className:"text-xs font-bold text-white",children:["#",de+1]})}),a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsx("div",{className:"font-medium text-xs text-slate-900 dark:text-slate-100 truncate",children:T.partName}),a.jsxs("div",{className:"text-[9px] text-slate-500 dark:text-slate-400",children:["SKU: ",T.sku]})]}),a.jsx("button",{onClick:()=>Ae(T.partId),className:"w-6 h-6 flex items-center justify-center bg-red-100 dark:bg-red-900/30 rounded text-red-600 dark:text-red-400 hover:bg-red-200 flex-shrink-0",title:"X√≥a",children:"√ó"})]}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsxs("div",{className:"flex items-center gap-1",children:[a.jsx("button",{onClick:()=>z(T.partId,"quantity",Math.max(1,T.quantity-1)),className:"w-6 h-6 flex items-center justify-center bg-slate-100 dark:bg-slate-700 rounded text-slate-600 dark:text-slate-300 hover:bg-blue-50 text-sm",children:"-"}),a.jsx("input",{type:"number",value:T.quantity,onChange:se=>{const ke=parseInt(se.target.value)||1;z(T.partId,"quantity",Math.max(1,ke))},className:"w-10 px-1 py-1 text-center border border-blue-300 dark:border-blue-700 rounded bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100 text-xs font-semibold",min:"1"}),a.jsx("button",{onClick:()=>z(T.partId,"quantity",T.quantity+1),className:"w-6 h-6 flex items-center justify-center bg-slate-100 dark:bg-slate-700 rounded text-slate-600 dark:text-slate-300 hover:bg-blue-50 text-sm",children:"+"})]}),a.jsx(ir,{value:T.importPrice,onValue:se=>{const{clean:ke}=Ts(se,T.quantity),_e=ke.importPrice,st=Math.round(_e*1.5);U(ht=>ht.map(De=>De.partId===T.partId?{...De,importPrice:_e,sellingPrice:De.sellingPrice===0||De.sellingPrice===Math.round((De.importPrice||0)*1.5)?st:De.sellingPrice}:De))},className:"flex-1 px-2 py-1 border border-slate-300 dark:border-slate-600 rounded bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100 text-right text-xs font-medium focus:border-blue-500",placeholder:"Gi√° nh·∫≠p"}),a.jsx(ir,{value:T.sellingPrice,onValue:se=>z(T.partId,"sellingPrice",Math.max(0,Math.round(se))),className:"flex-1 px-2 py-1 border border-slate-300 dark:border-slate-600 rounded bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100 text-right text-xs font-medium focus:border-emerald-500",placeholder:"Gi√° b√°n"}),a.jsx("div",{className:"w-20 text-right",children:a.jsx("div",{className:"text-xs font-bold text-blue-600 dark:text-blue-400",children:Se(T.importPrice*T.quantity)})})]})]},T.partId))})]}),a.jsxs("div",{className:"p-3 border-t-2 border-slate-200 dark:border-slate-700 bg-slate-50 dark:bg-slate-800",children:[a.jsx("div",{className:"mb-3 p-3 bg-gradient-to-r from-blue-600 to-indigo-600 rounded-lg shadow",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx("span",{className:"text-xs font-semibold text-white uppercase",children:"T·ªïng thanh to√°n"}),a.jsxs("div",{className:"text-right",children:[a.jsx("div",{className:"text-xl font-black text-white",children:Se(Ve)}),a.jsxs("div",{className:"text-[10px] text-white/70",children:[S.length," SP"]})]})]})}),a.jsxs("div",{className:"mb-3",children:[a.jsxs("label",{className:"block text-[10px] font-bold text-slate-700 dark:text-slate-300 mb-1.5",children:["Ph∆∞∆°ng th·ª©c thanh to√°n ",a.jsx("span",{className:"text-red-500",children:"*"})]}),a.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[a.jsx("button",{onClick:()=>xe("cash"),className:`flex items-center justify-center gap-1.5 px-3 py-2 border-2 rounded-lg text-xs font-bold transition-all ${M==="cash"?"border-emerald-500 bg-emerald-50 dark:bg-emerald-900/30 text-emerald-700 dark:text-emerald-400":"border-slate-300 dark:border-slate-600 text-slate-700 dark:text-slate-300"}`,children:"üíµ Ti·ªÅn m·∫∑t"}),a.jsx("button",{onClick:()=>xe("bank"),className:`flex items-center justify-center gap-1.5 px-3 py-2 border-2 rounded-lg text-xs font-bold transition-all ${M==="bank"?"border-blue-500 bg-blue-50 dark:bg-blue-900/30 text-blue-700 dark:text-blue-400":"border-slate-300 dark:border-slate-600 text-slate-700 dark:text-slate-300"}`,children:"üè¶ Chuy·ªÉn kho·∫£n"})]})]}),M&&a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"mb-3",children:[a.jsx("label",{className:"block text-[10px] font-bold text-slate-700 dark:text-slate-300 mb-1.5",children:"H√¨nh th·ª©c thanh to√°n"}),a.jsxs("div",{className:"grid grid-cols-3 gap-1.5",children:[a.jsx("button",{onClick:()=>{G("full"),ge(0)},className:`px-2 py-1.5 border-2 rounded-lg text-[10px] font-bold transition-all ${pe==="full"?"border-blue-500 bg-blue-50 dark:bg-blue-900/30 text-blue-700 dark:text-blue-400":"border-slate-300 dark:border-slate-600 text-slate-700 dark:text-slate-300"}`,children:"ƒê·ªß"}),a.jsx("button",{onClick:()=>G("partial"),className:`px-2 py-1.5 border-2 rounded-lg text-[10px] font-bold transition-all ${pe==="partial"?"border-orange-500 bg-orange-50 dark:bg-orange-900/30 text-orange-700 dark:text-orange-400":"border-slate-300 dark:border-slate-600 text-slate-700 dark:text-slate-300"}`,children:"1 ph·∫ßn"}),a.jsx("button",{onClick:()=>{G("note"),ge(0)},className:`px-2 py-1.5 border-2 rounded-lg text-[10px] font-bold transition-all ${pe==="note"?"border-purple-500 bg-purple-50 dark:bg-purple-900/30 text-purple-700 dark:text-purple-400":"border-slate-300 dark:border-slate-600 text-slate-700 dark:text-slate-300"}`,children:"C√¥ng n·ª£"})]})]}),pe==="partial"&&a.jsxs("div",{className:"mb-3",children:[a.jsx("label",{className:"block text-[10px] font-bold text-slate-700 dark:text-slate-300 mb-1.5",children:"S·ªë ti·ªÅn kh√°ch tr·∫£"}),a.jsx(ir,{value:ie,onValue:T=>ge(Math.max(0,Math.round(T))),className:"w-full px-3 py-2 border-2 border-orange-300 dark:border-orange-700 rounded-lg bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100 text-right text-sm font-bold focus:border-orange-500",placeholder:"Nh·∫≠p s·ªë ti·ªÅn..."}),a.jsxs("div",{className:"mt-1.5 flex items-center justify-between text-[10px]",children:[a.jsx("span",{className:"text-slate-500",children:"C√≤n l·∫°i:"}),a.jsx("span",{className:"font-bold text-red-600 dark:text-red-400",children:Se(Math.max(0,Ve-ie))})]})]}),pe&&a.jsxs("div",{className:"mb-3",children:[a.jsx("label",{className:"block text-[10px] font-bold text-slate-700 dark:text-slate-300 mb-1.5",children:"Lo·∫°i h·∫°ch to√°n"}),a.jsxs("select",{className:"w-full px-3 py-2 border-2 border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100 text-xs font-semibold focus:border-blue-500",children:[a.jsx("option",{children:"Mua h√†ng/nh·∫≠p kho"}),a.jsx("option",{children:"Nh·∫≠p tr·∫£ h√†ng"}),a.jsx("option",{children:"Kh√°c"})]})]})]}),a.jsxs("div",{className:"flex gap-2",children:[a.jsx("button",{onClick:g,className:"flex-1 bg-slate-200 hover:bg-slate-300 dark:bg-slate-700 dark:hover:bg-slate-600 text-slate-900 dark:text-slate-100 px-3 py-2.5 rounded-lg font-bold text-xs transition-all",children:a.jsxs("div",{className:"flex items-center justify-center gap-2",children:[a.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V4"})}),"L∆ØU NH√ÅP"]})}),a.jsx("button",{onClick:()=>{if(!M){be.warning("Vui l√≤ng ch·ªçn ph∆∞∆°ng th·ª©c thanh to√°n");return}if(!pe){be.warning("Vui l√≤ng ch·ªçn h√¨nh th·ª©c thanh to√°n");return}if(pe==="partial"&&ie<=0){be.warning("Vui l√≤ng nh·∫≠p s·ªë ti·ªÅn kh√°ch tr·∫£");return}ot()},disabled:!M||!pe||pe==="partial"&&ie<=0,className:"flex-1 bg-orange-500 hover:bg-orange-600 text-white px-3 py-2.5 rounded-lg font-bold text-xs transition-all disabled:bg-slate-300 disabled:text-slate-500 disabled:cursor-not-allowed dark:disabled:bg-slate-600 dark:disabled:text-slate-400",children:a.jsxs("div",{className:"flex items-center justify-center gap-2",children:[a.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 8h14M5 8a2 2 0 110-4h14a2 2 0 110 4M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8m-9 4h4"})}),"NH·∫¨P KHO"]})})]})]})]})]})}),a.jsx(En,{isOpen:oe,onClose:()=>re(!1),onSave:Wt})]}):null},oa=({isOpen:x,onClose:g,onSave:h,initialData:p,mode:w})=>{const[m,k]=V.useState((p==null?void 0:p.name)||""),[P,B]=V.useState((p==null?void 0:p.phone)||""),[C,R]=V.useState((p==null?void 0:p.address)||""),[_,ne]=V.useState((p==null?void 0:p.email)||"");V.useEffect(()=>{p&&(k(p.name),B(p.phone),R(p.address),ne(p.email))},[p]);const $=q=>{if(q.preventDefault(),!m.trim()){be.error("Vui l√≤ng nh·∫≠p t√™n nh√† cung c·∫•p");return}h({name:m.trim(),phone:P.trim(),address:C.trim(),email:_.trim()})};return x?a.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-[60] p-4",children:a.jsx("div",{className:"bg-white dark:bg-slate-800 rounded-lg w-full max-w-md",children:a.jsxs("form",{onSubmit:$,children:[a.jsxs("div",{className:"flex justify-between items-center p-4 border-b border-slate-200 dark:border-slate-700",children:[a.jsx("h3",{className:"text-lg font-semibold text-slate-900 dark:text-slate-100",children:w==="add"?"Th√™m nh√† cung c·∫•p m·ªõi":"Ch·ªânh s·ª≠a nh√† cung c·∫•p"}),a.jsx("button",{type:"button",onClick:g,className:"text-slate-500 hover:text-slate-700 dark:hover:text-slate-300 text-2xl",children:"√ó"})]}),a.jsxs("div",{className:"p-4 space-y-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"T√™n nh√† cung c·∫•p *"}),a.jsx("input",{type:"text",value:m,onChange:q=>k(q.target.value),placeholder:"Nh·∫≠p t√™n nh√† cung c·∫•p",className:"w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100",required:!0,autoFocus:!0})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"S·ªë ƒëi·ªán tho·∫°i"}),a.jsx("input",{type:"tel",value:P,onChange:q=>B(q.target.value),placeholder:"Nh·∫≠p s·ªë ƒëi·ªán tho·∫°i",className:"w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"Email"}),a.jsx("input",{type:"email",value:_,onChange:q=>ne(q.target.value),placeholder:"Nh·∫≠p email",className:"w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"ƒê·ªãa ch·ªâ"}),a.jsx("textarea",{value:C,onChange:q=>R(q.target.value),placeholder:"Nh·∫≠p ƒë·ªãa ch·ªâ",rows:3,className:"w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100"})]})]}),a.jsxs("div",{className:"flex justify-end gap-3 p-4 border-t border-slate-200 dark:border-slate-700",children:[a.jsx("button",{type:"button",onClick:g,className:"px-4 py-2 border border-slate-300 dark:border-slate-600 rounded-lg text-slate-700 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-slate-700",children:"H·ªßy"}),a.jsx("button",{type:"submit",className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium",children:w==="add"?"Th√™m":"L∆∞u"})]})]})})}):null},la=({isOpen:x,onClose:g,onAdd:h,currentBranchId:p})=>{const[w,m]=V.useState(""),[k,P]=V.useState(null),[B,C]=V.useState(1),[R,_]=V.useState(0),{data:ne=[]}=Xr({queryKey:["allPartsForReceipt"],queryFn:async()=>{const{data:ce,error:he}=await dt.from("parts").select("*").order("name");if(he)throw he;return ce||[]}}),$=V.useMemo(()=>{if(!w)return[];const ce=w.toLowerCase();return ne.filter(he=>{var X,I;return he.name.toLowerCase().includes(ce)||((X=he.sku)==null?void 0:X.toLowerCase().includes(ce))||((I=he.description)==null?void 0:I.toLowerCase().includes(ce))})},[ne,w]),q=ce=>{var he;P(ce),_(((he=ce.costPrice)==null?void 0:he[p])||0),m(ce.name)},K=ce=>{if(ce.preventDefault(),!k){be.error("Vui l√≤ng ch·ªçn s·∫£n ph·∫©m");return}if(B<=0){be.error("S·ªë l∆∞·ª£ng ph·∫£i l·ªõn h∆°n 0");return}if(R<0){be.error("ƒê∆°n gi√° kh√¥ng ƒë∆∞·ª£c √¢m");return}h({partId:k.id,partName:k.name,sku:k.sku||"",quantity:B,unitPrice:R}),m(""),P(null),C(1),_(0)};return x?a.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-[60] p-4",children:a.jsx("div",{className:"bg-white dark:bg-slate-800 rounded-lg w-full max-w-lg",children:a.jsxs("form",{onSubmit:K,children:[a.jsxs("div",{className:"flex justify-between items-center p-4 border-b border-slate-200 dark:border-slate-700",children:[a.jsx("h3",{className:"text-lg font-semibold text-slate-900 dark:text-slate-100",children:"Th√™m s·∫£n ph·∫©m v√†o phi·∫øu"}),a.jsx("button",{type:"button",onClick:g,className:"text-slate-500 hover:text-slate-700 dark:hover:text-slate-300 text-2xl",children:"√ó"})]}),a.jsxs("div",{className:"p-4 space-y-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"T√¨m ki·∫øm s·∫£n ph·∫©m *"}),a.jsxs("div",{className:"relative",children:[a.jsx("input",{type:"text",value:w,onChange:ce=>{m(ce.target.value),P(null)},placeholder:"Nh·∫≠p t√™n ho·∫∑c SKU s·∫£n ph·∫©m...",className:"w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100",autoFocus:!0}),w&&!k&&$.length>0&&a.jsx("div",{className:"absolute z-10 w-full mt-1 bg-white dark:bg-slate-800 border border-slate-300 dark:border-slate-600 rounded-lg shadow-lg max-h-60 overflow-y-auto",children:$.map(ce=>{var he;return a.jsxs("button",{type:"button",onClick:()=>q(ce),className:"w-full px-3 py-2 text-left hover:bg-slate-100 dark:hover:bg-slate-700 border-b border-slate-200 dark:border-slate-700 last:border-0",children:[a.jsx("div",{className:"text-sm font-medium text-slate-900 dark:text-slate-100",children:ce.name}),a.jsxs("div",{className:"text-xs text-slate-500",children:["SKU: ",ce.sku||"N/A"," | Gi√° nh·∫≠p:"," ",Se(((he=ce.costPrice)==null?void 0:he[p])||0)]})]},ce.id)})})]}),k&&a.jsxs("div",{className:"mt-2 p-2 bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded text-sm text-green-800 dark:text-green-200",children:["‚úì ƒê√£ ch·ªçn: ",k.name," (",k.sku,")"]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"S·ªë l∆∞·ª£ng *"}),a.jsx("input",{type:"number",value:B,onChange:ce=>C(Number(ce.target.value)),min:"1",className:"w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100",required:!0})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"ƒê∆°n gi√° nh·∫≠p *"}),a.jsx(ir,{value:R,onValue:_,className:"w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100",placeholder:"0"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"Th√†nh ti·ªÅn"}),a.jsx("input",{type:"text",value:Se(B*R),readOnly:!0,className:"w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-slate-100 dark:bg-slate-700 text-slate-900 dark:text-slate-100 font-bold"})]})]}),a.jsxs("div",{className:"flex justify-end gap-3 p-4 border-t border-slate-200 dark:border-slate-700",children:[a.jsx("button",{type:"button",onClick:g,className:"px-4 py-2 border border-slate-300 dark:border-slate-600 rounded-lg text-slate-700 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-slate-700",children:"H·ªßy"}),a.jsx("button",{type:"submit",className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium",children:"Th√™m s·∫£n ph·∫©m"})]})]})})}):null},ca=({receipt:x,onClose:g,onSave:h,currentBranchId:p})=>{const[w,m]=V.useState(x.supplier),[k,P]=V.useState(""),[B,C]=V.useState(x.supplier),[R,_]=V.useState(!1),[ne,$]=V.useState(!1),[q,K]=V.useState("add"),[ce,he]=V.useState(!1),[X,I]=V.useState(null),{data:W=[]}=Xr({queryKey:["suppliers"],queryFn:async()=>{const{data:z,error:Ae}=await dt.from("suppliers").select("*").order("name");if(Ae)throw Ae;return z||[]}}),oe=V.useMemo(()=>{if(!B)return W;const z=B.toLowerCase();return W.filter(Ae=>Ae.name.toLowerCase().includes(z))},[W,B]),[re,S]=V.useState(x.items.map(z=>({id:z.id,partName:z.partName,quantity:z.quantity,unitPrice:z.unitPrice||0,totalPrice:z.quantity*(z.unitPrice||0),notes:z.notes||""}))),[U,M]=V.useState([{time:"15:31",date:x.date,payer:"Xu√¢n Nhan",cashier:"(Ti·ªÅn m·∫∑t)",amount:x.total}]),[xe,pe]=V.useState(!0);Wr.useEffect(()=>{var Ae,le,Ve;const z=x.items[0];if((Ae=z==null?void 0:z.notes)!=null&&Ae.includes("Phone:")){const Ge=(Ve=(le=z.notes.split("Phone:")[1])==null?void 0:le.split("NV:")[0])==null?void 0:Ve.trim();Ge&&P(Ge)}},[x.items]),Wr.useEffect(()=>{const z=Ae=>{Ae.target.closest(".supplier-dropdown-container")||_(!1)};return document.addEventListener("mousedown",z),()=>document.removeEventListener("mousedown",z)},[]);const G=re.reduce((z,Ae)=>z+Ae.totalPrice,0),ie=U.reduce((z,Ae)=>z+Ae.amount,0),ge=(z,Ae)=>{const le=[...re];le[z].quantity=Ae,le[z].totalPrice=Ae*le[z].unitPrice,S(le)},j=(z,Ae)=>{const le=[...re];le[z].unitPrice=Ae,le[z].totalPrice=le[z].quantity*Ae,S(le)},Ce=z=>{if(re.length===1){be.error("Ph·∫£i c√≥ √≠t nh·∫•t 1 s·∫£n ph·∫©m");return}const Ae=re.filter((le,Ve)=>Ve!==z);S(Ae),be.success("ƒê√£ x√≥a s·∫£n ph·∫©m")},J=z=>{const Ae={id:`new-${Date.now()}`,partId:z.partId,partName:z.partName,quantity:z.quantity,unitPrice:z.unitPrice,totalPrice:z.quantity*z.unitPrice,notes:"",sku:z.sku};S([...re,Ae]),he(!1),be.success(`ƒê√£ th√™m ${z.partName} (s·∫Ω l∆∞u khi b·∫•m L∆ØU)`)},Ne=z=>{m(z.name),P(z.phone),$(!1),be.success(q==="add"?"ƒê√£ th√™m nh√† cung c·∫•p":"ƒê√£ c·∫≠p nh·∫≠t nh√† cung c·∫•p")},Oe=()=>{K("edit"),$(!0)},Qe=()=>{K("add"),$(!0)},rt=z=>{I(z),be.info("Click v√†o √¥ s·ªë l∆∞·ª£ng ho·∫∑c ƒë∆°n gi√° ƒë·ªÉ ch·ªânh s·ª≠a")},Ue=z=>{confirm("B·∫°n c√≥ mu·ªën x√≥a s·∫£n ph·∫©m n√†y?")&&Ce(z)},Je=z=>{if(z.preventDefault(),!w){be.error("Vui l√≤ng ch·ªçn nh√† cung c·∫•p");return}if(re.some(Ae=>Ae.quantity<=0)){be.error("S·ªë l∆∞·ª£ng ph·∫£i l·ªõn h∆°n 0");return}h({supplier:w,supplierPhone:k,items:re,payments:U,isPaid:xe})};return a.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:a.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-lg w-full max-w-3xl max-h-[90vh] overflow-y-auto",children:[a.jsxs("form",{onSubmit:Je,children:[a.jsxs("div",{className:"sticky top-0 bg-white dark:bg-slate-800 border-b border-slate-200 dark:border-slate-700 p-4 flex justify-between items-center",children:[a.jsxs("div",{children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("svg",{className:"w-5 h-5 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})}),a.jsxs("h3",{className:"text-lg font-semibold text-slate-900 dark:text-slate-100",children:["[Ch·ªânh s·ª≠a] Phi·∫øu Nh·∫≠p Kho ",x.receiptCode]})]}),a.jsxs("div",{className:"text-sm text-slate-500 dark:text-slate-400 mt-1",children:[new Date(x.date).toLocaleDateString("vi-VN",{day:"2-digit",month:"2-digit",year:"numeric"})," ",new Date(x.date).toLocaleTimeString("vi-VN",{hour:"2-digit",minute:"2-digit"})]})]}),a.jsx("button",{type:"button",onClick:g,className:"text-slate-500 hover:text-slate-700 dark:hover:text-slate-300 text-2xl w-8 h-8 flex items-center justify-center rounded hover:bg-slate-100 dark:hover:bg-slate-700",children:"√ó"})]}),a.jsxs("div",{className:"p-6 space-y-6",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-base font-medium text-teal-600 dark:text-teal-400 mb-2",children:"Nh√† cung c·∫•p:"}),a.jsxs("div",{className:"flex gap-2",children:[a.jsxs("div",{className:"flex-1 relative supplier-dropdown-container",children:[a.jsx("input",{type:"text",value:B,onChange:z=>{C(z.target.value),_(!0)},onFocus:()=>_(!0),placeholder:"T√¨m ki·∫øm v√† ch·ªçn m·ªôt nh√† cung c·∫•p",className:"w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100"}),B&&a.jsx("button",{type:"button",onClick:()=>{C(""),m(""),P("")},className:"absolute right-2 top-1/2 -translate-y-1/2 text-slate-400 hover:text-slate-600",children:"√ó"}),R&&oe.length>0&&a.jsx("div",{className:"absolute z-10 w-full mt-1 bg-white dark:bg-slate-800 border border-slate-300 dark:border-slate-600 rounded-lg shadow-lg max-h-60 overflow-y-auto",children:oe.map(z=>a.jsxs("button",{type:"button",onClick:()=>{m(z.name),C(z.name),P(z.phone||""),_(!1)},className:"w-full px-3 py-2 text-left hover:bg-slate-100 dark:hover:bg-slate-700 border-b border-slate-200 dark:border-slate-700 last:border-0",children:[a.jsx("div",{className:"text-sm font-medium text-slate-900 dark:text-slate-100",children:z.name}),z.phone&&a.jsxs("div",{className:"text-xs text-slate-500",children:["Phone: ",z.phone]})]},z.id))})]}),a.jsxs("button",{type:"button",onClick:Oe,className:"px-4 py-2 border border-slate-300 dark:border-slate-600 rounded-lg text-slate-700 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-slate-700 flex items-center gap-2",children:[a.jsx("svg",{className:"w-5 h-5 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})}),"Ch·ªânh s·ª≠a"]}),a.jsxs("button",{type:"button",onClick:Qe,className:"px-4 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded-lg flex items-center gap-2",children:[a.jsx("span",{className:"text-xl",children:"+"}),"Th√™m m·ªõi"]})]})]}),a.jsxs("div",{children:[a.jsxs("div",{className:"flex justify-between items-center mb-2",children:[a.jsx("label",{className:"block text-base font-medium text-teal-600 dark:text-teal-400",children:"Chi ti·∫øt s·∫£n ph·∫©m nh·∫≠p kho:"}),a.jsxs("button",{type:"button",onClick:()=>he(!0),className:"text-sm text-teal-600 hover:text-teal-700 dark:text-teal-400 flex items-center gap-1",children:[a.jsx("span",{className:"text-lg",children:"+"}),"Th√™m s·∫£n ph·∫©m"]})]}),a.jsx("div",{className:"border border-slate-300 dark:border-slate-600 rounded-lg overflow-hidden",children:a.jsxs("table",{className:"w-full",children:[a.jsx("thead",{className:"bg-slate-50 dark:bg-slate-700",children:a.jsxs("tr",{children:[a.jsx("th",{className:"px-3 py-2 text-left text-sm font-medium text-slate-700 dark:text-slate-300",children:"-"}),a.jsx("th",{className:"px-3 py-2 text-left text-sm font-medium text-slate-700 dark:text-slate-300",children:"T√™n"}),a.jsx("th",{className:"px-3 py-2 text-center text-sm font-medium text-slate-700 dark:text-slate-300",children:"SL"}),a.jsx("th",{className:"px-3 py-2 text-right text-sm font-medium text-slate-700 dark:text-slate-300",children:"ƒê∆°n gi√° nh·∫≠p"}),a.jsx("th",{className:"px-3 py-2 text-right text-sm font-medium text-slate-700 dark:text-slate-300",children:"Th√†nh ti·ªÅn"}),a.jsx("th",{className:"px-3 py-2 text-center text-sm font-medium text-slate-700 dark:text-slate-300 w-20"})]})}),a.jsx("tbody",{className:"divide-y divide-slate-200 dark:divide-slate-700",children:re.map((z,Ae)=>a.jsxs("tr",{className:`hover:bg-slate-50 dark:hover:bg-slate-700/30 transition-colors ${X===Ae?"bg-blue-50 dark:bg-blue-900/20":""}`,children:[a.jsx("td",{className:"px-3 py-3 text-sm text-slate-900 dark:text-slate-100",children:Ae+1}),a.jsxs("td",{className:"px-3 py-3",children:[a.jsx("div",{className:"text-sm text-slate-900 dark:text-slate-100",children:z.partName}),a.jsx("div",{className:"text-xs text-slate-500 dark:text-slate-400",children:"[Kh√°c]"}),a.jsxs("div",{className:"text-xs text-slate-500",children:["- ƒêG B√°n l·∫ª: ",Se(7e4)]}),a.jsxs("div",{className:"text-xs text-slate-500",children:["- ƒêG B√°n s·ªâ: ",Se(0)]}),a.jsx("div",{className:"text-xs text-red-500",children:"(ƒê√£ xu·∫•t kho)"})]}),a.jsx("td",{className:"px-3 py-3 text-center",children:a.jsx("input",{type:"number",value:z.quantity,onChange:le=>ge(Ae,Number(le.target.value)),onFocus:()=>I(Ae),onBlur:()=>I(null),min:"1",className:"w-16 px-2 py-1 border border-slate-300 dark:border-slate-600 rounded text-center bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100 focus:border-blue-500 focus:ring-1 focus:ring-blue-500"})}),a.jsx("td",{className:"px-3 py-3 text-right",children:a.jsx(ir,{value:z.unitPrice,onValue:le=>j(Ae,le),className:"w-28 px-2 py-1 border border-slate-300 dark:border-slate-600 rounded text-right bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100 focus:border-blue-500 focus:ring-1 focus:ring-blue-500"})}),a.jsx("td",{className:"px-3 py-3 text-right text-sm font-medium text-slate-900 dark:text-slate-100",children:Se(z.totalPrice)}),a.jsx("td",{className:"px-3 py-3 text-center",children:a.jsxs("div",{className:"flex justify-center gap-1",children:[a.jsx("button",{type:"button",onClick:()=>rt(Ae),className:"p-1 text-blue-400 hover:bg-blue-500/20 rounded",title:"Ch·ªânh s·ª≠a",children:a.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})})}),a.jsx("button",{type:"button",onClick:()=>Ue(Ae),className:"p-1 text-slate-400 hover:bg-slate-500/20 rounded",title:"X√≥a s·∫£n ph·∫©m",children:a.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 5v.01M12 12v.01M12 19v.01M12 6a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2z"})})})]})})]},z.id))}),a.jsx("tfoot",{className:"bg-slate-50 dark:bg-slate-700",children:a.jsxs("tr",{children:[a.jsx("td",{colSpan:4,className:"px-3 py-2 text-right font-bold text-slate-900 dark:text-slate-100",children:"T·ªîNG:"}),a.jsx("td",{className:"px-3 py-2 text-right font-bold text-slate-900 dark:text-slate-100",children:Se(G)}),a.jsx("td",{})]})})]})})]}),a.jsxs("div",{className:"border border-slate-300 dark:border-slate-600 rounded-lg p-4",children:[a.jsx("label",{className:"block text-base font-medium text-teal-600 dark:text-teal-400 mb-3",children:"C√¥ng n·ª£:"}),a.jsxs("div",{className:"flex items-center justify-between mb-3 p-3 bg-red-50 dark:bg-red-900/20 rounded-lg",children:[a.jsxs("span",{className:"text-lg font-bold text-red-600 dark:text-red-400",children:["T·ªîNG PH·∫¢I CHI: ",Se(G)]}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsxs("span",{className:"text-sm text-green-600 dark:text-green-400 flex items-center gap-1",children:[a.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),"ƒê√£ thanh to√°n ƒë·ªß"]}),a.jsxs("button",{type:"button",className:"px-3 py-1 bg-red-600 hover:bg-red-700 text-white rounded text-sm flex items-center gap-1",children:[a.jsx("span",{className:"text-lg",children:"+"}),"T·∫°o phi·∫øu chi"]})]})]}),a.jsxs("div",{className:"text-xs text-slate-500 dark:text-slate-400 mb-3 flex items-start gap-1",children:[a.jsx("svg",{className:"w-4 h-4 mt-0.5 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),"T·ªïng ph·∫£i chi l√† ph√≠ ch∆∞a ph·∫£i tr·∫£ cho ƒë·ªëi t√°c s·ª≠a ch·ªØa"]}),a.jsxs("table",{className:"w-full text-sm",children:[a.jsx("thead",{className:"border-b border-slate-200 dark:border-slate-700",children:a.jsxs("tr",{children:[a.jsx("th",{className:"px-2 py-2 text-left text-slate-700 dark:text-slate-300",children:"-"}),a.jsx("th",{className:"px-2 py-2 text-left text-slate-700 dark:text-slate-300",children:"Th·ªùi gian"}),a.jsx("th",{className:"px-2 py-2 text-left text-slate-700 dark:text-slate-300",children:"Ng∆∞·ªùi chi - Ghi ch√∫"}),a.jsx("th",{className:"px-2 py-2 text-right text-slate-700 dark:text-slate-300",children:"S·ªë ti·ªÅn"})]})}),a.jsx("tbody",{children:U.map((z,Ae)=>a.jsxs("tr",{className:"border-b border-slate-200 dark:border-slate-700",children:[a.jsx("td",{className:"px-2 py-2 text-slate-900 dark:text-slate-100",children:Ae+1}),a.jsxs("td",{className:"px-2 py-2 text-slate-900 dark:text-slate-100",children:[z.time," ",new Date(z.date).toLocaleDateString("vi-VN",{day:"2-digit",month:"2-digit",year:"numeric"})]}),a.jsxs("td",{className:"px-2 py-2",children:[a.jsx("div",{className:"text-slate-900 dark:text-slate-100",children:z.payer}),a.jsx("div",{className:"text-xs text-slate-500",children:z.cashier})]}),a.jsx("td",{className:"px-2 py-2 text-right text-slate-900 dark:text-slate-100",children:Se(z.amount)})]},Ae))}),a.jsx("tfoot",{className:"bg-slate-50 dark:bg-slate-700",children:a.jsxs("tr",{children:[a.jsx("td",{colSpan:3,className:"px-2 py-2 text-right font-bold text-slate-900 dark:text-slate-100",children:"T·ªïng ƒë√£ chi"}),a.jsx("td",{className:"px-2 py-2 text-right font-bold text-slate-900 dark:text-slate-100",children:Se(ie)})]})})]})]})]}),a.jsxs("div",{className:"sticky bottom-0 bg-white dark:bg-slate-800 border-t border-slate-200 dark:border-slate-700 p-4 flex justify-end gap-3",children:[a.jsx("button",{type:"button",onClick:g,className:"px-6 py-2 border border-slate-300 dark:border-slate-600 rounded-lg text-slate-700 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-slate-700",children:"ƒê√ìNG"}),a.jsx("button",{type:"submit",className:"px-6 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium",children:"L∆ØU"})]})]}),a.jsx(oa,{isOpen:ne,onClose:()=>$(!1),onSave:Ne,initialData:q==="edit"?{name:w,phone:k,address:"",email:""}:void 0,mode:q}),a.jsx(la,{isOpen:ce,onClose:()=>he(!1),onAdd:J,currentBranchId:p})]})})},da=({transactions:x})=>{const g=Os(),{data:h=[]}=wn(),[p,w]=V.useState("7days"),[m,k]=V.useState(Or(new Date,!0)),[P,B]=V.useState(Or(new Date,!0)),[C,R]=V.useState(""),[_,ne]=V.useState(null),{currentBranchId:$}=os(),q=V.useMemo(()=>{console.log("üì¶ [InventoryHistorySection] T·ªïng s·ªë giao d·ªãch:",x.length);let I=x.filter(oe=>oe.type==="Nh·∫≠p kho");console.log("üì¶ [InventoryHistorySection] Giao d·ªãch 'Nh·∫≠p kho':",I.length);const W=new Date;switch(p){case"7days":const oe=new Date(W.getTime()-6048e5);I=I.filter(U=>new Date(U.date)>=oe);break;case"30days":const re=new Date(W.getTime()-720*60*60*1e3);I=I.filter(U=>new Date(U.date)>=re);break;case"thisMonth":const S=new Date(W.getFullYear(),W.getMonth(),1);I=I.filter(U=>new Date(U.date)>=S);break;case"custom":I=I.filter(U=>{const M=new Date(U.date);return M>=new Date(m)&&M<=new Date(P)});break}if(C){const oe=C.toLowerCase();I=I.filter(re=>re.partName.toLowerCase().includes(oe)||re.notes&&re.notes.toLowerCase().includes(oe))}return I.sort((oe,re)=>new Date(re.date).getTime()-new Date(oe.date).getTime())},[x,p,m,P,C]),K=V.useMemo(()=>q.reduce((I,W)=>I+W.totalPrice,0),[q]),ce=V.useMemo(()=>{const I=new Map;return q.forEach(W=>{var M,xe;const oe=new Date(W.date),re=`${oe.getFullYear()}-${String(oe.getMonth()+1).padStart(2,"0")}-${String(oe.getDate()).padStart(2,"0")}`,S=(M=W.notes)!=null&&M.includes("NCC:")?(xe=W.notes.split("NCC:")[1])==null?void 0:xe.trim():"Kh√¥ng x√°c ƒë·ªãnh",U=`${re}_${S}_${oe.getHours()}_${oe.getMinutes()}`;I.has(U)||I.set(U,[]),I.get(U).push(W)}),Array.from(I.entries()).map(([W,oe],re)=>{var xe,pe,G;const S=oe[0],U=new Date(S.date);let M="";if(S.notes){const ie=S.notes.match(/NH-\d{8}-\d{3}/);ie&&(M=ie[0])}return M||(M=`NH-${`${U.getFullYear()}${String(U.getMonth()+1).padStart(2,"0")}${String(U.getDate()).padStart(2,"0")}`}-${String(I.size-re).padStart(3,"0")}`),{receiptCode:M,date:S.date,supplier:(xe=S.notes)!=null&&xe.includes("NCC:")?(G=(pe=S.notes.split("NCC:")[1])==null?void 0:pe.split("|")[0])==null?void 0:G.trim():"Kh√¥ng x√°c ƒë·ªãnh",items:oe,total:oe.reduce((ie,ge)=>ie+ge.totalPrice,0)}}).sort((W,oe)=>new Date(oe.date).getTime()-new Date(W.date).getTime())},[q]),[he,X]=V.useState(new Set);return a.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-lg shadow-sm border border-slate-200 dark:border-slate-700",children:[a.jsxs("div",{className:"p-3 sm:p-6 border-b border-slate-200 dark:border-slate-700",children:[a.jsx("h2",{className:"text-lg sm:text-xl font-bold text-slate-900 dark:text-slate-100 mb-3 sm:mb-4",children:"L·ªãch s·ª≠ nh·∫≠p kho"}),a.jsx("div",{className:"flex flex-wrap gap-2 mb-3 sm:mb-4",children:[{key:"7days",label:"7 ng√†y qua"},{key:"30days",label:"30 ng√†y qua"},{key:"thisMonth",label:"Th√°ng n√†y"},{key:"custom",label:"T√πy ch·ªçn"}].map(I=>a.jsx("button",{onClick:()=>w(I.key),className:`px-3 py-1.5 sm:px-4 sm:py-2 rounded-lg text-sm sm:text-base font-medium transition-colors ${p===I.key?"bg-blue-600 text-white":"bg-slate-100 dark:bg-slate-700 text-slate-700 dark:text-slate-300 hover:bg-slate-200 dark:hover:bg-slate-600"}`,children:I.label},I.key))}),p==="custom"&&a.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 sm:gap-4 mb-3 sm:mb-4",children:[a.jsxs("div",{className:"flex-1",children:[a.jsx("label",{className:"block text-xs sm:text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"T·ª´ ng√†y"}),a.jsx("input",{type:"date",value:m,onChange:I=>k(I.target.value),className:"w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100 text-sm sm:text-base"})]}),a.jsxs("div",{className:"flex-1",children:[a.jsx("label",{className:"block text-xs sm:text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"ƒê·∫øn ng√†y"}),a.jsx("input",{type:"date",value:P,onChange:I=>B(I.target.value),className:"w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100 text-sm sm:text-base"})]})]}),a.jsx("input",{type:"text",placeholder:"Nh√† cung c·∫•p, SKU, t√™n ph·ª• t√πng...",value:C,onChange:I=>R(I.target.value),className:"w-full px-3 py-2 sm:px-4 sm:py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100 text-sm sm:text-base"})]}),a.jsx("div",{className:"px-3 py-3 sm:px-6 sm:py-4 bg-slate-50 dark:bg-slate-900 border-b border-slate-200 dark:border-slate-700",children:a.jsxs("div",{className:"flex justify-between items-center",children:[a.jsxs("div",{className:"text-xs sm:text-sm text-slate-600 dark:text-slate-400",children:["T·ªïng s·ªë ti·ªÅn:"," ",a.jsx("span",{className:"text-base sm:text-lg font-bold text-slate-900 dark:text-slate-100",children:ce.length})]}),a.jsxs("div",{className:"text-right",children:[a.jsx("div",{className:"text-xs sm:text-sm text-slate-600 dark:text-slate-400",children:"T·ªïng gi√° tr·ªã"}),a.jsx("div",{className:"text-base sm:text-lg font-bold text-blue-600",children:Se(K)})]})]})}),a.jsxs("div",{className:"divide-y divide-slate-200 dark:divide-slate-700",children:[ce.length>0&&a.jsxs("div",{className:"hidden md:grid grid-cols-12 gap-4 px-4 py-3 bg-slate-100 dark:bg-slate-700 border-b border-slate-200 dark:border-slate-600 sticky top-0 z-10",children:[a.jsx("div",{className:"col-span-1 text-xs font-semibold text-slate-600 dark:text-slate-300"}),a.jsx("div",{className:"col-span-2 text-xs font-semibold text-slate-600 dark:text-slate-300",children:"M√£ phi·∫øu"}),a.jsx("div",{className:"col-span-2 text-xs font-semibold text-slate-600 dark:text-slate-300",children:"Nh√† cung c·∫•p"}),a.jsx("div",{className:"col-span-4 text-xs font-semibold text-slate-600 dark:text-slate-300",children:"Chi ti·∫øt"}),a.jsx("div",{className:"col-span-2 text-xs font-semibold text-slate-600 dark:text-slate-300",children:"Thanh to√°n"}),a.jsx("div",{className:"col-span-1 text-xs font-semibold text-slate-600 dark:text-slate-300",children:"Thao t√°c"})]}),ce.length===0?a.jsxs("div",{className:"px-3 py-8 sm:px-6 sm:py-12 text-center text-slate-500",children:[a.jsx("div",{className:"text-4xl sm:text-6xl mb-4",children:"üì¶"}),a.jsx("div",{className:"text-sm sm:text-base",children:"Kh√¥ng c√≥ d·ªØ li·ªáu"})]}):ce.map(I=>{var pe,G,ie,ge,j,Ce,J;const W=new Date(I.date),oe=W.toLocaleDateString("vi-VN",{day:"2-digit",month:"2-digit",year:"numeric"}),re=W.toLocaleTimeString("vi-VN",{hour:"2-digit",minute:"2-digit"}),S=h.find(Ne=>{var Oe;return(Oe=Ne.description)==null?void 0:Oe.includes(I.receiptCode)}),U=S?S.totalAmount-S.remainingAmount:I.total,M=(S==null?void 0:S.remainingAmount)||0,xe=M>0;return a.jsxs("div",{className:"p-4 hover:bg-slate-50 dark:hover:bg-slate-700/50 transition-colors",children:[a.jsxs("div",{className:"md:hidden flex flex-col gap-3 bg-white dark:bg-slate-800/60 rounded-2xl border border-slate-200 dark:border-slate-700 p-4 shadow-sm",children:[a.jsxs("div",{className:"flex items-start justify-between gap-3",children:[a.jsxs("div",{children:[a.jsxs("div",{className:"flex items-center gap-2 text-sm font-semibold text-cyan-600 dark:text-cyan-300",children:["üì¶ ",I.receiptCode]}),a.jsxs("div",{className:"text-xs text-slate-500 dark:text-slate-400 flex items-center gap-1 mt-1",children:["üìÖ"," ",a.jsxs("span",{children:[oe," ¬∑ ",re]})]})]}),a.jsxs("div",{className:"text-right",children:[a.jsx("div",{className:"text-xs text-slate-500 dark:text-slate-400",children:"T·ªïng ti·ªÅn"}),a.jsx("div",{className:"text-lg font-bold text-slate-900 dark:text-white",children:Se(I.total)})]})]}),a.jsxs("div",{className:"flex items-center gap-3 bg-slate-50 dark:bg-slate-900/30 rounded-2xl p-3",children:[a.jsx("div",{className:"w-12 h-12 rounded-full bg-orange-100 dark:bg-orange-900/30 flex items-center justify-center text-orange-600 dark:text-orange-200 font-semibold text-lg",children:"üè¢"}),a.jsxs("div",{children:[a.jsx("div",{className:"text-base font-semibold text-slate-900 dark:text-white",children:I.supplier}),((pe=I.items[0].notes)==null?void 0:pe.includes("Phone:"))&&a.jsxs("div",{className:"text-xs text-slate-500 dark:text-slate-400",children:["üìû ",(G=I.items[0].notes.split("Phone:")[1])==null?void 0:G.trim()]})]})]}),a.jsx("div",{className:"space-y-2",children:I.items.map((Ne,Oe)=>a.jsxs("div",{className:"flex items-start justify-between text-sm text-slate-700 dark:text-slate-200",children:[a.jsxs("div",{children:[a.jsxs("span",{className:"font-semibold",children:[Ne.quantity," x ",Ne.partName]}),a.jsxs("div",{className:"text-xs text-slate-400",children:[Se(Ne.unitPrice||0)," / s·∫£n ph·∫©m"]})]}),a.jsx("span",{className:"font-bold text-slate-900 dark:text-white",children:Se(Ne.quantity*(Ne.unitPrice||0))})]},Ne.id))}),a.jsx("div",{className:"flex flex-wrap gap-2",children:xe?a.jsxs("span",{className:"inline-flex items-center gap-1 px-3 py-1 rounded-full text-xs font-semibold bg-orange-100 text-orange-700 dark:bg-orange-900/30 dark:text-orange-200",children:["‚ö†Ô∏è C√≤n n·ª£ ",Se(M)]}):a.jsx("span",{className:"inline-flex items-center gap-1 px-3 py-1 rounded-full text-xs font-semibold bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-200",children:"‚úì ƒê√£ thanh to√°n"})}),a.jsx("div",{className:"flex flex-wrap gap-2 pt-3 border-t border-dashed border-slate-200 dark:border-slate-700",children:a.jsx("button",{onClick:()=>ne({...I,date:new Date(I.date)}),className:"flex-1 min-w-[120px] px-3 py-2 rounded-xl bg-slate-100 dark:bg-slate-800 text-slate-700 dark:text-slate-200 text-sm font-medium",children:"Ch·ªânh s·ª≠a"})})]}),a.jsxs("div",{className:"hidden md:grid grid-cols-12 gap-4 items-start",children:[a.jsx("div",{className:"col-span-1 flex items-start pt-1",children:a.jsx("input",{type:"checkbox",checked:he.has(I.receiptCode),onChange:Ne=>{const Oe=new Set(he);Ne.target.checked?Oe.add(I.receiptCode):Oe.delete(I.receiptCode),X(Oe)},className:"w-4 h-4 rounded border-slate-300"})}),a.jsx("div",{className:"col-span-2",children:a.jsxs("div",{className:"space-y-1",children:[a.jsx("div",{className:"text-sm font-bold text-cyan-600 dark:text-cyan-400",children:I.receiptCode}),a.jsxs("div",{className:"text-xs text-slate-500 dark:text-slate-400",children:[oe," ",re]}),a.jsxs("div",{className:"text-xs text-slate-600 dark:text-slate-300",children:[a.jsx("span",{className:"font-medium",children:"NV:"})," ",((j=(ge=(ie=I.items[0].notes)==null?void 0:ie.split("NV:")[1])==null?void 0:ge.split("NCC:")[0])==null?void 0:j.trim())||"Xu√¢n Nhan"]})]})}),a.jsx("div",{className:"col-span-2",children:a.jsxs("div",{className:"space-y-1",children:[a.jsx("div",{className:"text-sm font-semibold text-slate-900 dark:text-slate-100",children:I.supplier}),((Ce=I.items[0].notes)==null?void 0:Ce.includes("Phone:"))&&a.jsxs("div",{className:"text-xs text-slate-500 dark:text-slate-400",children:["üìû ",(J=I.items[0].notes.split("Phone:")[1])==null?void 0:J.trim()]})]})}),a.jsx("div",{className:"col-span-4",children:a.jsx("div",{className:"space-y-1",children:I.items.map((Ne,Oe)=>a.jsxs("div",{className:"text-xs text-slate-700 dark:text-slate-300",children:[a.jsxs("span",{className:"font-medium",children:[Ne.quantity," x"]})," ",Ne.partName,a.jsxs("span",{className:"text-slate-400 ml-1",children:["(",Se(Ne.unitPrice||0),")"]})]},Ne.id))})}),a.jsx("div",{className:"col-span-2",children:a.jsxs("div",{className:"space-y-1",children:[a.jsx("div",{className:"text-xs text-slate-600 dark:text-slate-400",children:"T·ªïng ti·ªÅn:"}),a.jsx("div",{className:"text-base font-bold text-slate-900 dark:text-white",children:Se(I.total)}),xe?a.jsxs("div",{className:"mt-2 space-y-1",children:[a.jsxs("div",{className:"text-xs text-green-600 dark:text-green-400",children:["ƒê√£ tr·∫£: ",Se(U)]}),a.jsxs("div",{className:"text-xs font-semibold text-red-600 dark:text-red-400",children:["C√≤n n·ª£: ",Se(M)]}),a.jsx("div",{className:"inline-flex items-center gap-1 px-2 py-1 rounded text-xs font-medium bg-orange-100 text-orange-700 dark:bg-orange-900/30 dark:text-orange-300",children:"‚ö†Ô∏è C√≤n n·ª£"})]}):a.jsx("div",{className:"mt-2",children:a.jsx("div",{className:"inline-flex items-center gap-1 px-2 py-1 rounded text-xs font-medium bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-300",children:"‚úì ƒê√£ thanh to√°n"})})]})}),a.jsx("div",{className:"col-span-1",children:a.jsx("button",{onClick:()=>ne({...I,date:new Date(I.date)}),className:"p-1.5 text-blue-400 hover:bg-blue-500/20 rounded transition-colors",title:"Ch·ªânh s·ª≠a",children:a.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})})})})]})]},I.receiptCode)})]}),a.jsx("div",{className:"px-6 py-4 border-t border-slate-200 dark:border-slate-700",children:a.jsxs("div",{className:"text-sm text-slate-600 dark:text-slate-400",children:["Hi·ªÉn th·ªã ",ce.length," phi·∫øu nh·∫≠p"]})}),_&&a.jsx(ca,{receipt:_,onClose:()=>ne(null),onSave:async I=>{var W,oe,re,S,U,M,xe,pe,G;try{const ie=new Set(_.items.map(J=>J.id)),ge=new Set(I.items.filter(J=>!J.id.startsWith("new-")).map(J=>J.id)),j=Array.from(ie).filter(J=>!ge.has(J));for(const J of j){const Ne=_.items.find(Ue=>Ue.id===J);if(!Ne)continue;const{data:Oe,error:Qe}=await dt.from("parts").select("stock").eq("id",Ne.partId).single();if(Qe)throw new Error(`Kh√¥ng th·ªÉ l·∫•y th√¥ng tin ph·ª• t√πng: ${Qe.message}`);if(Oe){const Je=(((W=Oe.stock)==null?void 0:W[$])||0)-Ne.quantity;if(Je<0)throw new Error(`Kh√¥ng th·ªÉ x√≥a s·∫£n ph·∫©m "${Ne.partName}" v√¨ s·∫Ω l√†m t·ªìn kho √¢m`);const{error:z}=await dt.from("parts").update({stock:{...Oe.stock,[$]:Je}}).eq("id",Ne.partId);if(z)throw new Error(`Kh√¥ng th·ªÉ c·∫≠p nh·∫≠t t·ªìn kho: ${z.message}`)}const{error:rt}=await dt.from("inventory_transactions").delete().eq("id",J);if(rt)throw new Error(`Kh√¥ng th·ªÉ x√≥a giao d·ªãch: ${rt.message}`)}for(const J of I.items){if(J.id.startsWith("new-"))continue;const Ne=_.items.find(Qe=>Qe.id===J.id),{error:Oe}=await dt.from("inventory_transactions").update({quantity:J.quantity,unitPrice:J.unitPrice,totalPrice:J.totalPrice,notes:`NV:${((S=(re=(oe=I.items[0].notes)==null?void 0:oe.split("NV:")[1])==null?void 0:re.split("NCC:")[0])==null?void 0:S.trim())||"Xu√¢n Nhan"} NCC:${I.supplier}${I.supplierPhone?` Phone:${I.supplierPhone}`:""}`}).eq("id",J.id);if(Oe)throw Oe;if(Ne&&Ne.quantity!==J.quantity){const Qe=J.quantity-Ne.quantity,{data:rt,error:Ue}=await dt.from("parts").select("stock, id").eq("id",Ne.partId).single();if(Ue)throw new Error(`Kh√¥ng th·ªÉ l·∫•y th√¥ng tin ph·ª• t√πng: ${Ue.message}`);if(rt){const Je=((U=rt.stock)==null?void 0:U[$])||0,z=Je+Qe;if(z<0)throw new Error(`Kh√¥ng th·ªÉ gi·∫£m s·ªë l∆∞·ª£ng v√¨ s·∫Ω l√†m t·ªìn kho √¢m (hi·ªán c√≥: ${Je})`);const{error:Ae}=await dt.from("parts").update({stock:{...rt.stock,[$]:z}}).eq("id",rt.id);if(Ae)throw new Error(`Kh√¥ng th·ªÉ c·∫≠p nh·∫≠t t·ªìn kho: ${Ae.message}`)}}}const Ce=I.items.filter(J=>J.id.startsWith("new-"));for(const J of Ce){const{data:Ne,error:Oe}=await dt.from("parts").select("stock, id").eq("id",J.partId).single();if(Oe)throw new Error(`Kh√¥ng th·ªÉ l·∫•y th√¥ng tin ph·ª• t√πng: ${Oe.message}`);if(Ne){const Ue=(((M=Ne.stock)==null?void 0:M[$])||0)+J.quantity,{error:Je}=await dt.from("parts").update({stock:{...Ne.stock,[$]:Ue}}).eq("id",Ne.id);if(Je)throw new Error(`Kh√¥ng th·ªÉ c·∫≠p nh·∫≠t t·ªìn kho: ${Je.message}`)}const{error:Qe}=await dt.from("inventory_transactions").insert({type:"Nh·∫≠p kho",partId:J.partId,partName:J.partName,quantity:J.quantity,date:_.date.toISOString(),unitPrice:J.unitPrice,totalPrice:J.totalPrice,branchId:$,notes:`NV:${((G=(pe=(xe=I.items[0].notes)==null?void 0:xe.split("NV:")[1])==null?void 0:pe.split("NCC:")[0])==null?void 0:G.trim())||"Xu√¢n Nhan"} NCC:${I.supplier}${I.supplierPhone?` Phone:${I.supplierPhone}`:""}`});if(Qe)throw new Error(`Kh√¥ng th·ªÉ t·∫°o giao d·ªãch m·ªõi: ${Qe.message}`)}be.success(`ƒê√£ c·∫≠p nh·∫≠t phi·∫øu nh·∫≠p kho (${I.items.length} s·∫£n ph·∫©m)`),g.invalidateQueries({queryKey:["inventoryTransactions"]}),g.invalidateQueries({queryKey:["partsRepo"]}),g.invalidateQueries({queryKey:["partsRepoPaged"]}),ne(null)}catch(ie){be.error(`L·ªói c·∫≠p nh·∫≠t: ${ie.message||"Kh√¥ng r√µ"}`)}},currentBranchId:$})]})},ka=()=>{var ut;const{currentBranchId:x}=os(),{mutateAsync:g}=xi(),h=fi(),{data:p=[]}=gi({branchId:x}),[w,m]=V.useState("stock"),[k,P]=V.useState(!1),[B,C]=V.useState(""),[R,_]=V.useState("all"),[ne,$]=V.useState("all"),[q,K]=V.useState(!1),[ce,he]=V.useState(1),[X,I]=V.useState(20),[W,oe]=V.useState([]),[re,S]=V.useState(null),[U,M]=V.useState(!1),[xe,pe]=V.useState(null),[G,ie]=V.useState(!1),[ge,j]=V.useState(null),Ce=v=>{if(!v)return"#94a3b8";let Q=0;for(let we=0;we<v.length;we++)Q=v.charCodeAt(we)+((Q<<5)-Q);const me=(Q&16777215).toString(16).toUpperCase();return`#${"00000".substring(0,6-me.length)+me}`},{confirm:J,confirmState:Ne,handleConfirm:Oe,handleCancel:Qe}=ci(),{data:rt,isLoading:Ue,isError:Je}=fn({page:ce,pageSize:X,search:B,category:R==="all"?void 0:R}),z=(rt==null?void 0:rt.data)||[],Ae=((ut=rt==null?void 0:rt.meta)==null?void 0:ut.total)||0,le=Math.max(1,Math.ceil(Ae/X)),{data:Ve,refetch:Ge}=Xr({queryKey:["allPartsForTotals",x,B,R],queryFn:async()=>{console.log("üîÑ Fetching allPartsForTotals...");let v=dt.from("parts").select("id, name, sku, stock, costPrice, retailPrice").order("name");if(R&&R!=="all"&&(v=v.eq("category",R)),B&&B.trim()){const we=B.trim();v=v.or(`name.ilike.%${we}%,sku.ilike.%${we}%`)}const{data:Q,error:me}=await v;if(me)throw me;return console.log(`‚úÖ Fetched ${(Q==null?void 0:Q.length)||0} parts`),Q||[]},staleTime:5e3}),ot=V.useMemo(()=>{if(!Ve)return{totalProducts:0,inStock:0,lowStock:0,outOfStock:0};const v={totalProducts:Ve.length,inStock:0,lowStock:0,outOfStock:0},Q=x||"";return Ve.forEach(me=>{var Pe;const we=((Pe=me.stock)==null?void 0:Pe[Q])||0;we>0&&(v.inStock+=1),we===0&&(v.outOfStock+=1),we>0&&we<=ur&&(v.lowStock+=1)}),v},[Ve,x]),Wt=V.useMemo(()=>[{id:"all",label:"T·∫•t c·∫£",description:"To√†n b·ªô kho",count:ot.totalProducts,variant:"neutral"},{id:"in-stock",label:"C√≤n h√†ng",description:"> 0",count:ot.inStock,variant:"success"},{id:"low-stock",label:"S·∫Øp h·∫øt",description:`<= ${ur}`,count:ot.lowStock,variant:"warning"},{id:"out-of-stock",label:"H·∫øt h√†ng",description:"= 0",count:ot.outOfStock,variant:"danger"}],[ot]),T=V.useMemo(()=>{if(!Ve)return new Set;const v=new Map;Ve.forEach(me=>{const we=v.get(me.name)||0;v.set(me.name,we+1)});const Q=new Set(Array.from(v.entries()).filter(([me,we])=>we>1).map(([me,we])=>me));return console.log(`üîç Detected ${Q.size} duplicate product names from ${Ve.length} parts`),Q.size>0&&console.log("Duplicate names:",Array.from(Q).slice(0,5)),Q},[Ve]),de=V.useCallback(v=>T.has(v),[T]),{data:se}=Xr({queryKey:["duplicateParts",x,Array.from(T)],queryFn:async()=>{if(T.size===0)return[];console.log(`üîç Fetching all duplicate parts for ${T.size} names...`);const{data:v,error:Q}=await dt.from("parts").select("*").in("name",Array.from(T)).order("name");if(Q)throw Q;return console.log(`‚úÖ Found ${(v==null?void 0:v.length)||0} parts with duplicate names`),v||[]},enabled:q&&T.size>0,staleTime:5e3}),ke=V.useMemo(()=>{const v=q&&T.size>0?se||[]:z;if(ne==="all")return v;const Q=x||"";return v.filter(me=>{var Pe;const we=((Pe=me.stock)==null?void 0:Pe[Q])||0;return ne==="in-stock"?we>0:ne==="low-stock"?we>0&&we<=ur:ne==="out-of-stock"?we===0:!0})},[z,q,T,se,ne,x]);V.useEffect(()=>{q&&T.size===0&&K(!1)},[q,T.size]);const _e=V.useMemo(()=>Ve?Ve.reduce((v,Q)=>{var me;return v+(((me=Q.stock)==null?void 0:me[x])||0)},0):0,[Ve,x]),st=V.useMemo(()=>Ve?Ve.reduce((v,Q)=>{var Pe,Te;const me=((Pe=Q.stock)==null?void 0:Pe[x])||0,we=((Te=Q.costPrice)==null?void 0:Te[x])||0;return v+me*we},0):0,[Ve,x]),ht=Os(),De=ii();Ms();const Be=ai(),{data:Cr=[]}=js(),{profile:ue}=mn(),xr=V.useCallback(async(v,Q,me,we,Pe)=>{const Te=new Date,Ct=Te.toISOString().split("T")[0].replace(/-/g,""),_t=`NH-${Ct}-${Math.floor(Math.random()*1e3).toString().padStart(3,"0")}`;console.log("üì¶ Saving goods receipt:",{receiptCode:_t,supplierId:Q,totalAmount:me,paymentInfo:Pe,itemCount:v.length});const{data:Xt}=await dt.from("suppliers").select("name").eq("id",Q).single(),mt=(Xt==null?void 0:Xt.name)||"Kh√¥ng x√°c ƒë·ªãnh",Vt=(Pe==null?void 0:Pe.paidAmount)||0,$e=me-Vt;try{if(await h.mutateAsync({items:v.map(ze=>({partId:ze.partId,partName:ze.partName,quantity:ze.quantity,importPrice:ze.importPrice,sellingPrice:ze.sellingPrice,wholesalePrice:ze.wholesalePrice||0})),supplierId:Q,branchId:x,userId:(ue==null?void 0:ue.id)||"unknown",notes:`${_t} | NCC: ${mt}${we?" | "+we:""}`}),$e>0&&Pe){const ze=`DEBT-${Ct}-${Math.random().toString(36).substring(2,5).toUpperCase()}`,{error:Mt}=await dt.from("supplier_debts").insert({id:ze,supplier_id:Q,supplier_name:mt,branch_id:x,total_amount:$e,paid_amount:0,remaining_amount:$e,description:`Nh·∫≠p kho ${_t} - Thanh to√°n ${Vt.toLocaleString()}/${me.toLocaleString()} ƒë`,created_date:Te.toISOString().split("T")[0],created_at:Te.toISOString()});Mt?(console.error("‚ùå Error creating debt:",Mt),be.error("L·ªói t·∫°o c√¥ng n·ª£: "+Mt.message)):console.log(`‚úÖ Created supplier debt: ${$e.toLocaleString()} ƒë`)}P(!1),be.success(`Nh·∫≠p kho th√†nh c√¥ng! M√£ phi·∫øu: ${_t}`),Ss((ue==null?void 0:ue.id)||null,{action:"inventory.receipt",tableName:"inventory_transactions",oldData:null,newData:{receiptCode:_t,supplierId:Q,supplierName:mt,items:v.map(ze=>({partId:ze.partId,quantity:ze.quantity,importPrice:ze.importPrice,sellingPrice:ze.sellingPrice})),totalAmount:me,paidAmount:Vt,debtAmount:$e,paymentInfo:Pe}})}catch(ze){console.error("üõë L·ªói l∆∞u phi·∫øu nh·∫≠p kho:",ze),be.error(`L·ªói: ${ze.message||"Kh√¥ng r√µ"}`)}},[Ve,x,De,g,ue==null?void 0:ue.id]),zr=v=>{oe(v?ke.map(Q=>Q.id):[])},Kt=(v,Q)=>{oe(Q?[...W,v]:W.filter(me=>me!==v))},Nr=async v=>{const Q=z.find(we=>we.id===v);!Q||!await J({title:"X√°c nh·∫≠n x√≥a",message:`B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a s·∫£n ph·∫©m "${Q.name}"?`,confirmText:"X√≥a",cancelText:"H·ªßy",confirmColor:"red"})||Be.mutate({id:v},{onSuccess:async()=>{oe(we=>we.filter(Pe=>Pe!==v)),await Ge(),console.log("üîÑ Refetched allPartsForTotals after delete"),be.success(`ƒê√£ x√≥a ph·ª• t√πng "${Q.name}"`)},onError:we=>{console.error("Delete error:",we),be.error(`Kh√¥ng th·ªÉ x√≥a: ${we.message}`)}})},Ut=async()=>{if(W.length===0){be.warning("Vui l√≤ng ch·ªçn √≠t nh·∫•t m·ªôt s·∫£n ph·∫©m");return}if(!await J({title:"X√°c nh·∫≠n x√≥a",message:`B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a ${W.length} s·∫£n ph·∫©m ƒë√£ ch·ªçn? H√†nh ƒë·ªông n√†y kh√¥ng th·ªÉ ho√†n t√°c.`,confirmText:"X√≥a",cancelText:"H·ªßy",confirmColor:"red"}))return;let Q=0,me=0;const we=W.length;W.forEach((Pe,Te)=>{Be.mutate({id:Pe},{onSuccess:async()=>{Q++,Q+me===we&&(await Ge(),console.log("üîÑ Refetched allPartsForTotals after bulk delete"),me===0?be.success(`ƒê√£ x√≥a ${Q} ph·ª• t√πng`):be.warning(`ƒê√£ x√≥a ${Q}/${we} ph·ª• t√πng (${me} l·ªói)`))},onError:Ct=>{console.error(`Delete error for item ${Pe}:`,Ct),me++,Q+me===we&&(Q===0?be.error(`Kh√¥ng th·ªÉ x√≥a ${we} ph·ª• t√πng`):be.warning(`ƒê√£ x√≥a ${Q}/${we} ph·ª• t√πng (${me} l·ªói)`))}})}),oe([])},yr=v=>{he(1),$(v)},Qt=v=>{he(1),_(v)},vt=()=>{$("all"),_("all"),K(!1),he(1),ie(!1)},Mr=ne!=="all"||R!=="all"||q,Ar=ot.lowStock>0&&ne!=="low-stock",ls=ot.totalProducts>0?Math.round(ot.lowStock/ot.totalProducts*100):0,lt=()=>{try{const v=new Date,Q=`ton-kho-${v.getDate()}-${v.getMonth()+1}-${v.getFullYear()}.xlsx`;Ni(z,x,Q),be.success("Xu·∫•t file Excel th√†nh c√¥ng!")}catch(v){console.error("Export error:",v),be.error("C√≥ l·ªói khi xu·∫•t file Excel")}},ae=()=>{try{yi(),be.success("T·∫£i template th√†nh c√¥ng! Vui l√≤ng ƒëi·ªÅn th√¥ng tin v√† import l·∫°i.")}catch(v){console.error("Template download error:",v),be.error("C√≥ l·ªói khi t·∫£i template")}};return V.useEffect(()=>{if(typeof document>"u")return;const v=()=>j(null);return document.addEventListener("click",v),()=>document.removeEventListener("click",v)},[]),a.jsxs("div",{className:"h-full flex flex-col bg-slate-50 dark:bg-slate-900 sm:bg-[#1e293b]",children:[a.jsx("div",{className:"hidden sm:block bg-primary-bg border-b border-primary-border px-4 py-3",children:a.jsxs("div",{className:"flex items-center justify-between gap-4",children:[a.jsx("div",{className:"flex gap-2",children:[{key:"stock",label:"T·ªìn kho",icon:a.jsx(Es,{className:"w-4 h-4"})},{key:"categories",label:"Danh m·ª•c",icon:a.jsx(rs,{className:"w-4 h-4"})},{key:"lookup",label:"Tra c·ª©u",icon:a.jsx(ss,{className:"w-4 h-4"})},{key:"history",label:"L·ªãch s·ª≠",icon:a.jsx(ks,{className:"w-4 h-4"})}].map(v=>a.jsx("button",{onClick:()=>m(v.key),className:`px-4 py-2 rounded-lg font-medium transition-colors ${w===v.key?"bg-blue-600 text-white":"text-secondary-text hover:bg-tertiary-bg"}`,children:a.jsxs("span",{className:"inline-flex items-center gap-1",children:[v.icon,v.label]})},v.key))}),a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsxs("button",{onClick:()=>P(!0),className:"flex items-center gap-2 px-5 py-2.5 rounded-xl bg-gradient-to-r from-blue-600 to-blue-500 text-white font-semibold shadow-lg shadow-blue-500/30 hover:brightness-110 transition",children:[a.jsx(vs,{className:"w-4 h-4"}),"T·∫°o phi·∫øu nh·∫≠p"]}),a.jsxs("div",{className:"flex items-center gap-1 rounded-2xl border border-primary-border bg-tertiary-bg px-1.5 py-1",children:[a.jsxs("button",{onClick:()=>{be.info("T√≠nh nƒÉng chuy·ªÉn kho ƒëang ph√°t tri·ªÉn")},className:"p-2 rounded-xl text-secondary-text hover:text-blue-600 hover:bg-primary-bg transition",title:"Chuy·ªÉn kho",children:[a.jsx($s,{className:"w-4 h-4"}),a.jsx("span",{className:"sr-only",children:"Chuy·ªÉn kho"})]}),a.jsxs("button",{onClick:lt,className:"p-2 rounded-xl text-secondary-text hover:text-emerald-600 hover:bg-primary-bg transition",title:"Xu·∫•t Excel",children:[a.jsx(wi,{className:"w-4 h-4"}),a.jsx("span",{className:"sr-only",children:"Xu·∫•t Excel"})]}),a.jsxs("button",{onClick:()=>M(!0),className:"p-2 rounded-xl text-secondary-text hover:text-blue-600 hover:bg-primary-bg transition",title:"Nh·∫≠p CSV",children:[a.jsx(pi,{className:"w-4 h-4"}),a.jsx("span",{className:"sr-only",children:"Nh·∫≠p CSV"})]}),a.jsxs("button",{onClick:ae,className:"p-2 rounded-xl text-secondary-text hover:text-amber-600 hover:bg-primary-bg transition",title:"T·∫£i m·∫´u import",children:[a.jsx(ks,{className:"w-4 h-4"}),a.jsx("span",{className:"sr-only",children:"T·∫£i template"})]})]})]})]})}),a.jsxs("div",{className:"sm:hidden bg-white dark:bg-slate-800 border-b border-slate-200 dark:border-slate-700 px-3 py-3",children:[a.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[a.jsxs("div",{className:"flex-1 relative",children:[a.jsx(ss,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-400"}),a.jsx("input",{type:"text",placeholder:"T√¨m ki·∫øm theo t√™n ho·∫∑c SKU...",value:B,onChange:v=>{he(1),C(v.target.value)},className:"w-full pl-10 pr-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-slate-900 dark:text-white text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),a.jsxs("button",{onClick:()=>P(!0),className:"flex items-center gap-1.5 px-3 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg text-sm font-medium transition whitespace-nowrap",children:[a.jsx(vs,{className:"w-4 h-4"}),"T·∫°o phi·∫øu"]})]}),a.jsx("div",{className:"flex items-center justify-between text-xs",children:a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsxs("div",{className:"flex items-center gap-1",children:[a.jsx("span",{className:"text-slate-600 dark:text-slate-400",children:"T·ªïng:"}),a.jsxs("span",{className:"font-semibold text-blue-600 dark:text-blue-400",children:[_e.toLocaleString()," sp"]})]}),a.jsx("div",{className:"h-3 w-px bg-slate-300 dark:bg-slate-600"}),a.jsxs("div",{className:"flex items-center gap-1",children:[a.jsx("span",{className:"text-slate-600 dark:text-slate-400",children:"Gi√° tr·ªã:"}),a.jsx("span",{className:"font-semibold text-green-600 dark:text-green-400",children:Se(st)})]})]})})]}),w==="stock"&&a.jsx("div",{className:"hidden sm:block bg-primary-bg border-b border-primary-border px-5 py-5",children:a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"grid gap-4 lg:grid-cols-[minmax(0,1fr)_320px]",children:[a.jsxs("div",{className:"grid gap-4 sm:grid-cols-2",children:[a.jsx("div",{className:"rounded-2xl border border-blue-500/20 bg-gradient-to-r from-blue-500/15 via-blue-500/5 to-transparent p-4 shadow-inner",children:a.jsxs("div",{className:"flex items-center justify-between gap-4",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-xs font-semibold uppercase tracking-wider text-blue-600 dark:text-blue-300",children:"T·ªïng s·ªë l∆∞·ª£ng t·ªìn"}),a.jsxs("p",{className:"mt-2 text-3xl font-bold text-primary-text",children:[_e.toLocaleString()," sp"]}),a.jsxs("p",{className:"text-xs text-secondary-text mt-1",children:[ot.inStock," s·∫£n ph·∫©m c√≤n h√†ng ‚Ä¢"," ",ot.outOfStock," h·∫øt h√†ng"]})]}),a.jsx("div",{className:"p-3 rounded-2xl bg-white/70 dark:bg-slate-900/40 text-blue-600",children:a.jsx(Es,{className:"w-6 h-6"})})]})}),a.jsx("div",{className:"rounded-2xl border border-emerald-500/20 bg-gradient-to-r from-emerald-500/15 via-emerald-500/5 to-transparent p-4 shadow-inner",children:a.jsxs("div",{className:"flex items-center justify-between gap-4",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-xs font-semibold uppercase tracking-wider text-emerald-600 dark:text-emerald-300",children:"T·ªïng gi√° tr·ªã t·ªìn"}),a.jsx("p",{className:"mt-2 text-3xl font-bold text-primary-text",children:Se(st)}),a.jsxs("p",{className:"text-xs text-secondary-text mt-1",children:["Trung b√¨nh"," ",Se(_e>0?st/_e:0)," ","/ s·∫£n ph·∫©m"]})]}),a.jsx("div",{className:"p-3 rounded-2xl bg-white/70 dark:bg-slate-900/40 text-emerald-600",children:a.jsx(rs,{className:"w-6 h-6"})})]})})]}),a.jsxs("div",{className:"flex flex-col gap-3",children:[a.jsxs("div",{className:"relative",children:[a.jsx(ss,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-slate-400"}),a.jsx("input",{type:"text",placeholder:"T√¨m ki·∫øm theo t√™n ho·∫∑c SKU...",value:B,onChange:v=>{he(1),C(v.target.value)},className:"w-full pl-10 pr-12 py-2.5 border border-primary-border rounded-xl bg-primary-bg text-primary-text focus:ring-2 focus:ring-blue-500 focus:border-transparent"}),a.jsxs("span",{className:"absolute right-3 top-1/2 -translate-y-1/2 text-xs text-secondary-text",children:[ke.length,"/",Ae]})]}),a.jsxs("div",{className:"flex items-center justify-end gap-2",children:[a.jsxs("button",{onClick:()=>ie(v=>!v),className:`flex items-center gap-2 px-3 py-2 text-sm font-medium rounded-xl border transition ${G?"border-blue-500 text-blue-600 bg-blue-50 dark:bg-blue-900/20":"border-primary-border text-secondary-text hover:text-primary-text"}`,children:[a.jsx(Ci,{className:"w-4 h-4"}),"B·ªô l·ªçc n√¢ng cao",Mr&&a.jsx("span",{className:"h-2 w-2 rounded-full bg-blue-500 animate-pulse"})]}),Mr&&a.jsx("button",{onClick:vt,className:"px-3 py-2 text-sm font-medium text-red-500 hover:text-red-600",children:"X√≥a b·ªô l·ªçc"})]})]})]}),Ar&&a.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3 rounded-2xl border border-amber-200 bg-amber-50 px-4 py-3 text-amber-900 dark:border-amber-800 dark:bg-amber-950/50 dark:text-amber-200",children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("span",{className:"text-xl",children:"‚ö†Ô∏è"}),a.jsxs("div",{children:[a.jsxs("p",{className:"font-semibold",children:[ot.lowStock," s·∫£n ph·∫©m s·∫Øp h·∫øt h√†ng"]}),a.jsxs("p",{className:"text-xs text-amber-700 dark:text-amber-400",children:["Chi·∫øm ",ls,"% danh m·ª•c hi·ªán t·∫°i"]})]})]}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("button",{onClick:()=>yr("low-stock"),className:"px-3 py-1.5 rounded-lg bg-amber-600 text-white text-sm font-semibold hover:bg-amber-700 transition dark:bg-amber-700 dark:hover:bg-amber-600",children:"L·ªçc nhanh"}),a.jsx("button",{onClick:()=>P(!0),className:"px-3 py-1.5 rounded-lg border border-amber-400 text-sm font-medium text-amber-800 hover:bg-amber-100 transition dark:border-amber-600 dark:text-amber-300 dark:hover:bg-amber-950/30",children:"T·∫°o phi·∫øu nh·∫≠p"})]})]}),a.jsx("div",{className:"grid gap-3 md:grid-cols-2 lg:grid-cols-4",children:Wt.map(v=>{const Q=ne===v.id,me=xn[v.variant??"neutral"]||xn.neutral,we=`text-left rounded-2xl border px-4 py-3 transition focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-blue-500 ${Q?me.buttonActive:me.buttonInactive}`,Pe=`inline-flex items-center justify-center rounded-xl border px-3 py-1 text-xs font-semibold ${Q?me.badgeActive:me.badgeInactive}`;return a.jsxs("button",{onClick:()=>yr(v.id),className:we,children:[a.jsxs("div",{className:"flex items-center justify-between gap-3",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-xs font-semibold uppercase tracking-wider text-secondary-text",children:v.label}),a.jsx("p",{className:"mt-1 text-2xl font-bold text-primary-text",children:(v.count||0).toLocaleString()})]}),a.jsx("span",{className:Pe,children:v.description})]}),a.jsx("p",{className:"mt-2 text-xs text-tertiary-text",children:"Tr·∫°ng th√°i kho t∆∞∆°ng ·ª©ng"})]},v.id)})}),G&&a.jsxs("div",{className:"rounded-2xl border border-primary-border bg-white/70 dark:bg-slate-900/40 p-4 grid gap-4 md:grid-cols-3",children:[a.jsxs("div",{children:[a.jsx("label",{className:"text-xs font-semibold uppercase tracking-wide text-secondary-text",children:"Tr·∫°ng th√°i t·ªìn kho"}),a.jsxs("select",{value:ne,onChange:v=>yr(v.target.value),className:"mt-2 w-full rounded-xl border border-secondary-border bg-primary-bg px-4 py-2.5 text-sm focus:border-blue-500 focus:ring-2 focus:ring-blue-500/40",children:[a.jsx("option",{value:"all",children:"T·∫•t c·∫£ t·ªìn kho"}),a.jsx("option",{value:"in-stock",children:"C√≤n h√†ng"}),a.jsx("option",{value:"low-stock",children:"S·∫Øp h·∫øt"}),a.jsx("option",{value:"out-of-stock",children:"H·∫øt h√†ng"})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"text-xs font-semibold uppercase tracking-wide text-secondary-text",children:"Danh m·ª•c"}),a.jsxs("select",{value:R,onChange:v=>Qt(v.target.value),className:"mt-2 w-full rounded-xl border border-secondary-border bg-primary-bg px-4 py-2.5 text-sm focus:border-blue-500 focus:ring-2 focus:ring-blue-500/40",children:[a.jsx("option",{value:"all",children:"T·∫•t c·∫£ danh m·ª•c"}),Cr.map(v=>a.jsx("option",{value:v.id,children:v.name},v.id))]})]}),a.jsxs("div",{className:"flex flex-col justify-end",children:[a.jsx("label",{className:"text-xs font-semibold uppercase tracking-wide text-secondary-text",children:"Ph√°t hi·ªán tr√πng t√™n"}),a.jsx("button",{onClick:()=>K(v=>!v),className:`mt-2 rounded-xl border px-4 py-2.5 text-sm font-medium transition ${q?"border-orange-500 text-orange-600 bg-orange-50 dark:bg-orange-900/20":"border-secondary-border text-secondary-text hover:text-primary-text"}`,children:q?"ƒêang hi·ªÉn th·ªã s·∫£n ph·∫©m tr√πng t√™n":"L·ªçc s·∫£n ph·∫©m tr√πng t√™n"})]})]})]})}),a.jsxs("div",{className:"flex-1 overflow-y-auto p-3 sm:p-4",children:[w==="stock"&&a.jsxs("div",{className:"space-y-3",children:[T.size>0&&a.jsx("div",{className:"bg-orange-50 dark:bg-orange-900/20 border-l-4 border-orange-500 p-3 rounded-lg",children:a.jsxs("div",{className:"flex items-start gap-2",children:[a.jsx("span",{className:"text-lg",children:"‚ö†Ô∏è"}),a.jsxs("div",{className:"flex-1",children:[a.jsxs("h3",{className:"text-xs font-semibold text-orange-800 dark:text-orange-300 mb-1",children:["Ph√°t hi·ªán ",T.size," s·∫£n ph·∫©m tr√πng t√™n"]}),a.jsx("button",{onClick:()=>K(!q),className:`mt-1 px-2 py-1 rounded text-xs font-medium transition ${q?"bg-orange-600 text-white":"bg-orange-100 dark:bg-orange-900/40 text-orange-800 dark:text-orange-300"}`,children:q?"‚úì ƒêang l·ªçc":"üîç L·ªçc"})]})]})}),a.jsxs("div",{className:"rounded-lg overflow-hidden border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800",children:[W.length>0&&a.jsxs("div",{className:"px-6 py-3 bg-blue-100 dark:bg-blue-900/30 border-b border-primary-border flex items-center justify-between",children:[a.jsxs("div",{className:"text-sm font-medium text-blue-900 dark:text-blue-100",children:["ƒê√£ ch·ªçn ",W.length," s·∫£n ph·∫©m"]}),a.jsxs("button",{onClick:Ut,className:"flex items-center gap-2 px-4 py-2 bg-red-500 hover:bg-red-600 text-white rounded-lg text-sm font-medium transition-colors",children:[a.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})}),"X√≥a ƒë√£ ch·ªçn"]})]}),a.jsx("div",{className:"block sm:hidden",children:a.jsx("div",{className:"space-y-3 p-3",children:ke.map((v,Q)=>{const me=v.stock[x]||0,we=v.retailPrice[x]||0,Pe=me*we,Te=de(v.name),Ct=v.name.split(/[-\s]/).slice(0,2).map(_t=>_t.charAt(0).toUpperCase()).join("");return a.jsxs("div",{className:`flex items-center gap-3 p-3 rounded-xl bg-[#2d3748] border border-slate-600 transition ${Te?"border-l-4 border-l-orange-500":""}`,role:"listitem",children:[a.jsx("div",{className:"w-14 h-14 bg-slate-600 rounded-lg overflow-hidden flex items-center justify-center flex-shrink-0",children:v.imageUrl?a.jsx("img",{src:v.imageUrl,alt:v.name,className:"w-full h-full object-cover"}):a.jsx("div",{className:"w-full h-full flex items-center justify-center",style:{backgroundColor:Ce(v.category)},children:a.jsx("span",{className:"text-lg font-bold text-white/90",children:Ct||a.jsx(rs,{className:"w-6 h-6 text-white opacity-90"})})})}),a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsxs("div",{className:"flex items-start justify-between gap-2",children:[a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsx("div",{className:"text-[15px] font-medium text-white line-clamp-2 leading-tight",children:v.name}),a.jsxs("div",{className:"text-[12px] text-slate-400 mt-1 truncate",children:["SKU: ",v.sku," ‚Ä¢ ",v.category]})]}),a.jsx("div",{className:"text-right flex-shrink-0",children:a.jsx("div",{className:"text-[13px] text-slate-300 font-medium",children:Se(Pe)})})]}),a.jsxs("div",{className:"mt-2 flex items-center justify-between",children:[a.jsxs("span",{className:`inline-flex items-center gap-1 px-2.5 py-1 text-sm font-bold rounded-lg ${me===0?"text-red-300 bg-red-900/40 border border-red-700/50":me<ur?"text-yellow-300 bg-yellow-900/40 border border-yellow-700/50":"text-emerald-300 bg-emerald-900/40 border border-emerald-700/50"}`,children:[a.jsx("span",{className:"text-xs opacity-80",children:"SL:"}),me]}),a.jsxs("div",{className:"relative",children:[a.jsx("button",{onClick:()=>pe(xe===Q?null:Q),"aria-haspopup":"true","aria-expanded":xe===Q,"aria-label":"Th√™m h√†nh ƒë·ªông",className:"p-2.5 -m-1 text-slate-400 hover:bg-slate-600 rounded-lg transition active:bg-slate-500",children:a.jsx(Js,{className:"w-5 h-5"})}),xe===Q&&a.jsxs("div",{className:"absolute right-0 mt-2 w-40 bg-slate-800 border border-slate-700 rounded-lg shadow-xl z-50",children:[a.jsxs("button",{onClick:()=>{S(v),pe(null)},className:"w-full text-left px-3 py-2 text-sm hover:bg-slate-700 flex items-center gap-2 text-white","aria-label":`Ch·ªânh s·ª≠a ${v.name}`,children:[a.jsx(en,{className:"w-4 h-4 text-blue-400"}),a.jsx("span",{children:"Ch·ªânh s·ª≠a"})]}),a.jsxs("button",{onClick:()=>{Nr(v.id),pe(null)},className:"w-full text-left px-3 py-2 text-sm hover:bg-slate-700 flex items-center gap-2 text-red-400","aria-label":`X√≥a ${v.name}`,children:[a.jsx(Qs,{className:"w-4 h-4"}),a.jsx("span",{children:"X√≥a"})]})]})]})]})]})]},v.id)})})}),a.jsx("div",{className:"hidden sm:block overflow-x-auto",children:a.jsxs("table",{className:"w-full",children:[a.jsx("thead",{className:"bg-tertiary-bg",children:a.jsxs("tr",{className:"border-b border-primary-border text-xs font-semibold uppercase tracking-wider text-secondary-text",children:[a.jsx("th",{className:"px-6 py-4 text-center w-12",children:a.jsx("input",{type:"checkbox",checked:W.length===ke.length&&ke.length>0,onChange:v=>zr(v.target.checked),className:"w-4 h-4 text-blue-600 rounded border-secondary-border focus:ring-blue-500"})}),a.jsx("th",{className:"px-6 py-4 text-left",children:"S·∫£n ph·∫©m"}),a.jsx("th",{className:"px-6 py-4 text-center",children:"T·ªìn kho"}),a.jsx("th",{className:"px-6 py-4 text-right",children:"Gi√° nh·∫≠p"}),a.jsx("th",{className:"px-6 py-4 text-right",children:"Gi√° b√°n l·∫ª"}),a.jsx("th",{className:"px-6 py-4 text-right",children:"Gi√° b√°n s·ªâ"}),a.jsx("th",{className:"px-6 py-4 text-right",children:"Gi√° tr·ªã t·ªìn"}),a.jsx("th",{className:"px-6 py-4 text-center w-16",children:"H√†nh ƒë·ªông"})]})}),a.jsx("tbody",{className:"bg-primary-bg divide-y divide-primary-border",children:ke.length===0?a.jsx("tr",{children:a.jsxs("td",{colSpan:8,className:"px-6 py-8 text-center text-tertiary-text",children:[a.jsx("div",{className:"text-6xl mb-4",children:"üóÇÔ∏è"}),a.jsx("div",{className:"text-lg",children:"Kh√¥ng c√≥ s·∫£n ph·∫©m n√†o"}),a.jsx("div",{className:"text-sm",children:"H√£y th·ª≠ m·ªôt b·ªô l·ªçc kh√°c ho·∫∑c th√™m s·∫£n ph·∫©m m·ªõi"})]})}):ke.map(v=>{var At,fr,Dt,Jt,bt,Pt;const Q=x||"",me=((At=v.stock)==null?void 0:At[Q])||0,we=((fr=v.retailPrice)==null?void 0:fr[Q])||0,Pe=((Dt=v.wholesalePrice)==null?void 0:Dt[Q])||0,Te=((Jt=v.costPrice)==null?void 0:Jt[Q])||0,Ct=me*we,_t=W.includes(v.id),Xt=de(v.name),mt=me===0?"border-red-300 bg-red-50 text-red-700 dark:border-red-700 dark:bg-red-950/50 dark:text-red-300":me<=ur?"border-amber-300 bg-amber-50 text-amber-700 dark:border-amber-600 dark:bg-amber-950/50 dark:text-amber-300":"border-emerald-300 bg-emerald-50 text-emerald-700 dark:border-emerald-600 dark:bg-emerald-950/50 dark:text-emerald-300",Vt=me===0?"H·∫øt h√†ng":me<=ur?"S·∫Øp h·∫øt":"·ªîn ƒë·ªãnh",$e=me===0?"text-red-600 dark:text-red-400":me<=ur?"text-amber-600 dark:text-amber-400":"text-emerald-700 dark:text-emerald-400",ze=((Pt=(bt=v.name)==null?void 0:bt.charAt(0))==null?void 0:Pt.toUpperCase())||"?",Mt=_t?"bg-blue-900/20 dark:bg-blue-900/20":Xt?"bg-orange-500/10 border-l-4 border-l-orange-500":"";return a.jsxs("tr",{className:`border-b border-primary-border hover:bg-tertiary-bg transition-colors ${Mt}`,children:[a.jsx("td",{className:"px-6 py-4 text-center",children:a.jsx("input",{type:"checkbox",checked:_t,onChange:et=>Kt(v.id,et.target.checked),className:"w-4 h-4 text-blue-600 rounded border-secondary-border focus:ring-blue-500"})}),a.jsx("td",{className:"px-6 py-4 min-w-[220px]",children:a.jsxs("div",{className:"flex items-center gap-4",children:[a.jsx("div",{className:"h-12 w-12 rounded-xl overflow-hidden flex items-center justify-center text-base font-semibold text-white",style:v.imageUrl?void 0:{backgroundColor:Ce(v.category)},children:v.imageUrl?a.jsx("img",{src:v.imageUrl,alt:v.name,className:"h-full w-full object-cover"}):a.jsx("span",{children:ze})}),a.jsxs("div",{className:"flex flex-col gap-1",children:[a.jsxs("div",{className:"flex items-center gap-2 text-sm font-semibold text-primary-text",children:[v.name,Xt&&a.jsx("span",{className:"inline-flex items-center gap-1 rounded-full border border-orange-300 bg-orange-50 px-2 py-0.5 text-[11px] font-semibold text-orange-700 dark:bg-orange-900/30",title:"S·∫£n ph·∫©m c√≥ t√™n tr√πng l·∫∑p",children:"‚ö†Ô∏è Tr√πng"})]}),a.jsxs("div",{className:"text-xs text-tertiary-text",children:["SKU: ",v.sku||"N/A"]}),a.jsx("div",{className:"text-xs text-tertiary-text",children:v.category||"Ch∆∞a ph√¢n lo·∫°i"})]})]})}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-center",children:a.jsxs("div",{className:"flex flex-col items-center gap-1",children:[a.jsx("span",{className:`text-lg font-semibold ${$e}`,children:me.toLocaleString()}),a.jsxs("span",{className:`inline-flex items-center gap-1 rounded-full border px-2 py-0.5 text-xs font-semibold ${mt}`,children:[a.jsx("span",{className:`h-1.5 w-1.5 rounded-full ${me===0?"bg-red-500":me<=ur?"bg-amber-500":"bg-emerald-500"}`}),Vt]})]})}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm text-secondary-text",children:Se(Te)}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium text-primary-text",children:Se(we)}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm text-secondary-text",children:Se(Pe)}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-semibold text-primary-text",children:Se(Ct)}),a.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-center",children:a.jsxs("div",{className:"relative flex justify-end",children:[a.jsx("button",{onClick:et=>{et.stopPropagation(),j(H=>H===v.id?null:v.id)},className:"rounded-full border border-transparent p-2 text-secondary-text hover:border-secondary-border hover:text-primary-text transition","aria-haspopup":"menu","aria-expanded":ge===v.id,title:"Thao t√°c nhanh",children:a.jsx(Js,{className:"w-5 h-5"})}),ge===v.id&&a.jsxs("div",{className:"absolute right-0 top-full z-10 mt-2 w-44 overflow-hidden rounded-xl border border-primary-border bg-white shadow-xl dark:bg-slate-800",onClick:et=>et.stopPropagation(),children:[a.jsxs("button",{onClick:et=>{et.stopPropagation(),S(v),j(null)},className:"flex w-full items-center gap-2 px-4 py-2 text-left text-sm hover:bg-blue-50 dark:hover:bg-slate-700",children:[a.jsx(en,{className:"h-4 w-4 text-blue-500"}),"Ch·ªânh s·ª≠a"]}),a.jsxs("button",{onClick:et=>{et.stopPropagation(),j(null),Nr(v.id)},className:"flex w-full items-center gap-2 px-4 py-2 text-left text-sm text-red-500 hover:bg-red-50 dark:hover:bg-slate-700/70",children:[a.jsx(Qs,{className:"h-4 w-4"}),"X√≥a"]})]})]})})]},v.id)})})]})}),a.jsxs("div",{className:"flex items-center justify-between px-6 py-4 border-t border-primary-border bg-primary-bg",children:[a.jsxs("div",{className:"text-sm text-secondary-text",children:["Trang ",ce,"/",le," ‚Ä¢ T·ªïng ",Ae," ph·ª• t√πng"]}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("button",{disabled:ce===1||Ue,onClick:()=>he(v=>Math.max(1,v-1)),className:"px-3 py-1.5 border border-secondary-border rounded disabled:opacity-40",children:"‚Üê Tr∆∞·ªõc"}),a.jsx("button",{disabled:ce>=le||Ue,onClick:()=>he(v=>Math.min(le,v+1)),className:"px-3 py-1.5 border border-secondary-border rounded disabled:opacity-40",children:"Sau ‚Üí"}),a.jsx("select",{value:X,onChange:v=>{const Q=Number(v.target.value)||20;I(Q),he(1)},className:"px-2 py-1.5 border border-secondary-border rounded",children:[10,20,50,100].map(v=>a.jsxs("option",{value:v,children:[v,"/trang"]},v))})]})]})]})]}),w==="history"&&a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"hidden sm:block",children:a.jsx(da,{transactions:p})}),a.jsx("div",{className:"sm:hidden",children:a.jsx(na,{transactions:p})})]}),w==="categories"&&a.jsx("div",{className:"bg-[#0f172a] -m-3 sm:-m-6",children:a.jsx(di,{})}),w==="lookup"&&a.jsxs("div",{className:"bg-[#0f172a] -m-3 sm:-m-6",children:[a.jsx("div",{className:"hidden sm:block",children:a.jsx(ui,{})}),a.jsx("div",{className:"sm:hidden",children:a.jsx(Ei,{})})]})]}),a.jsx("div",{className:"hidden sm:block",children:a.jsx(aa,{isOpen:k,onClose:()=>P(!1),parts:Ve||[],currentBranchId:x,onSave:xr})}),a.jsx(ia,{isOpen:k,onClose:()=>P(!1),parts:Ve||[],currentBranchId:x,onSave:xr}),re&&a.jsx(ua,{part:re,onClose:()=>S(null),onSave:v=>{console.log("üíæ Saving part updates:",v);const Q={name:v.name,category:v.category,stock:v.stock,retailPrice:v.retailPrice,wholesalePrice:v.wholesalePrice};v.costPrice&&(Q.costPrice=v.costPrice),console.log("üì§ Sending updates:",Q),De.mutate({id:v.id,updates:Q}),S(null)},currentBranchId:x}),U&&a.jsx(ha,{onClose:()=>M(!1),onDownloadTemplate:ae,onImport:async v=>{var Q,me;try{const{items:we,errors:Pe}=await Ai(v,x);if(we.length===0){const H=Pe.length?`Kh√¥ng import ƒë∆∞·ª£c: ${Pe.slice(0,3).join("; ")}`:"File kh√¥ng c√≥ d·ªØ li·ªáu h·ª£p l·ªá";throw new Error(H)}const Te=we.map(H=>H.sku);console.log(`üîç Checking ${Te.length} SKUs...`);const Ct=new Map;Te.forEach(H=>{Ct.set(H,(Ct.get(H)||0)+1)});const _t=Array.from(Ct.entries()).filter(([H,qe])=>qe>1).map(([H,qe])=>`${H}(${qe}x)`);_t.length>0&&console.warn(`‚ö†Ô∏è Duplicate SKUs in file: ${_t.slice(0,5).join(", ")}`);const Xt=Array.from(new Set(Te)),mt=100,Vt=[];for(let H=0;H<Xt.length;H+=mt){const qe=Xt.slice(H,H+mt),{data:Rt,error:pt}=await dt.from("parts").select("*").in("sku",qe);if(pt)throw console.error(`‚ùå Fetch chunk ${H/mt+1} error:`,pt),new Error(`L·ªói ki·ªÉm tra ph·ª• t√πng: ${pt.message}`);Rt&&Vt.push(...Rt)}console.log(`‚úÖ Found ${Vt.length} existing parts`);const $e=new Map(Vt.map(H=>[H.sku,H])),ze=[],Mt=[],At=[],fr=new Set;let Dt=0,Jt=0,bt=0;const Pt=new Date().toISOString();for(const H of we){if(fr.has(H.sku)){console.warn(`‚ö†Ô∏è Skipping duplicate SKU in file: ${H.sku}`),bt++;continue}fr.add(H.sku);const qe=$e.get(H.sku);if(qe)Jt+=1,Mt.push({id:qe.id,stock:{...qe.stock,[x]:(qe.stock[x]||0)+H.quantity},costPrice:{...qe.costPrice,[x]:H.costPrice},retailPrice:{...qe.retailPrice,[x]:H.retailPrice},wholesalePrice:{...qe.wholesalePrice,[x]:H.wholesalePrice}}),At.push({type:"Nh·∫≠p kho",date:Pt,branchId:x,partId:qe.id,partName:H.name,quantity:H.quantity,unitPrice:H.retailPrice,totalPrice:H.quantity*H.retailPrice,notes:"Nh·∫≠p kho t·ª´ file Excel"});else{Dt+=1;const Rt=((Q=crypto==null?void 0:crypto.randomUUID)==null?void 0:Q.call(crypto))||`${Math.random().toString(36).slice(2)}-${Date.now()}`;ze.push({id:Rt,name:H.name,sku:H.sku,category:H.category,description:H.description,stock:{[x]:H.quantity},costPrice:{[x]:H.costPrice},retailPrice:{[x]:H.retailPrice},wholesalePrice:{[x]:H.wholesalePrice}}),At.push({type:"Nh·∫≠p kho",date:Pt,branchId:x,partId:Rt,partName:H.name,quantity:H.quantity,unitPrice:H.retailPrice,totalPrice:H.quantity*H.retailPrice,notes:"Nh·∫≠p kho t·ª´ file Excel"})}}if(ze.length>0){const{data:H,error:qe}=await dt.from("parts").insert(ze).select();if(qe)throw console.error("‚ùå Batch create error:",qe),new Error(`L·ªói t·∫°o ph·ª• t√πng: ${qe.message}`);console.log(`‚úÖ Created ${(H==null?void 0:H.length)||0} parts`)}if(Mt.length>0){let H=0,qe=0;for(const Rt of Mt){const{error:pt}=await dt.from("parts").update({stock:Rt.stock,costPrice:Rt.costPrice,retailPrice:Rt.retailPrice,wholesalePrice:Rt.wholesalePrice}).eq("id",Rt.id);pt?(console.error(`‚ùå Update error for part ${Rt.id}:`,pt),qe++):H++}console.log(`‚úÖ Updated ${H}/${Mt.length} parts`)}if(At.length>0){const{error:H}=await dt.from("inventory_transactions").insert(At);H&&console.warn("‚ö†Ô∏è Inventory transactions error:",H)}ht.invalidateQueries({queryKey:["partsRepo"]}),ht.invalidateQueries({queryKey:["partsRepoPaged"]});try{const{data:H}=await dt.auth.getUser();await Ss(((me=H==null?void 0:H.user)==null?void 0:me.id)||null,{action:"inventory.import",tableName:"inventory_transactions",oldData:null,newData:{totalRows:we.length+Pe.length,created:Dt,updated:Jt,skipped:Pe.length,sampleErrors:Pe.slice(0,10),branchId:x,at:Pt}})}catch{}M(!1);let et=`Import: t·∫°o m·ªõi ${Dt}, c·∫≠p nh·∫≠t ${Jt}`;bt>0&&(et+=`, b·ªè qua ${bt} SKU tr√πng`),Pe.length>0&&(et+=`, ${Pe.length} d√≤ng l·ªói`),be.success(et)}catch(we){console.error("‚ùå Import error:",we),be.error(`L·ªói import: ${we}`)}}}),a.jsx(hi,{isOpen:Ne.isOpen,title:Ne.title,message:Ne.message,confirmText:Ne.confirmText,cancelText:Ne.cancelText,confirmColor:Ne.confirmColor,onConfirm:Oe,onCancel:Qe}),a.jsxs("div",{className:"sm:hidden fixed bottom-20 right-4 z-40 flex flex-col gap-3",children:[a.jsx("button",{onClick:()=>P(!0),className:"w-14 h-14 bg-gradient-to-br from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white rounded-full shadow-lg shadow-green-500/30 flex items-center justify-center transition-all transform hover:scale-110 active:scale-95","aria-label":"T·∫°o phi·∫øu nh·∫≠p",children:a.jsx(vs,{className:"w-5 h-5"})}),a.jsx("button",{onClick:lt,className:"w-14 h-14 bg-gradient-to-br from-orange-500 to-orange-600 hover:from-orange-600 hover:to-orange-700 text-white rounded-full shadow-lg shadow-orange-500/30 flex items-center justify-center transition-all transform hover:scale-110 active:scale-95","aria-label":"Xu·∫•t Excel",children:a.jsx($s,{className:"w-5 h-5"})})]}),a.jsxs("div",{className:"sm:hidden fixed bottom-0 left-0 right-0 bg-white dark:bg-slate-800 border-t border-slate-200 dark:border-slate-700 z-50 safe-area-bottom",children:[a.jsx("div",{className:"absolute inset-0 bg-white/80 dark:bg-slate-800/80 backdrop-blur-lg -z-10"}),a.jsxs("div",{className:"grid grid-cols-4 gap-1 px-2 py-2",children:[a.jsxs("button",{onClick:()=>m("stock"),className:`flex flex-col items-center gap-1 px-2 py-2 rounded-xl transition-all duration-200 ${w==="stock"?"bg-amber-100 dark:bg-amber-900/40 text-amber-600 dark:text-amber-400 scale-105":"text-slate-500 dark:text-slate-400 active:scale-95"}`,children:[a.jsx(Es,{className:`w-5 h-5 ${w==="stock"?"scale-110":""} transition-transform`}),a.jsx("span",{className:`text-[10px] font-medium ${w==="stock"?"font-semibold":""}`,children:"T·ªìn kho"})]}),a.jsxs("button",{onClick:()=>m("categories"),className:`flex flex-col items-center gap-1 px-2 py-2 rounded-xl transition-all duration-200 ${w==="categories"?"bg-purple-100 dark:bg-purple-900/40 text-purple-600 dark:text-purple-400 scale-105":"text-slate-500 dark:text-slate-400 active:scale-95"}`,children:[a.jsx(rs,{className:`w-5 h-5 ${w==="categories"?"scale-110":""} transition-transform`}),a.jsx("span",{className:`text-[10px] font-medium ${w==="categories"?"font-semibold":""}`,children:"Danh m·ª•c"})]}),a.jsxs("button",{onClick:()=>m("lookup"),className:`flex flex-col items-center gap-1 px-2 py-2 rounded-xl transition-all duration-200 ${w==="lookup"?"bg-blue-100 dark:bg-blue-900/40 text-blue-600 dark:text-blue-400 scale-105":"text-slate-500 dark:text-slate-400 active:scale-95"}`,children:[a.jsx(ss,{className:`w-5 h-5 ${w==="lookup"?"scale-110":""} transition-transform`}),a.jsx("span",{className:`text-[10px] font-medium ${w==="lookup"?"font-semibold":""}`,children:"Tra c·ª©u"})]}),a.jsxs("button",{onClick:()=>m("history"),className:`flex flex-col items-center gap-1 px-2 py-2 rounded-xl transition-all duration-200 ${w==="history"?"bg-green-100 dark:bg-green-900/40 text-green-600 dark:text-green-400 scale-105":"text-slate-500 dark:text-slate-400 active:scale-95"}`,children:[a.jsx(ks,{className:`w-5 h-5 ${w==="history"?"scale-110":""} transition-transform`}),a.jsx("span",{className:`text-[10px] font-medium ${w==="history"?"font-semibold":""}`,children:"L·ªãch s·ª≠"})]})]})]})]})},ha=({onClose:x,onDownloadTemplate:g,onImport:h})=>{const[p,w]=V.useState(null),[m,k]=V.useState(!1),P=C=>{var _,ne;const R=(_=C.target.files)==null?void 0:_[0];if(R){const $=(ne=R.name.split(".").pop())==null?void 0:ne.toLowerCase();$==="xlsx"||$==="xls"||$==="csv"?w(R):be.warning("Vui l√≤ng ch·ªçn file Excel (.xlsx, .xls) ho·∫∑c CSV (.csv)")}},B=async()=>{if(!p){be.warning("Vui l√≤ng ch·ªçn file ƒë·ªÉ import");return}k(!0);try{await h(p)}finally{k(!1)}};return a.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:a.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-lg shadow-xl max-w-2xl w-full",children:[a.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-slate-200 dark:border-slate-700",children:[a.jsx("h2",{className:"text-xl font-semibold text-slate-900 dark:text-slate-100",children:"Nh·∫≠p t·ªìn kho t·ª´ Excel/CSV"}),a.jsx("button",{onClick:x,disabled:m,className:"text-slate-400 hover:text-slate-600 dark:hover:text-slate-200 disabled:opacity-50",children:a.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),a.jsxs("div",{className:"p-6 space-y-6",children:[a.jsx("div",{className:"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4",children:a.jsxs("div",{className:"flex items-start gap-3",children:[a.jsx("svg",{className:"w-6 h-6 text-blue-600 dark:text-blue-400 flex-shrink-0 mt-0.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),a.jsxs("div",{className:"flex-1",children:[a.jsx("h3",{className:"font-medium text-blue-900 dark:text-blue-100 mb-2",children:"H∆∞·ªõng d·∫´n s·ª≠ d·ª•ng"}),a.jsxs("ol",{className:"text-sm text-blue-800 dark:text-blue-200 space-y-1 list-decimal list-inside",children:[a.jsx("li",{children:"T·∫£i file template m·∫´u"}),a.jsx("li",{children:"ƒêi·ªÅn th√¥ng tin s·∫£n ph·∫©m v√†o file"}),a.jsx("li",{children:"L∆∞u file v√† ch·ªçn ƒë·ªÉ import"})]}),a.jsx("button",{onClick:g,className:"mt-3 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg text-sm font-medium transition-colors",children:"üì• T·∫£i Template Excel"})]})]})}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:"Ch·ªçn file ƒë·ªÉ import"}),a.jsxs("div",{className:"border-2 border-dashed border-slate-300 dark:border-slate-600 rounded-lg p-6 text-center",children:[a.jsx("input",{type:"file",accept:".xlsx,.xls,.csv",onChange:P,disabled:m,className:"hidden",id:"file-upload"}),a.jsxs("label",{htmlFor:"file-upload",className:"cursor-pointer inline-flex flex-col items-center",children:[a.jsx("svg",{className:"w-12 h-12 text-slate-400 mb-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})}),a.jsx("span",{className:"text-sm text-slate-600 dark:text-slate-400",children:"Click ƒë·ªÉ ch·ªçn file Excel ho·∫∑c CSV"}),p&&a.jsxs("span",{className:"mt-2 text-sm font-medium text-blue-600 dark:text-blue-400",children:["‚úì ",p.name]})]})]})]}),a.jsxs("div",{className:"flex justify-end gap-3",children:[a.jsx("button",{type:"button",onClick:x,disabled:m,className:"px-4 py-2 border border-slate-300 dark:border-slate-600 text-slate-700 dark:text-slate-300 rounded-lg hover:bg-slate-50 dark:hover:bg-slate-700 transition-colors disabled:opacity-50",children:"H·ªßy"}),a.jsx("button",{onClick:B,disabled:!p||m,className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:m?"ƒêang x·ª≠ l√Ω...":"Import"})]})]})]})})},ua=({part:x,onClose:g,onSave:h,currentBranchId:p})=>{var $,q;const[w,m]=V.useState({name:x.name,category:x.category||"",retailPrice:x.retailPrice[p]||0,wholesalePrice:(($=x.wholesalePrice)==null?void 0:$[p])||0,costPrice:((q=x.costPrice)==null?void 0:q[p])||0,stock:x.stock[p]||0}),{data:k=[]}=js(),P=pn(),[B,C]=V.useState(!1),[R,_]=V.useState(""),ne=K=>{if(K.preventDefault(),!w.name.trim()){be.warning("Vui l√≤ng nh·∫≠p t√™n s·∫£n ph·∫©m");return}h({id:x.id,name:w.name.trim(),category:w.category.trim()||void 0,stock:{...x.stock,[p]:w.stock},costPrice:{...x.costPrice,[p]:w.costPrice},retailPrice:{...x.retailPrice,[p]:w.retailPrice},wholesalePrice:{...x.wholesalePrice,[p]:w.wholesalePrice}})};return a.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:a.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[a.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-slate-200 dark:border-slate-700",children:[a.jsx("h2",{className:"text-xl font-semibold text-slate-900 dark:text-slate-100",children:"Ch·ªânh s·ª≠a s·∫£n ph·∫©m"}),a.jsx("button",{onClick:g,className:"text-slate-400 hover:text-slate-600 dark:hover:text-slate-200",children:a.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),a.jsxs("form",{onSubmit:ne,className:"p-6 space-y-4",children:[a.jsxs("div",{children:[a.jsxs("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:["T√™n s·∫£n ph·∫©m ",a.jsx("span",{className:"text-red-500",children:"*"})]}),a.jsx("input",{type:"text",value:w.name,onChange:K=>m({...w,name:K.target.value}),className:"w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100",required:!0})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"Danh m·ª•c"}),a.jsxs("div",{className:"flex flex-col gap-2",children:[a.jsxs("div",{className:"flex gap-2",children:[a.jsxs("select",{value:w.category,onChange:K=>m({...w,category:K.target.value}),className:"flex-1 px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100",children:[a.jsx("option",{value:"",children:"-- Ch·ªçn ho·∫∑c t·∫°o m·ªõi --"}),k.map(K=>a.jsx("option",{value:K.name,children:K.name},K.id))]}),a.jsx("button",{type:"button",onClick:()=>C(!0),className:"px-3 py-2 bg-white dark:bg-slate-700 border border-slate-300 dark:border-slate-600 rounded-lg hover:bg-slate-50 dark:hover:bg-slate-600",title:"Th√™m danh m·ª•c m·ªõi",children:"+"})]}),B&&a.jsxs("form",{onSubmit:async K=>{K.preventDefault();const ce=R.trim();if(!ce)return be.warning("Vui l√≤ng nh·∫≠p t√™n danh m·ª•c");try{const he=await P.mutateAsync({name:ce});m({...w,category:he.name}),_(""),C(!1)}catch(he){be.error((he==null?void 0:he.message)||"L·ªói t·∫°o danh m·ª•c")}},className:"flex gap-2",children:[a.jsx("input",{autoFocus:!0,type:"text",value:R,onChange:K=>_(K.target.value),placeholder:"Nh·∫≠p t√™n danh m·ª•c m·ªõi",className:"flex-1 px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-sm text-slate-900 dark:text-slate-100"}),a.jsx("button",{type:"submit",className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg text-sm font-medium",children:"L∆∞u"}),a.jsx("button",{type:"button",onClick:()=>{C(!1),_("")},className:"px-4 py-2 border border-slate-300 dark:border-slate-600 rounded-lg text-sm bg-white dark:bg-slate-700 text-slate-700 dark:text-slate-300 hover:bg-slate-50 dark:hover:bg-slate-600",children:"H·ªßy"})]})]})]}),a.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"Gi√° nh·∫≠p"}),a.jsx("input",{type:"number",value:w.costPrice||0,onChange:K=>m({...w,costPrice:Number(K.target.value)}),className:"w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100",min:"0"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"Gi√° b√°n l·∫ª"}),a.jsx("input",{type:"number",value:w.retailPrice,onChange:K=>m({...w,retailPrice:Number(K.target.value)}),className:"w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100",min:"0"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"Gi√° b√°n s·ªâ"}),a.jsx("input",{type:"number",value:w.wholesalePrice,onChange:K=>m({...w,wholesalePrice:Number(K.target.value)}),className:"w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100",min:"0"})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"T·ªìn kho hi·ªán t·∫°i"}),a.jsx("input",{type:"number",value:w.stock,onChange:K=>m({...w,stock:Number(K.target.value)}),className:"w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100",min:"0"}),a.jsx("p",{className:"mt-1 text-xs text-slate-500 dark:text-slate-400",children:"S·ªë l∆∞·ª£ng t·ªìn kho t·∫°i chi nh√°nh hi·ªán t·∫°i"})]}),a.jsx("div",{className:"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4",children:a.jsxs("div",{className:"text-sm text-blue-800 dark:text-blue-300",children:[a.jsx("div",{className:"font-medium mb-1",children:"L∆∞u √Ω:"}),a.jsxs("ul",{className:"list-disc list-inside space-y-1",children:[a.jsx("li",{children:"B·∫°n c√≥ th·ªÉ ch·ªânh s·ª≠a tr·ª±c ti·∫øp gi√° nh·∫≠p, gi√° b√°n v√† t·ªìn kho"}),a.jsx("li",{children:'Ho·∫∑c s·ª≠ d·ª•ng "T·∫°o phi·∫øu nh·∫≠p" ƒë·ªÉ ghi nh·∫≠n l·ªãch s·ª≠ nh·∫≠p kho chi ti·∫øt'})]})]})}),a.jsxs("div",{className:"flex justify-end gap-3 pt-4",children:[a.jsx("button",{type:"button",onClick:g,className:"px-4 py-2 border border-slate-300 dark:border-slate-600 text-slate-700 dark:text-slate-300 rounded-lg hover:bg-slate-50 dark:hover:bg-slate-700 transition-colors",children:"H·ªßy"}),a.jsx("button",{type:"submit",className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors",children:"L∆∞u thay ƒë·ªïi"})]})]})]})})};export{ka as default};
